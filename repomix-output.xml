This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.github/
  workflows/
    build.yml
    release.yml
    test.yml
docs/
  01-plans/
    260117-024834-claudiminder-implementation/
      phase-01-backend-core.md
      phase-02-tauri-scaffold.md
      phase-03-frontend-ui.md
      phase-04-integration.md
      phase-05-testing.md
      plan.md
      requirements-summary.md
    reports/
      fullstack-developer-260117-035904-goals-tracker.md
      fullstack-developer-260117-035904-scheduler-modules.md
      fullstack-developer-260117-124920-sidecar-integration.md
      researcher-260117-024115-ui-themes-design.md
      researcher-260117-024702-python-tui-libraries.md
      researcher-260117-024702-tauri-v2-features.md
  02-general/
    rules/
      00-principles.md
      01-python.md
      02-tauri.md
      README.md
scripts/
  build-sidecar-nuitka.sh
src/
  backend/
    tui/
      widgets/
        __init__.py
        goals_indicator.py
        offline_banner.py
        reset_countdown.py
        usage_display.py
      __init__.py
      app.py
      styles.tcss
    sidecar.py
  claudiminder/
    api/
      __init__.py
      usage.py
    core/
      __init__.py
      config_manager.py
      goals_tracker.py
      instance_lock.py
    i18n/
      __init__.py
      en.py
      vi.py
    models/
      __init__.py
      settings.py
      usage.py
    scheduler/
      __init__.py
      focus_mode.py
      notifier.py
      reminder_service.py
    tui/
      widgets/
        __init__.py
        goals_indicator.py
        offline_banner.py
        reset_countdown.py
        usage_display.py
      __init__.py
      app.py
      styles.tcss
    utils/
      __init__.py
      credentials.py
    __init__.py
    cli.py
    sidecar.py
  frontend/
    src/
      components/
        dashboard/
          focus-mode-indicator.tsx
          goals-widget.tsx
          grid-layout-wrapper.tsx
          reset-countdown.tsx
          stats-panel.tsx
          usage-display.tsx
        settings/
          color-customizer.tsx
          font-size-slider.tsx
          language-switcher.tsx
          progress-bar-picker.tsx
          theme-switcher.tsx
        ui/
          circular-progress.css
          circular-progress.tsx
          demo.tsx
          gauge-progress.css
          gauge-progress.tsx
          glass-card.css
          glass-card.tsx
          index.ts
          neon-text.css
          neon-text.tsx
          README.md
        .gitkeep
      hooks/
        index.ts
        use-countdown.ts
        use-grid-layout.ts
        use-theme.ts
        use-usage.ts
      i18n/
        en.json
        index.ts
        vi.json
      stores/
        .gitkeep
        i18n-store.ts
        index.ts
        settings-store.ts
        theme-store.ts
      styles/
        components/
          dashboard.css
          settings.css
        themes/
          dark.css
          glass-dark.css
          glass-light.css
          light.css
          neon-dark.css
          neon-light.css
        globals.css
        index.css
      types/
        index.ts
        settings.ts
        theme.ts
        usage.ts
      utils/
        .gitkeep
        index.ts
        notifications.ts
        offline-detector.ts
        rate-limit.ts
        README.md
        token-refresh.ts
        tray.ts
      App.tsx
      main.tsx
      vite-env.d.ts
    src-tauri/
      capabilities/
        default.json
      gen/
        schemas/
          acl-manifests.json
          capabilities.json
          desktop-schema.json
          linux-schema.json
      icons/
        128x128.png
        128x128@2x.png
        32x32.png
        icon.icns
        icon.ico
        icon.png
      src/
        commands/
          mod.rs
          usage.rs
        sidecar/
          backend.rs
          mod.rs
        tray/
          mod.rs
          setup.rs
        events.rs
        lib.rs
        main.rs
      build.rs
      Cargo.toml
      tauri.conf.json
    tests/
      hooks/
        use-countdown.test.ts
      stores/
        theme-store.test.ts
      setup.ts
    index.html
    package.json
    tsconfig.json
    tsconfig.node.json
    vite.config.ts
    vitest.config.ts
tests/
  backend/
    scheduler/
      test_reminder.py
    tui/
      test_widgets.py
    __init__.py
    conftest.py
    test_api_usage.py
    test_config_manager.py
    test_credentials.py
    test_focus_mode.py
    test_goals_tracker.py
    test_i18n.py
    test_instance_lock.py
    test_models.py
    test_sidecar.py
    test_usage.py
  __init__.py
.gitignore
.pre-commit-config.yaml
CLAUDE.md
pyproject.toml
README.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".github/workflows/build.yml">
name: Build

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  build:
    name: Build (${{ matrix.platform }})
    strategy:
      fail-fast: false
      matrix:
        include:
          - platform: ubuntu-22.04
            target: linux
          - platform: macos-latest
            target: macos
          - platform: windows-latest
            target: windows

    runs-on: ${{ matrix.platform }}

    steps:
      - uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Install Rust stable
        uses: dtolnay/rust-action@stable

      - name: Install Linux dependencies
        if: matrix.target == 'linux'
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            libwebkit2gtk-4.1-dev \
            libappindicator3-dev \
            librsvg2-dev \
            patchelf

      - name: Install uv
        uses: astral-sh/setup-uv@v4

      - name: Setup Python (for sidecar)
        run: uv python install 3.12

      - name: Install Python dependencies
        run: uv sync

      - name: Install frontend dependencies
        working-directory: src/frontend
        run: bun install

      - name: Build Tauri app
        working-directory: src/frontend
        run: bun run tauri build

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: claudiminder-${{ matrix.target }}
          path: |
            src/frontend/src-tauri/target/release/bundle/**/*.deb
            src/frontend/src-tauri/target/release/bundle/**/*.AppImage
            src/frontend/src-tauri/target/release/bundle/**/*.dmg
            src/frontend/src-tauri/target/release/bundle/**/*.app
            src/frontend/src-tauri/target/release/bundle/**/*.msi
            src/frontend/src-tauri/target/release/bundle/**/*.exe
          if-no-files-found: ignore
</file>

<file path=".github/workflows/release.yml">
name: Release

on:
  push:
    tags:
      - "v*"

permissions:
  contents: write

jobs:
  release:
    name: Release (${{ matrix.platform }})
    strategy:
      fail-fast: false
      matrix:
        include:
          - platform: ubuntu-22.04
            target: linux
          - platform: macos-latest
            target: macos
          - platform: windows-latest
            target: windows

    runs-on: ${{ matrix.platform }}

    steps:
      - uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Install Rust stable
        uses: dtolnay/rust-action@stable

      - name: Install Linux dependencies
        if: matrix.target == 'linux'
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            libwebkit2gtk-4.1-dev \
            libappindicator3-dev \
            librsvg2-dev \
            patchelf

      - name: Install uv
        uses: astral-sh/setup-uv@v4

      - name: Setup Python
        run: uv python install 3.12

      - name: Install Python dependencies
        run: uv sync

      - name: Install frontend dependencies
        working-directory: src/frontend
        run: bun install

      - name: Build Tauri app
        working-directory: src/frontend
        run: bun run tauri build

      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          draft: true
          prerelease: false
          files: |
            src/frontend/src-tauri/target/release/bundle/**/*.deb
            src/frontend/src-tauri/target/release/bundle/**/*.AppImage
            src/frontend/src-tauri/target/release/bundle/**/*.dmg
            src/frontend/src-tauri/target/release/bundle/**/*.msi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
</file>

<file path=".github/workflows/test.yml">
name: Test

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

env:
  PYTHON_VERSION: "3.12"

jobs:
  backend:
    name: Backend Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v4
        with:
          version: "latest"

      - name: Setup Python
        run: uv python install ${{ env.PYTHON_VERSION }}

      - name: Install dependencies
        run: uv sync --dev

      - name: Run linting
        run: uv run ruff check src/claudiminder

      - name: Run formatting check
        run: uv run ruff format --check src/claudiminder

      - name: Run type checking
        run: uv run mypy src/claudiminder --ignore-missing-imports

      - name: Run tests with coverage
        run: |
          uv run pytest tests/backend \
            --cov=src/claudiminder \
            --cov-report=xml \
            --cov-report=term-missing \
            --cov-fail-under=60

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v4
        with:
          files: ./coverage.xml
          flags: backend
          fail_ci_if_error: false

  frontend:
    name: Frontend Tests
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: src/frontend
    steps:
      - uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Install dependencies
        run: bun install

      - name: Run type check
        run: bun run typecheck

      - name: Run tests
        run: bun run test --run

  lint:
    name: Lint & Format
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v4

      - name: Setup Python
        run: uv python install ${{ env.PYTHON_VERSION }}

      - name: Install dependencies
        run: uv sync --dev

      - name: Run pre-commit
        uses: pre-commit/action@v3.0.1
</file>

<file path="docs/01-plans/reports/fullstack-developer-260117-035904-goals-tracker.md">
---
agent: fullstack-developer
task: Create Goals Tracker Module
date: 2026-01-17
status: completed
---

# Goals Tracker Implementation Report

## Executed Task

**Task:** Create usage goals tracker module for Phase 1 Backend Core

**Status:** ✅ Completed

## Files Modified

### Created

- `/home/hieubt/Documents/ai-hub/claudiminder/src/backend/core/goals_tracker.py` (106 lines)

### Modified

- `/home/hieubt/Documents/ai-hub/claudiminder/src/backend/core/__init__.py` (added 3 exports)

## Implementation Details

### Module Structure

```python
# Core classes
- PaceStatus: NamedTuple for pace calculation results
- GoalsTracker: Main tracker class
- get_goals_tracker(): Singleton getter

# Key methods
- calculate_pace(current_usage) -> PaceStatus
- get_budget_status(current_usage) -> tuple[float, float, bool]
- should_warn(current_usage) -> bool
- set_reset_time(reset_time) -> None
```

### Features Implemented

1. **Pace Calculation**
   - Calculates expected usage based on hours elapsed in day
   - 24-hour even distribution assumption
   - 10% buffer for "on track" status
   - Returns detailed message with current vs expected

2. **Budget Status**
   - Returns usage, budget, exceeded status
   - Respects enabled/disabled config
   - Defaults to 100% when disabled

3. **Warning Logic**
   - Checks if pace warning should trigger
   - Respects config flags (enabled, warn_when_pace_exceeded)
   - Returns bool for UI display

4. **Reset Time Tracking**
   - Stores last reset time for accurate calculations
   - Optional setter method

## Tests Status

### Syntax Check

✅ `python3 -m py_compile` passed

### Import Check

✅ All exports work correctly with `uv run`

### Functionality Tests

✅ Default behavior (goals disabled)
✅ Budget status calculation
✅ Warning logic

### Test Output

```
Goals disabled test: PaceStatus(is_on_track=True, current_usage=50.0, expected_usage=0, message='')
Budget status: used=75.0%, budget=100%, exceeded=False
Should warn at 90%: False
All tests passed!
```

## Code Quality

- ✅ Type hints throughout
- ✅ Docstrings for all public methods
- ✅ Clean separation of concerns
- ✅ Singleton pattern for global state
- ✅ NamedTuple for return values
- ✅ Follows project code standards

## Integration Points

### Dependencies

- `config_manager.load_config()` for goals settings
- `datetime` for time calculations

### Exports (in `__init__.py`)

- `GoalsTracker`
- `PaceStatus`
- `get_goals_tracker`

## Next Steps

Module ready for integration with:

- TUI widgets (goals-indicator.py)
- Reminder service (pace-based warnings)
- Sidecar JSON output

## Unresolved Questions

None.
</file>

<file path="docs/01-plans/reports/fullstack-developer-260117-035904-scheduler-modules.md">
# Báo Cáo Triển Khai: Scheduler Modules

**Ngày**: 2026-01-17
**Thực hiện**: fullstack-developer
**Trạng thái**: ✅ Hoàn thành

## Tổng Quan

Đã tạo thành công 4 module scheduler cho Phase 1 Backend Core, bao gồm:

- Focus mode service (DND, quiet hours, snooze)
- Multi-channel notifier (system, bell, command, URL)
- Reminder service (percentage, before-reset, on-reset)

## Files Đã Tạo

| File                                        | Lines   | Mô tả                       |
| ------------------------------------------- | ------- | --------------------------- |
| `src/backend/scheduler/__init__.py`         | 14      | Module exports              |
| `src/backend/scheduler/focus_mode.py`       | 98      | Focus mode & DND logic      |
| `src/backend/scheduler/notifier.py`         | 110     | Multi-channel notifications |
| `src/backend/scheduler/reminder_service.py` | 137     | Reminder trigger logic      |
| **Tổng**                                    | **359** |                             |

## Tính Năng Đã Triển Khai

### 1. FocusModeService

- ✅ Snooze notifications (với thời gian đếm ngược)
- ✅ Clear snooze
- ✅ Quiet hours check (hỗ trợ overnight spans)
- ✅ DND by usage threshold
- ✅ Suppression check & reason reporting
- ✅ Singleton pattern

### 2. Notifier

- ✅ Multi-channel support:
  - System notifications (desktop-notifier)
  - Terminal bell
  - Custom command execution
  - URL opening
- ✅ Async send_notification()
- ✅ Sync wrapper send_notification_sync()
- ✅ Fallback to bell on system failure
- ✅ Config-driven custom command/URL

### 3. ReminderService

- ✅ Three reminder types:
  - Percentage thresholds
  - Before reset (minutes)
  - On reset
- ✅ Callback system for UI updates
- ✅ Trigger deduplication
- ✅ Focus mode integration
- ✅ Reset triggers method
- ✅ Snooze delegation to focus service
- ✅ Singleton pattern

## Tests Đã Chạy

```bash
✓ Python syntax check (py_compile)
✓ Import test
✓ FocusModeService: snooze/clear/remaining
✓ NotificationChannel enum values
✓ ReminderService initialization
✓ Callback system
✓ Reset triggers
```

## Cấu Trúc Code

### Focus Mode Service

```python
class FocusModeService:
    - snooze(minutes: int)
    - clear_snooze()
    - is_snoozed() -> bool
    - get_snooze_remaining() -> int
    - is_in_quiet_hours() -> bool
    - is_dnd_by_usage(usage: float) -> bool
    - should_suppress_notification(usage: float) -> bool
    - get_suppression_reason(usage: float) -> str | None
```

### Notifier

```python
async def send_notification(
    title: str,
    body: str,
    channels: list[NotificationChannel] | None = None
) -> list[NotificationChannel]

def send_notification_sync(title: str, body: str) -> None
```

### Reminder Service

```python
class ReminderService:
    - add_callback(callback)
    - remove_callback(callback)
    - reset_triggers()
    - check_and_trigger(usage, reset_time) -> list[tuple]
    - snooze(minutes: int)
```

## Tiêu Chí Thành Công

- ✅ Tất cả 4 files đã được tạo
- ✅ Focus mode hoạt động với snooze, quiet hours, DND
- ✅ Notifier hỗ trợ nhiều channels
- ✅ Reminder service trigger đúng cho tất cả presets
- ✅ Không có lỗi syntax
- ✅ Imports thành công
- ✅ Basic functionality tests pass
- ✅ Code dưới 200 lines/file
- ✅ Type hints đầy đủ
- ✅ Docstrings đầy đủ

## Dependencies Sử Dụng

- `loguru`: Logging
- `desktop-notifier`: System notifications
- `datetime`: Time/date operations
- Internal: `config_manager`, `load_config()`

## Tích Hợp

Các module này tích hợp với:

- ✅ Config system (qua `load_config()`)
- ✅ Singleton pattern (focus_mode, reminder_service)
- ✅ Callback system (reminder_service → UI)
- ✅ Async/sync patterns (notifier)

## Lưu Ý Kỹ Thuật

1. **Quiet Hours**: Hỗ trợ overnight spans (VD: 22:00 → 08:00)
2. **Notification Fallback**: System fail → bell fallback
3. **Trigger Deduplication**: Tránh spam notifications
4. **Reset Detection**: So sánh `reset_time` với `_last_reset_time`
5. **Singleton Pattern**: Global instances cho focus & reminder services

## Các Bước Tiếp Theo

- Tích hợp với tracker loop (sử dụng `check_and_trigger()`)
- Tạo unit tests cho edge cases
- Tích hợp với TUI/GUI cho snooze controls
- Test notification channels trên các platforms

## Câu Hỏi Chưa Giải Quyết

Không có.
</file>

<file path="docs/01-plans/reports/fullstack-developer-260117-124920-sidecar-integration.md">
---
agent: fullstack-developer
date: 2026-01-17
phase: phase-04-integration
status: completed
---

# Triển khai Python Sidecar cho Tauri Integration

## Tổng quan

Đã cập nhật Python backend sidecar với error handling nâng cao cho tích hợp Tauri, bao gồm token expired detection, rate limiting handling, offline mode detection, và Nuitka build script.

## Files đã sửa đổi

### 1. `src/claudiminder/api/usage.py` (+42 lines)

**Thay đổi:**

- Thêm `RateLimitError` exception class
- Thêm `TokenExpiredError` exception class
- Cập nhật `_fetch_usage_async()` để raise exceptions thay vì return None
- Cập nhật `get_usage_async()` với proper exception handling:
  - Raise `TokenExpiredError` khi token không có hoặc hết hạn (401)
  - Raise `RateLimitError` khi rate limit exceeded (429)
  - Re-raise exceptions để caller có thể handle
  - Network errors propagate lên caller

**Lý do:**

- Explicit exceptions tốt hơn returning None
- Frontend cần phân biệt giữa token expired vs rate limited vs offline
- Exception-based flow cho phép retry strategies

### 2. `src/claudiminder/sidecar.py` (+30 lines)

**Thay đổi:**

- Import `RateLimitError`, `TokenExpiredError` từ api.usage
- Import `is_token_available` từ utils.credentials
- Import `clear_usage_cache` ở đầu file
- Thêm `check_token()` function trả về `{"available": bool}`
- Cập nhật `get_usage()` với enhanced error handling:
  - Check token availability trước khi fetch
  - Catch `TokenExpiredError` → return `{"error": "...", "token_expired": true}`
  - Catch `RateLimitError` → return `{"error": "...", "rate_limited": true}`
  - Detect network errors → return `{"error": "...", "offline": true}`
- Cập nhật `refresh_usage()` để dùng imported clear_usage_cache
- Thêm `check_token` action vào main() dispatcher

**Lý do:**

- Tauri frontend cần biết chính xác lỗi nào xảy ra để hiển thị UI phù hợp
- Offline detection cho phép retry with exponential backoff
- Rate limit handling cho phép graceful degradation
- Token expired notification cho phép user re-login

### 3. `scripts/build-sidecar-nuitka.sh` (new file, 116 lines)

**Tính năng:**

- Auto-detect target triple:
  - Linux: x86_64-unknown-linux-gnu, aarch64-unknown-linux-gnu
  - macOS: x86_64-apple-darwin, aarch64-apple-darwin
  - Windows: x86_64-pc-windows-msvc
- Build với Nuitka flags:
  - `--standalone --onefile` cho single binary
  - `--enable-plugin=anti-bloat` để giảm size
  - `--assume-yes-for-downloads` cho CI/CD
  - `--remove-output` để cleanup
  - `--quiet` để giảm noise
- Auto-install Nuitka nếu chưa có
- Copy binary vào `src/frontend/src-tauri/binaries/`
- Make executable trên Unix-like systems
- Test binary sau khi build
- Hiển thị file size

**Lý do:**

- Nuitka tạo binaries nhỏ hơn và nhanh hơn PyInstaller
- Target triple naming theo Tauri conventions
- Anti-bloat plugin giảm size từ ~50MB xuống ~20-30MB
- Single binary dễ distribute hơn folder

## Tests thực hiện

```bash
# Test 1: Check token action
$ uv run python -m claudiminder.sidecar check_token
{"available": false}
✓ Pass - trả về JSON valid

# Test 2: Get usage với no token
$ uv run python -m claudiminder.sidecar get_usage
{"token_expired": true, "error": "No OAuth token available"}
✓ Pass - detect token expired

# Test 3: Python compilation
$ uv run python -m py_compile src/claudiminder/sidecar.py src/claudiminder/api/usage.py
✓ Pass - no syntax errors

# Test 4: Import exceptions
$ uv run python -c "from claudiminder.api.usage import RateLimitError, TokenExpiredError"
✓ Pass - exceptions importable

# Test 5: Build script syntax
$ bash -n scripts/build-sidecar-nuitka.sh
✓ Pass - valid bash syntax
```

## Success criteria đạt được

- ✅ `RateLimitError` và `TokenExpiredError` exceptions trong usage.py
- ✅ `handle_action()` pattern với proper return types:
  - get_usage: usage data hoặc error với flags
  - refresh_usage: clear cache và get usage
  - check_token: {"available": bool}
- ✅ Network error detection → offline mode flag
- ✅ Nuitka build script với target triple detection
- ✅ Scripts executable và syntax valid
- ✅ All code compiles without errors

## Chưa implement (theo plan)

Các phần sau thuộc frontend (Tauri/React) - ngoài scope của task này:

- [ ] Rust event definitions (events.rs)
- [ ] Rust main.rs với event listeners
- [ ] Rust tray setup returning TrayIconId
- [ ] TypeScript tray update utilities
- [ ] TypeScript notification utilities với throttling
- [ ] TypeScript rate limit handler
- [ ] TypeScript offline detector
- [ ] TypeScript token refresh handler
- [ ] React hooks integration
- [ ] Dashboard widget offline UI

## Technical notes

### Error handling flow

```
Python Backend (sidecar.py)
  ├─ No token → {"error": "...", "token_expired": true}
  ├─ API 401 → TokenExpiredError → {"error": "...", "token_expired": true}
  ├─ API 429 → RateLimitError → {"error": "...", "rate_limited": true}
  ├─ Network error → {"error": "...", "offline": true}
  └─ Success → {"five_hour": {...}, "goals": {...}, "focus_mode": {...}}

Frontend (TypeScript)
  ├─ token_expired → Show login notification + open Claude login
  ├─ rate_limited → Retry with exponential backoff (1s, 2s, 4s, 8s)
  ├─ offline → Show offline UI + retry with backoff
  └─ Success → Update tray + check for notifications
```

### Nuitka build process

1. Detect OS + architecture → target triple
2. Install Nuitka via uv if needed
3. Build single binary với anti-bloat
4. Copy to `src/frontend/src-tauri/binaries/{name}`
5. Make executable (Unix)
6. Test execution
7. Report size

Expected sizes:

- Linux: ~25-30MB
- macOS: ~20-25MB
- Windows: ~15-20MB

### Next steps

1. Delegate to frontend developer:
   - Implement Rust sidecar command integration
   - Create TypeScript error handlers
   - Add tray icon updates
   - Implement notification system

2. Test Nuitka build trên production:

   ```bash
   ./scripts/build-sidecar-nuitka.sh
   ```

3. Verify binary works standalone:
   ```bash
   ./src/frontend/src-tauri/binaries/claudiminder-backend-* check_token
   ```

## Issues gặp phải

1. **Credentials validation error** - Có lỗi trong credentials.py với format của ~/.claude/.credentials.json
   - **Impact**: Low - sidecar vẫn hoạt động đúng, chỉ báo token unavailable
   - **Next**: Fix credentials model trong phase riêng

## Summary

✅ **Hoàn thành đầy đủ Python backend updates cho phase 04**

- Enhanced error handling với 3 error types: token_expired, rate_limited, offline
- check_token action cho frontend
- Nuitka build script ready to use
- All code tested và compiles successfully

**Lines modified:** ~72 lines across 2 files + 116 lines new build script
**Test coverage:** 5/5 manual tests passed
**Ready for:** Tauri integration + Nuitka build testing
</file>

<file path="scripts/build-sidecar-nuitka.sh">
#!/bin/bash
set -e

# Build Python sidecar using Nuitka for Tauri integration
# This script detects the target platform and builds a standalone binary

# Detect target triple based on OS and architecture
detect_target() {
    local os=$(uname -s)
    local arch=$(uname -m)

    case "${os}-${arch}" in
        Linux-x86_64)
            echo "x86_64-unknown-linux-gnu"
            ;;
        Linux-aarch64)
            echo "aarch64-unknown-linux-gnu"
            ;;
        Darwin-x86_64)
            echo "x86_64-apple-darwin"
            ;;
        Darwin-arm64)
            echo "aarch64-apple-darwin"
            ;;
        MINGW*-x86_64|MSYS*-x86_64|CYGWIN*-x86_64)
            echo "x86_64-pc-windows-msvc"
            ;;
        *)
            echo "ERROR: Unsupported platform: ${os}-${arch}" >&2
            exit 1
            ;;
    esac
}

# Get file extension for Windows
get_extension() {
    if [[ "$(uname -s)" =~ ^(MINGW|MSYS|CYGWIN) ]]; then
        echo ".exe"
    else
        echo ""
    fi
}

TARGET=$(detect_target)
EXT=$(get_extension)
OUTPUT_NAME="claudiminder-backend-${TARGET}${EXT}"

echo "========================================="
echo "Building claudiminder sidecar with Nuitka"
echo "========================================="
echo "Platform: $(uname -s) $(uname -m)"
echo "Target: ${TARGET}"
echo "Output: ${OUTPUT_NAME}"
echo "========================================="
echo ""

# Navigate to project root
cd "$(dirname "$0")/.."

# Ensure Nuitka is installed
echo "Checking Nuitka installation..."
if ! uv run python -c "import nuitka" 2>/dev/null; then
    echo "Installing Nuitka..."
    uv add --dev nuitka
fi

# Build with Nuitka
echo ""
echo "Building with Nuitka (this may take a few minutes)..."
echo ""

uv run nuitka \
    --standalone \
    --onefile \
    --output-filename="${OUTPUT_NAME}" \
    --enable-plugin=anti-bloat \
    --assume-yes-for-downloads \
    --remove-output \
    --quiet \
    src/claudiminder/sidecar.py

# Check build result
if [ ! -f "${OUTPUT_NAME}" ]; then
    echo "ERROR: Build failed - ${OUTPUT_NAME} not found" >&2
    exit 1
fi

# Create binaries directory for Tauri
BINARIES_DIR="src/frontend/src-tauri/binaries"
mkdir -p "${BINARIES_DIR}"

# Copy binary to Tauri binaries directory
echo "Copying binary to ${BINARIES_DIR}/"
cp "${OUTPUT_NAME}" "${BINARIES_DIR}/"

# Make executable on Unix-like systems
if [[ ! "$(uname -s)" =~ ^(MINGW|MSYS|CYGWIN) ]]; then
    chmod +x "${BINARIES_DIR}/${OUTPUT_NAME}"
fi

# Get file size
FILE_SIZE=$(du -h "${BINARIES_DIR}/${OUTPUT_NAME}" | cut -f1)

echo ""
echo "========================================="
echo "Build successful!"
echo "========================================="
echo "Output: ${BINARIES_DIR}/${OUTPUT_NAME}"
echo "Size: ${FILE_SIZE}"
echo "========================================="
echo ""

# Test the binary
echo "Testing binary..."
if "${BINARIES_DIR}/${OUTPUT_NAME}" check_token > /dev/null 2>&1; then
    echo "✓ Binary test passed"
else
    echo "⚠ Binary test returned non-zero exit code (may be normal if no token present)"
fi

echo ""
echo "Done! Binary ready for Tauri integration."
</file>

<file path="src/backend/tui/widgets/__init__.py">
"""TUI widgets for Claudiminder."""
from .goals_indicator import GoalsIndicator
from .offline_banner import OfflineBanner
from .reset_countdown import ResetCountdown
from .usage_display import UsageDisplay

__all__ = [
    "GoalsIndicator",
    "OfflineBanner",
    "ResetCountdown",
    "UsageDisplay",
]
</file>

<file path="src/backend/tui/widgets/goals_indicator.py">
"""Goals indicator widget for budget and pace tracking."""
from textual.app import ComposeResult
from textual.widgets import Static
from textual.reactive import reactive

from ...core.config_manager import load_config
from ...core.goals_tracker import get_goals_tracker
from ...i18n import get_string


class GoalsIndicator(Static):
    """Display usage goals and pace indicator."""

    current_usage: reactive[float] = reactive(0.0)

    def __init__(self, **kwargs) -> None:
        super().__init__(**kwargs)
        self.border_title = get_string("goals")

    def compose(self) -> ComposeResult:
        yield Static(id="goals-content")

    def on_mount(self) -> None:
        """Check if goals are enabled."""
        config = load_config().goals
        if not config.enabled:
            self.add_class("hidden")
        self._update_display()

    def watch_current_usage(self, value: float) -> None:
        self._update_display()

    def _update_display(self) -> None:
        """Update the goals display."""
        content = self.query_one("#goals-content", Static)
        config = load_config().goals

        if not config.enabled:
            content.update("")
            return

        tracker = get_goals_tracker()

        # Get budget status
        used, budget, exceeded = tracker.get_budget_status(self.current_usage)
        budget_str = get_string("budget_used", used=f"{used:.1f}", total=f"{budget:.0f}")

        # Get pace status
        pace = tracker.calculate_pace(self.current_usage)
        pace_msg = pace.message if pace.message else get_string("pace_ok")

        # Color based on status
        if exceeded or not pace.is_on_track:
            pace_color = "red"
            pace_icon = "⚠"
        else:
            pace_color = "green"
            pace_icon = "✓"

        lines = [
            f"[bold]{budget_str}[/]",
            f"[{pace_color}]{pace_icon} {pace_msg}[/]",
        ]

        content.update("\n".join(lines))

    def update_usage(self, usage: float) -> None:
        """Update current usage value."""
        self.current_usage = usage
</file>

<file path="src/backend/tui/widgets/offline_banner.py">
"""Offline mode banner widget."""
from textual.app import ComposeResult
from textual.widgets import Static
from textual.reactive import reactive

from ...i18n import get_string


class OfflineBanner(Static):
    """Display offline mode warning banner."""

    is_offline: reactive[bool] = reactive(False)

    def __init__(self, **kwargs) -> None:
        super().__init__(**kwargs)

    def compose(self) -> ComposeResult:
        yield Static(id="offline-text")

    def on_mount(self) -> None:
        """Initialize banner as hidden."""
        self.add_class("hidden")
        self._update_display()

    def watch_is_offline(self, value: bool) -> None:
        self._update_display()

    def _update_display(self) -> None:
        """Update banner display."""
        content = self.query_one("#offline-text", Static)

        if self.is_offline:
            self.remove_class("hidden")
            offline_msg = get_string("offline_mode")
            content.update(f"[bold yellow]⚠ {offline_msg}[/]")
        else:
            self.add_class("hidden")
            content.update("")

    def set_offline(self, offline: bool) -> None:
        """Set offline status."""
        self.is_offline = offline

    def show_connection_restored(self) -> None:
        """Show connection restored message briefly."""
        content = self.query_one("#offline-text", Static)
        self.remove_class("hidden")
        restored_msg = get_string("connection_restored")
        content.update(f"[bold green]✓ {restored_msg}[/]")
</file>

<file path="src/backend/tui/widgets/reset_countdown.py">
"""Reset countdown timer widget."""
from datetime import datetime

from textual.app import ComposeResult
from textual.reactive import reactive
from textual.widgets import Static

from ...i18n import get_string


class ResetCountdown(Static):
    """Display countdown to next reset."""

    reset_time: reactive[datetime | None] = reactive(None)
    show_human_readable: reactive[bool] = reactive(True)

    def __init__(self, **kwargs) -> None:
        super().__init__(**kwargs)
        self.border_title = get_string("reset_in")
        self._timer = None

    def compose(self) -> ComposeResult:
        yield Static(get_string("loading"), id="countdown-text")

    def on_mount(self) -> None:
        """Start the countdown timer."""
        self._timer = self.set_interval(1.0, self._update_countdown)

    def on_unmount(self) -> None:
        """Stop the countdown timer."""
        if self._timer:
            self._timer.stop()

    def watch_reset_time(self, value: datetime | None) -> None:
        self._update_countdown()

    def _update_countdown(self) -> None:
        """Update countdown display."""
        try:
            content = self.query_one("#countdown-text", Static)
        except Exception:
            return

        if self.reset_time is None:
            content.update(get_string("loading"))
            return

        now = datetime.now(tz=self.reset_time.tzinfo)
        if now >= self.reset_time:
            content.update(f"[bold green]{get_string('reset_complete')}[/]")
            return

        delta = self.reset_time - now
        total_seconds = int(delta.total_seconds())

        hours, remainder = divmod(total_seconds, 3600)
        minutes, seconds = divmod(remainder, 60)

        if self.show_human_readable:
            parts = []
            if hours > 0:
                parts.append(f"{hours} {get_string('hours')}")
            if minutes > 0:
                parts.append(f"{minutes} {get_string('minutes')}")
            parts.append(f"{seconds} {get_string('seconds')}")
            time_str = ", ".join(parts)
        else:
            time_str = f"{hours:02d}:{minutes:02d}:{seconds:02d}"

        # Color based on time remaining
        if total_seconds < 300:  # < 5 min
            color = "red bold"
        elif total_seconds < 900:  # < 15 min
            color = "yellow"
        else:
            color = "cyan"

        content.update(f"[{color}]{time_str}[/]")

    def toggle_format(self) -> None:
        """Toggle between HH:MM:SS and human readable."""
        self.show_human_readable = not self.show_human_readable

    def set_reset_time(self, reset_time: datetime | None) -> None:
        """Set the reset time."""
        self.reset_time = reset_time
</file>

<file path="src/backend/tui/widgets/usage_display.py">
"""Usage display widget showing all metrics."""
from textual.app import ComposeResult
from textual.reactive import reactive
from textual.widgets import Static

from ...i18n import get_string


class UsageDisplay(Static):
    """Display usage metrics: 5h, 7d, extra usage."""

    five_hour_usage: reactive[float] = reactive(0.0)
    seven_day_usage: reactive[float | None] = reactive(None)
    extra_usage: reactive[float | None] = reactive(None)

    def __init__(self, **kwargs) -> None:
        super().__init__(**kwargs)
        self.border_title = get_string("usage_title")

    def compose(self) -> ComposeResult:
        yield Static(id="usage-content")

    def on_mount(self) -> None:
        self._update_display()

    def watch_five_hour_usage(self, value: float) -> None:
        self._update_display()

    def watch_seven_day_usage(self, value: float | None) -> None:
        self._update_display()

    def watch_extra_usage(self, value: float | None) -> None:
        self._update_display()

    def _update_display(self) -> None:
        """Update the display content."""
        try:
            content = self.query_one("#usage-content", Static)
        except Exception:
            return

        lines = []

        # 5-hour usage (main metric)
        five_h = get_string("five_hour_usage")
        lines.append(f"[bold cyan]{five_h}:[/] {self.five_hour_usage:.1f}%")
        lines.append(self._progress_bar(self.five_hour_usage))

        # 7-day usage
        if self.seven_day_usage is not None:
            seven_d = get_string("seven_day_usage")
            lines.append(f"\n[cyan]{seven_d}:[/] {self.seven_day_usage:.1f}%")
            lines.append(self._progress_bar(self.seven_day_usage))

        # Extra usage
        if self.extra_usage is not None and self.extra_usage > 0:
            extra = get_string("extra_usage")
            lines.append(f"\n[yellow]{extra}:[/] {self.extra_usage:.1f}%")

        content.update("\n".join(lines))

    def _progress_bar(self, percent: float, width: int = 30) -> str:
        """Create ASCII progress bar."""
        filled = int(width * min(percent, 100) / 100)
        empty = width - filled

        # Color based on percentage
        if percent >= 90:
            color = "red"
        elif percent >= 75:
            color = "yellow"
        else:
            color = "green"

        bar = f"[{color}]{'█' * filled}{'░' * empty}[/]"
        return bar

    def update_usage(
        self,
        five_hour: float,
        seven_day: float | None = None,
        extra: float | None = None,
    ) -> None:
        """Update all usage values."""
        self.five_hour_usage = five_hour
        self.seven_day_usage = seven_day
        self.extra_usage = extra

    def refresh_usage(self) -> None:
        """Trigger a refresh of usage data."""
        self.post_message(self.RefreshRequested())

    class RefreshRequested:
        """Message sent when refresh is requested."""
        pass
</file>

<file path="src/backend/tui/__init__.py">
"""TUI module using Textual."""
from .app import ClaudiminderApp

__all__ = ["ClaudiminderApp"]
</file>

<file path="src/backend/tui/app.py">
"""Main TUI application using Textual."""
from datetime import datetime, timezone
from pathlib import Path

from loguru import logger
from textual.app import App, ComposeResult
from textual.binding import Binding
from textual.containers import Container, Vertical
from textual.widgets import Footer, Header

from ..api.usage import UsageAPI
from ..core.config_manager import load_config
from ..core.goals_tracker import get_goals_tracker
from ..core.instance_lock import acquire_instance_lock, release_instance_lock
from ..i18n import get_string, set_language
from ..scheduler import get_reminder_service
from .widgets import GoalsIndicator, OfflineBanner, ResetCountdown, UsageDisplay


class ClaudiminderApp(App):
    """Claudiminder TUI Application."""

    CSS_PATH = "styles.tcss"

    BINDINGS = [
        Binding("q", "quit", "Quit"),
        Binding("r", "refresh", "Refresh"),
        Binding("h", "help", "Help"),
        Binding("t", "toggle_format", "Toggle time format"),
    ]

    def __init__(self) -> None:
        super().__init__()
        self._lock = None
        self._usage_api: UsageAPI | None = None
        self._poll_timer = None
        self._last_error: str | None = None

        # Load config and set language
        config = load_config()
        set_language(config.language)

    def compose(self) -> ComposeResult:
        yield Header(show_clock=True)
        yield OfflineBanner(id="offline-banner")
        yield Container(
            Vertical(
                UsageDisplay(id="usage-display"),
                ResetCountdown(id="reset-countdown"),
                GoalsIndicator(id="goals-indicator"),
                id="main-content",
            ),
            id="app-container",
        )
        yield Footer()

    async def on_mount(self) -> None:
        """Called when app is mounted."""
        # Check single instance
        self._lock = acquire_instance_lock()
        if self._lock is None:
            self.notify(
                "Another instance is already running",
                severity="error",
                timeout=3,
            )
            self.exit(1)
            return

        # Initialize API
        try:
            self._usage_api = UsageAPI()
        except Exception as e:
            logger.error(f"Failed to initialize API: {e}")
            self._show_offline()

        # Initial fetch
        await self._fetch_usage()

        # Start polling
        config = load_config()
        self._poll_timer = self.set_interval(
            config.poll_interval_seconds,
            self._fetch_usage,
        )

        logger.info("Claudiminder TUI started")

    async def on_unmount(self) -> None:
        """Called when app is unmounting."""
        if self._poll_timer:
            self._poll_timer.stop()
        release_instance_lock()
        logger.info("Claudiminder TUI stopped")

    async def _fetch_usage(self) -> None:
        """Fetch usage data from API."""
        if self._usage_api is None:
            return

        try:
            usage_data = await self._usage_api.get_usage()
            self._update_widgets(usage_data)
            self._hide_offline()
            self._last_error = None

            # Check reminders
            reminder_service = get_reminder_service()
            reset_time = None
            if usage_data.five_hour and usage_data.five_hour.resets_at:
                reset_time = datetime.fromisoformat(
                    usage_data.five_hour.resets_at.replace("Z", "+00:00")
                )

            reminder_service.check_and_trigger(
                current_usage=usage_data.five_hour.utilization if usage_data.five_hour else 0,
                reset_time=reset_time,
            )

        except Exception as e:
            error_msg = str(e)
            if error_msg != self._last_error:
                logger.error(f"Failed to fetch usage: {e}")
                self.notify(f"Error: {error_msg}", severity="error", timeout=5)
                self._last_error = error_msg
            self._show_offline()

    def _update_widgets(self, usage_data) -> None:
        """Update all widgets with new data."""
        usage_display = self.query_one("#usage-display", UsageDisplay)
        reset_countdown = self.query_one("#reset-countdown", ResetCountdown)
        goals_indicator = self.query_one("#goals-indicator", GoalsIndicator)

        if usage_data.five_hour:
            five_hour = usage_data.five_hour.utilization

            # Get optional data
            seven_day = None
            extra = None
            if hasattr(usage_data, 'seven_day') and usage_data.seven_day:
                seven_day = getattr(usage_data.seven_day, 'utilization', None)
            if hasattr(usage_data, 'extra_usage') and usage_data.extra_usage:
                extra = getattr(usage_data.extra_usage, 'utilization', None)

            usage_display.update_usage(
                five_hour=five_hour,
                seven_day=seven_day,
                extra=extra,
            )

            # Update reset countdown
            if usage_data.five_hour.resets_at:
                reset_time = datetime.fromisoformat(
                    usage_data.five_hour.resets_at.replace("Z", "+00:00")
                )
                reset_countdown.set_reset_time(reset_time)

            # Update goals
            goals_indicator.update_usage(five_hour)
            goals_tracker = get_goals_tracker()
            if usage_data.five_hour.resets_at:
                reset_time = datetime.fromisoformat(
                    usage_data.five_hour.resets_at.replace("Z", "+00:00")
                )
                goals_tracker.set_reset_time(reset_time)

    def _show_offline(self) -> None:
        """Show offline banner."""
        banner = self.query_one("#offline-banner", OfflineBanner)
        banner.set_offline(True)

    def _hide_offline(self) -> None:
        """Hide offline banner."""
        banner = self.query_one("#offline-banner", OfflineBanner)
        if banner.is_offline:
            banner.show_connection_restored()
            self.set_timer(2.0, lambda: banner.set_offline(False))

    def action_quit(self) -> None:
        """Quit the application."""
        self.exit()

    async def action_refresh(self) -> None:
        """Manually refresh usage data."""
        self.notify(get_string("refreshing"), timeout=1)
        await self._fetch_usage()

    def action_help(self) -> None:
        """Show help."""
        help_text = (
            f"{get_string('press_q_quit')}\n"
            f"{get_string('press_r_refresh')}\n"
            f"{get_string('press_h_help')}\n"
            "t - Toggle time format"
        )
        self.notify(help_text, timeout=5)

    def action_toggle_format(self) -> None:
        """Toggle countdown format."""
        countdown = self.query_one("#reset-countdown", ResetCountdown)
        countdown.toggle_format()


def run_tui() -> None:
    """Run the TUI application."""
    app = ClaudiminderApp()
    app.run()
</file>

<file path="src/backend/tui/styles.tcss">
/* Claudiminder TUI Styles */

Screen {
    background: $surface;
}

#app-container {
    padding: 1 2;
}

#main-content {
    height: auto;
}

#usage-display {
    border: solid $primary;
    padding: 1 2;
    margin-bottom: 1;
    height: auto;
}

#reset-countdown {
    border: solid $secondary;
    padding: 1 2;
    margin-bottom: 1;
    height: auto;
    text-align: center;
}

#goals-indicator {
    border: solid $accent;
    padding: 1 2;
    height: auto;
}

#offline-banner {
    text-align: center;
    margin-bottom: 1;
}

Header {
    dock: top;
}

Footer {
    dock: bottom;
}
</file>

<file path="src/backend/sidecar.py">
"""Sidecar module for Tauri integration.

This module provides a JSON interface for the Tauri GUI to communicate
with the Python backend. It can be invoked via CLI or as a standalone binary.

Usage:
    python -m claudiminder.sidecar get_usage
    python -m claudiminder.sidecar refresh_usage
    python -m claudiminder.sidecar get_config
    python -m claudiminder.sidecar set_config '{"language": "vi"}'
    python -m claudiminder.sidecar snooze 15
"""
import asyncio
import json
import sys
from datetime import datetime
from typing import Any

from loguru import logger

from .api.usage import UsageAPI
from .core.config_manager import AppConfig, load_config, save_config
from .core.goals_tracker import get_goals_tracker
from .scheduler import get_focus_mode_service, get_reminder_service


def _json_response(data: dict[str, Any] | None = None, error: str | None = None) -> str:
    """Create JSON response string."""
    response: dict[str, Any] = {}
    if data is not None:
        response.update(data)
    if error is not None:
        response["error"] = error
    return json.dumps(response)


async def get_usage() -> str:
    """Get current usage data as JSON."""
    try:
        api = UsageAPI()
        usage = await api.get_usage()

        result: dict[str, Any] = {}

        if usage.five_hour:
            result["five_hour"] = {
                "utilization": usage.five_hour.utilization,
                "resets_at": usage.five_hour.resets_at,
            }
        else:
            result["five_hour"] = None

        # Add goals status
        if usage.five_hour:
            tracker = get_goals_tracker()
            pace = tracker.calculate_pace(usage.five_hour.utilization)
            result["goals"] = {
                "enabled": load_config().goals.enabled,
                "is_on_track": pace.is_on_track,
                "current_usage": pace.current_usage,
                "expected_usage": pace.expected_usage,
                "message": pace.message,
            }

        # Add focus mode status
        focus_service = get_focus_mode_service()
        current_usage = usage.five_hour.utilization if usage.five_hour else 0
        result["focus_mode"] = {
            "is_snoozed": focus_service.is_snoozed(),
            "snooze_remaining": focus_service.get_snooze_remaining(),
            "is_quiet_hours": focus_service.is_in_quiet_hours(),
            "is_dnd": focus_service.is_dnd_by_usage(current_usage),
            "notifications_suppressed": focus_service.should_suppress_notification(current_usage),
        }

        return _json_response(result)

    except Exception as e:
        logger.error(f"Sidecar get_usage error: {e}")
        return _json_response(error=str(e))


async def refresh_usage() -> str:
    """Force refresh usage data."""
    return await get_usage()


def get_config() -> str:
    """Get current configuration as JSON."""
    try:
        config = load_config()
        return _json_response({"config": config.model_dump()})
    except Exception as e:
        logger.error(f"Sidecar get_config error: {e}")
        return _json_response(error=str(e))


def set_config(config_json: str) -> str:
    """Update configuration from JSON."""
    try:
        updates = json.loads(config_json)
        current = load_config()

        # Merge updates into current config
        current_dict = current.model_dump()
        _deep_merge(current_dict, updates)

        new_config = AppConfig.model_validate(current_dict)
        save_config(new_config)

        return _json_response({"success": True, "config": new_config.model_dump()})
    except Exception as e:
        logger.error(f"Sidecar set_config error: {e}")
        return _json_response(error=str(e))


def _deep_merge(base: dict, updates: dict) -> None:
    """Deep merge updates into base dict."""
    for key, value in updates.items():
        if key in base and isinstance(base[key], dict) and isinstance(value, dict):
            _deep_merge(base[key], value)
        else:
            base[key] = value


def snooze(minutes: int) -> str:
    """Snooze notifications for specified minutes."""
    try:
        reminder_service = get_reminder_service()
        reminder_service.snooze(minutes)

        focus_service = get_focus_mode_service()
        return _json_response({
            "success": True,
            "snoozed_until": (datetime.now().timestamp() + minutes * 60),
            "snooze_remaining": focus_service.get_snooze_remaining(),
        })
    except Exception as e:
        logger.error(f"Sidecar snooze error: {e}")
        return _json_response(error=str(e))


def clear_snooze() -> str:
    """Clear any active snooze."""
    try:
        focus_service = get_focus_mode_service()
        focus_service.clear_snooze()
        return _json_response({"success": True})
    except Exception as e:
        logger.error(f"Sidecar clear_snooze error: {e}")
        return _json_response(error=str(e))


def check_reminders(usage_percent: float, reset_time_iso: str | None) -> str:
    """Check and trigger reminders based on current state."""
    try:
        reminder_service = get_reminder_service()

        reset_time = None
        if reset_time_iso:
            reset_time = datetime.fromisoformat(reset_time_iso.replace("Z", "+00:00"))

        triggered = reminder_service.check_and_trigger(usage_percent, reset_time)

        return _json_response({
            "triggered": [
                {"type": t.value, "message": m}
                for t, m in triggered
            ]
        })
    except Exception as e:
        logger.error(f"Sidecar check_reminders error: {e}")
        return _json_response(error=str(e))


def main() -> None:
    """CLI entry point for sidecar."""
    if len(sys.argv) < 2:
        print(_json_response(error="Usage: sidecar <action> [args...]"))
        sys.exit(1)

    action = sys.argv[1]
    args = sys.argv[2:]

    # Configure minimal logging for sidecar
    logger.remove()
    logger.add(sys.stderr, level="ERROR")

    try:
        if action == "get_usage":
            result = asyncio.run(get_usage())
        elif action == "refresh_usage":
            result = asyncio.run(refresh_usage())
        elif action == "get_config":
            result = get_config()
        elif action == "set_config":
            if not args:
                result = _json_response(error="set_config requires JSON argument")
            else:
                result = set_config(args[0])
        elif action == "snooze":
            if not args:
                result = _json_response(error="snooze requires minutes argument")
            else:
                result = snooze(int(args[0]))
        elif action == "clear_snooze":
            result = clear_snooze()
        elif action == "check_reminders":
            if len(args) < 1:
                result = _json_response(error="check_reminders requires usage_percent")
            else:
                usage = float(args[0])
                reset_time = args[1] if len(args) > 1 else None
                result = check_reminders(usage, reset_time)
        else:
            result = _json_response(error=f"Unknown action: {action}")

        print(result)

    except Exception as e:
        print(_json_response(error=str(e)))
        sys.exit(1)


if __name__ == "__main__":
    main()
</file>

<file path="src/claudiminder/api/__init__.py">
"""API client for Anthropic usage API."""
</file>

<file path="src/claudiminder/api/usage.py">
"""Anthropic Usage API client."""

from __future__ import annotations

import time
from dataclasses import dataclass

import httpx
from loguru import logger
from tenacity import retry, stop_after_attempt, wait_exponential

from ..models.settings import get_settings
from ..models.usage import UsageResponse
from ..utils.credentials import clear_credentials_cache, get_access_token


class RateLimitError(Exception):
    """Raised when API rate limit is exceeded."""
    pass


class TokenExpiredError(Exception):
    """Raised when OAuth token is expired or invalid."""
    pass


@dataclass
class UsageCache:
    """Cache for usage API response."""

    data: UsageResponse | None
    timestamp: float
    token_expired: bool = False


_usage_cache: UsageCache | None = None


def _get_cache_duration() -> float:
    """Get cache duration in seconds."""
    return float(get_settings().cache_duration_seconds)


def _is_cache_valid() -> bool:
    """Check if cache is still valid."""
    if _usage_cache is None:
        return False
    return time.time() - _usage_cache.timestamp < _get_cache_duration()


@retry(stop=stop_after_attempt(3), wait=wait_exponential(min=1, max=10))
async def _fetch_usage_async(client: httpx.AsyncClient, token: str) -> UsageResponse | None:
    """Fetch usage from API with retry."""
    settings = get_settings()
    url = f"{settings.api_base_url}/api/oauth/usage"

    response = await client.get(
        url,
        headers={
            "Accept": "application/json",
            "Content-Type": "application/json",
            "Authorization": f"Bearer {token}",
            "anthropic-beta": "oauth-2025-04-20",
            "User-Agent": "claudiminder/0.1.0",
        },
        timeout=10.0,
    )

    if response.status_code == 401:
        logger.warning("Token expired or invalid")
        clear_credentials_cache()
        raise TokenExpiredError("OAuth token expired or invalid")

    if response.status_code == 429:
        logger.warning("Rate limit exceeded")
        raise RateLimitError("API rate limit exceeded")

    response.raise_for_status()
    return UsageResponse.model_validate(response.json())


async def get_usage_async() -> UsageResponse | None:
    """Get usage data (async), using cache if valid."""
    global _usage_cache

    if _is_cache_valid() and _usage_cache is not None:
        return _usage_cache.data

    token = get_access_token()
    if token is None:
        _usage_cache = UsageCache(data=None, timestamp=time.time(), token_expired=True)
        raise TokenExpiredError("No OAuth token available")

    try:
        async with httpx.AsyncClient() as client:
            data = await _fetch_usage_async(client, token)
            _usage_cache = UsageCache(data=data, timestamp=time.time(), token_expired=False)
            return data
    except TokenExpiredError:
        _usage_cache = UsageCache(data=None, timestamp=time.time(), token_expired=True)
        raise
    except RateLimitError:
        _usage_cache = UsageCache(data=None, timestamp=time.time())
        raise
    except httpx.HTTPStatusError as e:
        if e.response.status_code == 401:
            _usage_cache = UsageCache(data=None, timestamp=time.time(), token_expired=True)
            raise TokenExpiredError("OAuth token expired or invalid") from e
        elif e.response.status_code == 429:
            _usage_cache = UsageCache(data=None, timestamp=time.time())
            raise RateLimitError("API rate limit exceeded") from e
        else:
            _usage_cache = UsageCache(data=None, timestamp=time.time())
            logger.error(f"HTTP error fetching usage: {e}")
            raise
    except Exception as e:
        _usage_cache = UsageCache(data=None, timestamp=time.time())
        logger.error(f"Error fetching usage: {e}")
        raise


def get_usage_sync() -> UsageResponse | None:
    """Get usage data (sync), using cache if valid."""
    global _usage_cache

    if _is_cache_valid() and _usage_cache is not None:
        return _usage_cache.data

    token = get_access_token()
    if token is None:
        _usage_cache = UsageCache(data=None, timestamp=time.time(), token_expired=True)
        return None

    settings = get_settings()
    url = f"{settings.api_base_url}/api/oauth/usage"

    try:
        with httpx.Client() as client:
            response = client.get(
                url,
                headers={
                    "Accept": "application/json",
                    "Content-Type": "application/json",
                    "Authorization": f"Bearer {token}",
                    "anthropic-beta": "oauth-2025-04-20",
                    "User-Agent": "claudiminder/0.1.0",
                },
                timeout=10.0,
            )

            if response.status_code == 401:
                logger.warning("Token expired or invalid")
                clear_credentials_cache()
                _usage_cache = UsageCache(data=None, timestamp=time.time(), token_expired=True)
                return None

            response.raise_for_status()
            data = UsageResponse.model_validate(response.json())
            _usage_cache = UsageCache(data=data, timestamp=time.time(), token_expired=False)
            return data

    except Exception as e:
        _usage_cache = UsageCache(data=None, timestamp=time.time())
        logger.error(f"Error fetching usage: {e}")
        return None


def clear_usage_cache() -> None:
    """Clear usage cache."""
    global _usage_cache
    _usage_cache = None


def is_token_expired() -> bool:
    """Check if token is known to be expired."""
    return _usage_cache is not None and _usage_cache.token_expired


class UsageAPI:
    """Usage API client class for TUI/GUI integration."""

    async def get_usage(self) -> UsageResponse:
        """Get usage data asynchronously.

        Returns:
            UsageResponse with usage data

        Raises:
            RuntimeError: If no token or failed to fetch
        """
        result = await get_usage_async()
        if result is None:
            if is_token_expired():
                raise RuntimeError("Token expired. Please re-login to Claude.")
            raise RuntimeError("Failed to fetch usage data")
        return result

    def get_usage_sync_wrapped(self) -> UsageResponse:
        """Get usage data synchronously.

        Returns:
            UsageResponse with usage data

        Raises:
            RuntimeError: If no token or failed to fetch
        """
        result = get_usage_sync()
        if result is None:
            if is_token_expired():
                raise RuntimeError("Token expired. Please re-login to Claude.")
            raise RuntimeError("Failed to fetch usage data")
        return result
</file>

<file path="src/claudiminder/core/__init__.py">
"""Core business logic for claudiminder."""
from .config_manager import (
    AppConfig,
    FocusModeConfig,
    GoalsConfig,
    ReminderConfig,
    get_config_path,
    load_config,
    save_config,
)
from .goals_tracker import (
    GoalsTracker,
    PaceStatus,
    get_goals_tracker,
)
from .instance_lock import (
    acquire_instance_lock,
    is_another_instance_running,
    release_instance_lock,
)

__all__ = [
    "acquire_instance_lock",
    "release_instance_lock",
    "is_another_instance_running",
    "AppConfig",
    "FocusModeConfig",
    "GoalsConfig",
    "ReminderConfig",
    "load_config",
    "save_config",
    "get_config_path",
    "GoalsTracker",
    "PaceStatus",
    "get_goals_tracker",
]
</file>

<file path="src/claudiminder/core/config_manager.py">
"""TOML configuration manager for Claudiminder."""
from pathlib import Path

import tomli
import tomli_w
from pydantic import BaseModel, Field

CONFIG_DIR = Path.home() / ".config" / "claudiminder"
CONFIG_FILE = CONFIG_DIR / "config.toml"


class ReminderConfig(BaseModel):
    """Reminder settings."""
    enabled: bool = True
    before_reset_minutes: list[int] = Field(default_factory=lambda: [15, 30, 60])
    on_reset: bool = True
    percentage_thresholds: list[int] = Field(default_factory=lambda: [50, 75, 90, 100])
    snooze_minutes: list[int] = Field(default_factory=lambda: [5, 15, 30])
    custom_command: str | None = None
    custom_url: str | None = None


class FocusModeConfig(BaseModel):
    """Focus mode / DND settings."""
    enabled: bool = False
    dnd_threshold: int = 80
    quiet_hours_start: str | None = None
    quiet_hours_end: str | None = None


class GoalsConfig(BaseModel):
    """Daily usage goals settings."""
    enabled: bool = False
    daily_budget_percent: int = 100
    warn_when_pace_exceeded: bool = True


class AppConfig(BaseModel):
    """Main application configuration."""
    language: str = "en"
    log_level: str = "INFO"
    poll_interval_seconds: int = 60
    reminder: ReminderConfig = Field(default_factory=ReminderConfig)
    focus_mode: FocusModeConfig = Field(default_factory=FocusModeConfig)
    goals: GoalsConfig = Field(default_factory=GoalsConfig)


def load_config() -> AppConfig:
    """Load config from TOML file, or return defaults."""
    if not CONFIG_FILE.exists():
        return AppConfig()
    with open(CONFIG_FILE, "rb") as f:
        data = tomli.load(f)
    return AppConfig.model_validate(data)


def _remove_none_values(d: dict) -> dict:
    """Recursively remove None values from dict for TOML serialization."""
    result = {}
    for k, v in d.items():
        if isinstance(v, dict):
            result[k] = _remove_none_values(v)
        elif v is not None:
            result[k] = v
    return result


def save_config(config: AppConfig) -> None:
    """Save config to TOML file."""
    CONFIG_DIR.mkdir(parents=True, exist_ok=True)
    # Remove None values as TOML doesn't support them
    data = _remove_none_values(config.model_dump())
    with open(CONFIG_FILE, "wb") as f:
        tomli_w.dump(data, f)


def get_config_path() -> Path:
    """Get the config file path."""
    return CONFIG_FILE
</file>

<file path="src/claudiminder/core/goals_tracker.py">
"""Daily usage goals and pace tracking."""
from datetime import datetime
from typing import NamedTuple

from .config_manager import load_config


class PaceStatus(NamedTuple):
    """Pace calculation result."""
    is_on_track: bool
    current_usage: float
    expected_usage: float
    message: str


class GoalsTracker:
    """Track daily usage goals and pace."""

    def __init__(self) -> None:
        self._session_start = datetime.now()
        self._last_reset_time: datetime | None = None

    def set_reset_time(self, reset_time: datetime) -> None:
        """Set the next reset time for accurate pace calculation."""
        self._last_reset_time = reset_time

    def calculate_pace(self, current_usage: float) -> PaceStatus:
        """Calculate if usage is on track for daily budget.

        Args:
            current_usage: Current usage percentage (0-100)

        Returns:
            PaceStatus with is_on_track, current/expected usage, and message
        """
        config = load_config().goals

        if not config.enabled:
            return PaceStatus(
                is_on_track=True,
                current_usage=current_usage,
                expected_usage=0,
                message=""
            )

        # Calculate hours elapsed today
        now = datetime.now()
        day_start = now.replace(hour=0, minute=0, second=0, microsecond=0)
        hours_elapsed = (now - day_start).total_seconds() / 3600

        # Calculate expected usage at this time
        # Assumes even distribution across 24 hours
        expected_usage = (hours_elapsed / 24) * config.daily_budget_percent

        # 10% buffer for "on track"
        is_on_track = current_usage <= expected_usage * 1.1

        if is_on_track:
            message = f"On track: {current_usage:.1f}% / {expected_usage:.1f}% expected"
        else:
            overage = current_usage - expected_usage
            message = f"Pace exceeded by {overage:.1f}%"

        return PaceStatus(
            is_on_track=is_on_track,
            current_usage=current_usage,
            expected_usage=expected_usage,
            message=message
        )

    def get_budget_status(self, current_usage: float) -> tuple[float, float, bool]:
        """Get budget status: (used%, budget%, exceeded).

        Returns:
            Tuple of (current_usage, daily_budget, is_exceeded)
        """
        config = load_config().goals
        budget = config.daily_budget_percent if config.enabled else 100
        exceeded = current_usage > budget
        return current_usage, budget, exceeded

    def should_warn(self, current_usage: float) -> bool:
        """Check if pace warning should be shown."""
        config = load_config().goals
        if not config.enabled or not config.warn_when_pace_exceeded:
            return False

        pace = self.calculate_pace(current_usage)
        return not pace.is_on_track


# Singleton instance
_tracker: GoalsTracker | None = None


def get_goals_tracker() -> GoalsTracker:
    """Get singleton goals tracker instance."""
    global _tracker
    if _tracker is None:
        _tracker = GoalsTracker()
    return _tracker
</file>

<file path="src/claudiminder/core/instance_lock.py">
"""Single instance enforcement using file lock."""
from pathlib import Path

from filelock import FileLock, Timeout

LOCK_FILE = Path.home() / ".config" / "claudiminder" / ".lock"

_current_lock: FileLock | None = None


def acquire_instance_lock() -> FileLock | None:
    """Acquire instance lock. Returns lock on success, None if another instance running."""
    global _current_lock
    LOCK_FILE.parent.mkdir(parents=True, exist_ok=True)
    lock = FileLock(str(LOCK_FILE), timeout=0)
    try:
        lock.acquire()
        _current_lock = lock
        return lock
    except Timeout:
        return None


def release_instance_lock() -> None:
    """Release the current instance lock."""
    global _current_lock
    if _current_lock is not None:
        _current_lock.release()
        _current_lock = None


def is_another_instance_running() -> bool:
    """Check if another instance is already running."""
    LOCK_FILE.parent.mkdir(parents=True, exist_ok=True)
    lock = FileLock(str(LOCK_FILE), timeout=0)
    try:
        lock.acquire()
        lock.release()
        return False
    except Timeout:
        return True
</file>

<file path="src/claudiminder/i18n/__init__.py">
"""Internationalization module for Claudiminder."""
from .en import STRINGS as EN_STRINGS
from .vi import STRINGS as VI_STRINGS

_current_language = "en"

LANGUAGES = {
    "en": EN_STRINGS,
    "vi": VI_STRINGS,
}


def set_language(lang: str) -> None:
    """Set current language (en or vi)."""
    global _current_language
    if lang not in LANGUAGES:
        raise ValueError(f"Unsupported language: {lang}. Available: {list(LANGUAGES.keys())}")
    _current_language = lang


def get_language() -> str:
    """Get current language code."""
    return _current_language


def get_string(key: str, **kwargs: str | int | float) -> str:
    """Get localized string by key with optional formatting."""
    strings = LANGUAGES.get(_current_language, EN_STRINGS)
    template = strings.get(key, EN_STRINGS.get(key, key))
    if kwargs:
        return template.format(**kwargs)
    return template


def get_all_strings() -> dict[str, str]:
    """Get all strings for current language."""
    return LANGUAGES.get(_current_language, EN_STRINGS).copy()


__all__ = [
    "set_language",
    "get_language",
    "get_string",
    "get_all_strings",
    "LANGUAGES",
]
</file>

<file path="src/claudiminder/i18n/en.py">
"""English language strings."""

STRINGS: dict[str, str] = {
    # General
    "app_name": "Claudiminder",
    "usage_title": "Claude Usage",
    "loading": "Loading...",
    "error": "Error",
    "success": "Success",

    # Reset countdown
    "reset_in": "Reset in",
    "reset_complete": "Reset complete!",
    "hours": "hours",
    "minutes": "minutes",
    "seconds": "seconds",

    # Offline mode
    "offline_mode": "Offline - showing cached data",
    "connection_restored": "Connection restored",

    # Reminders
    "reminder_soon": "Token reset in {minutes} minutes!",
    "reminder_reset": "Your token has reset!",
    "reminder_threshold": "Usage reached {percent}%",
    "reminder_snoozed": "Reminder snoozed for {minutes} minutes",

    # Goals & Pace
    "pace_ok": "On track",
    "pace_exceeded": "Using too fast!",
    "budget_used": "Budget: {used}% of {total}%",
    "daily_goal": "Daily Goal",

    # Focus mode
    "focus_mode_active": "Focus mode active",
    "quiet_hours_active": "Quiet hours active",
    "dnd_active": "Do Not Disturb active (usage > {threshold}%)",

    # TUI
    "press_q_quit": "Press 'q' to quit",
    "press_r_refresh": "Press 'r' to refresh",
    "press_h_help": "Press 'h' for help",
    "refreshing": "Refreshing...",
    "last_updated": "Last updated: {time}",

    # Usage metrics
    "five_hour_usage": "5-Hour Usage",
    "seven_day_usage": "7-Day Usage",
    "extra_usage": "Extra Usage",
    "utilization": "Utilization",
}
</file>

<file path="src/claudiminder/i18n/vi.py">
"""Vietnamese language strings."""

STRINGS: dict[str, str] = {
    # General
    "app_name": "Claudiminder",
    "usage_title": "Sử dụng Claude",
    "loading": "Đang tải...",
    "error": "Lỗi",
    "success": "Thành công",

    # Reset countdown
    "reset_in": "Reset sau",
    "reset_complete": "Đã reset xong!",
    "hours": "giờ",
    "minutes": "phút",
    "seconds": "giây",

    # Offline mode
    "offline_mode": "Ngoại tuyến - hiển thị dữ liệu đã lưu",
    "connection_restored": "Đã kết nối lại",

    # Reminders
    "reminder_soon": "Token sẽ reset trong {minutes} phút!",
    "reminder_reset": "Token của bạn đã reset!",
    "reminder_threshold": "Đã sử dụng {percent}%",
    "reminder_snoozed": "Nhắc nhở đã tạm hoãn {minutes} phút",

    # Goals & Pace
    "pace_ok": "Đúng tiến độ",
    "pace_exceeded": "Đang dùng quá nhanh!",
    "budget_used": "Ngân sách: {used}% / {total}%",
    "daily_goal": "Mục tiêu ngày",

    # Focus mode
    "focus_mode_active": "Chế độ tập trung đang bật",
    "quiet_hours_active": "Giờ yên tĩnh đang bật",
    "dnd_active": "Không làm phiền (sử dụng > {threshold}%)",

    # TUI
    "press_q_quit": "Nhấn 'q' để thoát",
    "press_r_refresh": "Nhấn 'r' để làm mới",
    "press_h_help": "Nhấn 'h' để xem hướng dẫn",
    "refreshing": "Đang làm mới...",
    "last_updated": "Cập nhật lúc: {time}",

    # Usage metrics
    "five_hour_usage": "Sử dụng 5 giờ",
    "seven_day_usage": "Sử dụng 7 ngày",
    "extra_usage": "Sử dụng thêm",
    "utilization": "Mức sử dụng",
}
</file>

<file path="src/claudiminder/models/__init__.py">
"""Pydantic models for claudiminder."""
</file>

<file path="src/claudiminder/models/settings.py">
"""Application settings using pydantic-settings."""

from __future__ import annotations

from functools import lru_cache
from pathlib import Path

from pydantic import Field
from pydantic_settings import BaseSettings, SettingsConfigDict


class ReminderSettings(BaseSettings):
    """Reminder configuration."""

    enabled: bool = Field(default=True, description="Enable reminders")
    before_reset_minutes: list[int] = Field(
        default=[30, 15, 5],
        description="Minutes before reset to send reminder",
    )
    on_reset: bool = Field(default=True, description="Remind on reset")
    custom_command: str | None = Field(None, description="Custom command to run on reminder")


class AppSettings(BaseSettings):
    """Main application settings."""

    model_config = SettingsConfigDict(
        env_file=".env",
        env_nested_delimiter="__",
        case_sensitive=False,
        extra="ignore",
    )

    # General
    environment: str = Field(default="production", description="Environment")
    debug: bool = Field(default=False, description="Debug mode")

    # Credentials path
    credentials_path: Path = Field(
        default=Path.home() / ".claude" / ".credentials.json",
        description="Path to Claude credentials file",
    )

    # API
    api_base_url: str = Field(
        default="https://api.anthropic.com",
        description="Anthropic API base URL",
    )
    cache_duration_seconds: int = Field(
        default=60,
        description="Cache duration for API responses",
    )

    # Reminders
    reminder: ReminderSettings = Field(
        default_factory=ReminderSettings,
        description="Reminder settings",
    )

    # UI
    theme: str = Field(default="dark", description="UI theme")


@lru_cache
def get_settings() -> AppSettings:
    """Get cached settings instance."""
    return AppSettings()
</file>

<file path="src/claudiminder/models/usage.py">
"""Usage response models from Anthropic OAuth API."""

from __future__ import annotations

from pydantic import BaseModel, Field


class FiveHourUsage(BaseModel):
    """5-hour usage window data."""

    utilization: float = Field(..., description="Usage utilization (0.0 - 1.0)")
    resets_at: str = Field(..., description="ISO 8601 timestamp when quota resets")


class ExtraUsage(BaseModel):
    """Extra usage (paid) data."""

    is_enabled: bool = Field(..., description="Whether extra usage is enabled")
    monthly_limit: float | None = Field(None, description="Monthly spending limit")
    used_credits: float | None = Field(None, description="Credits used this month")
    utilization: float | None = Field(None, description="Extra usage utilization")


class UsageResponse(BaseModel):
    """Response from Anthropic OAuth Usage API."""

    five_hour: FiveHourUsage | None = Field(None, description="5-hour usage window")
    extra_usage: ExtraUsage | None = Field(None, description="Extra usage data")

    # Unused fields (kept for completeness)
    seven_day: dict | None = Field(None, description="7-day usage data")
    seven_day_opus: dict | None = Field(None, description="7-day Opus usage")
    seven_day_sonnet: dict | None = Field(None, description="7-day Sonnet usage")
    seven_day_oauth_apps: dict | None = Field(None, description="7-day OAuth apps usage")
</file>

<file path="src/claudiminder/scheduler/__init__.py">
"""Scheduler module for reminders, focus mode, and notifications."""
from .focus_mode import FocusModeService, get_focus_mode_service
from .notifier import NotificationChannel, send_notification
from .reminder_service import ReminderService, ReminderType, get_reminder_service

__all__ = [
    "FocusModeService",
    "get_focus_mode_service",
    "send_notification",
    "NotificationChannel",
    "ReminderService",
    "get_reminder_service",
    "ReminderType",
]
</file>

<file path="src/claudiminder/scheduler/focus_mode.py">
"""Focus mode with DND threshold and quiet hours."""
from datetime import datetime, time, timedelta

from ..core.config_manager import load_config


class FocusModeService:
    """Manage focus mode / do not disturb functionality."""

    def __init__(self) -> None:
        self._snoozed_until: datetime | None = None

    def snooze(self, minutes: int) -> None:
        """Snooze notifications for specified minutes."""
        self._snoozed_until = datetime.now() + timedelta(minutes=minutes)

    def clear_snooze(self) -> None:
        """Clear any active snooze."""
        self._snoozed_until = None

    def is_snoozed(self) -> bool:
        """Check if currently snoozed."""
        if self._snoozed_until is None:
            return False
        return datetime.now() < self._snoozed_until

    def get_snooze_remaining(self) -> int:
        """Get remaining snooze time in seconds, 0 if not snoozed."""
        if self._snoozed_until is None:
            return 0
        remaining = (self._snoozed_until - datetime.now()).total_seconds()
        return max(0, int(remaining))

    def is_in_quiet_hours(self) -> bool:
        """Check if current time is in quiet hours."""
        config = load_config().focus_mode
        if not config.enabled:
            return False
        if not config.quiet_hours_start or not config.quiet_hours_end:
            return False

        now = datetime.now().time()
        start = time.fromisoformat(config.quiet_hours_start)
        end = time.fromisoformat(config.quiet_hours_end)

        # Handle overnight quiet hours (e.g., 22:00 to 08:00)
        if start > end:
            return now >= start or now <= end
        return start <= now <= end

    def is_dnd_by_usage(self, current_usage: float) -> bool:
        """Check if DND should be active based on usage threshold."""
        config = load_config().focus_mode
        if not config.enabled:
            return False
        return current_usage > config.dnd_threshold

    def should_suppress_notification(self, current_usage: float) -> bool:
        """Check if notification should be suppressed.

        Returns True if any of these conditions are met:
        - Snoozed
        - In quiet hours
        - Usage exceeds DND threshold
        """
        if self.is_snoozed():
            return True
        if self.is_in_quiet_hours():
            return True
        if self.is_dnd_by_usage(current_usage):
            return True
        return False

    def get_suppression_reason(self, current_usage: float) -> str | None:
        """Get reason for notification suppression, or None if not suppressed."""
        if self.is_snoozed():
            remaining = self.get_snooze_remaining()
            mins = remaining // 60
            return f"Snoozed for {mins} more minutes"
        if self.is_in_quiet_hours():
            config = load_config().focus_mode
            return f"Quiet hours ({config.quiet_hours_start} - {config.quiet_hours_end})"
        if self.is_dnd_by_usage(current_usage):
            config = load_config().focus_mode
            return f"DND active (usage > {config.dnd_threshold}%)"
        return None


# Singleton instance
_service: FocusModeService | None = None


def get_focus_mode_service() -> FocusModeService:
    """Get singleton focus mode service instance."""
    global _service
    if _service is None:
        _service = FocusModeService()
    return _service
</file>

<file path="src/claudiminder/scheduler/notifier.py">
"""Multi-channel notification system."""
import subprocess
import webbrowser
from enum import Enum
from typing import TYPE_CHECKING

from loguru import logger

if TYPE_CHECKING:
    from desktop_notifier import DesktopNotifier

from ..core.config_manager import load_config


class NotificationChannel(Enum):
    """Available notification channels."""
    SYSTEM = "system"
    BELL = "bell"
    COMMAND = "command"
    URL = "url"


_notifier: "DesktopNotifier | None" = None


def _get_notifier() -> "DesktopNotifier":
    """Get or create desktop notifier instance."""
    global _notifier
    if _notifier is None:
        from desktop_notifier import DesktopNotifier
        _notifier = DesktopNotifier(app_name="Claudiminder")
    return _notifier


async def send_notification(
    title: str,
    body: str,
    channels: list[NotificationChannel] | None = None,
) -> list[NotificationChannel]:
    """Send notification through configured channels.

    Args:
        title: Notification title
        body: Notification body text
        channels: Specific channels to use, or None for all configured

    Returns:
        List of channels that successfully sent
    """
    config = load_config()
    sent_channels: list[NotificationChannel] = []

    # Default to system notification
    if channels is None:
        channels = [NotificationChannel.SYSTEM]

    for channel in channels:
        try:
            if channel == NotificationChannel.SYSTEM:
                notifier = _get_notifier()
                await notifier.send(title=title, message=body)
                sent_channels.append(channel)
                logger.debug(f"System notification sent: {title}")

            elif channel == NotificationChannel.BELL:
                print("\a", end="", flush=True)
                sent_channels.append(channel)
                logger.debug("Terminal bell sent")

            elif channel == NotificationChannel.COMMAND:
                if config.reminder.custom_command:
                    subprocess.Popen(
                        config.reminder.custom_command,
                        shell=True,
                        stdout=subprocess.DEVNULL,
                        stderr=subprocess.DEVNULL,
                    )
                    sent_channels.append(channel)
                    logger.debug(f"Custom command executed: {config.reminder.custom_command}")

            elif channel == NotificationChannel.URL:
                if config.reminder.custom_url:
                    webbrowser.open(config.reminder.custom_url)
                    sent_channels.append(channel)
                    logger.debug(f"URL opened: {config.reminder.custom_url}")

        except Exception as e:
            logger.warning(f"Failed to send {channel.value} notification: {e}")
            # Try fallback to bell on system notification failure
            if channel == NotificationChannel.SYSTEM and NotificationChannel.BELL not in sent_channels:
                try:
                    print("\a", end="", flush=True)
                    sent_channels.append(NotificationChannel.BELL)
                except Exception:
                    pass

    return sent_channels


def send_notification_sync(title: str, body: str) -> None:
    """Synchronous wrapper for send_notification (system + bell fallback)."""
    import asyncio
    try:
        loop = asyncio.get_event_loop()
        if loop.is_running():
            asyncio.create_task(send_notification(title, body))
        else:
            loop.run_until_complete(send_notification(title, body))
    except RuntimeError:
        asyncio.run(send_notification(title, body))
</file>

<file path="src/claudiminder/scheduler/reminder_service.py">
"""Reminder service for usage thresholds and reset times."""
from collections.abc import Callable
from datetime import datetime
from enum import Enum

from loguru import logger

from ..core.config_manager import load_config
from .focus_mode import get_focus_mode_service
from .notifier import send_notification_sync


class ReminderType(Enum):
    """Types of reminders."""
    BEFORE_RESET = "before_reset"
    ON_RESET = "on_reset"
    PERCENTAGE = "percentage"


class ReminderService:
    """Manage and trigger usage reminders."""

    def __init__(self) -> None:
        self._triggered_before_reset: set[int] = set()  # Minutes already triggered
        self._triggered_percentages: set[int] = set()
        self._reset_triggered = False
        self._last_reset_time: datetime | None = None
        self._callbacks: list[Callable[[ReminderType, str], None]] = []

    def add_callback(self, callback: Callable[[ReminderType, str], None]) -> None:
        """Add callback for when reminder triggers."""
        self._callbacks.append(callback)

    def remove_callback(self, callback: Callable[[ReminderType, str], None]) -> None:
        """Remove a callback."""
        if callback in self._callbacks:
            self._callbacks.remove(callback)

    def _notify_callbacks(self, reminder_type: ReminderType, message: str) -> None:
        """Notify all registered callbacks."""
        for callback in self._callbacks:
            try:
                callback(reminder_type, message)
            except Exception as e:
                logger.error(f"Callback error: {e}")

    def reset_triggers(self) -> None:
        """Reset all triggers (call after token reset)."""
        self._triggered_before_reset.clear()
        self._triggered_percentages.clear()
        self._reset_triggered = False
        logger.debug("Reminder triggers reset")

    def check_and_trigger(
        self,
        current_usage: float,
        reset_time: datetime | None,
    ) -> list[tuple[ReminderType, str]]:
        """Check conditions and trigger appropriate reminders.

        Args:
            current_usage: Current usage percentage (0-100)
            reset_time: When the usage will reset

        Returns:
            List of (ReminderType, message) for triggered reminders
        """
        config = load_config().reminder
        if not config.enabled:
            return []

        focus_service = get_focus_mode_service()
        if focus_service.should_suppress_notification(current_usage):
            reason = focus_service.get_suppression_reason(current_usage)
            logger.debug(f"Notifications suppressed: {reason}")
            return []

        triggered: list[tuple[ReminderType, str]] = []

        # Check percentage thresholds
        for threshold in config.percentage_thresholds:
            if threshold not in self._triggered_percentages:
                if current_usage >= threshold:
                    self._triggered_percentages.add(threshold)
                    message = f"Usage reached {threshold}%"
                    triggered.append((ReminderType.PERCENTAGE, message))
                    send_notification_sync("Claudiminder", message)
                    self._notify_callbacks(ReminderType.PERCENTAGE, message)
                    logger.info(f"Triggered percentage reminder: {threshold}%")

        # Check before-reset reminders
        if reset_time:
            now = datetime.now()
            time_until_reset = reset_time - now
            minutes_until = time_until_reset.total_seconds() / 60

            for minutes in config.before_reset_minutes:
                if minutes not in self._triggered_before_reset:
                    if 0 < minutes_until <= minutes:
                        self._triggered_before_reset.add(minutes)
                        message = f"Token reset in {int(minutes_until)} minutes!"
                        triggered.append((ReminderType.BEFORE_RESET, message))
                        send_notification_sync("Claudiminder", message)
                        self._notify_callbacks(ReminderType.BEFORE_RESET, message)
                        logger.info(f"Triggered before-reset reminder: {minutes}m")

            # Check on-reset
            if config.on_reset and not self._reset_triggered:
                if self._last_reset_time and reset_time > self._last_reset_time:
                    self._reset_triggered = True
                    message = "Your token has reset!"
                    triggered.append((ReminderType.ON_RESET, message))
                    send_notification_sync("Claudiminder", message)
                    self._notify_callbacks(ReminderType.ON_RESET, message)
                    logger.info("Triggered on-reset reminder")

            self._last_reset_time = reset_time

        return triggered

    def snooze(self, minutes: int) -> None:
        """Snooze all reminders for specified minutes."""
        focus_service = get_focus_mode_service()
        focus_service.snooze(minutes)
        logger.info(f"Reminders snoozed for {minutes} minutes")


# Singleton instance
_service: ReminderService | None = None


def get_reminder_service() -> ReminderService:
    """Get singleton reminder service instance."""
    global _service
    if _service is None:
        _service = ReminderService()
    return _service
</file>

<file path="src/claudiminder/tui/widgets/__init__.py">
"""TUI widgets for Claudiminder."""
from .goals_indicator import GoalsIndicator
from .offline_banner import OfflineBanner
from .reset_countdown import ResetCountdown
from .usage_display import UsageDisplay

__all__ = [
    "GoalsIndicator",
    "OfflineBanner",
    "ResetCountdown",
    "UsageDisplay",
]
</file>

<file path="src/claudiminder/tui/widgets/goals_indicator.py">
"""Goals and pace indicator widget."""
from textual.app import ComposeResult
from textual.reactive import reactive
from textual.widgets import Static

from ...core.goals_tracker import get_goals_tracker
from ...i18n import get_string


class GoalsIndicator(Static):
    """Display daily goals and pace status."""

    current_usage: reactive[float] = reactive(0.0)
    is_visible: reactive[bool] = reactive(False)

    def __init__(self, **kwargs) -> None:
        super().__init__(**kwargs)
        self.border_title = get_string("daily_goal")

    def compose(self) -> ComposeResult:
        yield Static(id="goals-content")

    def on_mount(self) -> None:
        self._update_display()

    def watch_current_usage(self, value: float) -> None:
        self._update_display()

    def watch_is_visible(self, value: bool) -> None:
        self.display = value

    def _update_display(self) -> None:
        """Update the goals display."""
        try:
            content = self.query_one("#goals-content", Static)
        except Exception:
            return

        tracker = get_goals_tracker()

        pace = tracker.calculate_pace(self.current_usage)
        used, budget, exceeded = tracker.get_budget_status(self.current_usage)

        if not pace.message:
            # Goals not enabled
            self.is_visible = False
            return

        self.is_visible = True

        lines = []

        # Budget status
        budget_str = get_string("budget_used", used=f"{used:.1f}", total=str(int(budget)))
        if exceeded:
            lines.append(f"[bold red]{budget_str}[/]")
        else:
            lines.append(f"[cyan]{budget_str}[/]")

        # Pace status
        if pace.is_on_track:
            pace_str = get_string("pace_ok")
            lines.append(f"[green]✓ {pace_str}[/]")
        else:
            pace_str = get_string("pace_exceeded")
            lines.append(f"[yellow bold]⚠ {pace_str}[/]")

        # Expected vs actual
        lines.append(f"[dim]{pace.message}[/]")

        content.update("\n".join(lines))

    def update_usage(self, usage: float) -> None:
        """Update current usage for pace calculation."""
        self.current_usage = usage
</file>

<file path="src/claudiminder/tui/widgets/offline_banner.py">
"""Offline mode banner widget."""
from textual.reactive import reactive
from textual.widgets import Static

from ...i18n import get_string


class OfflineBanner(Static):
    """Display banner when offline."""

    is_offline: reactive[bool] = reactive(False)

    def __init__(self, **kwargs) -> None:
        super().__init__(**kwargs)
        self.update("")

    def watch_is_offline(self, value: bool) -> None:
        if value:
            self.update(f"[bold yellow on red] ⚠ {get_string('offline_mode')} [/]")
            self.display = True
        else:
            self.update("")
            self.display = False

    def set_offline(self, offline: bool) -> None:
        """Set offline status."""
        self.is_offline = offline

    def show_connection_restored(self) -> None:
        """Briefly show connection restored message."""
        self.update(f"[bold green] ✓ {get_string('connection_restored')} [/]")
        self.display = True
</file>

<file path="src/claudiminder/tui/widgets/reset_countdown.py">
"""Reset countdown timer widget."""
from datetime import datetime

from textual.app import ComposeResult
from textual.reactive import reactive
from textual.widgets import Static

from ...i18n import get_string


class ResetCountdown(Static):
    """Display countdown to next reset."""

    reset_time: reactive[datetime | None] = reactive(None)
    show_human_readable: reactive[bool] = reactive(True)

    def __init__(self, **kwargs) -> None:
        super().__init__(**kwargs)
        self.border_title = get_string("reset_in")
        self._timer = None

    def compose(self) -> ComposeResult:
        yield Static(get_string("loading"), id="countdown-text")

    def on_mount(self) -> None:
        """Start the countdown timer."""
        self._timer = self.set_interval(1.0, self._update_countdown)

    def watch_reset_time(self, value: datetime | None) -> None:
        self._update_countdown()

    def on_unmount(self) -> None:
        """Stop the countdown timer."""
        if self._timer:
            self._timer.stop()

    def _update_countdown(self) -> None:
        """Update countdown display."""
        try:
            content = self.query_one("#countdown-text", Static)
        except Exception:
            return

        if self.reset_time is None:
            content.update(get_string("loading"))
            return

        now = datetime.now()
        if now >= self.reset_time:
            content.update(f"[bold green]{get_string('reset_complete')}[/]")
            return

        delta = self.reset_time - now
        total_seconds = int(delta.total_seconds())

        hours, remainder = divmod(total_seconds, 3600)
        minutes, seconds = divmod(remainder, 60)

        if self.show_human_readable:
            parts = []
            if hours > 0:
                parts.append(f"{hours} {get_string('hours')}")
            if minutes > 0:
                parts.append(f"{minutes} {get_string('minutes')}")
            parts.append(f"{seconds} {get_string('seconds')}")
            time_str = ", ".join(parts)
        else:
            time_str = f"{hours:02d}:{minutes:02d}:{seconds:02d}"

        # Color based on time remaining
        if total_seconds < 300:  # < 5 min
            color = "red bold"
        elif total_seconds < 900:  # < 15 min
            color = "yellow"
        else:
            color = "cyan"

        content.update(f"[{color}]{time_str}[/]")

    def toggle_format(self) -> None:
        """Toggle between HH:MM:SS and human readable."""
        self.show_human_readable = not self.show_human_readable

    def set_reset_time(self, reset_time: datetime | None) -> None:
        """Set the reset time."""
        self.reset_time = reset_time
</file>

<file path="src/claudiminder/tui/widgets/usage_display.py">
"""Usage display widget showing all metrics."""
from textual.app import ComposeResult
from textual.reactive import reactive
from textual.widgets import Static

from ...i18n import get_string


class UsageDisplay(Static):
    """Display usage metrics: 5h, 7d, extra usage."""

    five_hour_usage: reactive[float] = reactive(0.0)
    seven_day_usage: reactive[float | None] = reactive(None)
    extra_usage: reactive[float | None] = reactive(None)

    def __init__(self, **kwargs) -> None:
        super().__init__(**kwargs)
        self.border_title = get_string("usage_title")

    def compose(self) -> ComposeResult:
        yield Static(id="usage-content")

    def watch_five_hour_usage(self, value: float) -> None:
        self._update_display()

    def watch_seven_day_usage(self, value: float | None) -> None:
        self._update_display()

    def watch_extra_usage(self, value: float | None) -> None:
        self._update_display()

    def on_mount(self) -> None:
        self._update_display()

    def _update_display(self) -> None:
        """Update the display content."""
        try:
            content = self.query_one("#usage-content", Static)
        except Exception:
            return

        lines = []

        # 5-hour usage (main metric)
        five_h = get_string("five_hour_usage")
        lines.append(f"[bold cyan]{five_h}:[/] {self.five_hour_usage:.1f}%")
        lines.append(self._progress_bar(self.five_hour_usage))

        # 7-day usage
        if self.seven_day_usage is not None:
            seven_d = get_string("seven_day_usage")
            lines.append(f"\n[cyan]{seven_d}:[/] {self.seven_day_usage:.1f}%")
            lines.append(self._progress_bar(self.seven_day_usage))

        # Extra usage
        if self.extra_usage is not None and self.extra_usage > 0:
            extra = get_string("extra_usage")
            lines.append(f"\n[yellow]{extra}:[/] {self.extra_usage:.1f}%")

        content.update("\n".join(lines))

    def _progress_bar(self, percent: float, width: int = 30) -> str:
        """Create ASCII progress bar."""
        filled = int(width * min(percent, 100) / 100)
        empty = width - filled

        # Color based on percentage
        if percent >= 90:
            color = "red"
        elif percent >= 75:
            color = "yellow"
        else:
            color = "green"

        bar = f"[{color}]{'█' * filled}{'░' * empty}[/]"
        return bar

    def update_usage(
        self,
        five_hour: float,
        seven_day: float | None = None,
        extra: float | None = None,
    ) -> None:
        """Update all usage values."""
        self.five_hour_usage = five_hour
        self.seven_day_usage = seven_day
        self.extra_usage = extra
</file>

<file path="src/claudiminder/tui/__init__.py">
"""TUI module using Textual."""
from .app import ClaudiminderApp, run_tui

__all__ = ["ClaudiminderApp", "run_tui"]
</file>

<file path="src/claudiminder/tui/app.py">
"""Main TUI application using Textual."""
from datetime import datetime

from loguru import logger
from textual.app import App, ComposeResult
from textual.binding import Binding
from textual.containers import Container, Vertical
from textual.widgets import Footer, Header

from ..api.usage import UsageAPI
from ..core.config_manager import load_config
from ..core.goals_tracker import get_goals_tracker
from ..core.instance_lock import acquire_instance_lock, release_instance_lock
from ..i18n import get_string, set_language
from ..scheduler import get_reminder_service
from .widgets import GoalsIndicator, OfflineBanner, ResetCountdown, UsageDisplay


class ClaudiminderApp(App):
    """Claudiminder TUI Application."""

    CSS_PATH = "styles.tcss"

    BINDINGS = [
        Binding("q", "quit", "Quit"),
        Binding("r", "refresh", "Refresh"),
        Binding("h", "help", "Help"),
        Binding("t", "toggle_format", "Toggle time format"),
    ]

    def __init__(self) -> None:
        super().__init__()
        self._lock = None
        self._usage_api: UsageAPI | None = None
        self._poll_timer = None
        self._last_error: str | None = None

        # Load config and set language
        config = load_config()
        set_language(config.language)

    def compose(self) -> ComposeResult:
        yield Header(show_clock=True)
        yield OfflineBanner(id="offline-banner")
        yield Container(
            Vertical(
                UsageDisplay(id="usage-display"),
                ResetCountdown(id="reset-countdown"),
                GoalsIndicator(id="goals-indicator"),
                id="main-content",
            ),
            id="app-container",
        )
        yield Footer()

    async def on_mount(self) -> None:
        """Called when app is mounted."""
        # Check single instance
        self._lock = acquire_instance_lock()
        if self._lock is None:
            self.notify(
                "Another instance is already running",
                severity="error",
                timeout=3,
            )
            self.exit(1)
            return

        # Initialize API
        try:
            self._usage_api = UsageAPI()
        except Exception as e:
            logger.error(f"Failed to initialize API: {e}")
            self._show_offline()

        # Initial fetch
        await self._fetch_usage()

        # Start polling
        config = load_config()
        self._poll_timer = self.set_interval(
            config.poll_interval_seconds,
            self._fetch_usage,
        )

        logger.info("Claudiminder TUI started")

    async def on_unmount(self) -> None:
        """Called when app is unmounting."""
        if self._poll_timer:
            self._poll_timer.stop()
        release_instance_lock()
        logger.info("Claudiminder TUI stopped")

    async def _fetch_usage(self) -> None:
        """Fetch usage data from API."""
        if self._usage_api is None:
            return

        try:
            usage_data = await self._usage_api.get_usage()
            self._update_widgets(usage_data)
            self._hide_offline()
            self._last_error = None

            # Check reminders
            reminder_service = get_reminder_service()
            reset_time = None
            if usage_data.five_hour and usage_data.five_hour.resets_at:
                reset_time = datetime.fromisoformat(
                    usage_data.five_hour.resets_at.replace("Z", "+00:00")
                )

            reminder_service.check_and_trigger(
                current_usage=usage_data.five_hour.utilization if usage_data.five_hour else 0,
                reset_time=reset_time,
            )

        except Exception as e:
            error_msg = str(e)
            if error_msg != self._last_error:
                logger.error(f"Failed to fetch usage: {e}")
                self.notify(f"Error: {error_msg}", severity="error", timeout=5)
                self._last_error = error_msg
            self._show_offline()

    def _update_widgets(self, usage_data) -> None:
        """Update all widgets with new data."""
        usage_display = self.query_one("#usage-display", UsageDisplay)
        reset_countdown = self.query_one("#reset-countdown", ResetCountdown)
        goals_indicator = self.query_one("#goals-indicator", GoalsIndicator)

        if usage_data.five_hour:
            five_hour = usage_data.five_hour.utilization

            # Get optional data
            seven_day = None
            extra = None
            if hasattr(usage_data, 'seven_day') and usage_data.seven_day:
                seven_day = getattr(usage_data.seven_day, 'utilization', None)
            if hasattr(usage_data, 'extra_usage') and usage_data.extra_usage:
                extra = getattr(usage_data.extra_usage, 'utilization', None)

            usage_display.update_usage(
                five_hour=five_hour,
                seven_day=seven_day,
                extra=extra,
            )

            # Update reset countdown
            if usage_data.five_hour.resets_at:
                reset_time = datetime.fromisoformat(
                    usage_data.five_hour.resets_at.replace("Z", "+00:00")
                )
                reset_countdown.set_reset_time(reset_time)

            # Update goals
            goals_indicator.update_usage(five_hour)
            goals_tracker = get_goals_tracker()
            if usage_data.five_hour.resets_at:
                reset_time = datetime.fromisoformat(
                    usage_data.five_hour.resets_at.replace("Z", "+00:00")
                )
                goals_tracker.set_reset_time(reset_time)

    def _show_offline(self) -> None:
        """Show offline banner."""
        banner = self.query_one("#offline-banner", OfflineBanner)
        banner.set_offline(True)

    def _hide_offline(self) -> None:
        """Hide offline banner."""
        banner = self.query_one("#offline-banner", OfflineBanner)
        if banner.is_offline:
            banner.show_connection_restored()
            self.set_timer(2.0, lambda: banner.set_offline(False))

    def action_quit(self) -> None:
        """Quit the application."""
        self.exit()

    async def action_refresh(self) -> None:
        """Manually refresh usage data."""
        self.notify(get_string("refreshing"), timeout=1)
        await self._fetch_usage()

    def action_help(self) -> None:
        """Show help."""
        help_text = (
            f"{get_string('press_q_quit')}\n"
            f"{get_string('press_r_refresh')}\n"
            f"{get_string('press_h_help')}\n"
            "t - Toggle time format"
        )
        self.notify(help_text, timeout=5)

    def action_toggle_format(self) -> None:
        """Toggle countdown format."""
        countdown = self.query_one("#reset-countdown", ResetCountdown)
        countdown.toggle_format()


def run_tui() -> None:
    """Run the TUI application."""
    app = ClaudiminderApp()
    app.run()
</file>

<file path="src/claudiminder/tui/styles.tcss">
/* Claudiminder TUI Styles */

Screen {
    background: $surface;
}

#app-container {
    padding: 1 2;
}

#main-content {
    height: auto;
}

#usage-display {
    border: solid $primary;
    padding: 1 2;
    margin-bottom: 1;
    height: auto;
}

#reset-countdown {
    border: solid $secondary;
    padding: 1 2;
    margin-bottom: 1;
    height: auto;
    text-align: center;
}

#goals-indicator {
    border: solid $accent;
    padding: 1 2;
    height: auto;
}

#offline-banner {
    text-align: center;
    margin-bottom: 1;
}

Header {
    dock: top;
}

Footer {
    dock: bottom;
}
</file>

<file path="src/claudiminder/utils/__init__.py">
"""Utility functions for claudiminder."""
</file>

<file path="src/claudiminder/utils/credentials.py">
"""Credentials management for Claude OAuth."""

from __future__ import annotations

import json
from pathlib import Path

from loguru import logger
from pydantic import BaseModel, Field, SecretStr

from ..models.settings import get_settings


class OAuthCredentials(BaseModel):
    """OAuth credentials from Claude."""

    access_token: SecretStr = Field(..., description="OAuth access token")
    refresh_token: SecretStr | None = Field(None, description="OAuth refresh token")
    expires_at: int | None = Field(None, description="Token expiration timestamp")
    subscription_type: str | None = Field(None, description="Subscription type")
    rate_limit_tier: str | None = Field(None, description="Rate limit tier")


class CredentialsFile(BaseModel):
    """Structure of ~/.claude/.credentials.json."""

    claudeAiOauth: OAuthCredentials | None = Field(None, description="OAuth credentials")


_credentials_cache: OAuthCredentials | None = None


def get_credentials_path() -> Path:
    """Get path to credentials file."""
    return get_settings().credentials_path


def load_credentials() -> OAuthCredentials | None:
    """Load OAuth credentials from file."""
    global _credentials_cache

    if _credentials_cache is not None:
        return _credentials_cache

    path = get_credentials_path()

    if not path.exists():
        logger.warning(f"Credentials file not found: {path}")
        return None

    try:
        content = path.read_text()
        data = json.loads(content)
        creds_file = CredentialsFile.model_validate(data)

        if creds_file.claudeAiOauth is None:
            logger.warning("No OAuth credentials in file")
            return None

        _credentials_cache = creds_file.claudeAiOauth
        return _credentials_cache

    except json.JSONDecodeError as e:
        logger.error(f"Invalid JSON in credentials file: {e}")
        return None
    except Exception as e:
        logger.error(f"Failed to load credentials: {e}")
        return None


def get_access_token() -> str | None:
    """Get access token from credentials."""
    creds = load_credentials()
    if creds is None:
        return None
    return creds.access_token.get_secret_value()


def clear_credentials_cache() -> None:
    """Clear cached credentials."""
    global _credentials_cache
    _credentials_cache = None


def is_token_available() -> bool:
    """Check if OAuth token is available."""
    return get_access_token() is not None
</file>

<file path="src/claudiminder/__init__.py">
"""claudiminder - Claude usage tracking & reminder tool."""

__version__ = "0.1.0"
</file>

<file path="src/claudiminder/cli.py">
"""CLI entry point for claudiminder."""

from __future__ import annotations

import json
import sys

import typer
from loguru import logger

from .api.usage import get_usage_sync, is_token_expired
from .utils.credentials import is_token_available

app = typer.Typer(
    name="claudiminder",
    help="Claude usage tracking & reminder tool",
    no_args_is_help=True,
)


def setup_logging(debug: bool = False) -> None:
    """Configure loguru logging."""
    logger.remove()
    level = "DEBUG" if debug else "INFO"
    logger.add(sys.stderr, level=level, format="{time:HH:mm:ss} | {level} | {message}")


@app.command()
def status(
    json_output: bool = typer.Option(False, "--json", "-j", help="Output as JSON"),
    debug: bool = typer.Option(False, "--debug", "-d", help="Enable debug logging"),
) -> None:
    """Show current Claude usage status."""
    setup_logging(debug)

    if not is_token_available():
        if json_output:
            print(json.dumps({"error": "No OAuth token found", "token_expired": True}))
        else:
            typer.echo("❌ No OAuth token found. Please login to Claude.")
        raise typer.Exit(1)

    usage = get_usage_sync()

    if usage is None:
        if json_output:
            print(json.dumps({"error": "Failed to fetch usage", "token_expired": is_token_expired()}))
        else:
            if is_token_expired():
                typer.echo("❌ Token expired. Please re-login to Claude.")
            else:
                typer.echo("❌ Failed to fetch usage data.")
        raise typer.Exit(1)

    if json_output:
        print(usage.model_dump_json(indent=2))
    else:
        if usage.five_hour:
            pct = usage.five_hour.utilization * 100
            typer.echo(f"📊 Usage: {pct:.1f}%")
            typer.echo(f"🔄 Resets at: {usage.five_hour.resets_at}")
        else:
            typer.echo("⚠️ No usage data available")


@app.command()
def tui() -> None:
    """Launch interactive TUI mode."""
    from .tui import run_tui
    run_tui()


@app.command()
def version() -> None:
    """Show version information."""
    from . import __version__
    typer.echo(f"claudiminder v{__version__}")


def main() -> None:
    """Main entry point."""
    app()


if __name__ == "__main__":
    main()
</file>

<file path="src/claudiminder/sidecar.py">
"""Sidecar module for Tauri integration.

This module provides a JSON interface for the Tauri GUI to communicate
with the Python backend. It can be invoked via CLI or as a standalone binary.

Usage:
    python -m claudiminder.sidecar get_usage
    python -m claudiminder.sidecar refresh_usage
    python -m claudiminder.sidecar check_token
    python -m claudiminder.sidecar get_config
    python -m claudiminder.sidecar set_config '{"language": "vi"}'
    python -m claudiminder.sidecar snooze 15
"""

from __future__ import annotations

import asyncio
import json
import sys
from datetime import datetime
from typing import Any

from loguru import logger

from .api.usage import RateLimitError, TokenExpiredError, clear_usage_cache, get_usage_async
from .core.config_manager import AppConfig, load_config, save_config
from .core.goals_tracker import get_goals_tracker
from .scheduler import get_focus_mode_service, get_reminder_service
from .utils.credentials import is_token_available


def _json_response(data: dict[str, Any] | None = None, error: str | None = None) -> str:
    """Create JSON response string."""
    response: dict[str, Any] = {}
    if data is not None:
        response.update(data)
    if error is not None:
        response["error"] = error
    return json.dumps(response)


async def get_usage() -> str:
    """Get current usage data as JSON."""
    try:
        # Check token availability first
        if not is_token_available():
            return _json_response(
                error="No OAuth token available",
                data={"token_expired": True}
            )

        usage = await get_usage_async()

        result: dict[str, Any] = {}

        if usage and usage.five_hour:
            result["five_hour"] = {
                "utilization": usage.five_hour.utilization,
                "resets_at": usage.five_hour.resets_at,
            }
        else:
            result["five_hour"] = None

        # Add goals status
        if usage and usage.five_hour:
            tracker = get_goals_tracker()
            pace = tracker.calculate_pace(usage.five_hour.utilization)
            result["goals"] = {
                "enabled": load_config().goals.enabled,
                "is_on_track": pace.is_on_track,
                "current_usage": pace.current_usage,
                "expected_usage": pace.expected_usage,
                "message": pace.message,
            }

        # Add focus mode status
        focus_service = get_focus_mode_service()
        current_usage = usage.five_hour.utilization if usage and usage.five_hour else 0
        result["focus_mode"] = {
            "is_snoozed": focus_service.is_snoozed(),
            "snooze_remaining": focus_service.get_snooze_remaining(),
            "is_quiet_hours": focus_service.is_in_quiet_hours(),
            "is_dnd": focus_service.is_dnd_by_usage(current_usage),
            "notifications_suppressed": focus_service.should_suppress_notification(current_usage),
        }

        return _json_response(result)

    except TokenExpiredError as e:
        logger.warning(f"Token expired: {e}")
        return _json_response(
            error="OAuth token expired",
            data={"token_expired": True}
        )
    except RateLimitError as e:
        logger.warning(f"Rate limit exceeded: {e}")
        return _json_response(
            error="Rate limit exceeded",
            data={"rate_limited": True}
        )
    except Exception as e:
        error_msg = str(e).lower()
        # Detect network/connection errors for offline mode
        if any(keyword in error_msg for keyword in ["connection", "network", "timeout", "unreachable"]):
            logger.warning(f"Network error (offline): {e}")
            return _json_response(
                error="Network error",
                data={"offline": True}
            )
        logger.error(f"Sidecar get_usage error: {e}")
        return _json_response(error=str(e))


async def refresh_usage() -> str:
    """Force refresh usage data."""
    # Clear any cached data and fetch fresh
    clear_usage_cache()
    return await get_usage()


def check_token() -> str:
    """Check if OAuth token is available."""
    try:
        available = is_token_available()
        return _json_response({"available": available})
    except Exception as e:
        logger.error(f"Sidecar check_token error: {e}")
        return _json_response(error=str(e))


def get_config() -> str:
    """Get current configuration as JSON."""
    try:
        config = load_config()
        return _json_response({"config": config.model_dump()})
    except Exception as e:
        logger.error(f"Sidecar get_config error: {e}")
        return _json_response(error=str(e))


def set_config(config_json: str) -> str:
    """Update configuration from JSON."""
    try:
        updates = json.loads(config_json)
        current = load_config()

        # Merge updates into current config
        current_dict = current.model_dump()
        _deep_merge(current_dict, updates)

        new_config = AppConfig.model_validate(current_dict)
        save_config(new_config)

        return _json_response({"success": True, "config": new_config.model_dump()})
    except Exception as e:
        logger.error(f"Sidecar set_config error: {e}")
        return _json_response(error=str(e))


def _deep_merge(base: dict[str, Any], updates: dict[str, Any]) -> None:
    """Deep merge updates into base dict."""
    for key, value in updates.items():
        if key in base and isinstance(base[key], dict) and isinstance(value, dict):
            _deep_merge(base[key], value)
        else:
            base[key] = value


def snooze(minutes: int) -> str:
    """Snooze notifications for specified minutes."""
    try:
        focus_service = get_focus_mode_service()
        focus_service.snooze(minutes)

        return _json_response(
            {
                "success": True,
                "snoozed_until": (datetime.now().timestamp() + minutes * 60),
                "snooze_remaining": focus_service.get_snooze_remaining(),
            }
        )
    except Exception as e:
        logger.error(f"Sidecar snooze error: {e}")
        return _json_response(error=str(e))


def clear_snooze() -> str:
    """Clear any active snooze."""
    try:
        focus_service = get_focus_mode_service()
        focus_service.clear_snooze()
        return _json_response({"success": True})
    except Exception as e:
        logger.error(f"Sidecar clear_snooze error: {e}")
        return _json_response(error=str(e))


def check_reminders(usage_percent: float, reset_time_iso: str | None) -> str:
    """Check and trigger reminders based on current state."""
    try:
        reminder_service = get_reminder_service()

        reset_time = None
        if reset_time_iso:
            reset_time = datetime.fromisoformat(reset_time_iso.replace("Z", "+00:00"))

        triggered = reminder_service.check_and_trigger(usage_percent, reset_time)

        return _json_response({
            "triggered": [
                {"type": t.value, "message": m}
                for t, m in triggered
            ]
        })
    except Exception as e:
        logger.error(f"Sidecar check_reminders error: {e}")
        return _json_response(error=str(e))


def main() -> None:
    """CLI entry point for sidecar."""
    if len(sys.argv) < 2:
        print(_json_response(error="Usage: sidecar <action> [args...]"))
        sys.exit(1)

    action = sys.argv[1]
    args = sys.argv[2:]

    # Configure minimal logging for sidecar
    logger.remove()
    logger.add(sys.stderr, level="ERROR")

    try:
        if action == "get_usage":
            result = asyncio.run(get_usage())
        elif action == "refresh_usage":
            result = asyncio.run(refresh_usage())
        elif action == "check_token":
            result = check_token()
        elif action == "get_config":
            result = get_config()
        elif action == "set_config":
            if not args:
                result = _json_response(error="set_config requires JSON argument")
            else:
                result = set_config(args[0])
        elif action == "snooze":
            if not args:
                result = _json_response(error="snooze requires minutes argument")
            else:
                result = snooze(int(args[0]))
        elif action == "clear_snooze":
            result = clear_snooze()
        elif action == "check_reminders":
            if len(args) < 1:
                result = _json_response(error="check_reminders requires usage_percent")
            else:
                usage = float(args[0])
                reset_time = args[1] if len(args) > 1 else None
                result = check_reminders(usage, reset_time)
        else:
            result = _json_response(error=f"Unknown action: {action}")

        print(result)

    except Exception as e:
        print(_json_response(error=str(e)))
        sys.exit(1)


if __name__ == "__main__":
    main()
</file>

<file path="src/frontend/src/components/dashboard/focus-mode-indicator.tsx">
import { useTranslation } from "react-i18next";

interface FocusModeIndicatorProps {
  enabled: boolean;
  onToggle: () => void;
}

export function FocusModeIndicator({
  enabled,
  onToggle,
}: FocusModeIndicatorProps) {
  const { t } = useTranslation();

  return (
    <div className={`focus-mode-indicator ${enabled ? "active" : ""}`}>
      <button onClick={onToggle} className="focus-toggle">
        <span className="icon">{enabled ? "🎯" : "💤"}</span>
        <span className="label">{t("dashboard.focusMode")}</span>
        <span className="status">{enabled ? "ON" : "OFF"}</span>
      </button>
    </div>
  );
}
</file>

<file path="src/frontend/src/components/dashboard/goals-widget.tsx">
import { useTranslation } from "react-i18next";

interface GoalsWidgetProps {
  budget: number;
  current: number;
  pace: "on-track" | "ahead" | "behind";
}

export function GoalsWidget({ budget, current, pace }: GoalsWidgetProps) {
  const { t } = useTranslation();
  const percentage = (current / budget) * 100;

  const paceIcons = {
    "on-track": "✓",
    ahead: "↑",
    behind: "↓",
  };

  const paceColors = {
    "on-track": "var(--success, #39ff14)",
    ahead: "var(--accent, #00e5ff)",
    behind: "var(--warning, #ffff00)",
  };

  return (
    <div className="goals-widget">
      <div className="goals-header">
        <span className="label">{t("dashboard.goals")}</span>
        <span className="pace" style={{ color: paceColors[pace] }}>
          {paceIcons[pace]} {pace}
        </span>
      </div>

      <div className="budget-bar-container">
        <div className="budget-bar">
          <div
            className="budget-fill"
            style={{
              width: `${Math.min(percentage, 100)}%`,
              background:
                percentage > 100
                  ? "var(--danger, #ff0000)"
                  : "var(--accent, #00e5ff)",
            }}
          />
        </div>
        <div className="budget-text">
          <span className="current">{current}</span>
          <span className="separator">/</span>
          <span className="total">{budget}</span>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/frontend/src/components/dashboard/grid-layout-wrapper.tsx">
import { ReactNode } from "react";
import { Responsive, useContainerWidth } from "react-grid-layout";
import { useGridLayout } from "../../hooks/use-grid-layout";
import "react-grid-layout/css/styles.css";
import "react-resizable/css/styles.css";

interface GridLayoutWrapperProps {
  children: ReactNode;
}

export function GridLayoutWrapper({ children }: GridLayoutWrapperProps) {
  const { layout, handleLayoutChange } = useGridLayout();
  const { width, containerRef, mounted } = useContainerWidth();

  if (!mounted) {
    return <div ref={containerRef as any}>Loading...</div>;
  }

  return (
    <div ref={containerRef as any}>
      <Responsive
        className="dashboard-grid"
        layouts={{ lg: layout }}
        breakpoints={{ lg: 1200, md: 996, sm: 768, xs: 480, xxs: 0 }}
        cols={{ lg: 12, md: 10, sm: 6, xs: 4, xxs: 2 }}
        rowHeight={40}
        width={width}
        onLayoutChange={handleLayoutChange}
      >
        {children}
      </Responsive>
    </div>
  );
}
</file>

<file path="src/frontend/src/components/dashboard/reset-countdown.tsx">
import { useTranslation } from "react-i18next";
import { useCountdown } from "../../hooks/use-countdown";

interface ResetCountdownProps {
  resetsAt: string;
}

export function ResetCountdown({ resetsAt }: ResetCountdownProps) {
  const { t } = useTranslation();
  const { hours, minutes, seconds, isExpired, humanReadable } =
    useCountdown(resetsAt);

  if (isExpired) {
    return (
      <div className="reset-countdown complete">
        <span className="neon-text">{t("dashboard.resetComplete")}</span>
      </div>
    );
  }

  return (
    <div className="reset-countdown">
      <span className="label">{t("dashboard.resetsIn")}</span>
      <span className="timer neon-text">
        {String(hours).padStart(2, "0")}:{String(minutes).padStart(2, "0")}:
        {String(seconds).padStart(2, "0")}
      </span>
      <span className="human-readable">{humanReadable}</span>
    </div>
  );
}
</file>

<file path="src/frontend/src/components/dashboard/stats-panel.tsx">
import { useTranslation } from "react-i18next";

interface StatsPanelProps {
  requestsUsed?: number;
  requestsLimit?: number;
  tokensUsed?: number;
  tokensLimit?: number;
}

export function StatsPanel({
  requestsUsed = 0,
  requestsLimit = 0,
  tokensUsed = 0,
  tokensLimit = 0,
}: StatsPanelProps) {
  const { t } = useTranslation();

  return (
    <div className="stats-panel">
      <div className="stat-item">
        <span className="stat-label">
          {t("dashboard.requests", "Requests")}
        </span>
        <span className="stat-value">
          {requestsUsed} / {requestsLimit}
        </span>
      </div>
      <div className="stat-item">
        <span className="stat-label">{t("dashboard.tokens", "Tokens")}</span>
        <span className="stat-value">
          {tokensUsed} / {tokensLimit}
        </span>
      </div>
    </div>
  );
}
</file>

<file path="src/frontend/src/components/dashboard/usage-display.tsx">
import { useTranslation } from "react-i18next";
import { useSettingsStore } from "../../stores/settings-store";
import { CircularProgress } from "../ui/circular-progress";
import { GaugeProgress } from "../ui/gauge-progress";

interface UsageDisplayProps {
  percentage: number;
}

export function UsageDisplay({ percentage }: UsageDisplayProps) {
  const { t } = useTranslation();
  const { progressBarType } = useSettingsStore();

  const getColor = (pct: number) => {
    if (pct < 33) return "var(--success, #39ff14)";
    if (pct < 66) return "var(--warning, #ffff00)";
    if (pct < 90) return "#ff8800";
    return "var(--danger, #ff0000)";
  };

  return (
    <div className="usage-display">
      <div className="usage-header">
        <span className="label">{t("dashboard.usage")}</span>
        {progressBarType === "linear" && (
          <span className="value neon-text">{percentage.toFixed(1)}%</span>
        )}
      </div>

      {progressBarType === "linear" && (
        <div className="progress-container">
          <div
            className="progress-fill"
            style={{
              width: `${percentage}%`,
              background: `linear-gradient(90deg, var(--accent, #00e5ff), ${getColor(percentage)})`,
            }}
          />
        </div>
      )}

      {progressBarType === "circular" && (
        <div className="progress-circular-wrapper">
          <CircularProgress percentage={percentage} />
        </div>
      )}

      {progressBarType === "gauge" && (
        <div className="progress-gauge-wrapper">
          <GaugeProgress percentage={percentage} />
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/frontend/src/components/settings/color-customizer.tsx">
import { useTranslation } from "react-i18next";
import { useThemeStore } from "../../stores/theme-store";

export function ColorCustomizer() {
  const { t } = useTranslation();
  const {
    colorLevel,
    setColorLevel,
    accentColor,
    setAccentColor,
    customColors,
    setCustomColors,
  } = useThemeStore();

  return (
    <div className="color-customizer">
      <label>{t("settings.colors")}</label>

      <div className="color-level-selector">
        <button
          className={colorLevel === "basic" ? "active" : ""}
          onClick={() => setColorLevel("basic")}
        >
          {t("colorLevels.basic")}
        </button>
        <button
          className={colorLevel === "advanced" ? "active" : ""}
          onClick={() => setColorLevel("advanced")}
        >
          {t("colorLevels.advanced")}
        </button>
        <button
          className={colorLevel === "expert" ? "active" : ""}
          onClick={() => setColorLevel("expert")}
        >
          {t("colorLevels.expert")}
        </button>
      </div>

      {colorLevel === "advanced" && (
        <div className="accent-picker">
          <label htmlFor="accent-color">Accent Color</label>
          <input
            type="color"
            id="accent-color"
            value={accentColor}
            onChange={(e) => setAccentColor(e.target.value)}
          />
        </div>
      )}

      {colorLevel === "expert" && (
        <div className="full-customization">
          <div className="color-input">
            <label>Background Primary</label>
            <input
              type="color"
              value={customColors.bgPrimary || "#1a1a1a"}
              onChange={(e) =>
                setCustomColors({ ...customColors, bgPrimary: e.target.value })
              }
            />
          </div>
          <div className="color-input">
            <label>Text Primary</label>
            <input
              type="color"
              value={customColors.textPrimary || "#ffffff"}
              onChange={(e) =>
                setCustomColors({
                  ...customColors,
                  textPrimary: e.target.value,
                })
              }
            />
          </div>
          <div className="color-input">
            <label>Accent</label>
            <input
              type="color"
              value={customColors.accent || "#00e5ff"}
              onChange={(e) =>
                setCustomColors({ ...customColors, accent: e.target.value })
              }
            />
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/frontend/src/components/settings/font-size-slider.tsx">
import { useTranslation } from "react-i18next";
import { useSettingsStore } from "../../stores/settings-store";

export function FontSizeSlider() {
  const { t } = useTranslation();
  const { fontSize, setFontSize } = useSettingsStore();

  return (
    <div className="font-size-slider">
      <label htmlFor="font-size">
        {t("settings.fontSize")}: {fontSize}%
      </label>
      <input
        type="range"
        id="font-size"
        min="80"
        max="150"
        step="5"
        value={fontSize}
        onChange={(e) => setFontSize(Number(e.target.value))}
      />
      <div className="range-labels">
        <span>80%</span>
        <span>100%</span>
        <span>150%</span>
      </div>
    </div>
  );
}
</file>

<file path="src/frontend/src/components/settings/language-switcher.tsx">
import { useTranslation } from "react-i18next";
import { useI18nStore } from "../../stores/i18n-store";

export function LanguageSwitcher() {
  const { t } = useTranslation();
  const { language, setLanguage } = useI18nStore();

  return (
    <div className="language-switcher">
      <label htmlFor="language-select">{t("settings.language")}</label>
      <select
        id="language-select"
        value={language}
        onChange={(e) => setLanguage(e.target.value as "en" | "vi")}
      >
        <option value="en">English</option>
        <option value="vi">Tiếng Việt</option>
      </select>
    </div>
  );
}
</file>

<file path="src/frontend/src/components/settings/progress-bar-picker.tsx">
import { useTranslation } from "react-i18next";
import {
  useSettingsStore,
  type ProgressBarType,
} from "../../stores/settings-store";

export function ProgressBarPicker() {
  const { t } = useTranslation();
  const { progressBarType, setProgressBarType } = useSettingsStore();

  const types: ProgressBarType[] = ["linear", "circular", "gauge"];

  return (
    <div className="progress-bar-picker">
      <label>{t("settings.progressBar")}</label>
      <div className="type-buttons">
        {types.map((type) => (
          <button
            key={type}
            className={progressBarType === type ? "active" : ""}
            onClick={() => setProgressBarType(type)}
          >
            {t(`progressTypes.${type}`)}
          </button>
        ))}
      </div>
    </div>
  );
}
</file>

<file path="src/frontend/src/components/settings/theme-switcher.tsx">
import { useTranslation } from "react-i18next";
import { useThemeStore } from "../../stores/theme-store";
import type { ThemeName } from "../../types/theme";

const themes: { value: ThemeName; label: string }[] = [
  { value: "system", label: "themes.system" },
  { value: "light", label: "themes.light" },
  { value: "dark", label: "themes.dark" },
  { value: "neon-light", label: "themes.neonLight" },
  { value: "neon-dark", label: "themes.neonDark" },
  { value: "glass-light", label: "themes.glassLight" },
  { value: "glass-dark", label: "themes.glassDark" },
];

export function ThemeSwitcher() {
  const { t } = useTranslation();
  const { theme, setTheme } = useThemeStore();

  return (
    <div className="theme-switcher">
      <label htmlFor="theme-select">{t("settings.theme")}</label>
      <select
        id="theme-select"
        value={theme}
        onChange={(e) => setTheme(e.target.value as ThemeName)}
      >
        {themes.map((themeOption) => (
          <option key={themeOption.value} value={themeOption.value}>
            {t(themeOption.label)}
          </option>
        ))}
      </select>
    </div>
  );
}
</file>

<file path="src/frontend/src/components/ui/circular-progress.css">
.circular-progress {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.circular-progress__svg {
  transform: rotate(-90deg);
}

.circular-progress__background {
  fill: none;
  stroke: var(--bg-secondary, rgba(0, 0, 0, 0.1));
}

.circular-progress__progress {
  fill: none;
  stroke-linecap: round;
  transition:
    stroke-dashoffset 0.5s ease,
    stroke 0.3s ease;
}

.circular-progress--animated .circular-progress__progress {
  transition:
    stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1),
    stroke 0.3s ease;
}

.circular-progress__text {
  position: absolute;
  display: flex;
  align-items: baseline;
  font-weight: 700;
}

.circular-progress__percentage {
  font-size: 2rem;
  line-height: 1;
  color: var(--text-primary, #1a1a1a);
}

.circular-progress__symbol {
  font-size: 1rem;
  margin-left: 0.15rem;
  color: var(--text-secondary, #666);
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  .circular-progress__background {
    stroke: var(--bg-secondary, rgba(255, 255, 255, 0.1));
  }

  .circular-progress__percentage {
    color: var(--text-primary, #f5f5f5);
  }

  .circular-progress__symbol {
    color: var(--text-secondary, #aaa);
  }
}
</file>

<file path="src/frontend/src/components/ui/circular-progress.tsx">
import React, { useMemo } from "react";
import "./circular-progress.css";

export interface CircularProgressProps {
  percentage: number;
  size?: number;
  strokeWidth?: number;
  className?: string;
  showPercentage?: boolean;
  color?: "accent" | "success" | "warning" | "danger" | "auto";
  animated?: boolean;
}

/**
 * Circular SVG progress indicator with center percentage display.
 * Automatically adjusts color based on usage when color is set to 'auto'.
 */
export const CircularProgress: React.FC<CircularProgressProps> = ({
  percentage,
  size = 120,
  strokeWidth = 8,
  className = "",
  showPercentage = true,
  color = "auto",
  animated = true,
}) => {
  const normalizedPercentage = Math.min(Math.max(percentage, 0), 100);

  const radius = (size - strokeWidth) / 2;
  const circumference = 2 * Math.PI * radius;
  const offset = circumference - (normalizedPercentage / 100) * circumference;

  // Auto color based on percentage
  const progressColor = useMemo(() => {
    if (color !== "auto") {
      return `var(--${color})`;
    }

    if (normalizedPercentage < 50) {
      return "var(--success, #22c55e)";
    } else if (normalizedPercentage < 80) {
      return "var(--warning, #f59e0b)";
    } else {
      return "var(--danger, #ef4444)";
    }
  }, [normalizedPercentage, color]);

  const animatedClass = animated ? "circular-progress--animated" : "";

  return (
    <div className={`circular-progress ${animatedClass} ${className}`}>
      <svg width={size} height={size} className="circular-progress__svg">
        {/* Background circle */}
        <circle
          className="circular-progress__background"
          cx={size / 2}
          cy={size / 2}
          r={radius}
          strokeWidth={strokeWidth}
        />

        {/* Progress circle */}
        <circle
          className="circular-progress__progress"
          cx={size / 2}
          cy={size / 2}
          r={radius}
          strokeWidth={strokeWidth}
          strokeDasharray={circumference}
          strokeDashoffset={offset}
          style={{ stroke: progressColor }}
        />
      </svg>

      {showPercentage && (
        <div className="circular-progress__text">
          <span className="circular-progress__percentage">
            {normalizedPercentage.toFixed(0)}
          </span>
          <span className="circular-progress__symbol">%</span>
        </div>
      )}
    </div>
  );
};
</file>

<file path="src/frontend/src/components/ui/demo.tsx">
import React from "react";
import { GlassCard } from "./glass-card";
import { NeonText } from "./neon-text";
import { CircularProgress } from "./circular-progress";
import { GaugeProgress } from "./gauge-progress";

/**
 * Demo component showcasing all UI components.
 * This file is for development/testing purposes only.
 */
export const UIDemo: React.FC = () => {
  return (
    <div
      style={{
        padding: "2rem",
        display: "flex",
        flexDirection: "column",
        gap: "2rem",
      }}
    >
      <section>
        <h2>Glass Card</h2>
        <div style={{ display: "flex", gap: "1rem", flexWrap: "wrap" }}>
          <GlassCard blur="light">
            <h3>Light Blur</h3>
            <p>8px backdrop filter</p>
          </GlassCard>
          <GlassCard blur="medium">
            <h3>Medium Blur</h3>
            <p>16px backdrop filter</p>
          </GlassCard>
          <GlassCard blur="heavy">
            <h3>Heavy Blur</h3>
            <p>24px backdrop filter</p>
          </GlassCard>
        </div>
      </section>

      <section>
        <h2>Neon Text</h2>
        <div style={{ display: "flex", flexDirection: "column", gap: "1rem" }}>
          <NeonText color="accent" intensity="low">
            Accent Low Intensity
          </NeonText>
          <NeonText color="success" intensity="medium">
            Success Medium Intensity
          </NeonText>
          <NeonText color="warning" intensity="high">
            Warning High Intensity
          </NeonText>
          <NeonText color="danger" intensity="high" animated>
            Danger Animated
          </NeonText>
          <NeonText customColor="#00ff00" intensity="high">
            Custom Green Color
          </NeonText>
        </div>
      </section>

      <section>
        <h2>Circular Progress</h2>
        <div style={{ display: "flex", gap: "2rem", flexWrap: "wrap" }}>
          <CircularProgress percentage={25} />
          <CircularProgress percentage={55} />
          <CircularProgress percentage={85} />
          <CircularProgress
            percentage={95}
            color="danger"
            size={150}
            strokeWidth={12}
          />
        </div>
      </section>

      <section>
        <h2>Gauge Progress</h2>
        <div style={{ display: "flex", gap: "2rem", flexWrap: "wrap" }}>
          <GaugeProgress percentage={25} label="Low Usage" />
          <GaugeProgress percentage={55} label="Medium Usage" />
          <GaugeProgress percentage={85} label="High Usage" />
          <GaugeProgress percentage={95} label="Critical" size={250} />
        </div>
      </section>
    </div>
  );
};
</file>

<file path="src/frontend/src/components/ui/gauge-progress.css">
.gauge-progress {
  position: relative;
  display: inline-flex;
  flex-direction: column;
  align-items: center;
}

.gauge-progress__svg {
  display: block;
}

.gauge-progress__background {
  stroke: var(--bg-secondary, rgba(0, 0, 0, 0.1));
  stroke-linecap: round;
}

.gauge-progress__arc {
  stroke-linecap: round;
  transition: stroke-dashoffset 0.5s ease;
}

.gauge-progress--animated .gauge-progress__arc {
  transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.gauge-progress__needle {
  transition: transform 0.5s ease;
  transform-origin: center;
}

.gauge-progress--animated .gauge-progress__needle {
  transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.gauge-progress__info {
  margin-top: 0.5rem;
  text-align: center;
}

.gauge-progress__value {
  font-size: 2.5rem;
  font-weight: 700;
  line-height: 1;
  color: var(--text-primary, #1a1a1a);
}

.gauge-progress__symbol {
  font-size: 1.25rem;
  margin-left: 0.25rem;
  color: var(--text-secondary, #666);
}

.gauge-progress__label {
  margin-top: 0.5rem;
  font-size: 0.875rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-secondary, #666);
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  .gauge-progress__background {
    stroke: var(--bg-secondary, rgba(255, 255, 255, 0.1));
  }

  .gauge-progress__needle line,
  .gauge-progress__needle circle {
    stroke: var(--text-primary, #f5f5f5);
    fill: var(--text-primary, #f5f5f5);
  }

  .gauge-progress__value {
    color: var(--text-primary, #f5f5f5);
  }

  .gauge-progress__symbol,
  .gauge-progress__label {
    color: var(--text-secondary, #aaa);
  }
}
</file>

<file path="src/frontend/src/components/ui/gauge-progress.tsx">
import React, { useMemo } from "react";
import "./gauge-progress.css";

export interface GaugeProgressProps {
  percentage: number;
  size?: number;
  className?: string;
  showValue?: boolean;
  label?: string;
  animated?: boolean;
}

/**
 * Gauge/speedometer style progress indicator.
 * Arc from 0-180 degrees with gradient from green to yellow to red.
 * Needle rotates based on percentage value.
 */
export const GaugeProgress: React.FC<GaugeProgressProps> = ({
  percentage,
  size = 200,
  className = "",
  showValue = true,
  label,
  animated = true,
}) => {
  const normalizedPercentage = Math.min(Math.max(percentage, 0), 100);

  // Calculate needle rotation (0% = -90deg, 100% = 90deg)
  const needleRotation = -90 + (normalizedPercentage / 100) * 180;

  // SVG dimensions
  const strokeWidth = size * 0.08;
  const radius = (size - strokeWidth) / 2;
  const centerX = size / 2;
  const centerY = size / 2;

  // Create arc path (semicircle from -90deg to 90deg)
  const arcPath = useMemo(() => {
    const startAngle = -Math.PI / 2; // -90deg
    const endAngle = Math.PI / 2; // 90deg

    const startX = centerX + radius * Math.cos(startAngle);
    const startY = centerY + radius * Math.sin(startAngle);
    const endX = centerX + radius * Math.cos(endAngle);
    const endY = centerY + radius * Math.sin(endAngle);

    return `M ${startX} ${startY} A ${radius} ${radius} 0 0 1 ${endX} ${endY}`;
  }, [centerX, centerY, radius]);

  // Gradient stops for green -> yellow -> red
  const gradientId = `gauge-gradient-${Math.random().toString(36).substr(2, 9)}`;

  const animatedClass = animated ? "gauge-progress--animated" : "";

  return (
    <div className={`gauge-progress ${animatedClass} ${className}`}>
      <svg width={size} height={size * 0.65} className="gauge-progress__svg">
        <defs>
          {/* Gradient definition */}
          <linearGradient id={gradientId} x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stopColor="var(--success, #22c55e)" />
            <stop offset="50%" stopColor="var(--warning, #f59e0b)" />
            <stop offset="100%" stopColor="var(--danger, #ef4444)" />
          </linearGradient>
        </defs>

        {/* Background arc */}
        <path
          className="gauge-progress__background"
          d={arcPath}
          strokeWidth={strokeWidth}
          fill="none"
        />

        {/* Progress arc */}
        <path
          className="gauge-progress__arc"
          d={arcPath}
          strokeWidth={strokeWidth}
          fill="none"
          stroke={`url(#${gradientId})`}
          strokeDasharray={Math.PI * radius}
          strokeDashoffset={Math.PI * radius * (1 - normalizedPercentage / 100)}
        />

        {/* Needle */}
        <g
          className="gauge-progress__needle"
          transform={`rotate(${needleRotation} ${centerX} ${centerY})`}
        >
          <line
            x1={centerX}
            y1={centerY}
            x2={centerX + radius * 0.7}
            y2={centerY}
            strokeWidth={strokeWidth * 0.3}
            stroke="var(--text-primary, #1a1a1a)"
            strokeLinecap="round"
          />
          {/* Center dot */}
          <circle
            cx={centerX}
            cy={centerY}
            r={strokeWidth * 0.5}
            fill="var(--text-primary, #1a1a1a)"
          />
        </g>
      </svg>

      {/* Value and label */}
      {(showValue || label) && (
        <div className="gauge-progress__info">
          {showValue && (
            <div className="gauge-progress__value">
              {normalizedPercentage.toFixed(0)}
              <span className="gauge-progress__symbol">%</span>
            </div>
          )}
          {label && <div className="gauge-progress__label">{label}</div>}
        </div>
      )}
    </div>
  );
};
</file>

<file path="src/frontend/src/components/ui/glass-card.css">
.glass-card {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 1.5rem;
  position: relative;
  overflow: hidden;
}

.glass-card--blur-light {
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

.glass-card--blur-medium {
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
}

.glass-card--blur-heavy {
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);
}

.glass-card--border {
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.glass-card--clickable {
  cursor: pointer;
  transition: all 0.3s ease;
}

.glass-card--clickable:hover {
  background: rgba(255, 255, 255, 0.15);
  transform: translateY(-2px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}

.glass-card--clickable:active {
  transform: translateY(0);
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  .glass-card {
    background: rgba(0, 0, 0, 0.3);
  }

  .glass-card--border {
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

  .glass-card--clickable:hover {
    background: rgba(0, 0, 0, 0.4);
  }
}
</file>

<file path="src/frontend/src/components/ui/glass-card.tsx">
import React from "react";
import "./glass-card.css";

export interface GlassCardProps {
  children: React.ReactNode;
  className?: string;
  blur?: "light" | "medium" | "heavy";
  border?: boolean;
  onClick?: () => void;
}

/**
 * Glassmorphism container with backdrop-filter blur effect.
 * Supports three blur levels: light (8px), medium (16px), heavy (24px).
 */
export const GlassCard: React.FC<GlassCardProps> = ({
  children,
  className = "",
  blur = "medium",
  border = true,
  onClick,
}) => {
  const blurClass = `glass-card--blur-${blur}`;
  const borderClass = border ? "glass-card--border" : "";
  const clickableClass = onClick ? "glass-card--clickable" : "";

  return (
    <div
      className={`glass-card ${blurClass} ${borderClass} ${clickableClass} ${className}`}
      onClick={onClick}
    >
      {children}
    </div>
  );
};
</file>

<file path="src/frontend/src/components/ui/index.ts">
export { GlassCard, type GlassCardProps } from "./glass-card";
export { NeonText, type NeonTextProps } from "./neon-text";
export {
  CircularProgress,
  type CircularProgressProps,
} from "./circular-progress";
export { GaugeProgress, type GaugeProgressProps } from "./gauge-progress";
</file>

<file path="src/frontend/src/components/ui/neon-text.css">
.neon-text {
  font-weight: 600;
  letter-spacing: 0.05em;
}

/* Intensity levels */
.neon-text--low {
  text-shadow:
    0 0 5px var(--neon-color, var(--accent)),
    0 0 10px var(--neon-color, var(--accent));
}

.neon-text--medium {
  text-shadow:
    0 0 7px var(--neon-color, var(--accent)),
    0 0 14px var(--neon-color, var(--accent)),
    0 0 21px var(--neon-color, var(--accent));
}

.neon-text--high {
  text-shadow:
    0 0 10px var(--neon-color, var(--accent)),
    0 0 20px var(--neon-color, var(--accent)),
    0 0 30px var(--neon-color, var(--accent)),
    0 0 40px var(--neon-color, var(--accent));
}

/* Color variants */
.neon-text--accent {
  color: var(--accent, #646cff);
  --neon-color: var(--accent, #646cff);
}

.neon-text--success {
  color: var(--success, #22c55e);
  --neon-color: var(--success, #22c55e);
}

.neon-text--warning {
  color: var(--warning, #f59e0b);
  --neon-color: var(--warning, #f59e0b);
}

.neon-text--danger {
  color: var(--danger, #ef4444);
  --neon-color: var(--danger, #ef4444);
}

/* Animation */
@keyframes neon-pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

.neon-text--animated {
  animation: neon-pulse 2s ease-in-out infinite;
}

/* Accessibility: reduce motion */
@media (prefers-reduced-motion: reduce) {
  .neon-text--animated {
    animation: none;
  }
}
</file>

<file path="src/frontend/src/components/ui/neon-text.tsx">
import React from "react";
import "./neon-text.css";

export interface NeonTextProps {
  children: React.ReactNode;
  className?: string;
  color?: "accent" | "success" | "warning" | "danger" | "custom";
  customColor?: string;
  intensity?: "low" | "medium" | "high";
  animated?: boolean;
  as?: "h1" | "h2" | "h3" | "h4" | "h5" | "h6" | "p" | "span";
}

/**
 * Text component with neon glow effect using text-shadow.
 * Supports multiple colors via CSS variables and custom colors.
 */
export const NeonText: React.FC<NeonTextProps> = ({
  children,
  className = "",
  color = "accent",
  customColor,
  intensity = "medium",
  animated = false,
  as: Component = "span",
}) => {
  const colorClass = customColor ? "" : `neon-text--${color}`;
  const intensityClass = `neon-text--${intensity}`;
  const animatedClass = animated ? "neon-text--animated" : "";

  const style = customColor
    ? ({
        "--neon-color": customColor,
      } as React.CSSProperties)
    : undefined;

  return (
    <Component
      className={`neon-text ${colorClass} ${intensityClass} ${animatedClass} ${className}`}
      style={style}
    >
      {children}
    </Component>
  );
};
</file>

<file path="src/frontend/src/components/ui/README.md">
# UI Components

Bộ UI components có thể tái sử dụng cho claudiminder frontend với hiệu ứng glassmorphism và neon.

## Components

### GlassCard

Container có hiệu ứng glassmorphism với backdrop-filter blur.

**Props:**

- `children`: React.ReactNode - Nội dung bên trong card
- `className?`: string - CSS class tùy chỉnh
- `blur?`: 'light' | 'medium' | 'heavy' - Mức độ blur (mặc định: 'medium')
  - light: 8px
  - medium: 16px
  - heavy: 24px
- `border?`: boolean - Hiển thị border (mặc định: true)
- `onClick?`: () => void - Click handler

**Ví dụ:**

```tsx
import { GlassCard } from "./components/ui";

<GlassCard blur="heavy" border={true}>
  <h3>Card Title</h3>
  <p>Card content</p>
</GlassCard>;
```

### NeonText

Text component với hiệu ứng neon glow sử dụng text-shadow.

**Props:**

- `children`: React.ReactNode - Nội dung text
- `className?`: string - CSS class tùy chỉnh
- `color?`: 'accent' | 'success' | 'warning' | 'danger' | 'custom' - Màu sắc (mặc định: 'accent')
- `customColor?`: string - Màu tùy chỉnh (hex/rgb)
- `intensity?`: 'low' | 'medium' | 'high' - Độ sáng (mặc định: 'medium')
- `animated?`: boolean - Animation pulse (mặc định: false)
- `as?`: 'h1' | 'h2' | ... | 'span' - HTML tag (mặc định: 'span')

**Ví dụ:**

```tsx
import { NeonText } from './components/ui';

<NeonText color="success" intensity="high" animated>
  High Usage Alert
</NeonText>

<NeonText customColor="#00ff00" intensity="medium" as="h1">
  Custom Color
</NeonText>
```

### CircularProgress

Circular SVG progress indicator với hiển thị phần trăm ở giữa.

**Props:**

- `percentage`: number - Giá trị phần trăm (0-100)
- `size?`: number - Kích thước (px, mặc định: 120)
- `strokeWidth?`: number - Độ dày đường viền (mặc định: 8)
- `className?`: string - CSS class tùy chỉnh
- `showPercentage?`: boolean - Hiển thị % ở giữa (mặc định: true)
- `color?`: 'accent' | 'success' | 'warning' | 'danger' | 'auto' - Màu (mặc định: 'auto')
  - auto: Tự động chọn màu dựa trên percentage
    - < 50%: success (green)
    - 50-80%: warning (yellow)
    - > 80%: danger (red)
- `animated?`: boolean - Animation (mặc định: true)

**Ví dụ:**

```tsx
import { CircularProgress } from './components/ui';

<CircularProgress percentage={75} size={150} strokeWidth={10} />
<CircularProgress percentage={95} color="danger" />
```

### GaugeProgress

Gauge/speedometer style progress indicator với arc 0-180 độ.

**Props:**

- `percentage`: number - Giá trị phần trăm (0-100)
- `size?`: number - Kích thước (px, mặc định: 200)
- `className?`: string - CSS class tùy chỉnh
- `showValue?`: boolean - Hiển thị giá trị (mặc định: true)
- `label?`: string - Nhãn phía dưới
- `animated?`: boolean - Animation (mặc định: true)

**Features:**

- Arc từ -90° đến 90° (semicircle)
- Gradient từ green → yellow → red
- Kim xoay theo giá trị percentage
- Center dot và value text

**Ví dụ:**

```tsx
import { GaugeProgress } from './components/ui';

<GaugeProgress percentage={65} label="CPU Usage" />
<GaugeProgress percentage={95} size={250} label="Critical" />
```

## CSS Variables

Các components sử dụng CSS variables để tùy chỉnh màu sắc:

```css
:root {
  --accent: #646cff;
  --bg-secondary: rgba(0, 0, 0, 0.1);
  --success: #22c55e;
  --warning: #f59e0b;
  --danger: #ef4444;
  --text-primary: #1a1a1a;
  --text-secondary: #666;
}
```

## Dark Mode

Tất cả components đều hỗ trợ dark mode tự động thông qua `prefers-color-scheme`.

## Demo

Xem file `demo.tsx` để xem ví dụ sử dụng tất cả components.

```bash
# Import demo component
import { UIDemo } from './components/ui/demo';

# Use in your app
<UIDemo />
```
</file>

<file path="src/frontend/src/components/.gitkeep">

</file>

<file path="src/frontend/src/hooks/index.ts">
export { useCountdown } from "./use-countdown";
export { useTheme } from "./use-theme";
export { useGridLayout } from "./use-grid-layout";
export { useUsage } from "./use-usage";
</file>

<file path="src/frontend/src/hooks/use-countdown.ts">
import { useEffect, useState } from "react";

interface CountdownResult {
  hours: number;
  minutes: number;
  seconds: number;
  totalSeconds: number;
  isExpired: boolean;
  humanReadable: string;
}

export function useCountdown(targetDate: string): CountdownResult {
  const [timeLeft, setTimeLeft] = useState<number>(0);

  useEffect(() => {
    const calculateTimeLeft = () => {
      const target = new Date(targetDate).getTime();
      const now = Date.now();
      const diff = Math.max(0, Math.floor((target - now) / 1000));
      setTimeLeft(diff);
    };

    calculateTimeLeft();
    const interval = setInterval(calculateTimeLeft, 1000);

    return () => clearInterval(interval);
  }, [targetDate]);

  const hours = Math.floor(timeLeft / 3600);
  const minutes = Math.floor((timeLeft % 3600) / 60);
  const seconds = timeLeft % 60;
  const isExpired = timeLeft === 0;

  const humanReadable = (() => {
    if (isExpired) return "Expired";
    if (hours > 0) return `${hours}h ${minutes}m left`;
    if (minutes > 0) return `${minutes}m ${seconds}s left`;
    return `${seconds}s left`;
  })();

  return {
    hours,
    minutes,
    seconds,
    totalSeconds: timeLeft,
    isExpired,
    humanReadable,
  };
}
</file>

<file path="src/frontend/src/hooks/use-grid-layout.ts">
import { useCallback } from "react";
import type { Layout, LayoutItem } from "react-grid-layout";
import { useSettingsStore } from "../stores/settings-store";

interface UseGridLayoutResult {
  layout: LayoutItem[];
  handleLayoutChange: (newLayout: Layout) => void;
}

export function useGridLayout(): UseGridLayoutResult {
  const { layout, setLayout } = useSettingsStore();

  const handleLayoutChange = useCallback(
    (newLayout: Layout) => {
      setLayout([...newLayout]);
    },
    [setLayout],
  );

  return {
    layout,
    handleLayoutChange,
  };
}
</file>

<file path="src/frontend/src/hooks/use-theme.ts">
import { useCallback, useEffect } from "react";
import { useThemeStore } from "../stores/theme-store";
import type { ThemeName } from "../types/theme";

interface UseThemeResult {
  theme: ThemeName;
  setTheme: (theme: ThemeName) => void;
  applyTheme: (themeName?: ThemeName) => void;
}

const getSystemTheme = (): "light" | "dark" => {
  if (typeof window === "undefined") return "light";
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};

export function useTheme(): UseThemeResult {
  const { theme, setTheme } = useThemeStore();

  const applyTheme = useCallback(
    (themeName?: ThemeName) => {
      const themeToApply = themeName ?? theme;
      const resolvedTheme =
        themeToApply === "system" ? getSystemTheme() : themeToApply;
      document.documentElement.setAttribute("data-theme", resolvedTheme);
    },
    [theme],
  );

  useEffect(() => {
    applyTheme(theme);
  }, [theme, applyTheme]);

  useEffect(() => {
    if (theme !== "system") return;

    const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
    const handleChange = () => applyTheme("system");

    mediaQuery.addEventListener("change", handleChange);
    return () => mediaQuery.removeEventListener("change", handleChange);
  }, [theme, applyTheme]);

  return {
    theme,
    setTheme,
    applyTheme,
  };
}
</file>

<file path="src/frontend/src/hooks/use-usage.ts">
import { invoke } from "@tauri-apps/api/core";
import { useCallback, useEffect, useRef, useState } from "react";
import type { UsageResponse } from "../types/usage";
import { updateTray } from "../utils/tray";
import {
  notifyUsageWarning,
  notifyOffline,
  notifyRateLimited,
} from "../utils/notifications";
import { handleTokenExpired } from "../utils/token-refresh";

export function useUsage(pollInterval = 60000) {
  const [usage, setUsage] = useState<UsageResponse | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [isOffline, setIsOffline] = useState(false);
  const [isRateLimited, setIsRateLimited] = useState(false);

  const lastPercentageRef = useRef<number | null>(null);

  const fetchUsage = useCallback(async () => {
    try {
      setLoading(true);

      const result = await invoke<UsageResponse>("get_usage");

      // Check for error states
      if (result.token_expired) {
        await handleTokenExpired();
        setError("Token expired. Please re-login.");
        return;
      }

      if (result.rate_limited) {
        setIsRateLimited(true);
        await notifyRateLimited();
        setError("Rate limit exceeded");
        return;
      }

      if (result.offline) {
        setIsOffline(true);
        await notifyOffline();
        setError("Network error");
        return;
      }

      // Success - clear error states
      setIsRateLimited(false);
      setIsOffline(false);
      setUsage(result);
      setError(result.error || null);

      // Update tray and check notifications
      if (result.five_hour) {
        const { utilization, resets_at } = result.five_hour;
        const percentage = utilization * 100;

        // Update tray with full details
        await updateTray(
          utilization,
          resets_at,
          result.five_hour.input_tokens_used || 0,
          result.five_hour.input_tokens_limit || 0,
        );

        // Check for usage warnings (only on increase)
        if (
          lastPercentageRef.current !== null &&
          percentage > lastPercentageRef.current
        ) {
          await notifyUsageWarning(percentage);
        }
        lastPercentageRef.current = percentage;
      }
    } catch (e: unknown) {
      const errorMessage = e instanceof Error ? e.message : String(e);

      // Check if it's a network error
      if (
        errorMessage.toLowerCase().includes("network") ||
        errorMessage.toLowerCase().includes("connection")
      ) {
        setIsOffline(true);
        await notifyOffline();
      }

      setError(errorMessage);
    } finally {
      setLoading(false);
    }
  }, []);

  useEffect(() => {
    fetchUsage();
    const interval = setInterval(fetchUsage, pollInterval);
    return () => clearInterval(interval);
  }, [fetchUsage, pollInterval]);

  return {
    usage,
    loading,
    error,
    isOffline,
    isRateLimited,
    refresh: fetchUsage,
  };
}
</file>

<file path="src/frontend/src/i18n/en.json">
{
  "dashboard": {
    "title": "Claude Usage",
    "usage": "Usage",
    "resetsIn": "Resets in",
    "resetComplete": "Reset Complete!",
    "refresh": "Refresh",
    "goals": "Goals",
    "budget": "Budget",
    "pace": "Pace",
    "focusMode": "Focus Mode"
  },
  "settings": {
    "theme": "Theme",
    "language": "Language",
    "fontSize": "Font Size",
    "progressBar": "Progress Bar Style",
    "colors": "Colors",
    "layout": "Layout"
  },
  "themes": {
    "system": "System",
    "light": "Light",
    "dark": "Dark",
    "neonLight": "Neon Light",
    "neonDark": "Neon Dark",
    "glassLight": "Glass Light",
    "glassDark": "Glass Dark"
  },
  "progressTypes": {
    "linear": "Linear",
    "circular": "Circular",
    "gauge": "Gauge"
  },
  "colorLevels": {
    "basic": "Theme Presets",
    "advanced": "Accent Color",
    "expert": "Full Customization"
  }
}
</file>

<file path="src/frontend/src/i18n/index.ts">
import i18n from "i18next";
import { initReactI18next } from "react-i18next";
import en from "./en.json";
import vi from "./vi.json";

i18n.use(initReactI18next).init({
  resources: {
    en: { translation: en },
    vi: { translation: vi },
  },
  lng: "en",
  fallbackLng: "en",
  interpolation: {
    escapeValue: false,
  },
});

export default i18n;
</file>

<file path="src/frontend/src/i18n/vi.json">
{
  "dashboard": {
    "title": "Sử Dụng Claude",
    "usage": "Đã dùng",
    "resetsIn": "Reset sau",
    "resetComplete": "Đã Reset!",
    "refresh": "Làm mới",
    "goals": "Mục tiêu",
    "budget": "Ngân sách",
    "pace": "Tốc độ",
    "focusMode": "Chế độ tập trung"
  },
  "settings": {
    "theme": "Giao diện",
    "language": "Ngôn ngữ",
    "fontSize": "Cỡ chữ",
    "progressBar": "Kiểu thanh tiến trình",
    "colors": "Màu sắc",
    "layout": "Bố cục"
  },
  "themes": {
    "system": "Hệ thống",
    "light": "Sáng",
    "dark": "Tối",
    "neonLight": "Neon Sáng",
    "neonDark": "Neon Tối",
    "glassLight": "Thủy tinh Sáng",
    "glassDark": "Thủy tinh Tối"
  },
  "progressTypes": {
    "linear": "Dạng thanh",
    "circular": "Dạng tròn",
    "gauge": "Dạng đồng hồ"
  },
  "colorLevels": {
    "basic": "Giao diện có sẵn",
    "advanced": "Màu nhấn",
    "expert": "Tùy chỉnh đầy đủ"
  }
}
</file>

<file path="src/frontend/src/stores/.gitkeep">

</file>

<file path="src/frontend/src/stores/i18n-store.ts">
import { create } from "zustand";
import { persist } from "zustand/middleware";
import i18n from "../i18n";

interface I18nStore {
  language: "en" | "vi";
  setLanguage: (lang: "en" | "vi") => void;
}

export const useI18nStore = create<I18nStore>()(
  persist(
    (set) => ({
      language: "en",
      setLanguage: (lang) => {
        set({ language: lang });
        i18n.changeLanguage(lang);
      },
    }),
    { name: "claudiminder-language" },
  ),
);
</file>

<file path="src/frontend/src/stores/index.ts">
export { useThemeStore } from "./theme-store";
export { useSettingsStore } from "./settings-store";
export { useI18nStore } from "./i18n-store";
</file>

<file path="src/frontend/src/stores/settings-store.ts">
import { create } from "zustand";
import { persist } from "zustand/middleware";
import type { LayoutItem } from "react-grid-layout";

export type ProgressBarType = "linear" | "circular" | "gauge";

interface SettingsStore {
  fontSize: number; // 80-150
  layout: LayoutItem[];
  progressBarType: ProgressBarType;
  setFontSize: (size: number) => void;
  setLayout: (layout: LayoutItem[]) => void;
  setProgressBarType: (type: ProgressBarType) => void;
}

const defaultLayout: LayoutItem[] = [
  { i: "usage", x: 0, y: 0, w: 6, h: 4 },
  { i: "countdown", x: 6, y: 0, w: 6, h: 2 },
  { i: "goals", x: 6, y: 2, w: 6, h: 2 },
  { i: "stats", x: 0, y: 4, w: 12, h: 2 },
];

export const useSettingsStore = create<SettingsStore>()(
  persist(
    (set) => ({
      layout: defaultLayout,
      fontSize: 100,
      progressBarType: "linear",
      setLayout: (layout) => set({ layout }),
      setFontSize: (size) => {
        const clamped = Math.max(80, Math.min(150, size));
        set({ fontSize: clamped });
        document.documentElement.style.fontSize = `${clamped}%`;
      },
      setProgressBarType: (type) => set({ progressBarType: type }),
    }),
    {
      name: "claudiminder-settings",
    },
  ),
);
</file>

<file path="src/frontend/src/stores/theme-store.ts">
import { create } from "zustand";
import { persist } from "zustand/middleware";
import type { ThemeName } from "../types/theme";

export type ColorLevel = "basic" | "advanced" | "expert";

export interface ColorScheme {
  bgPrimary?: string;
  bgSecondary?: string;
  textPrimary?: string;
  textSecondary?: string;
  accent?: string;
  success?: string;
  warning?: string;
  danger?: string;
}

interface ThemeStore {
  theme: ThemeName;
  colorLevel: ColorLevel;
  accentColor: string;
  customColors: ColorScheme;
  setTheme: (theme: ThemeName) => void;
  setColorLevel: (level: ColorLevel) => void;
  setAccentColor: (color: string) => void;
  setCustomColors: (colors: ColorScheme) => void;
}

export const useThemeStore = create<ThemeStore>()(
  persist(
    (set, get) => ({
      theme: "neon-dark",
      colorLevel: "basic",
      accentColor: "#00e5ff",
      customColors: {},
      setTheme: (theme) => {
        set({ theme });
        applyTheme(theme, get().customColors);
      },
      setColorLevel: (level) => set({ colorLevel: level }),
      setAccentColor: (color) => {
        set({ accentColor: color });
        if (get().colorLevel === "advanced") {
          document.documentElement.style.setProperty("--accent", color);
        }
      },
      setCustomColors: (colors) => {
        set({ customColors: colors });
        if (get().colorLevel === "expert") {
          Object.entries(colors).forEach(([key, value]) => {
            const cssVar = `--${key.replace(/([A-Z])/g, "-$1").toLowerCase()}`;
            document.documentElement.style.setProperty(cssVar, value);
          });
        }
      },
    }),
    {
      name: "claudiminder-theme",
    },
  ),
);

function applyTheme(theme: ThemeName, customColors: ColorScheme) {
  const root = document.documentElement;

  if (theme === "system") {
    const prefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)",
    ).matches;
    root.className = prefersDark ? "dark" : "light";
  } else {
    root.className = theme;
  }

  // Apply custom colors if in advanced/expert mode
  if (Object.keys(customColors).length > 0) {
    Object.entries(customColors).forEach(([key, value]) => {
      const cssVar = `--${key.replace(/([A-Z])/g, "-$1").toLowerCase()}`;
      root.style.setProperty(cssVar, value);
    });
  }
}
</file>

<file path="src/frontend/src/styles/components/dashboard.css">
/* Dashboard Component Styles */

.dashboard-container {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  padding: var(--spacing-xl);
  background-color: var(--bg-primary);
  transition: var(--transition-theme);
}

.dashboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-xl);
  padding: var(--spacing-lg);
  background-color: var(--bg-secondary);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  transition: var(--transition-theme);
}

.dashboard-header h1 {
  font-size: 2rem;
  font-weight: 700;
  color: var(--text-primary);
  margin: 0;
}

/* Usage Display */
.usage-display {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-lg);
  padding: var(--spacing-xl);
  background-color: var(--bg-secondary);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  transition: var(--transition-theme);
}

.usage-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--spacing-md);
}

.stat-card {
  padding: var(--spacing-lg);
  background: var(--glass-bg);
  backdrop-filter: blur(var(--glass-blur));
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-md);
  transition: var(--transition-theme);
}

.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--neon-glow);
}

.stat-label {
  font-size: 0.875rem;
  color: var(--text-secondary);
  margin-bottom: var(--spacing-xs);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.stat-value {
  font-size: 1.875rem;
  font-weight: 700;
  color: var(--text-primary);
}

/* Progress Container */
.progress-container {
  width: 100%;
  margin: var(--spacing-lg) 0;
}

.progress-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: var(--spacing-sm);
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.progress-bar {
  width: 100%;
  height: 24px;
  background-color: var(--bg-secondary);
  border-radius: var(--radius-full);
  overflow: hidden;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
  position: relative;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--success));
  border-radius: var(--radius-full);
  transition:
    width 0.5s ease,
    background 0.3s ease;
  box-shadow: var(--neon-glow);
  position: relative;
  overflow: hidden;
}

.progress-fill::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.3),
    transparent
  );
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

.progress-fill.warning {
  background: linear-gradient(90deg, var(--warning), var(--danger));
}

.progress-fill.danger {
  background: linear-gradient(90deg, var(--danger), #dc2626);
}

.progress-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 0.75rem;
  font-weight: 600;
  color: white;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  z-index: 1;
}

/* Reset Countdown */
.reset-countdown {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-md);
  padding: var(--spacing-xl);
  background: var(--glass-bg);
  backdrop-filter: blur(var(--glass-blur));
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-lg);
  transition: var(--transition-theme);
}

.countdown-label {
  font-size: 1rem;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.timer {
  font-size: 3rem;
  font-weight: 700;
  color: var(--accent);
  text-shadow: var(--neon-text-glow);
  font-variant-numeric: tabular-nums;
  letter-spacing: -0.02em;
}

.timer.warning {
  color: var(--warning);
}

.timer.danger {
  color: var(--danger);
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.8;
    transform: scale(1.05);
  }
}

/* State Indicators */
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 200px;
  gap: var(--spacing-md);
}

.loading-spinner {
  width: 48px;
  height: 48px;
  border: 4px solid var(--bg-secondary);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.loading-text {
  font-size: 1rem;
  color: var(--text-secondary);
}

.error-state {
  padding: var(--spacing-xl);
  background-color: rgba(239, 68, 68, 0.1);
  border: 2px solid var(--danger);
  border-radius: var(--radius-lg);
  color: var(--danger);
  text-align: center;
}

.error-title {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: var(--spacing-sm);
}

.error-message {
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.offline-indicator {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) var(--spacing-md);
  background-color: var(--warning);
  color: white;
  border-radius: var(--radius-md);
  font-size: 0.875rem;
  font-weight: 500;
}

.offline-dot {
  width: 8px;
  height: 8px;
  background-color: white;
  border-radius: 50%;
  animation: blink 1.5s infinite;
}

@keyframes blink {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.3;
  }
}

/* Responsive Design */
@media (max-width: 768px) {
  .dashboard-container {
    padding: var(--spacing-md);
  }

  .dashboard-header {
    flex-direction: column;
    gap: var(--spacing-md);
    text-align: center;
  }

  .dashboard-header h1 {
    font-size: 1.5rem;
  }

  .timer {
    font-size: 2rem;
  }

  .usage-stats {
    grid-template-columns: 1fr;
  }
}
</file>

<file path="src/frontend/src/styles/components/settings.css">
/* Settings Panel Styles */
.settings-panel {
  padding: 16px;
  background: var(--bg-secondary, #f5f5f5);
  border-radius: 8px;
  margin-top: 16px;
}

.settings-panel > * + * {
  margin-top: 16px;
}

/* Theme Switcher */
.theme-switcher,
.language-switcher {
  display: flex;
  align-items: center;
  gap: 8px;
}

.theme-switcher label,
.language-switcher label {
  font-weight: 500;
  color: var(--text-primary, #1a1a1a);
}

.theme-switcher select,
.language-switcher select {
  flex: 1;
  background: var(--bg-primary, #ffffff);
  color: var(--text-primary, #1a1a1a);
  border: 1px solid var(--glass-border, rgba(0, 0, 0, 0.2));
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  transition: border-color 0.2s ease;
}

.theme-switcher select:hover,
.language-switcher select:hover {
  border-color: var(--accent, #007acc);
}

.theme-switcher select:focus,
.language-switcher select:focus {
  outline: none;
  border-color: var(--accent, #007acc);
  box-shadow: 0 0 0 3px rgba(0, 122, 204, 0.1);
}

/* Color Customizer */
.color-customizer {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.color-customizer > label {
  font-weight: 500;
  color: var(--text-primary, #1a1a1a);
}

.color-level-selector {
  display: flex;
  gap: 8px;
}

.color-level-selector button {
  flex: 1;
  padding: 8px 12px;
  background: var(--bg-primary, #ffffff);
  color: var(--text-primary, #1a1a1a);
  border: 1px solid var(--glass-border, rgba(0, 0, 0, 0.2));
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.color-level-selector button:hover {
  background: var(--bg-secondary, #f5f5f5);
  border-color: var(--accent, #007acc);
}

.color-level-selector button.active {
  background: var(--accent, #007acc);
  color: #ffffff;
  border-color: var(--accent, #007acc);
}

.accent-picker,
.full-customization {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 12px;
  background: var(--bg-primary, #ffffff);
  border-radius: 4px;
  border: 1px solid var(--glass-border, rgba(0, 0, 0, 0.1));
}

.color-input {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.color-input label {
  font-size: 13px;
  color: var(--text-secondary, #666666);
}

.color-input input[type="color"],
.accent-picker input[type="color"] {
  width: 60px;
  height: 32px;
  border: 1px solid var(--glass-border, rgba(0, 0, 0, 0.2));
  border-radius: 4px;
  cursor: pointer;
  transition: border-color 0.2s ease;
}

.color-input input[type="color"]:hover,
.accent-picker input[type="color"]:hover {
  border-color: var(--accent, #007acc);
}

/* Progress Bar Picker */
.progress-bar-picker {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.progress-bar-picker > label {
  font-weight: 500;
  color: var(--text-primary, #1a1a1a);
}

.type-buttons {
  display: flex;
  gap: 8px;
}

.type-buttons button {
  flex: 1;
  padding: 8px 12px;
  background: var(--bg-primary, #ffffff);
  color: var(--text-primary, #1a1a1a);
  border: 1px solid var(--glass-border, rgba(0, 0, 0, 0.2));
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.type-buttons button:hover {
  background: var(--bg-secondary, #f5f5f5);
  border-color: var(--accent, #007acc);
}

.type-buttons button.active {
  background: var(--accent, #007acc);
  color: #ffffff;
  border-color: var(--accent, #007acc);
}

/* Font Size Slider */
.font-size-slider {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.font-size-slider > label {
  font-weight: 500;
  color: var(--text-primary, #1a1a1a);
  font-size: 14px;
}

.font-size-slider input[type="range"] {
  width: 100%;
  height: 6px;
  background: var(--bg-primary, #ffffff);
  border-radius: 3px;
  outline: none;
  cursor: pointer;
  -webkit-appearance: none;
}

.font-size-slider input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  background: var(--accent, #007acc);
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s ease;
}

.font-size-slider input[type="range"]::-webkit-slider-thumb:hover {
  transform: scale(1.1);
  box-shadow: 0 0 0 4px rgba(0, 122, 204, 0.1);
}

.font-size-slider input[type="range"]::-moz-range-thumb {
  width: 18px;
  height: 18px;
  background: var(--accent, #007acc);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s ease;
}

.font-size-slider input[type="range"]::-moz-range-thumb:hover {
  transform: scale(1.1);
  box-shadow: 0 0 0 4px rgba(0, 122, 204, 0.1);
}

.range-labels {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: var(--text-secondary, #666666);
  opacity: 0.7;
}

/* Responsive Design */
@media (max-width: 768px) {
  .color-level-selector,
  .type-buttons {
    flex-direction: column;
  }

  .theme-switcher,
  .language-switcher {
    flex-direction: column;
    align-items: stretch;
  }
}
</file>

<file path="src/frontend/src/styles/themes/dark.css">
/* Dark Theme */

.dark {
  --bg-primary: #0f1419;
  --bg-secondary: #1a1f2e;
  --text-primary: #e6e6e6;
  --text-secondary: #a0a0a0;
  --accent: #60a5fa;
  --success: #34d399;
  --warning: #fbbf24;
  --danger: #f87171;

  /* Glassmorphism */
  --glass-bg: rgba(26, 31, 46, 0.7);
  --glass-border: rgba(255, 255, 255, 0.1);
  --glass-blur: 15px;

  /* Neon Effects */
  --neon-glow:
    0 0 10px var(--accent), 0 0 20px var(--accent), 0 0 30px var(--accent);
  --neon-text-glow: 0 0 5px var(--accent);
}
</file>

<file path="src/frontend/src/styles/themes/glass-dark.css">
/* Glass Dark Theme */

.glass-dark {
  --bg-primary: #0a0e1a;
  --bg-secondary: #141824;
  --text-primary: #f1f5f9;
  --text-secondary: #94a3b8;
  --accent: #8b5cf6;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;

  /* Glassmorphism - Enhanced */
  --glass-bg: rgba(20, 24, 36, 0.4);
  --glass-border: rgba(139, 92, 246, 0.2);
  --glass-blur: 20px;

  /* Neon Effects */
  --neon-glow:
    0 0 12px rgba(139, 92, 246, 0.6), 0 0 24px rgba(139, 92, 246, 0.4),
    0 0 36px rgba(139, 92, 246, 0.2);
  --neon-text-glow: 0 0 6px rgba(139, 92, 246, 0.5);
}
</file>

<file path="src/frontend/src/styles/themes/glass-light.css">
/* Glass Light Theme */

.glass-light {
  --bg-primary: #e0f2fe;
  --bg-secondary: #bae6fd;
  --text-primary: #0c4a6e;
  --text-secondary: #075985;
  --accent: #0ea5e9;
  --success: #14b8a6;
  --warning: #f59e0b;
  --danger: #ef4444;

  /* Glassmorphism - Enhanced */
  --glass-bg: rgba(255, 255, 255, 0.25);
  --glass-border: rgba(255, 255, 255, 0.4);
  --glass-blur: 16px;

  /* Neon Effects (subtle) */
  --neon-glow:
    0 0 8px rgba(14, 165, 233, 0.5), 0 0 16px rgba(14, 165, 233, 0.3);
  --neon-text-glow: 0 0 4px rgba(14, 165, 233, 0.4);
}
</file>

<file path="src/frontend/src/styles/themes/light.css">
/* Light Theme */

.light {
  --bg-primary: #ffffff;
  --bg-secondary: #f5f5f5;
  --text-primary: #1a1a1a;
  --text-secondary: #666666;
  --accent: #3b82f6;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;

  /* Glassmorphism */
  --glass-bg: rgba(255, 255, 255, 0.7);
  --glass-border: rgba(0, 0, 0, 0.1);
  --glass-blur: 10px;

  /* Neon Effects (subtle in light mode) */
  --neon-glow: 0 0 5px var(--accent), 0 0 10px var(--accent);
  --neon-text-glow: 0 0 3px var(--accent);
}
</file>

<file path="src/frontend/src/styles/themes/neon-dark.css">
/* Neon Dark Theme - DEFAULT */

.neon-dark {
  --bg-primary: #05081a;
  --bg-secondary: #0a0f24;
  --text-primary: #e0e7ff;
  --text-secondary: #94a3b8;
  --accent: #06b6d4;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #f43f5e;

  /* Glassmorphism */
  --glass-bg: rgba(10, 15, 36, 0.6);
  --glass-border: rgba(6, 182, 212, 0.3);
  --glass-blur: 20px;

  /* Neon Effects - Cyan/Magenta */
  --neon-glow:
    0 0 15px #06b6d4, 0 0 30px #06b6d4, 0 0 45px #d946ef, 0 0 60px #d946ef;
  --neon-text-glow: 0 0 8px #06b6d4, 0 0 12px #d946ef;
}
</file>

<file path="src/frontend/src/styles/themes/neon-light.css">
/* Neon Light Theme */

.neon-light {
  --bg-primary: #f8f9fa;
  --bg-secondary: #e9ecef;
  --text-primary: #212529;
  --text-secondary: #6c757d;
  --accent: #ec4899;
  --success: #06b6d4;
  --warning: #f59e0b;
  --danger: #ef4444;

  /* Glassmorphism */
  --glass-bg: rgba(255, 255, 255, 0.6);
  --glass-border: rgba(236, 72, 153, 0.2);
  --glass-blur: 12px;

  /* Neon Effects - Pink/Cyan */
  --neon-glow: 0 0 10px #ec4899, 0 0 20px #ec4899, 0 0 30px #06b6d4;
  --neon-text-glow: 0 0 5px #ec4899, 0 0 10px #06b6d4;
}
</file>

<file path="src/frontend/src/styles/globals.css">
/* Global Styles & CSS Variables */

:root {
  /* Color System */
  --bg-primary: #ffffff;
  --bg-secondary: #f5f5f5;
  --text-primary: #1a1a1a;
  --text-secondary: #666666;
  --accent: #3b82f6;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;

  /* Glassmorphism */
  --glass-bg: rgba(255, 255, 255, 0.1);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-blur: 10px;

  /* Neon Effects */
  --neon-glow: 0 0 10px var(--accent), 0 0 20px var(--accent);
  --neon-text-glow: 0 0 5px var(--accent);

  /* Transitions */
  --transition-theme: all 0.3s ease;

  /* Spacing */
  --spacing-xs: 0.25rem;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;

  /* Border Radius */
  --radius-sm: 0.25rem;
  --radius-md: 0.5rem;
  --radius-lg: 1rem;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

/* CSS Reset */
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family:
    -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu",
    "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: var(--bg-primary);
  color: var(--text-primary);
  transition: var(--transition-theme);
  line-height: 1.5;
}

code {
  font-family:
    source-code-pro, Menlo, Monaco, Consolas, "Courier New", monospace;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--text-secondary);
  border-radius: var(--radius-full);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-primary);
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Focus Visible */
:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* Selection */
::selection {
  background-color: var(--accent);
  color: white;
}
</file>

<file path="src/frontend/src/styles/index.css">
:root {
  font-family: Inter, system-ui, sans-serif;
  line-height: 1.5;
  font-weight: 400;
  color: #213547;
  background-color: #ffffff;

  /* CSS Variables for UI Components */
  --accent: #646cff;
  --bg-secondary: rgba(0, 0, 0, 0.1);
  --success: #22c55e;
  --warning: #f59e0b;
  --danger: #ef4444;
  --text-primary: #1a1a1a;
  --text-secondary: #666;
}

/* Dark mode variables */
@media (prefers-color-scheme: dark) {
  :root {
    color: #f5f5f5;
    background-color: #1a1a1a;

    --accent: #818cf8;
    --bg-secondary: rgba(255, 255, 255, 0.1);
    --success: #34d399;
    --warning: #fbbf24;
    --danger: #f87171;
    --text-primary: #f5f5f5;
    --text-secondary: #aaa;
  }
}

.app {
  max-width: 400px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.usage-card {
  background: #f5f5f5;
  border-radius: 8px;
  padding: 1.5rem;
  margin: 1rem 0;
}

.usage-percent {
  font-size: 3rem;
  font-weight: bold;
  color: #1a1a1a;
}

.error {
  color: #cc0000;
}

button {
  padding: 0.6rem 1.2rem;
  font-size: 1rem;
  cursor: pointer;
  border: 1px solid #646cff;
  border-radius: 8px;
  background-color: #f9f9f9;
}

button:hover {
  border-color: #535bf2;
  background-color: #646cff;
  color: white;
}
</file>

<file path="src/frontend/src/types/index.ts">
export type { ThemeName, ThemeColors } from "./theme";
export type { AppSettings } from "./settings";
export type {
  FiveHourUsage,
  GoalsStatus,
  FocusModeStatus,
  UsageResponse,
} from "./usage";
</file>

<file path="src/frontend/src/types/settings.ts">
import type { Layout } from "react-grid-layout";

export interface AppSettings {
  theme: string;
  locale: string;
  layout: Layout;
}
</file>

<file path="src/frontend/src/types/theme.ts">
export type ThemeName =
  | "light"
  | "dark"
  | "neon-light"
  | "neon-dark"
  | "glass-light"
  | "glass-dark"
  | "system";

export interface ThemeColors {
  primary: string;
  secondary: string;
  background: string;
  surface: string;
  text: string;
  textSecondary: string;
  border: string;
  accent: string;
}
</file>

<file path="src/frontend/src/types/usage.ts">
export interface FiveHourUsage {
  utilization: number;
  resets_at: string;
  input_tokens_used?: number;
  input_tokens_limit?: number;
  output_tokens_used?: number;
  output_tokens_limit?: number;
}

export interface GoalsStatus {
  enabled: boolean;
  is_on_track: boolean;
  current_usage: number;
  expected_usage: number;
  message: string;
}

export interface FocusModeStatus {
  is_snoozed: boolean;
  snooze_remaining: number;
  is_quiet_hours: boolean;
  is_dnd: boolean;
  notifications_suppressed: boolean;
}

export interface UsageResponse {
  five_hour: FiveHourUsage | null;
  goals?: GoalsStatus;
  focus_mode?: FocusModeStatus;
  error?: string;
  token_expired?: boolean;
  rate_limited?: boolean;
  offline?: boolean;
}
</file>

<file path="src/frontend/src/utils/.gitkeep">

</file>

<file path="src/frontend/src/utils/index.ts">
// Tray utilities
export * from "./tray";

// Notification utilities
export * from "./notifications";

// Rate limit handling
export * from "./rate-limit";

// Offline detection
export {
  OfflineDetector,
  defaultOfflineDetector,
  checkNetworkError,
  retryWithBackoff,
} from "./offline-detector";

// Token refresh utilities
export * from "./token-refresh";
</file>

<file path="src/frontend/src/utils/notifications.ts">
import {
  isPermissionGranted,
  requestPermission,
  sendNotification,
} from "@tauri-apps/plugin-notification";
import { emit } from "@tauri-apps/api/event";
import { animateTray } from "./tray";

/**
 * Minimum interval between notifications (1 minute)
 */
export const NOTIFICATION_THROTTLE_MS = 60000;

/**
 * Track last notification timestamp for throttling
 */
let lastNotificationTime = 0;

/**
 * Ensure notification permission is granted
 *
 * @returns true if permission is granted, false otherwise
 */
export async function ensureNotificationPermission(): Promise<boolean> {
  try {
    let permissionGranted = await isPermissionGranted();

    if (!permissionGranted) {
      const permission = await requestPermission();
      permissionGranted = permission === "granted";
    }

    return permissionGranted;
  } catch (error) {
    console.error("Failed to check/request notification permission:", error);
    return false;
  }
}

/**
 * Check if notifications can be sent (throttle + permission check)
 *
 * @returns true if notification can be sent
 */
export function canNotify(): boolean {
  const now = Date.now();
  const timeSinceLastNotification = now - lastNotificationTime;

  return timeSinceLastNotification >= NOTIFICATION_THROTTLE_MS;
}

/**
 * Send a reminder notification
 *
 * @param title - Notification title
 * @param body - Notification body
 */
export async function notifyReminder(
  title: string,
  body: string,
): Promise<void> {
  try {
    if (!canNotify()) {
      console.debug("Notification throttled");
      return;
    }

    const hasPermission = await ensureNotificationPermission();
    if (!hasPermission) {
      console.warn("Notification permission not granted");
      return;
    }

    await sendNotification({ title, body });
    lastNotificationTime = Date.now();

    // Animate tray to draw attention
    await animateTray(1500);
  } catch (error) {
    console.error("Failed to send reminder notification:", error);
    throw error;
  }
}

/**
 * Send usage warning notification based on percentage
 *
 * @param percentage - Current usage percentage (0-100)
 */
export async function notifyUsageWarning(percentage: number): Promise<void> {
  try {
    if (percentage >= 90) {
      await notifyReminder(
        "Critical Usage Alert",
        `You've used ${percentage.toFixed(1)}% of your Claude quota. Consider saving your work.`,
      );
    } else if (percentage >= 75) {
      await notifyReminder(
        "High Usage Warning",
        `You've used ${percentage.toFixed(1)}% of your Claude quota.`,
      );
    }
  } catch (error) {
    console.error("Failed to send usage warning:", error);
  }
}

/**
 * Send reset soon notification
 *
 * @param minutes - Minutes until reset
 */
export async function notifyResetSoon(minutes: number): Promise<void> {
  try {
    const timeStr =
      minutes < 60
        ? `${minutes} minute${minutes !== 1 ? "s" : ""}`
        : `${Math.floor(minutes / 60)} hour${Math.floor(minutes / 60) !== 1 ? "s" : ""}`;

    await notifyReminder(
      "Reset Soon",
      `Your Claude usage quota will reset in ${timeStr}.`,
    );
  } catch (error) {
    console.error("Failed to send reset soon notification:", error);
  }
}

/**
 * Send token expired notification
 */
export async function notifyTokenExpired(): Promise<void> {
  try {
    await notifyReminder(
      "Token Expired",
      "Your Claude authentication token has expired. Please log in again.",
    );
  } catch (error) {
    console.error("Failed to send token expired notification:", error);
  }
}

/**
 * Send offline/network error notification
 */
export async function notifyOffline(): Promise<void> {
  try {
    await notifyReminder(
      "Network Error",
      "Unable to connect to Claude API. Please check your internet connection.",
    );
  } catch (error) {
    console.error("Failed to send offline notification:", error);
  }
}

/**
 * Send rate limited notification
 */
export async function notifyRateLimited(): Promise<void> {
  try {
    await notifyReminder(
      "Rate Limited",
      "Claude API rate limit reached. Please wait before retrying.",
    );
  } catch (error) {
    console.error("Failed to send rate limited notification:", error);
  }
}

/**
 * Handle snooze request
 *
 * @param minutes - Duration to snooze notifications (in minutes)
 */
export async function handleSnooze(minutes: number): Promise<void> {
  try {
    await emit("snooze", { duration_minutes: minutes });
    console.log(`Notifications snoozed for ${minutes} minutes`);
  } catch (error) {
    console.error("Failed to handle snooze:", error);
    throw error;
  }
}
</file>

<file path="src/frontend/src/utils/offline-detector.ts">
import { emit } from "@tauri-apps/api/event";

/**
 * Callback for retry attempts
 */
export type RetryCallback = (attempt: number, delay: number) => void;

/**
 * Offline mode detector with retry logic
 */
export class OfflineDetector {
  private readonly maxRetries: number;
  private readonly baseDelay: number;
  private isOffline: boolean = false;

  /**
   * Create a new offline detector
   *
   * @param maxRetries - Maximum number of retry attempts (default: 5)
   * @param baseDelay - Base delay in milliseconds (default: 2000)
   */
  constructor(maxRetries: number = 5, baseDelay: number = 2000) {
    this.maxRetries = maxRetries;
    this.baseDelay = baseDelay;
  }

  /**
   * Calculate exponential backoff delay
   *
   * @param attempt - Current attempt number (0-indexed)
   * @returns Delay in milliseconds (capped at 32s)
   */
  private calculateDelay(attempt: number): number {
    const delay = this.baseDelay * Math.pow(2, attempt);
    return Math.min(delay, 32000); // Cap at 32 seconds
  }

  /**
   * Check if error indicates network connectivity issue
   *
   * @param error - Error object to check
   * @returns true if network error detected
   */
  private isNetworkError(error: any): boolean {
    if (!error) return false;

    const message = error.message?.toLowerCase() || "";
    const errorCode = error.code?.toLowerCase() || "";
    const statusCode = error.status || error.statusCode || 0;

    // Common network error indicators
    const networkErrorPatterns = [
      "network",
      "offline",
      "connection",
      "timeout",
      "econnrefused",
      "enotfound",
      "enetunreach",
      "etimedout",
      "fetch failed",
      "failed to fetch",
    ];

    const hasNetworkError = networkErrorPatterns.some(
      (pattern) => message.includes(pattern) || errorCode.includes(pattern),
    );

    const isNetworkStatusCode = statusCode === 0 || statusCode >= 500;

    return hasNetworkError || isNetworkStatusCode;
  }

  /**
   * Emit offline mode event
   */
  private async emitOfflineMode(): Promise<void> {
    try {
      if (!this.isOffline) {
        this.isOffline = true;
        await emit("offline-mode", { offline: true });
        console.warn("Offline mode detected");
      }
    } catch (error) {
      console.error("Failed to emit offline mode event:", error);
    }
  }

  /**
   * Emit online mode event
   */
  private async emitOnlineMode(): Promise<void> {
    try {
      if (this.isOffline) {
        this.isOffline = false;
        await emit("offline-mode", { offline: false });
        console.log("Back online");
      }
    } catch (error) {
      console.error("Failed to emit online mode event:", error);
    }
  }

  /**
   * Check if error is a network error and emit offline event
   *
   * @param error - Error to check
   * @returns true if network error detected
   */
  async checkNetworkError(error: any): Promise<boolean> {
    const isNetwork = this.isNetworkError(error);

    if (isNetwork) {
      await this.emitOfflineMode();
    }

    return isNetwork;
  }

  /**
   * Retry a function with exponential backoff on network errors
   *
   * @param fn - Async function to execute
   * @param onRetry - Optional callback for retry attempts
   * @returns Result of the function
   * @throws Last error if all retries fail
   */
  async retryWithBackoff<T>(
    fn: () => Promise<T>,
    onRetry?: RetryCallback,
  ): Promise<T> {
    let lastError: any;

    for (let attempt = 0; attempt <= this.maxRetries; attempt++) {
      try {
        const result = await fn();

        // Success - mark as online
        await this.emitOnlineMode();

        return result;
      } catch (error) {
        lastError = error;

        const isNetwork = await this.checkNetworkError(error);

        // Only retry on network errors
        if (!isNetwork) {
          throw error;
        }

        // Don't retry if we've exhausted attempts
        if (attempt >= this.maxRetries) {
          console.error(
            `Network retry failed after ${this.maxRetries} attempts. Staying in offline mode.`,
          );
          throw error;
        }

        const delay = this.calculateDelay(attempt);
        console.warn(
          `Network error detected. Retrying in ${delay}ms (attempt ${attempt + 1}/${this.maxRetries})`,
        );

        // Call retry callback if provided
        if (onRetry) {
          onRetry(attempt + 1, delay);
        }

        // Wait before retrying
        await new Promise((resolve) => setTimeout(resolve, delay));
      }
    }

    throw lastError;
  }

  /**
   * Get current offline status
   */
  getOfflineStatus(): boolean {
    return this.isOffline;
  }

  /**
   * Manually reset offline status
   */
  reset(): void {
    this.isOffline = false;
  }
}

/**
 * Default offline detector instance
 */
export const defaultOfflineDetector = new OfflineDetector();

/**
 * Convenience function using the default detector
 */
export async function checkNetworkError(error: any): Promise<boolean> {
  return defaultOfflineDetector.checkNetworkError(error);
}

/**
 * Convenience function using the default detector
 */
export async function retryWithBackoff<T>(
  fn: () => Promise<T>,
  onRetry?: RetryCallback,
): Promise<T> {
  return defaultOfflineDetector.retryWithBackoff(fn, onRetry);
}
</file>

<file path="src/frontend/src/utils/rate-limit.ts">
/**
 * Callback for retry attempts
 */
export type RetryCallback = (attempt: number, delay: number) => void;

/**
 * Rate limit handler with exponential backoff
 */
export class RateLimitHandler {
  private readonly maxRetries: number;
  private readonly baseDelay: number;

  /**
   * Create a new rate limit handler
   *
   * @param maxRetries - Maximum number of retry attempts (default: 4)
   * @param baseDelay - Base delay in milliseconds (default: 1000)
   */
  constructor(maxRetries: number = 4, baseDelay: number = 1000) {
    this.maxRetries = maxRetries;
    this.baseDelay = baseDelay;
  }

  /**
   * Calculate exponential backoff delay
   *
   * @param attempt - Current attempt number (0-indexed)
   * @returns Delay in milliseconds
   */
  private calculateDelay(attempt: number): number {
    return this.baseDelay * Math.pow(2, attempt);
  }

  /**
   * Check if error is a rate limit error
   */
  private isRateLimitError(error: any): boolean {
    if (!error) return false;

    // Check for common rate limit indicators
    const message = error.message?.toLowerCase() || "";
    const statusCode = error.status || error.statusCode || 0;

    return (
      statusCode === 429 ||
      message.includes("rate limit") ||
      message.includes("too many requests")
    );
  }

  /**
   * Execute a function with exponential backoff on rate limit errors
   *
   * @param fn - Async function to execute
   * @param onRetry - Optional callback for retry attempts
   * @returns Result of the function
   * @throws Last error if all retries fail
   */
  async executeWithBackoff<T>(
    fn: () => Promise<T>,
    onRetry?: RetryCallback,
  ): Promise<T> {
    let lastError: any;

    for (let attempt = 0; attempt <= this.maxRetries; attempt++) {
      try {
        return await fn();
      } catch (error) {
        lastError = error;

        // Only retry on rate limit errors
        if (!this.isRateLimitError(error)) {
          throw error;
        }

        // Don't retry if we've exhausted attempts
        if (attempt >= this.maxRetries) {
          console.error(
            `Rate limit retry failed after ${this.maxRetries} attempts`,
          );
          throw error;
        }

        const delay = this.calculateDelay(attempt);
        console.warn(
          `Rate limited. Retrying in ${delay}ms (attempt ${attempt + 1}/${this.maxRetries})`,
        );

        // Call retry callback if provided
        if (onRetry) {
          onRetry(attempt + 1, delay);
        }

        // Wait before retrying
        await new Promise((resolve) => setTimeout(resolve, delay));
      }
    }

    throw lastError;
  }

  /**
   * Reset retry state (if needed for manual control)
   */
  reset(): void {
    // Currently stateless, but kept for future extensions
  }
}

/**
 * Default rate limit handler instance
 */
export const defaultRateLimitHandler = new RateLimitHandler();

/**
 * Convenience function using the default handler
 */
export async function executeWithBackoff<T>(
  fn: () => Promise<T>,
  onRetry?: RetryCallback,
): Promise<T> {
  return defaultRateLimitHandler.executeWithBackoff(fn, onRetry);
}
</file>

<file path="src/frontend/src/utils/README.md">
# Frontend Integration Utilities

Integration utilities for claudiminder frontend to handle tray updates, notifications, rate limiting, offline detection, and token refresh.

## Files

- **tray.ts** - System tray update utilities
- **notifications.ts** - Notification helpers with throttling
- **rate-limit.ts** - Rate limit handler with exponential backoff
- **offline-detector.ts** - Offline mode detection and retry logic
- **token-refresh.ts** - Token expiration handling and login flow

## Usage Examples

### Tray Updates

```typescript
import { updateTray, animateTray } from "./utils";

// Update tray with usage info
await updateTray(75.5, "2026-01-17T18:00:00Z", 150, 200);

// Animate tray icon
await animateTray(1500);
```

### Notifications

```typescript
import {
  notifyUsageWarning,
  notifyResetSoon,
  notifyTokenExpired,
  handleSnooze,
} from "./utils";

// Send usage warning (auto-triggered at 75% and 90%)
await notifyUsageWarning(90.5);

// Notify before reset
await notifyResetSoon(30); // 30 minutes

// Notify token expired
await notifyTokenExpired();

// Snooze notifications
await handleSnooze(60); // Snooze for 60 minutes
```

### Rate Limiting

```typescript
import { RateLimitHandler, executeWithBackoff } from "./utils";

// Using default handler
const data = await executeWithBackoff(
  async () => await fetchUsageData(),
  (attempt, delay) => console.log(`Retry ${attempt} in ${delay}ms`),
);

// Custom handler
const handler = new RateLimitHandler(5, 2000); // 5 retries, 2s base delay
const result = await handler.executeWithBackoff(async () => {
  return await apiCall();
});
```

### Offline Detection

```typescript
import { OfflineDetector, retryWithBackoff, checkNetworkError } from "./utils";

// Check if error is network-related
try {
  await fetchData();
} catch (error) {
  const isOffline = await checkNetworkError(error);
  if (isOffline) {
    console.log("Offline mode activated");
  }
}

// Retry with exponential backoff
const data = await retryWithBackoff(
  async () => await fetchUsageData(),
  (attempt, delay) => console.log(`Network retry ${attempt} in ${delay}ms`),
);

// Custom detector
const detector = new OfflineDetector(3, 1000);
const result = await detector.retryWithBackoff(async () => {
  return await apiCall();
});
```

### Token Refresh

```typescript
import {
  handleTokenExpired,
  openClaudeLogin,
  isTokenExpiredError,
  handlePotentialTokenExpiration,
} from "./utils";

// Handle token expiration
try {
  await fetchUsageData();
} catch (error) {
  if (isTokenExpiredError(error)) {
    await handleTokenExpired(); // Sends notification
    await openClaudeLogin(); // Opens browser
  }
}

// Automatic handling
try {
  await fetchUsageData();
} catch (error) {
  const handled = await handlePotentialTokenExpiration(error);
  if (!handled) {
    throw error; // Re-throw if not token error
  }
}
```

## Events Emitted

- `tray-update` - Tray icon update with payload: `{ utilization, tooltip, color }`
- `tray-animate` - Tray animation with payload: `{ duration }`
- `offline-mode` - Offline status change with payload: `{ offline: boolean }`
- `snooze` - Snooze request with payload: `{ duration_minutes }`

## Constants

- `NOTIFICATION_THROTTLE_MS` - 60000ms (1 minute between notifications)
- `CLAUDE_LOGIN_URL` - https://claude.ai/login

## Error Handling

All functions include proper error handling with try-catch blocks and console logging. Network errors, rate limits, and token expiration are detected automatically.

## Dependencies

- `@tauri-apps/api/event` - Event emission
- `@tauri-apps/plugin-notification` - System notifications
- `@tauri-apps/plugin-shell` - Browser opening
</file>

<file path="src/frontend/src/utils/token-refresh.ts">
import { open } from "@tauri-apps/plugin-shell";
import { notifyTokenExpired } from "./notifications";

/**
 * Claude login URL
 */
export const CLAUDE_LOGIN_URL = "https://claude.ai/login";

/**
 * Handle token expiration
 * Sends notification and prepares for login flow
 */
export async function handleTokenExpired(): Promise<void> {
  try {
    console.warn("Claude authentication token has expired");
    await notifyTokenExpired();
  } catch (error) {
    console.error("Failed to handle token expiration:", error);
    throw error;
  }
}

/**
 * Open Claude login page in the default browser
 *
 * @returns Promise that resolves when browser is opened
 */
export async function openClaudeLogin(): Promise<void> {
  try {
    console.log("Opening Claude login page...");
    await open(CLAUDE_LOGIN_URL);
  } catch (error) {
    console.error("Failed to open Claude login page:", error);
    throw error;
  }
}

/**
 * Watch token file for changes (placeholder for file watcher)
 *
 * This function is a placeholder for implementing file system watching
 * of ~/.claude/.credentials.json. The actual implementation will depend
 * on the backend providing file watch events.
 *
 * @param onTokenAvailable - Callback when new token is detected
 * @returns Cleanup function to stop watching
 */
export function watchTokenFile(_onTokenAvailable: () => void): () => void {
  console.warn("Token file watching not yet implemented");

  // TODO: Implement file watching via backend events
  // This could be done through:
  // 1. Backend polling the credentials file
  // 2. OS-level file system events (via Tauri plugin)
  // 3. Manual refresh trigger from UI

  // Return cleanup function
  return () => {
    console.log("Stopped watching token file");
  };
}

/**
 * Check if error indicates token expiration
 *
 * @param error - Error object to check
 * @returns true if error indicates expired token
 */
export function isTokenExpiredError(error: any): boolean {
  if (!error) return false;

  const message = error.message?.toLowerCase() || "";
  const statusCode = error.status || error.statusCode || 0;

  // Common token expiration indicators
  const tokenErrorPatterns = [
    "unauthorized",
    "authentication",
    "token expired",
    "invalid token",
    "session expired",
  ];

  const hasTokenError = tokenErrorPatterns.some((pattern) =>
    message.includes(pattern),
  );

  return statusCode === 401 || hasTokenError;
}

/**
 * Handle potential token expiration error
 * Checks if error is token-related and triggers appropriate handling
 *
 * @param error - Error to check
 * @returns true if token expiration was handled
 */
export async function handlePotentialTokenExpiration(
  error: any,
): Promise<boolean> {
  if (isTokenExpiredError(error)) {
    await handleTokenExpired();
    return true;
  }
  return false;
}
</file>

<file path="src/frontend/src/utils/tray.ts">
import { emit } from "@tauri-apps/api/event";

/**
 * Payload for tray update events
 */
export interface TrayUpdatePayload {
  utilization: number;
  tooltip: string;
  color: "green" | "yellow" | "orange" | "red";
}

/**
 * Calculate tray icon color based on utilization percentage
 */
function getUtilizationColor(
  utilization: number,
): "green" | "yellow" | "orange" | "red" {
  if (utilization >= 90) return "red";
  if (utilization >= 75) return "orange";
  if (utilization >= 50) return "yellow";
  return "green";
}

/**
 * Format reset time for tooltip display
 */
function formatResetTime(resetsAt: string): string {
  try {
    const resetDate = new Date(resetsAt);
    const now = new Date();
    const diff = resetDate.getTime() - now.getTime();

    if (diff <= 0) {
      return "Resetting soon";
    }

    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

    if (hours > 0) {
      return `Resets in ${hours}h ${minutes}m`;
    }
    return `Resets in ${minutes}m`;
  } catch (error) {
    console.error("Failed to format reset time:", error);
    return "Reset time unknown";
  }
}

/**
 * Update system tray with current usage information
 *
 * @param utilization - Usage percentage (0-100)
 * @param resetsAt - ISO timestamp of next reset
 * @param requestsUsed - Number of requests used (optional)
 * @param requestsLimit - Request limit (optional)
 */
export async function updateTray(
  utilization: number,
  resetsAt: string,
  requestsUsed?: number,
  requestsLimit?: number,
): Promise<void> {
  try {
    const color = getUtilizationColor(utilization);
    const resetInfo = formatResetTime(resetsAt);

    let tooltip = `Claude Usage: ${utilization.toFixed(1)}%\n${resetInfo}`;

    if (requestsUsed !== undefined && requestsLimit !== undefined) {
      tooltip += `\nRequests: ${requestsUsed}/${requestsLimit}`;
    }

    const payload: TrayUpdatePayload = {
      utilization: Math.round(utilization * 10) / 10,
      tooltip,
      color,
    };

    await emit("tray-update", payload);
  } catch (error) {
    console.error("Failed to update tray:", error);
    throw error;
  }
}

/**
 * Trigger tray icon animation (e.g., for notifications)
 *
 * @param durationMs - Animation duration in milliseconds (default: 1000ms)
 */
export async function animateTray(durationMs: number = 1000): Promise<void> {
  try {
    await emit("tray-animate", { duration: durationMs });
  } catch (error) {
    console.error("Failed to animate tray:", error);
    throw error;
  }
}
</file>

<file path="src/frontend/src/App.tsx">
import { useEffect, useRef, useState } from "react";
import { listen } from "@tauri-apps/api/event";
import { useTranslation } from "react-i18next";

import { useUsage } from "./hooks/use-usage";
import { useTheme } from "./hooks/use-theme";
import { useSettingsStore } from "./stores/settings-store";

import { GlassCard } from "./components/ui/glass-card";
import { UsageDisplay } from "./components/dashboard/usage-display";
import { ResetCountdown } from "./components/dashboard/reset-countdown";
import { GoalsWidget } from "./components/dashboard/goals-widget";
import { FocusModeIndicator } from "./components/dashboard/focus-mode-indicator";
import { StatsPanel } from "./components/dashboard/stats-panel";
import { GridLayoutWrapper } from "./components/dashboard/grid-layout-wrapper";

import { ThemeSwitcher } from "./components/settings/theme-switcher";
import { ColorCustomizer } from "./components/settings/color-customizer";
import { ProgressBarPicker } from "./components/settings/progress-bar-picker";
import { FontSizeSlider } from "./components/settings/font-size-slider";
import { LanguageSwitcher } from "./components/settings/language-switcher";

import {
  notifyResetSoon,
  ensureNotificationPermission,
} from "./utils/notifications";

import "./i18n";
import "./styles/globals.css";
import "./styles/themes/light.css";
import "./styles/themes/dark.css";
import "./styles/themes/neon-light.css";
import "./styles/themes/neon-dark.css";
import "./styles/themes/glass-light.css";
import "./styles/themes/glass-dark.css";
import "./styles/components/dashboard.css";
import "./styles/components/settings.css";

const REMINDER_MINUTES = [30, 15, 5];

function App() {
  const { t } = useTranslation();
  const { usage, loading, error, isOffline, isRateLimited, refresh } =
    useUsage();
  const { theme, applyTheme } = useTheme();
  const { fontSize } = useSettingsStore();
  const [focusMode, setFocusMode] = useState(false);
  const [snoozeUntil, setSnoozeUntil] = useState<number | null>(null);
  const [showSettings, setShowSettings] = useState(false);
  const notifiedMinutesRef = useRef<Set<number>>(new Set());

  // Apply theme on mount and changes
  useEffect(() => {
    applyTheme();
  }, [theme, applyTheme]);

  // Apply font size
  useEffect(() => {
    document.documentElement.style.fontSize = `${fontSize}%`;
  }, [fontSize]);

  // Request notification permission on mount
  useEffect(() => {
    ensureNotificationPermission();
  }, []);

  // Listen for snooze events
  useEffect(() => {
    const setupListener = async () => {
      const unlisten = await listen(
        "snooze-activated",
        (event: { payload: { minutes: number } }) => {
          const { minutes } = event.payload;
          const snoozeUntilTime = Date.now() + minutes * 60000;
          setSnoozeUntil(snoozeUntilTime);
        },
      );
      return unlisten;
    };

    const unlistenPromise = setupListener();
    return () => {
      unlistenPromise.then((fn) => fn());
    };
  }, []);

  // Reminder scheduler
  useEffect(() => {
    if (!usage?.five_hour) return;

    const checkReminders = () => {
      if (snoozeUntil && Date.now() < snoozeUntil) {
        return;
      }

      const resetTime = new Date(usage.five_hour!.resets_at).getTime();
      const now = Date.now();
      const remainingMins = Math.floor((resetTime - now) / 60000);

      for (const reminderMin of REMINDER_MINUTES) {
        if (
          remainingMins <= reminderMin &&
          remainingMins > reminderMin - 1 &&
          !notifiedMinutesRef.current.has(reminderMin)
        ) {
          notifyResetSoon(remainingMins);
          notifiedMinutesRef.current.add(reminderMin);
        }
      }

      if (remainingMins <= 0) {
        notifiedMinutesRef.current.clear();
        setSnoozeUntil(null);
      }
    };

    checkReminders();
    const interval = setInterval(checkReminders, 30000);
    return () => clearInterval(interval);
  }, [usage, snoozeUntil]);

  // Loading state
  if (loading && !usage) {
    return (
      <div className="dashboard-container loading-state">
        <div className="loading-spinner" />
        <p>{t("dashboard.loading", "Loading...")}</p>
      </div>
    );
  }

  // Offline state
  if (isOffline) {
    return (
      <div className="dashboard-container offline-state">
        <GlassCard>
          <h3>{t("dashboard.offline", "Offline Mode")}</h3>
          <p>
            {t(
              "dashboard.offlineMessage",
              "Claudiminder is offline. Retrying automatically...",
            )}
          </p>
          <button onClick={refresh} className="refresh-btn">
            {t("dashboard.retry", "Retry Now")}
          </button>
        </GlassCard>
      </div>
    );
  }

  // Rate limited state
  if (isRateLimited) {
    return (
      <div className="dashboard-container rate-limited-state">
        <GlassCard>
          <h3>{t("dashboard.rateLimited", "Rate Limited")}</h3>
          <p>
            {t(
              "dashboard.rateLimitedMessage",
              "API rate limit exceeded. Retrying with backoff...",
            )}
          </p>
        </GlassCard>
      </div>
    );
  }

  // Error state
  if (error && !usage) {
    return (
      <div className="dashboard-container error-state">
        <GlassCard>
          <h3>{t("dashboard.error", "Error")}</h3>
          <p>{error}</p>
          <button onClick={refresh} className="refresh-btn">
            {t("dashboard.retry", "Retry")}
          </button>
        </GlassCard>
      </div>
    );
  }

  const fiveHour = usage?.five_hour;

  return (
    <main className="app-container">
      <div className="dashboard-container">
        <header className="dashboard-header">
          <h1 className="neon-text">{t("dashboard.title", "Claude Usage")}</h1>
          <div className="header-actions">
            <FocusModeIndicator
              enabled={focusMode}
              onToggle={() => setFocusMode(!focusMode)}
            />
            <button onClick={refresh} className="refresh-btn">
              {t("dashboard.refresh", "Refresh")}
            </button>
            <button
              onClick={() => setShowSettings(!showSettings)}
              className="settings-toggle-btn"
            >
              {showSettings ? "✕" : "⚙"}
            </button>
          </div>
        </header>

        <GridLayoutWrapper>
          <div key="usage" className="grid-item">
            <GlassCard>
              {fiveHour && (
                <UsageDisplay percentage={fiveHour.utilization * 100} />
              )}
            </GlassCard>
          </div>

          <div key="countdown" className="grid-item">
            <GlassCard>
              {fiveHour && <ResetCountdown resetsAt={fiveHour.resets_at} />}
            </GlassCard>
          </div>

          <div key="goals" className="grid-item">
            <GlassCard>
              <GoalsWidget
                budget={1000}
                current={fiveHour?.input_tokens_used || 0}
                pace="on-track"
              />
            </GlassCard>
          </div>

          <div key="stats" className="grid-item">
            <GlassCard>
              <StatsPanel
                requestsUsed={fiveHour?.input_tokens_used || 0}
                requestsLimit={fiveHour?.input_tokens_limit || 0}
                tokensUsed={fiveHour?.output_tokens_used || 0}
                tokensLimit={fiveHour?.output_tokens_limit || 0}
              />
            </GlassCard>
          </div>
        </GridLayoutWrapper>
      </div>

      {showSettings && (
        <aside className="settings-panel">
          <h2>{t("settings.title", "Settings")}</h2>
          <LanguageSwitcher />
          <ThemeSwitcher />
          <ColorCustomizer />
          <ProgressBarPicker />
          <FontSizeSlider />
        </aside>
      )}
    </main>
  );
}

export default App;
</file>

<file path="src/frontend/src/main.tsx">
import React from "react";
import ReactDOM from "react-dom/client";
import App from "./App";

ReactDOM.createRoot(document.getElementById("root")!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
);
</file>

<file path="src/frontend/src/vite-env.d.ts">
/// <reference types="vite/client" />
</file>

<file path="src/frontend/src-tauri/capabilities/default.json">
{
  "$schema": "https://tauri.app/v2/schemas/capability-schema.json",
  "identifier": "default",
  "description": "Default capabilities for Claudiminder",
  "windows": ["main"],
  "permissions": [
    "core:default",
    "notification:default",
    "notification:allow-is-permission-granted",
    "notification:allow-request-permission",
    "notification:allow-notify",
    "shell:allow-open"
  ]
}
</file>

<file path="src/frontend/src-tauri/gen/schemas/acl-manifests.json">
{
  "core": {
    "default_permission": {
      "identifier": "default",
      "description": "Default core plugins set.",
      "permissions": [
        "core:path:default",
        "core:event:default",
        "core:window:default",
        "core:webview:default",
        "core:app:default",
        "core:image:default",
        "core:resources:default",
        "core:menu:default",
        "core:tray:default"
      ]
    },
    "permissions": {},
    "permission_sets": {},
    "global_scope_schema": null
  },
  "core:app": {
    "default_permission": {
      "identifier": "default",
      "description": "Default permissions for the plugin.",
      "permissions": [
        "allow-version",
        "allow-name",
        "allow-tauri-version",
        "allow-identifier",
        "allow-bundle-type",
        "allow-register-listener",
        "allow-remove-listener"
      ]
    },
    "permissions": {
      "allow-app-hide": {
        "identifier": "allow-app-hide",
        "description": "Enables the app_hide command without any pre-configured scope.",
        "commands": { "allow": ["app_hide"], "deny": [] }
      },
      "allow-app-show": {
        "identifier": "allow-app-show",
        "description": "Enables the app_show command without any pre-configured scope.",
        "commands": { "allow": ["app_show"], "deny": [] }
      },
      "allow-bundle-type": {
        "identifier": "allow-bundle-type",
        "description": "Enables the bundle_type command without any pre-configured scope.",
        "commands": { "allow": ["bundle_type"], "deny": [] }
      },
      "allow-default-window-icon": {
        "identifier": "allow-default-window-icon",
        "description": "Enables the default_window_icon command without any pre-configured scope.",
        "commands": { "allow": ["default_window_icon"], "deny": [] }
      },
      "allow-fetch-data-store-identifiers": {
        "identifier": "allow-fetch-data-store-identifiers",
        "description": "Enables the fetch_data_store_identifiers command without any pre-configured scope.",
        "commands": { "allow": ["fetch_data_store_identifiers"], "deny": [] }
      },
      "allow-identifier": {
        "identifier": "allow-identifier",
        "description": "Enables the identifier command without any pre-configured scope.",
        "commands": { "allow": ["identifier"], "deny": [] }
      },
      "allow-name": {
        "identifier": "allow-name",
        "description": "Enables the name command without any pre-configured scope.",
        "commands": { "allow": ["name"], "deny": [] }
      },
      "allow-register-listener": {
        "identifier": "allow-register-listener",
        "description": "Enables the register_listener command without any pre-configured scope.",
        "commands": { "allow": ["register_listener"], "deny": [] }
      },
      "allow-remove-data-store": {
        "identifier": "allow-remove-data-store",
        "description": "Enables the remove_data_store command without any pre-configured scope.",
        "commands": { "allow": ["remove_data_store"], "deny": [] }
      },
      "allow-remove-listener": {
        "identifier": "allow-remove-listener",
        "description": "Enables the remove_listener command without any pre-configured scope.",
        "commands": { "allow": ["remove_listener"], "deny": [] }
      },
      "allow-set-app-theme": {
        "identifier": "allow-set-app-theme",
        "description": "Enables the set_app_theme command without any pre-configured scope.",
        "commands": { "allow": ["set_app_theme"], "deny": [] }
      },
      "allow-set-dock-visibility": {
        "identifier": "allow-set-dock-visibility",
        "description": "Enables the set_dock_visibility command without any pre-configured scope.",
        "commands": { "allow": ["set_dock_visibility"], "deny": [] }
      },
      "allow-tauri-version": {
        "identifier": "allow-tauri-version",
        "description": "Enables the tauri_version command without any pre-configured scope.",
        "commands": { "allow": ["tauri_version"], "deny": [] }
      },
      "allow-version": {
        "identifier": "allow-version",
        "description": "Enables the version command without any pre-configured scope.",
        "commands": { "allow": ["version"], "deny": [] }
      },
      "deny-app-hide": {
        "identifier": "deny-app-hide",
        "description": "Denies the app_hide command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["app_hide"] }
      },
      "deny-app-show": {
        "identifier": "deny-app-show",
        "description": "Denies the app_show command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["app_show"] }
      },
      "deny-bundle-type": {
        "identifier": "deny-bundle-type",
        "description": "Denies the bundle_type command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["bundle_type"] }
      },
      "deny-default-window-icon": {
        "identifier": "deny-default-window-icon",
        "description": "Denies the default_window_icon command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["default_window_icon"] }
      },
      "deny-fetch-data-store-identifiers": {
        "identifier": "deny-fetch-data-store-identifiers",
        "description": "Denies the fetch_data_store_identifiers command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["fetch_data_store_identifiers"] }
      },
      "deny-identifier": {
        "identifier": "deny-identifier",
        "description": "Denies the identifier command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["identifier"] }
      },
      "deny-name": {
        "identifier": "deny-name",
        "description": "Denies the name command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["name"] }
      },
      "deny-register-listener": {
        "identifier": "deny-register-listener",
        "description": "Denies the register_listener command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["register_listener"] }
      },
      "deny-remove-data-store": {
        "identifier": "deny-remove-data-store",
        "description": "Denies the remove_data_store command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["remove_data_store"] }
      },
      "deny-remove-listener": {
        "identifier": "deny-remove-listener",
        "description": "Denies the remove_listener command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["remove_listener"] }
      },
      "deny-set-app-theme": {
        "identifier": "deny-set-app-theme",
        "description": "Denies the set_app_theme command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_app_theme"] }
      },
      "deny-set-dock-visibility": {
        "identifier": "deny-set-dock-visibility",
        "description": "Denies the set_dock_visibility command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_dock_visibility"] }
      },
      "deny-tauri-version": {
        "identifier": "deny-tauri-version",
        "description": "Denies the tauri_version command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["tauri_version"] }
      },
      "deny-version": {
        "identifier": "deny-version",
        "description": "Denies the version command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["version"] }
      }
    },
    "permission_sets": {},
    "global_scope_schema": null
  },
  "core:event": {
    "default_permission": {
      "identifier": "default",
      "description": "Default permissions for the plugin, which enables all commands.",
      "permissions": [
        "allow-listen",
        "allow-unlisten",
        "allow-emit",
        "allow-emit-to"
      ]
    },
    "permissions": {
      "allow-emit": {
        "identifier": "allow-emit",
        "description": "Enables the emit command without any pre-configured scope.",
        "commands": { "allow": ["emit"], "deny": [] }
      },
      "allow-emit-to": {
        "identifier": "allow-emit-to",
        "description": "Enables the emit_to command without any pre-configured scope.",
        "commands": { "allow": ["emit_to"], "deny": [] }
      },
      "allow-listen": {
        "identifier": "allow-listen",
        "description": "Enables the listen command without any pre-configured scope.",
        "commands": { "allow": ["listen"], "deny": [] }
      },
      "allow-unlisten": {
        "identifier": "allow-unlisten",
        "description": "Enables the unlisten command without any pre-configured scope.",
        "commands": { "allow": ["unlisten"], "deny": [] }
      },
      "deny-emit": {
        "identifier": "deny-emit",
        "description": "Denies the emit command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["emit"] }
      },
      "deny-emit-to": {
        "identifier": "deny-emit-to",
        "description": "Denies the emit_to command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["emit_to"] }
      },
      "deny-listen": {
        "identifier": "deny-listen",
        "description": "Denies the listen command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["listen"] }
      },
      "deny-unlisten": {
        "identifier": "deny-unlisten",
        "description": "Denies the unlisten command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["unlisten"] }
      }
    },
    "permission_sets": {},
    "global_scope_schema": null
  },
  "core:image": {
    "default_permission": {
      "identifier": "default",
      "description": "Default permissions for the plugin, which enables all commands.",
      "permissions": [
        "allow-new",
        "allow-from-bytes",
        "allow-from-path",
        "allow-rgba",
        "allow-size"
      ]
    },
    "permissions": {
      "allow-from-bytes": {
        "identifier": "allow-from-bytes",
        "description": "Enables the from_bytes command without any pre-configured scope.",
        "commands": { "allow": ["from_bytes"], "deny": [] }
      },
      "allow-from-path": {
        "identifier": "allow-from-path",
        "description": "Enables the from_path command without any pre-configured scope.",
        "commands": { "allow": ["from_path"], "deny": [] }
      },
      "allow-new": {
        "identifier": "allow-new",
        "description": "Enables the new command without any pre-configured scope.",
        "commands": { "allow": ["new"], "deny": [] }
      },
      "allow-rgba": {
        "identifier": "allow-rgba",
        "description": "Enables the rgba command without any pre-configured scope.",
        "commands": { "allow": ["rgba"], "deny": [] }
      },
      "allow-size": {
        "identifier": "allow-size",
        "description": "Enables the size command without any pre-configured scope.",
        "commands": { "allow": ["size"], "deny": [] }
      },
      "deny-from-bytes": {
        "identifier": "deny-from-bytes",
        "description": "Denies the from_bytes command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["from_bytes"] }
      },
      "deny-from-path": {
        "identifier": "deny-from-path",
        "description": "Denies the from_path command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["from_path"] }
      },
      "deny-new": {
        "identifier": "deny-new",
        "description": "Denies the new command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["new"] }
      },
      "deny-rgba": {
        "identifier": "deny-rgba",
        "description": "Denies the rgba command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["rgba"] }
      },
      "deny-size": {
        "identifier": "deny-size",
        "description": "Denies the size command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["size"] }
      }
    },
    "permission_sets": {},
    "global_scope_schema": null
  },
  "core:menu": {
    "default_permission": {
      "identifier": "default",
      "description": "Default permissions for the plugin, which enables all commands.",
      "permissions": [
        "allow-new",
        "allow-append",
        "allow-prepend",
        "allow-insert",
        "allow-remove",
        "allow-remove-at",
        "allow-items",
        "allow-get",
        "allow-popup",
        "allow-create-default",
        "allow-set-as-app-menu",
        "allow-set-as-window-menu",
        "allow-text",
        "allow-set-text",
        "allow-is-enabled",
        "allow-set-enabled",
        "allow-set-accelerator",
        "allow-set-as-windows-menu-for-nsapp",
        "allow-set-as-help-menu-for-nsapp",
        "allow-is-checked",
        "allow-set-checked",
        "allow-set-icon"
      ]
    },
    "permissions": {
      "allow-append": {
        "identifier": "allow-append",
        "description": "Enables the append command without any pre-configured scope.",
        "commands": { "allow": ["append"], "deny": [] }
      },
      "allow-create-default": {
        "identifier": "allow-create-default",
        "description": "Enables the create_default command without any pre-configured scope.",
        "commands": { "allow": ["create_default"], "deny": [] }
      },
      "allow-get": {
        "identifier": "allow-get",
        "description": "Enables the get command without any pre-configured scope.",
        "commands": { "allow": ["get"], "deny": [] }
      },
      "allow-insert": {
        "identifier": "allow-insert",
        "description": "Enables the insert command without any pre-configured scope.",
        "commands": { "allow": ["insert"], "deny": [] }
      },
      "allow-is-checked": {
        "identifier": "allow-is-checked",
        "description": "Enables the is_checked command without any pre-configured scope.",
        "commands": { "allow": ["is_checked"], "deny": [] }
      },
      "allow-is-enabled": {
        "identifier": "allow-is-enabled",
        "description": "Enables the is_enabled command without any pre-configured scope.",
        "commands": { "allow": ["is_enabled"], "deny": [] }
      },
      "allow-items": {
        "identifier": "allow-items",
        "description": "Enables the items command without any pre-configured scope.",
        "commands": { "allow": ["items"], "deny": [] }
      },
      "allow-new": {
        "identifier": "allow-new",
        "description": "Enables the new command without any pre-configured scope.",
        "commands": { "allow": ["new"], "deny": [] }
      },
      "allow-popup": {
        "identifier": "allow-popup",
        "description": "Enables the popup command without any pre-configured scope.",
        "commands": { "allow": ["popup"], "deny": [] }
      },
      "allow-prepend": {
        "identifier": "allow-prepend",
        "description": "Enables the prepend command without any pre-configured scope.",
        "commands": { "allow": ["prepend"], "deny": [] }
      },
      "allow-remove": {
        "identifier": "allow-remove",
        "description": "Enables the remove command without any pre-configured scope.",
        "commands": { "allow": ["remove"], "deny": [] }
      },
      "allow-remove-at": {
        "identifier": "allow-remove-at",
        "description": "Enables the remove_at command without any pre-configured scope.",
        "commands": { "allow": ["remove_at"], "deny": [] }
      },
      "allow-set-accelerator": {
        "identifier": "allow-set-accelerator",
        "description": "Enables the set_accelerator command without any pre-configured scope.",
        "commands": { "allow": ["set_accelerator"], "deny": [] }
      },
      "allow-set-as-app-menu": {
        "identifier": "allow-set-as-app-menu",
        "description": "Enables the set_as_app_menu command without any pre-configured scope.",
        "commands": { "allow": ["set_as_app_menu"], "deny": [] }
      },
      "allow-set-as-help-menu-for-nsapp": {
        "identifier": "allow-set-as-help-menu-for-nsapp",
        "description": "Enables the set_as_help_menu_for_nsapp command without any pre-configured scope.",
        "commands": { "allow": ["set_as_help_menu_for_nsapp"], "deny": [] }
      },
      "allow-set-as-window-menu": {
        "identifier": "allow-set-as-window-menu",
        "description": "Enables the set_as_window_menu command without any pre-configured scope.",
        "commands": { "allow": ["set_as_window_menu"], "deny": [] }
      },
      "allow-set-as-windows-menu-for-nsapp": {
        "identifier": "allow-set-as-windows-menu-for-nsapp",
        "description": "Enables the set_as_windows_menu_for_nsapp command without any pre-configured scope.",
        "commands": { "allow": ["set_as_windows_menu_for_nsapp"], "deny": [] }
      },
      "allow-set-checked": {
        "identifier": "allow-set-checked",
        "description": "Enables the set_checked command without any pre-configured scope.",
        "commands": { "allow": ["set_checked"], "deny": [] }
      },
      "allow-set-enabled": {
        "identifier": "allow-set-enabled",
        "description": "Enables the set_enabled command without any pre-configured scope.",
        "commands": { "allow": ["set_enabled"], "deny": [] }
      },
      "allow-set-icon": {
        "identifier": "allow-set-icon",
        "description": "Enables the set_icon command without any pre-configured scope.",
        "commands": { "allow": ["set_icon"], "deny": [] }
      },
      "allow-set-text": {
        "identifier": "allow-set-text",
        "description": "Enables the set_text command without any pre-configured scope.",
        "commands": { "allow": ["set_text"], "deny": [] }
      },
      "allow-text": {
        "identifier": "allow-text",
        "description": "Enables the text command without any pre-configured scope.",
        "commands": { "allow": ["text"], "deny": [] }
      },
      "deny-append": {
        "identifier": "deny-append",
        "description": "Denies the append command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["append"] }
      },
      "deny-create-default": {
        "identifier": "deny-create-default",
        "description": "Denies the create_default command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["create_default"] }
      },
      "deny-get": {
        "identifier": "deny-get",
        "description": "Denies the get command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["get"] }
      },
      "deny-insert": {
        "identifier": "deny-insert",
        "description": "Denies the insert command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["insert"] }
      },
      "deny-is-checked": {
        "identifier": "deny-is-checked",
        "description": "Denies the is_checked command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_checked"] }
      },
      "deny-is-enabled": {
        "identifier": "deny-is-enabled",
        "description": "Denies the is_enabled command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_enabled"] }
      },
      "deny-items": {
        "identifier": "deny-items",
        "description": "Denies the items command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["items"] }
      },
      "deny-new": {
        "identifier": "deny-new",
        "description": "Denies the new command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["new"] }
      },
      "deny-popup": {
        "identifier": "deny-popup",
        "description": "Denies the popup command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["popup"] }
      },
      "deny-prepend": {
        "identifier": "deny-prepend",
        "description": "Denies the prepend command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["prepend"] }
      },
      "deny-remove": {
        "identifier": "deny-remove",
        "description": "Denies the remove command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["remove"] }
      },
      "deny-remove-at": {
        "identifier": "deny-remove-at",
        "description": "Denies the remove_at command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["remove_at"] }
      },
      "deny-set-accelerator": {
        "identifier": "deny-set-accelerator",
        "description": "Denies the set_accelerator command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_accelerator"] }
      },
      "deny-set-as-app-menu": {
        "identifier": "deny-set-as-app-menu",
        "description": "Denies the set_as_app_menu command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_as_app_menu"] }
      },
      "deny-set-as-help-menu-for-nsapp": {
        "identifier": "deny-set-as-help-menu-for-nsapp",
        "description": "Denies the set_as_help_menu_for_nsapp command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_as_help_menu_for_nsapp"] }
      },
      "deny-set-as-window-menu": {
        "identifier": "deny-set-as-window-menu",
        "description": "Denies the set_as_window_menu command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_as_window_menu"] }
      },
      "deny-set-as-windows-menu-for-nsapp": {
        "identifier": "deny-set-as-windows-menu-for-nsapp",
        "description": "Denies the set_as_windows_menu_for_nsapp command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_as_windows_menu_for_nsapp"] }
      },
      "deny-set-checked": {
        "identifier": "deny-set-checked",
        "description": "Denies the set_checked command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_checked"] }
      },
      "deny-set-enabled": {
        "identifier": "deny-set-enabled",
        "description": "Denies the set_enabled command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_enabled"] }
      },
      "deny-set-icon": {
        "identifier": "deny-set-icon",
        "description": "Denies the set_icon command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_icon"] }
      },
      "deny-set-text": {
        "identifier": "deny-set-text",
        "description": "Denies the set_text command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_text"] }
      },
      "deny-text": {
        "identifier": "deny-text",
        "description": "Denies the text command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["text"] }
      }
    },
    "permission_sets": {},
    "global_scope_schema": null
  },
  "core:path": {
    "default_permission": {
      "identifier": "default",
      "description": "Default permissions for the plugin, which enables all commands.",
      "permissions": [
        "allow-resolve-directory",
        "allow-resolve",
        "allow-normalize",
        "allow-join",
        "allow-dirname",
        "allow-extname",
        "allow-basename",
        "allow-is-absolute"
      ]
    },
    "permissions": {
      "allow-basename": {
        "identifier": "allow-basename",
        "description": "Enables the basename command without any pre-configured scope.",
        "commands": { "allow": ["basename"], "deny": [] }
      },
      "allow-dirname": {
        "identifier": "allow-dirname",
        "description": "Enables the dirname command without any pre-configured scope.",
        "commands": { "allow": ["dirname"], "deny": [] }
      },
      "allow-extname": {
        "identifier": "allow-extname",
        "description": "Enables the extname command without any pre-configured scope.",
        "commands": { "allow": ["extname"], "deny": [] }
      },
      "allow-is-absolute": {
        "identifier": "allow-is-absolute",
        "description": "Enables the is_absolute command without any pre-configured scope.",
        "commands": { "allow": ["is_absolute"], "deny": [] }
      },
      "allow-join": {
        "identifier": "allow-join",
        "description": "Enables the join command without any pre-configured scope.",
        "commands": { "allow": ["join"], "deny": [] }
      },
      "allow-normalize": {
        "identifier": "allow-normalize",
        "description": "Enables the normalize command without any pre-configured scope.",
        "commands": { "allow": ["normalize"], "deny": [] }
      },
      "allow-resolve": {
        "identifier": "allow-resolve",
        "description": "Enables the resolve command without any pre-configured scope.",
        "commands": { "allow": ["resolve"], "deny": [] }
      },
      "allow-resolve-directory": {
        "identifier": "allow-resolve-directory",
        "description": "Enables the resolve_directory command without any pre-configured scope.",
        "commands": { "allow": ["resolve_directory"], "deny": [] }
      },
      "deny-basename": {
        "identifier": "deny-basename",
        "description": "Denies the basename command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["basename"] }
      },
      "deny-dirname": {
        "identifier": "deny-dirname",
        "description": "Denies the dirname command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["dirname"] }
      },
      "deny-extname": {
        "identifier": "deny-extname",
        "description": "Denies the extname command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["extname"] }
      },
      "deny-is-absolute": {
        "identifier": "deny-is-absolute",
        "description": "Denies the is_absolute command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_absolute"] }
      },
      "deny-join": {
        "identifier": "deny-join",
        "description": "Denies the join command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["join"] }
      },
      "deny-normalize": {
        "identifier": "deny-normalize",
        "description": "Denies the normalize command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["normalize"] }
      },
      "deny-resolve": {
        "identifier": "deny-resolve",
        "description": "Denies the resolve command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["resolve"] }
      },
      "deny-resolve-directory": {
        "identifier": "deny-resolve-directory",
        "description": "Denies the resolve_directory command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["resolve_directory"] }
      }
    },
    "permission_sets": {},
    "global_scope_schema": null
  },
  "core:resources": {
    "default_permission": {
      "identifier": "default",
      "description": "Default permissions for the plugin, which enables all commands.",
      "permissions": ["allow-close"]
    },
    "permissions": {
      "allow-close": {
        "identifier": "allow-close",
        "description": "Enables the close command without any pre-configured scope.",
        "commands": { "allow": ["close"], "deny": [] }
      },
      "deny-close": {
        "identifier": "deny-close",
        "description": "Denies the close command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["close"] }
      }
    },
    "permission_sets": {},
    "global_scope_schema": null
  },
  "core:tray": {
    "default_permission": {
      "identifier": "default",
      "description": "Default permissions for the plugin, which enables all commands.",
      "permissions": [
        "allow-new",
        "allow-get-by-id",
        "allow-remove-by-id",
        "allow-set-icon",
        "allow-set-menu",
        "allow-set-tooltip",
        "allow-set-title",
        "allow-set-visible",
        "allow-set-temp-dir-path",
        "allow-set-icon-as-template",
        "allow-set-show-menu-on-left-click"
      ]
    },
    "permissions": {
      "allow-get-by-id": {
        "identifier": "allow-get-by-id",
        "description": "Enables the get_by_id command without any pre-configured scope.",
        "commands": { "allow": ["get_by_id"], "deny": [] }
      },
      "allow-new": {
        "identifier": "allow-new",
        "description": "Enables the new command without any pre-configured scope.",
        "commands": { "allow": ["new"], "deny": [] }
      },
      "allow-remove-by-id": {
        "identifier": "allow-remove-by-id",
        "description": "Enables the remove_by_id command without any pre-configured scope.",
        "commands": { "allow": ["remove_by_id"], "deny": [] }
      },
      "allow-set-icon": {
        "identifier": "allow-set-icon",
        "description": "Enables the set_icon command without any pre-configured scope.",
        "commands": { "allow": ["set_icon"], "deny": [] }
      },
      "allow-set-icon-as-template": {
        "identifier": "allow-set-icon-as-template",
        "description": "Enables the set_icon_as_template command without any pre-configured scope.",
        "commands": { "allow": ["set_icon_as_template"], "deny": [] }
      },
      "allow-set-menu": {
        "identifier": "allow-set-menu",
        "description": "Enables the set_menu command without any pre-configured scope.",
        "commands": { "allow": ["set_menu"], "deny": [] }
      },
      "allow-set-show-menu-on-left-click": {
        "identifier": "allow-set-show-menu-on-left-click",
        "description": "Enables the set_show_menu_on_left_click command without any pre-configured scope.",
        "commands": { "allow": ["set_show_menu_on_left_click"], "deny": [] }
      },
      "allow-set-temp-dir-path": {
        "identifier": "allow-set-temp-dir-path",
        "description": "Enables the set_temp_dir_path command without any pre-configured scope.",
        "commands": { "allow": ["set_temp_dir_path"], "deny": [] }
      },
      "allow-set-title": {
        "identifier": "allow-set-title",
        "description": "Enables the set_title command without any pre-configured scope.",
        "commands": { "allow": ["set_title"], "deny": [] }
      },
      "allow-set-tooltip": {
        "identifier": "allow-set-tooltip",
        "description": "Enables the set_tooltip command without any pre-configured scope.",
        "commands": { "allow": ["set_tooltip"], "deny": [] }
      },
      "allow-set-visible": {
        "identifier": "allow-set-visible",
        "description": "Enables the set_visible command without any pre-configured scope.",
        "commands": { "allow": ["set_visible"], "deny": [] }
      },
      "deny-get-by-id": {
        "identifier": "deny-get-by-id",
        "description": "Denies the get_by_id command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["get_by_id"] }
      },
      "deny-new": {
        "identifier": "deny-new",
        "description": "Denies the new command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["new"] }
      },
      "deny-remove-by-id": {
        "identifier": "deny-remove-by-id",
        "description": "Denies the remove_by_id command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["remove_by_id"] }
      },
      "deny-set-icon": {
        "identifier": "deny-set-icon",
        "description": "Denies the set_icon command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_icon"] }
      },
      "deny-set-icon-as-template": {
        "identifier": "deny-set-icon-as-template",
        "description": "Denies the set_icon_as_template command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_icon_as_template"] }
      },
      "deny-set-menu": {
        "identifier": "deny-set-menu",
        "description": "Denies the set_menu command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_menu"] }
      },
      "deny-set-show-menu-on-left-click": {
        "identifier": "deny-set-show-menu-on-left-click",
        "description": "Denies the set_show_menu_on_left_click command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_show_menu_on_left_click"] }
      },
      "deny-set-temp-dir-path": {
        "identifier": "deny-set-temp-dir-path",
        "description": "Denies the set_temp_dir_path command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_temp_dir_path"] }
      },
      "deny-set-title": {
        "identifier": "deny-set-title",
        "description": "Denies the set_title command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_title"] }
      },
      "deny-set-tooltip": {
        "identifier": "deny-set-tooltip",
        "description": "Denies the set_tooltip command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_tooltip"] }
      },
      "deny-set-visible": {
        "identifier": "deny-set-visible",
        "description": "Denies the set_visible command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_visible"] }
      }
    },
    "permission_sets": {},
    "global_scope_schema": null
  },
  "core:webview": {
    "default_permission": {
      "identifier": "default",
      "description": "Default permissions for the plugin.",
      "permissions": [
        "allow-get-all-webviews",
        "allow-webview-position",
        "allow-webview-size",
        "allow-internal-toggle-devtools"
      ]
    },
    "permissions": {
      "allow-clear-all-browsing-data": {
        "identifier": "allow-clear-all-browsing-data",
        "description": "Enables the clear_all_browsing_data command without any pre-configured scope.",
        "commands": { "allow": ["clear_all_browsing_data"], "deny": [] }
      },
      "allow-create-webview": {
        "identifier": "allow-create-webview",
        "description": "Enables the create_webview command without any pre-configured scope.",
        "commands": { "allow": ["create_webview"], "deny": [] }
      },
      "allow-create-webview-window": {
        "identifier": "allow-create-webview-window",
        "description": "Enables the create_webview_window command without any pre-configured scope.",
        "commands": { "allow": ["create_webview_window"], "deny": [] }
      },
      "allow-get-all-webviews": {
        "identifier": "allow-get-all-webviews",
        "description": "Enables the get_all_webviews command without any pre-configured scope.",
        "commands": { "allow": ["get_all_webviews"], "deny": [] }
      },
      "allow-internal-toggle-devtools": {
        "identifier": "allow-internal-toggle-devtools",
        "description": "Enables the internal_toggle_devtools command without any pre-configured scope.",
        "commands": { "allow": ["internal_toggle_devtools"], "deny": [] }
      },
      "allow-print": {
        "identifier": "allow-print",
        "description": "Enables the print command without any pre-configured scope.",
        "commands": { "allow": ["print"], "deny": [] }
      },
      "allow-reparent": {
        "identifier": "allow-reparent",
        "description": "Enables the reparent command without any pre-configured scope.",
        "commands": { "allow": ["reparent"], "deny": [] }
      },
      "allow-set-webview-auto-resize": {
        "identifier": "allow-set-webview-auto-resize",
        "description": "Enables the set_webview_auto_resize command without any pre-configured scope.",
        "commands": { "allow": ["set_webview_auto_resize"], "deny": [] }
      },
      "allow-set-webview-background-color": {
        "identifier": "allow-set-webview-background-color",
        "description": "Enables the set_webview_background_color command without any pre-configured scope.",
        "commands": { "allow": ["set_webview_background_color"], "deny": [] }
      },
      "allow-set-webview-focus": {
        "identifier": "allow-set-webview-focus",
        "description": "Enables the set_webview_focus command without any pre-configured scope.",
        "commands": { "allow": ["set_webview_focus"], "deny": [] }
      },
      "allow-set-webview-position": {
        "identifier": "allow-set-webview-position",
        "description": "Enables the set_webview_position command without any pre-configured scope.",
        "commands": { "allow": ["set_webview_position"], "deny": [] }
      },
      "allow-set-webview-size": {
        "identifier": "allow-set-webview-size",
        "description": "Enables the set_webview_size command without any pre-configured scope.",
        "commands": { "allow": ["set_webview_size"], "deny": [] }
      },
      "allow-set-webview-zoom": {
        "identifier": "allow-set-webview-zoom",
        "description": "Enables the set_webview_zoom command without any pre-configured scope.",
        "commands": { "allow": ["set_webview_zoom"], "deny": [] }
      },
      "allow-webview-close": {
        "identifier": "allow-webview-close",
        "description": "Enables the webview_close command without any pre-configured scope.",
        "commands": { "allow": ["webview_close"], "deny": [] }
      },
      "allow-webview-hide": {
        "identifier": "allow-webview-hide",
        "description": "Enables the webview_hide command without any pre-configured scope.",
        "commands": { "allow": ["webview_hide"], "deny": [] }
      },
      "allow-webview-position": {
        "identifier": "allow-webview-position",
        "description": "Enables the webview_position command without any pre-configured scope.",
        "commands": { "allow": ["webview_position"], "deny": [] }
      },
      "allow-webview-show": {
        "identifier": "allow-webview-show",
        "description": "Enables the webview_show command without any pre-configured scope.",
        "commands": { "allow": ["webview_show"], "deny": [] }
      },
      "allow-webview-size": {
        "identifier": "allow-webview-size",
        "description": "Enables the webview_size command without any pre-configured scope.",
        "commands": { "allow": ["webview_size"], "deny": [] }
      },
      "deny-clear-all-browsing-data": {
        "identifier": "deny-clear-all-browsing-data",
        "description": "Denies the clear_all_browsing_data command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["clear_all_browsing_data"] }
      },
      "deny-create-webview": {
        "identifier": "deny-create-webview",
        "description": "Denies the create_webview command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["create_webview"] }
      },
      "deny-create-webview-window": {
        "identifier": "deny-create-webview-window",
        "description": "Denies the create_webview_window command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["create_webview_window"] }
      },
      "deny-get-all-webviews": {
        "identifier": "deny-get-all-webviews",
        "description": "Denies the get_all_webviews command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["get_all_webviews"] }
      },
      "deny-internal-toggle-devtools": {
        "identifier": "deny-internal-toggle-devtools",
        "description": "Denies the internal_toggle_devtools command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["internal_toggle_devtools"] }
      },
      "deny-print": {
        "identifier": "deny-print",
        "description": "Denies the print command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["print"] }
      },
      "deny-reparent": {
        "identifier": "deny-reparent",
        "description": "Denies the reparent command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["reparent"] }
      },
      "deny-set-webview-auto-resize": {
        "identifier": "deny-set-webview-auto-resize",
        "description": "Denies the set_webview_auto_resize command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_webview_auto_resize"] }
      },
      "deny-set-webview-background-color": {
        "identifier": "deny-set-webview-background-color",
        "description": "Denies the set_webview_background_color command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_webview_background_color"] }
      },
      "deny-set-webview-focus": {
        "identifier": "deny-set-webview-focus",
        "description": "Denies the set_webview_focus command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_webview_focus"] }
      },
      "deny-set-webview-position": {
        "identifier": "deny-set-webview-position",
        "description": "Denies the set_webview_position command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_webview_position"] }
      },
      "deny-set-webview-size": {
        "identifier": "deny-set-webview-size",
        "description": "Denies the set_webview_size command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_webview_size"] }
      },
      "deny-set-webview-zoom": {
        "identifier": "deny-set-webview-zoom",
        "description": "Denies the set_webview_zoom command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_webview_zoom"] }
      },
      "deny-webview-close": {
        "identifier": "deny-webview-close",
        "description": "Denies the webview_close command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["webview_close"] }
      },
      "deny-webview-hide": {
        "identifier": "deny-webview-hide",
        "description": "Denies the webview_hide command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["webview_hide"] }
      },
      "deny-webview-position": {
        "identifier": "deny-webview-position",
        "description": "Denies the webview_position command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["webview_position"] }
      },
      "deny-webview-show": {
        "identifier": "deny-webview-show",
        "description": "Denies the webview_show command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["webview_show"] }
      },
      "deny-webview-size": {
        "identifier": "deny-webview-size",
        "description": "Denies the webview_size command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["webview_size"] }
      }
    },
    "permission_sets": {},
    "global_scope_schema": null
  },
  "core:window": {
    "default_permission": {
      "identifier": "default",
      "description": "Default permissions for the plugin.",
      "permissions": [
        "allow-get-all-windows",
        "allow-scale-factor",
        "allow-inner-position",
        "allow-outer-position",
        "allow-inner-size",
        "allow-outer-size",
        "allow-is-fullscreen",
        "allow-is-minimized",
        "allow-is-maximized",
        "allow-is-focused",
        "allow-is-decorated",
        "allow-is-resizable",
        "allow-is-maximizable",
        "allow-is-minimizable",
        "allow-is-closable",
        "allow-is-visible",
        "allow-is-enabled",
        "allow-title",
        "allow-current-monitor",
        "allow-primary-monitor",
        "allow-monitor-from-point",
        "allow-available-monitors",
        "allow-cursor-position",
        "allow-theme",
        "allow-is-always-on-top",
        "allow-internal-toggle-maximize"
      ]
    },
    "permissions": {
      "allow-available-monitors": {
        "identifier": "allow-available-monitors",
        "description": "Enables the available_monitors command without any pre-configured scope.",
        "commands": { "allow": ["available_monitors"], "deny": [] }
      },
      "allow-center": {
        "identifier": "allow-center",
        "description": "Enables the center command without any pre-configured scope.",
        "commands": { "allow": ["center"], "deny": [] }
      },
      "allow-close": {
        "identifier": "allow-close",
        "description": "Enables the close command without any pre-configured scope.",
        "commands": { "allow": ["close"], "deny": [] }
      },
      "allow-create": {
        "identifier": "allow-create",
        "description": "Enables the create command without any pre-configured scope.",
        "commands": { "allow": ["create"], "deny": [] }
      },
      "allow-current-monitor": {
        "identifier": "allow-current-monitor",
        "description": "Enables the current_monitor command without any pre-configured scope.",
        "commands": { "allow": ["current_monitor"], "deny": [] }
      },
      "allow-cursor-position": {
        "identifier": "allow-cursor-position",
        "description": "Enables the cursor_position command without any pre-configured scope.",
        "commands": { "allow": ["cursor_position"], "deny": [] }
      },
      "allow-destroy": {
        "identifier": "allow-destroy",
        "description": "Enables the destroy command without any pre-configured scope.",
        "commands": { "allow": ["destroy"], "deny": [] }
      },
      "allow-get-all-windows": {
        "identifier": "allow-get-all-windows",
        "description": "Enables the get_all_windows command without any pre-configured scope.",
        "commands": { "allow": ["get_all_windows"], "deny": [] }
      },
      "allow-hide": {
        "identifier": "allow-hide",
        "description": "Enables the hide command without any pre-configured scope.",
        "commands": { "allow": ["hide"], "deny": [] }
      },
      "allow-inner-position": {
        "identifier": "allow-inner-position",
        "description": "Enables the inner_position command without any pre-configured scope.",
        "commands": { "allow": ["inner_position"], "deny": [] }
      },
      "allow-inner-size": {
        "identifier": "allow-inner-size",
        "description": "Enables the inner_size command without any pre-configured scope.",
        "commands": { "allow": ["inner_size"], "deny": [] }
      },
      "allow-internal-toggle-maximize": {
        "identifier": "allow-internal-toggle-maximize",
        "description": "Enables the internal_toggle_maximize command without any pre-configured scope.",
        "commands": { "allow": ["internal_toggle_maximize"], "deny": [] }
      },
      "allow-is-always-on-top": {
        "identifier": "allow-is-always-on-top",
        "description": "Enables the is_always_on_top command without any pre-configured scope.",
        "commands": { "allow": ["is_always_on_top"], "deny": [] }
      },
      "allow-is-closable": {
        "identifier": "allow-is-closable",
        "description": "Enables the is_closable command without any pre-configured scope.",
        "commands": { "allow": ["is_closable"], "deny": [] }
      },
      "allow-is-decorated": {
        "identifier": "allow-is-decorated",
        "description": "Enables the is_decorated command without any pre-configured scope.",
        "commands": { "allow": ["is_decorated"], "deny": [] }
      },
      "allow-is-enabled": {
        "identifier": "allow-is-enabled",
        "description": "Enables the is_enabled command without any pre-configured scope.",
        "commands": { "allow": ["is_enabled"], "deny": [] }
      },
      "allow-is-focused": {
        "identifier": "allow-is-focused",
        "description": "Enables the is_focused command without any pre-configured scope.",
        "commands": { "allow": ["is_focused"], "deny": [] }
      },
      "allow-is-fullscreen": {
        "identifier": "allow-is-fullscreen",
        "description": "Enables the is_fullscreen command without any pre-configured scope.",
        "commands": { "allow": ["is_fullscreen"], "deny": [] }
      },
      "allow-is-maximizable": {
        "identifier": "allow-is-maximizable",
        "description": "Enables the is_maximizable command without any pre-configured scope.",
        "commands": { "allow": ["is_maximizable"], "deny": [] }
      },
      "allow-is-maximized": {
        "identifier": "allow-is-maximized",
        "description": "Enables the is_maximized command without any pre-configured scope.",
        "commands": { "allow": ["is_maximized"], "deny": [] }
      },
      "allow-is-minimizable": {
        "identifier": "allow-is-minimizable",
        "description": "Enables the is_minimizable command without any pre-configured scope.",
        "commands": { "allow": ["is_minimizable"], "deny": [] }
      },
      "allow-is-minimized": {
        "identifier": "allow-is-minimized",
        "description": "Enables the is_minimized command without any pre-configured scope.",
        "commands": { "allow": ["is_minimized"], "deny": [] }
      },
      "allow-is-resizable": {
        "identifier": "allow-is-resizable",
        "description": "Enables the is_resizable command without any pre-configured scope.",
        "commands": { "allow": ["is_resizable"], "deny": [] }
      },
      "allow-is-visible": {
        "identifier": "allow-is-visible",
        "description": "Enables the is_visible command without any pre-configured scope.",
        "commands": { "allow": ["is_visible"], "deny": [] }
      },
      "allow-maximize": {
        "identifier": "allow-maximize",
        "description": "Enables the maximize command without any pre-configured scope.",
        "commands": { "allow": ["maximize"], "deny": [] }
      },
      "allow-minimize": {
        "identifier": "allow-minimize",
        "description": "Enables the minimize command without any pre-configured scope.",
        "commands": { "allow": ["minimize"], "deny": [] }
      },
      "allow-monitor-from-point": {
        "identifier": "allow-monitor-from-point",
        "description": "Enables the monitor_from_point command without any pre-configured scope.",
        "commands": { "allow": ["monitor_from_point"], "deny": [] }
      },
      "allow-outer-position": {
        "identifier": "allow-outer-position",
        "description": "Enables the outer_position command without any pre-configured scope.",
        "commands": { "allow": ["outer_position"], "deny": [] }
      },
      "allow-outer-size": {
        "identifier": "allow-outer-size",
        "description": "Enables the outer_size command without any pre-configured scope.",
        "commands": { "allow": ["outer_size"], "deny": [] }
      },
      "allow-primary-monitor": {
        "identifier": "allow-primary-monitor",
        "description": "Enables the primary_monitor command without any pre-configured scope.",
        "commands": { "allow": ["primary_monitor"], "deny": [] }
      },
      "allow-request-user-attention": {
        "identifier": "allow-request-user-attention",
        "description": "Enables the request_user_attention command without any pre-configured scope.",
        "commands": { "allow": ["request_user_attention"], "deny": [] }
      },
      "allow-scale-factor": {
        "identifier": "allow-scale-factor",
        "description": "Enables the scale_factor command without any pre-configured scope.",
        "commands": { "allow": ["scale_factor"], "deny": [] }
      },
      "allow-set-always-on-bottom": {
        "identifier": "allow-set-always-on-bottom",
        "description": "Enables the set_always_on_bottom command without any pre-configured scope.",
        "commands": { "allow": ["set_always_on_bottom"], "deny": [] }
      },
      "allow-set-always-on-top": {
        "identifier": "allow-set-always-on-top",
        "description": "Enables the set_always_on_top command without any pre-configured scope.",
        "commands": { "allow": ["set_always_on_top"], "deny": [] }
      },
      "allow-set-background-color": {
        "identifier": "allow-set-background-color",
        "description": "Enables the set_background_color command without any pre-configured scope.",
        "commands": { "allow": ["set_background_color"], "deny": [] }
      },
      "allow-set-badge-count": {
        "identifier": "allow-set-badge-count",
        "description": "Enables the set_badge_count command without any pre-configured scope.",
        "commands": { "allow": ["set_badge_count"], "deny": [] }
      },
      "allow-set-badge-label": {
        "identifier": "allow-set-badge-label",
        "description": "Enables the set_badge_label command without any pre-configured scope.",
        "commands": { "allow": ["set_badge_label"], "deny": [] }
      },
      "allow-set-closable": {
        "identifier": "allow-set-closable",
        "description": "Enables the set_closable command without any pre-configured scope.",
        "commands": { "allow": ["set_closable"], "deny": [] }
      },
      "allow-set-content-protected": {
        "identifier": "allow-set-content-protected",
        "description": "Enables the set_content_protected command without any pre-configured scope.",
        "commands": { "allow": ["set_content_protected"], "deny": [] }
      },
      "allow-set-cursor-grab": {
        "identifier": "allow-set-cursor-grab",
        "description": "Enables the set_cursor_grab command without any pre-configured scope.",
        "commands": { "allow": ["set_cursor_grab"], "deny": [] }
      },
      "allow-set-cursor-icon": {
        "identifier": "allow-set-cursor-icon",
        "description": "Enables the set_cursor_icon command without any pre-configured scope.",
        "commands": { "allow": ["set_cursor_icon"], "deny": [] }
      },
      "allow-set-cursor-position": {
        "identifier": "allow-set-cursor-position",
        "description": "Enables the set_cursor_position command without any pre-configured scope.",
        "commands": { "allow": ["set_cursor_position"], "deny": [] }
      },
      "allow-set-cursor-visible": {
        "identifier": "allow-set-cursor-visible",
        "description": "Enables the set_cursor_visible command without any pre-configured scope.",
        "commands": { "allow": ["set_cursor_visible"], "deny": [] }
      },
      "allow-set-decorations": {
        "identifier": "allow-set-decorations",
        "description": "Enables the set_decorations command without any pre-configured scope.",
        "commands": { "allow": ["set_decorations"], "deny": [] }
      },
      "allow-set-effects": {
        "identifier": "allow-set-effects",
        "description": "Enables the set_effects command without any pre-configured scope.",
        "commands": { "allow": ["set_effects"], "deny": [] }
      },
      "allow-set-enabled": {
        "identifier": "allow-set-enabled",
        "description": "Enables the set_enabled command without any pre-configured scope.",
        "commands": { "allow": ["set_enabled"], "deny": [] }
      },
      "allow-set-focus": {
        "identifier": "allow-set-focus",
        "description": "Enables the set_focus command without any pre-configured scope.",
        "commands": { "allow": ["set_focus"], "deny": [] }
      },
      "allow-set-focusable": {
        "identifier": "allow-set-focusable",
        "description": "Enables the set_focusable command without any pre-configured scope.",
        "commands": { "allow": ["set_focusable"], "deny": [] }
      },
      "allow-set-fullscreen": {
        "identifier": "allow-set-fullscreen",
        "description": "Enables the set_fullscreen command without any pre-configured scope.",
        "commands": { "allow": ["set_fullscreen"], "deny": [] }
      },
      "allow-set-icon": {
        "identifier": "allow-set-icon",
        "description": "Enables the set_icon command without any pre-configured scope.",
        "commands": { "allow": ["set_icon"], "deny": [] }
      },
      "allow-set-ignore-cursor-events": {
        "identifier": "allow-set-ignore-cursor-events",
        "description": "Enables the set_ignore_cursor_events command without any pre-configured scope.",
        "commands": { "allow": ["set_ignore_cursor_events"], "deny": [] }
      },
      "allow-set-max-size": {
        "identifier": "allow-set-max-size",
        "description": "Enables the set_max_size command without any pre-configured scope.",
        "commands": { "allow": ["set_max_size"], "deny": [] }
      },
      "allow-set-maximizable": {
        "identifier": "allow-set-maximizable",
        "description": "Enables the set_maximizable command without any pre-configured scope.",
        "commands": { "allow": ["set_maximizable"], "deny": [] }
      },
      "allow-set-min-size": {
        "identifier": "allow-set-min-size",
        "description": "Enables the set_min_size command without any pre-configured scope.",
        "commands": { "allow": ["set_min_size"], "deny": [] }
      },
      "allow-set-minimizable": {
        "identifier": "allow-set-minimizable",
        "description": "Enables the set_minimizable command without any pre-configured scope.",
        "commands": { "allow": ["set_minimizable"], "deny": [] }
      },
      "allow-set-overlay-icon": {
        "identifier": "allow-set-overlay-icon",
        "description": "Enables the set_overlay_icon command without any pre-configured scope.",
        "commands": { "allow": ["set_overlay_icon"], "deny": [] }
      },
      "allow-set-position": {
        "identifier": "allow-set-position",
        "description": "Enables the set_position command without any pre-configured scope.",
        "commands": { "allow": ["set_position"], "deny": [] }
      },
      "allow-set-progress-bar": {
        "identifier": "allow-set-progress-bar",
        "description": "Enables the set_progress_bar command without any pre-configured scope.",
        "commands": { "allow": ["set_progress_bar"], "deny": [] }
      },
      "allow-set-resizable": {
        "identifier": "allow-set-resizable",
        "description": "Enables the set_resizable command without any pre-configured scope.",
        "commands": { "allow": ["set_resizable"], "deny": [] }
      },
      "allow-set-shadow": {
        "identifier": "allow-set-shadow",
        "description": "Enables the set_shadow command without any pre-configured scope.",
        "commands": { "allow": ["set_shadow"], "deny": [] }
      },
      "allow-set-simple-fullscreen": {
        "identifier": "allow-set-simple-fullscreen",
        "description": "Enables the set_simple_fullscreen command without any pre-configured scope.",
        "commands": { "allow": ["set_simple_fullscreen"], "deny": [] }
      },
      "allow-set-size": {
        "identifier": "allow-set-size",
        "description": "Enables the set_size command without any pre-configured scope.",
        "commands": { "allow": ["set_size"], "deny": [] }
      },
      "allow-set-size-constraints": {
        "identifier": "allow-set-size-constraints",
        "description": "Enables the set_size_constraints command without any pre-configured scope.",
        "commands": { "allow": ["set_size_constraints"], "deny": [] }
      },
      "allow-set-skip-taskbar": {
        "identifier": "allow-set-skip-taskbar",
        "description": "Enables the set_skip_taskbar command without any pre-configured scope.",
        "commands": { "allow": ["set_skip_taskbar"], "deny": [] }
      },
      "allow-set-theme": {
        "identifier": "allow-set-theme",
        "description": "Enables the set_theme command without any pre-configured scope.",
        "commands": { "allow": ["set_theme"], "deny": [] }
      },
      "allow-set-title": {
        "identifier": "allow-set-title",
        "description": "Enables the set_title command without any pre-configured scope.",
        "commands": { "allow": ["set_title"], "deny": [] }
      },
      "allow-set-title-bar-style": {
        "identifier": "allow-set-title-bar-style",
        "description": "Enables the set_title_bar_style command without any pre-configured scope.",
        "commands": { "allow": ["set_title_bar_style"], "deny": [] }
      },
      "allow-set-visible-on-all-workspaces": {
        "identifier": "allow-set-visible-on-all-workspaces",
        "description": "Enables the set_visible_on_all_workspaces command without any pre-configured scope.",
        "commands": { "allow": ["set_visible_on_all_workspaces"], "deny": [] }
      },
      "allow-show": {
        "identifier": "allow-show",
        "description": "Enables the show command without any pre-configured scope.",
        "commands": { "allow": ["show"], "deny": [] }
      },
      "allow-start-dragging": {
        "identifier": "allow-start-dragging",
        "description": "Enables the start_dragging command without any pre-configured scope.",
        "commands": { "allow": ["start_dragging"], "deny": [] }
      },
      "allow-start-resize-dragging": {
        "identifier": "allow-start-resize-dragging",
        "description": "Enables the start_resize_dragging command without any pre-configured scope.",
        "commands": { "allow": ["start_resize_dragging"], "deny": [] }
      },
      "allow-theme": {
        "identifier": "allow-theme",
        "description": "Enables the theme command without any pre-configured scope.",
        "commands": { "allow": ["theme"], "deny": [] }
      },
      "allow-title": {
        "identifier": "allow-title",
        "description": "Enables the title command without any pre-configured scope.",
        "commands": { "allow": ["title"], "deny": [] }
      },
      "allow-toggle-maximize": {
        "identifier": "allow-toggle-maximize",
        "description": "Enables the toggle_maximize command without any pre-configured scope.",
        "commands": { "allow": ["toggle_maximize"], "deny": [] }
      },
      "allow-unmaximize": {
        "identifier": "allow-unmaximize",
        "description": "Enables the unmaximize command without any pre-configured scope.",
        "commands": { "allow": ["unmaximize"], "deny": [] }
      },
      "allow-unminimize": {
        "identifier": "allow-unminimize",
        "description": "Enables the unminimize command without any pre-configured scope.",
        "commands": { "allow": ["unminimize"], "deny": [] }
      },
      "deny-available-monitors": {
        "identifier": "deny-available-monitors",
        "description": "Denies the available_monitors command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["available_monitors"] }
      },
      "deny-center": {
        "identifier": "deny-center",
        "description": "Denies the center command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["center"] }
      },
      "deny-close": {
        "identifier": "deny-close",
        "description": "Denies the close command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["close"] }
      },
      "deny-create": {
        "identifier": "deny-create",
        "description": "Denies the create command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["create"] }
      },
      "deny-current-monitor": {
        "identifier": "deny-current-monitor",
        "description": "Denies the current_monitor command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["current_monitor"] }
      },
      "deny-cursor-position": {
        "identifier": "deny-cursor-position",
        "description": "Denies the cursor_position command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["cursor_position"] }
      },
      "deny-destroy": {
        "identifier": "deny-destroy",
        "description": "Denies the destroy command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["destroy"] }
      },
      "deny-get-all-windows": {
        "identifier": "deny-get-all-windows",
        "description": "Denies the get_all_windows command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["get_all_windows"] }
      },
      "deny-hide": {
        "identifier": "deny-hide",
        "description": "Denies the hide command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["hide"] }
      },
      "deny-inner-position": {
        "identifier": "deny-inner-position",
        "description": "Denies the inner_position command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["inner_position"] }
      },
      "deny-inner-size": {
        "identifier": "deny-inner-size",
        "description": "Denies the inner_size command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["inner_size"] }
      },
      "deny-internal-toggle-maximize": {
        "identifier": "deny-internal-toggle-maximize",
        "description": "Denies the internal_toggle_maximize command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["internal_toggle_maximize"] }
      },
      "deny-is-always-on-top": {
        "identifier": "deny-is-always-on-top",
        "description": "Denies the is_always_on_top command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_always_on_top"] }
      },
      "deny-is-closable": {
        "identifier": "deny-is-closable",
        "description": "Denies the is_closable command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_closable"] }
      },
      "deny-is-decorated": {
        "identifier": "deny-is-decorated",
        "description": "Denies the is_decorated command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_decorated"] }
      },
      "deny-is-enabled": {
        "identifier": "deny-is-enabled",
        "description": "Denies the is_enabled command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_enabled"] }
      },
      "deny-is-focused": {
        "identifier": "deny-is-focused",
        "description": "Denies the is_focused command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_focused"] }
      },
      "deny-is-fullscreen": {
        "identifier": "deny-is-fullscreen",
        "description": "Denies the is_fullscreen command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_fullscreen"] }
      },
      "deny-is-maximizable": {
        "identifier": "deny-is-maximizable",
        "description": "Denies the is_maximizable command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_maximizable"] }
      },
      "deny-is-maximized": {
        "identifier": "deny-is-maximized",
        "description": "Denies the is_maximized command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_maximized"] }
      },
      "deny-is-minimizable": {
        "identifier": "deny-is-minimizable",
        "description": "Denies the is_minimizable command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_minimizable"] }
      },
      "deny-is-minimized": {
        "identifier": "deny-is-minimized",
        "description": "Denies the is_minimized command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_minimized"] }
      },
      "deny-is-resizable": {
        "identifier": "deny-is-resizable",
        "description": "Denies the is_resizable command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_resizable"] }
      },
      "deny-is-visible": {
        "identifier": "deny-is-visible",
        "description": "Denies the is_visible command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_visible"] }
      },
      "deny-maximize": {
        "identifier": "deny-maximize",
        "description": "Denies the maximize command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["maximize"] }
      },
      "deny-minimize": {
        "identifier": "deny-minimize",
        "description": "Denies the minimize command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["minimize"] }
      },
      "deny-monitor-from-point": {
        "identifier": "deny-monitor-from-point",
        "description": "Denies the monitor_from_point command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["monitor_from_point"] }
      },
      "deny-outer-position": {
        "identifier": "deny-outer-position",
        "description": "Denies the outer_position command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["outer_position"] }
      },
      "deny-outer-size": {
        "identifier": "deny-outer-size",
        "description": "Denies the outer_size command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["outer_size"] }
      },
      "deny-primary-monitor": {
        "identifier": "deny-primary-monitor",
        "description": "Denies the primary_monitor command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["primary_monitor"] }
      },
      "deny-request-user-attention": {
        "identifier": "deny-request-user-attention",
        "description": "Denies the request_user_attention command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["request_user_attention"] }
      },
      "deny-scale-factor": {
        "identifier": "deny-scale-factor",
        "description": "Denies the scale_factor command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["scale_factor"] }
      },
      "deny-set-always-on-bottom": {
        "identifier": "deny-set-always-on-bottom",
        "description": "Denies the set_always_on_bottom command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_always_on_bottom"] }
      },
      "deny-set-always-on-top": {
        "identifier": "deny-set-always-on-top",
        "description": "Denies the set_always_on_top command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_always_on_top"] }
      },
      "deny-set-background-color": {
        "identifier": "deny-set-background-color",
        "description": "Denies the set_background_color command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_background_color"] }
      },
      "deny-set-badge-count": {
        "identifier": "deny-set-badge-count",
        "description": "Denies the set_badge_count command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_badge_count"] }
      },
      "deny-set-badge-label": {
        "identifier": "deny-set-badge-label",
        "description": "Denies the set_badge_label command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_badge_label"] }
      },
      "deny-set-closable": {
        "identifier": "deny-set-closable",
        "description": "Denies the set_closable command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_closable"] }
      },
      "deny-set-content-protected": {
        "identifier": "deny-set-content-protected",
        "description": "Denies the set_content_protected command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_content_protected"] }
      },
      "deny-set-cursor-grab": {
        "identifier": "deny-set-cursor-grab",
        "description": "Denies the set_cursor_grab command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_cursor_grab"] }
      },
      "deny-set-cursor-icon": {
        "identifier": "deny-set-cursor-icon",
        "description": "Denies the set_cursor_icon command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_cursor_icon"] }
      },
      "deny-set-cursor-position": {
        "identifier": "deny-set-cursor-position",
        "description": "Denies the set_cursor_position command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_cursor_position"] }
      },
      "deny-set-cursor-visible": {
        "identifier": "deny-set-cursor-visible",
        "description": "Denies the set_cursor_visible command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_cursor_visible"] }
      },
      "deny-set-decorations": {
        "identifier": "deny-set-decorations",
        "description": "Denies the set_decorations command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_decorations"] }
      },
      "deny-set-effects": {
        "identifier": "deny-set-effects",
        "description": "Denies the set_effects command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_effects"] }
      },
      "deny-set-enabled": {
        "identifier": "deny-set-enabled",
        "description": "Denies the set_enabled command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_enabled"] }
      },
      "deny-set-focus": {
        "identifier": "deny-set-focus",
        "description": "Denies the set_focus command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_focus"] }
      },
      "deny-set-focusable": {
        "identifier": "deny-set-focusable",
        "description": "Denies the set_focusable command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_focusable"] }
      },
      "deny-set-fullscreen": {
        "identifier": "deny-set-fullscreen",
        "description": "Denies the set_fullscreen command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_fullscreen"] }
      },
      "deny-set-icon": {
        "identifier": "deny-set-icon",
        "description": "Denies the set_icon command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_icon"] }
      },
      "deny-set-ignore-cursor-events": {
        "identifier": "deny-set-ignore-cursor-events",
        "description": "Denies the set_ignore_cursor_events command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_ignore_cursor_events"] }
      },
      "deny-set-max-size": {
        "identifier": "deny-set-max-size",
        "description": "Denies the set_max_size command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_max_size"] }
      },
      "deny-set-maximizable": {
        "identifier": "deny-set-maximizable",
        "description": "Denies the set_maximizable command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_maximizable"] }
      },
      "deny-set-min-size": {
        "identifier": "deny-set-min-size",
        "description": "Denies the set_min_size command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_min_size"] }
      },
      "deny-set-minimizable": {
        "identifier": "deny-set-minimizable",
        "description": "Denies the set_minimizable command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_minimizable"] }
      },
      "deny-set-overlay-icon": {
        "identifier": "deny-set-overlay-icon",
        "description": "Denies the set_overlay_icon command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_overlay_icon"] }
      },
      "deny-set-position": {
        "identifier": "deny-set-position",
        "description": "Denies the set_position command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_position"] }
      },
      "deny-set-progress-bar": {
        "identifier": "deny-set-progress-bar",
        "description": "Denies the set_progress_bar command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_progress_bar"] }
      },
      "deny-set-resizable": {
        "identifier": "deny-set-resizable",
        "description": "Denies the set_resizable command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_resizable"] }
      },
      "deny-set-shadow": {
        "identifier": "deny-set-shadow",
        "description": "Denies the set_shadow command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_shadow"] }
      },
      "deny-set-simple-fullscreen": {
        "identifier": "deny-set-simple-fullscreen",
        "description": "Denies the set_simple_fullscreen command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_simple_fullscreen"] }
      },
      "deny-set-size": {
        "identifier": "deny-set-size",
        "description": "Denies the set_size command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_size"] }
      },
      "deny-set-size-constraints": {
        "identifier": "deny-set-size-constraints",
        "description": "Denies the set_size_constraints command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_size_constraints"] }
      },
      "deny-set-skip-taskbar": {
        "identifier": "deny-set-skip-taskbar",
        "description": "Denies the set_skip_taskbar command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_skip_taskbar"] }
      },
      "deny-set-theme": {
        "identifier": "deny-set-theme",
        "description": "Denies the set_theme command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_theme"] }
      },
      "deny-set-title": {
        "identifier": "deny-set-title",
        "description": "Denies the set_title command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_title"] }
      },
      "deny-set-title-bar-style": {
        "identifier": "deny-set-title-bar-style",
        "description": "Denies the set_title_bar_style command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_title_bar_style"] }
      },
      "deny-set-visible-on-all-workspaces": {
        "identifier": "deny-set-visible-on-all-workspaces",
        "description": "Denies the set_visible_on_all_workspaces command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["set_visible_on_all_workspaces"] }
      },
      "deny-show": {
        "identifier": "deny-show",
        "description": "Denies the show command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["show"] }
      },
      "deny-start-dragging": {
        "identifier": "deny-start-dragging",
        "description": "Denies the start_dragging command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["start_dragging"] }
      },
      "deny-start-resize-dragging": {
        "identifier": "deny-start-resize-dragging",
        "description": "Denies the start_resize_dragging command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["start_resize_dragging"] }
      },
      "deny-theme": {
        "identifier": "deny-theme",
        "description": "Denies the theme command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["theme"] }
      },
      "deny-title": {
        "identifier": "deny-title",
        "description": "Denies the title command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["title"] }
      },
      "deny-toggle-maximize": {
        "identifier": "deny-toggle-maximize",
        "description": "Denies the toggle_maximize command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["toggle_maximize"] }
      },
      "deny-unmaximize": {
        "identifier": "deny-unmaximize",
        "description": "Denies the unmaximize command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["unmaximize"] }
      },
      "deny-unminimize": {
        "identifier": "deny-unminimize",
        "description": "Denies the unminimize command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["unminimize"] }
      }
    },
    "permission_sets": {},
    "global_scope_schema": null
  },
  "notification": {
    "default_permission": {
      "identifier": "default",
      "description": "This permission set configures which\nnotification features are by default exposed.\n\n#### Granted Permissions\n\nIt allows all notification related features.\n\n",
      "permissions": [
        "allow-is-permission-granted",
        "allow-request-permission",
        "allow-notify",
        "allow-register-action-types",
        "allow-register-listener",
        "allow-cancel",
        "allow-get-pending",
        "allow-remove-active",
        "allow-get-active",
        "allow-check-permissions",
        "allow-show",
        "allow-batch",
        "allow-list-channels",
        "allow-delete-channel",
        "allow-create-channel",
        "allow-permission-state"
      ]
    },
    "permissions": {
      "allow-batch": {
        "identifier": "allow-batch",
        "description": "Enables the batch command without any pre-configured scope.",
        "commands": { "allow": ["batch"], "deny": [] }
      },
      "allow-cancel": {
        "identifier": "allow-cancel",
        "description": "Enables the cancel command without any pre-configured scope.",
        "commands": { "allow": ["cancel"], "deny": [] }
      },
      "allow-check-permissions": {
        "identifier": "allow-check-permissions",
        "description": "Enables the check_permissions command without any pre-configured scope.",
        "commands": { "allow": ["check_permissions"], "deny": [] }
      },
      "allow-create-channel": {
        "identifier": "allow-create-channel",
        "description": "Enables the create_channel command without any pre-configured scope.",
        "commands": { "allow": ["create_channel"], "deny": [] }
      },
      "allow-delete-channel": {
        "identifier": "allow-delete-channel",
        "description": "Enables the delete_channel command without any pre-configured scope.",
        "commands": { "allow": ["delete_channel"], "deny": [] }
      },
      "allow-get-active": {
        "identifier": "allow-get-active",
        "description": "Enables the get_active command without any pre-configured scope.",
        "commands": { "allow": ["get_active"], "deny": [] }
      },
      "allow-get-pending": {
        "identifier": "allow-get-pending",
        "description": "Enables the get_pending command without any pre-configured scope.",
        "commands": { "allow": ["get_pending"], "deny": [] }
      },
      "allow-is-permission-granted": {
        "identifier": "allow-is-permission-granted",
        "description": "Enables the is_permission_granted command without any pre-configured scope.",
        "commands": { "allow": ["is_permission_granted"], "deny": [] }
      },
      "allow-list-channels": {
        "identifier": "allow-list-channels",
        "description": "Enables the list_channels command without any pre-configured scope.",
        "commands": { "allow": ["list_channels"], "deny": [] }
      },
      "allow-notify": {
        "identifier": "allow-notify",
        "description": "Enables the notify command without any pre-configured scope.",
        "commands": { "allow": ["notify"], "deny": [] }
      },
      "allow-permission-state": {
        "identifier": "allow-permission-state",
        "description": "Enables the permission_state command without any pre-configured scope.",
        "commands": { "allow": ["permission_state"], "deny": [] }
      },
      "allow-register-action-types": {
        "identifier": "allow-register-action-types",
        "description": "Enables the register_action_types command without any pre-configured scope.",
        "commands": { "allow": ["register_action_types"], "deny": [] }
      },
      "allow-register-listener": {
        "identifier": "allow-register-listener",
        "description": "Enables the register_listener command without any pre-configured scope.",
        "commands": { "allow": ["register_listener"], "deny": [] }
      },
      "allow-remove-active": {
        "identifier": "allow-remove-active",
        "description": "Enables the remove_active command without any pre-configured scope.",
        "commands": { "allow": ["remove_active"], "deny": [] }
      },
      "allow-request-permission": {
        "identifier": "allow-request-permission",
        "description": "Enables the request_permission command without any pre-configured scope.",
        "commands": { "allow": ["request_permission"], "deny": [] }
      },
      "allow-show": {
        "identifier": "allow-show",
        "description": "Enables the show command without any pre-configured scope.",
        "commands": { "allow": ["show"], "deny": [] }
      },
      "deny-batch": {
        "identifier": "deny-batch",
        "description": "Denies the batch command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["batch"] }
      },
      "deny-cancel": {
        "identifier": "deny-cancel",
        "description": "Denies the cancel command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["cancel"] }
      },
      "deny-check-permissions": {
        "identifier": "deny-check-permissions",
        "description": "Denies the check_permissions command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["check_permissions"] }
      },
      "deny-create-channel": {
        "identifier": "deny-create-channel",
        "description": "Denies the create_channel command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["create_channel"] }
      },
      "deny-delete-channel": {
        "identifier": "deny-delete-channel",
        "description": "Denies the delete_channel command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["delete_channel"] }
      },
      "deny-get-active": {
        "identifier": "deny-get-active",
        "description": "Denies the get_active command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["get_active"] }
      },
      "deny-get-pending": {
        "identifier": "deny-get-pending",
        "description": "Denies the get_pending command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["get_pending"] }
      },
      "deny-is-permission-granted": {
        "identifier": "deny-is-permission-granted",
        "description": "Denies the is_permission_granted command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["is_permission_granted"] }
      },
      "deny-list-channels": {
        "identifier": "deny-list-channels",
        "description": "Denies the list_channels command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["list_channels"] }
      },
      "deny-notify": {
        "identifier": "deny-notify",
        "description": "Denies the notify command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["notify"] }
      },
      "deny-permission-state": {
        "identifier": "deny-permission-state",
        "description": "Denies the permission_state command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["permission_state"] }
      },
      "deny-register-action-types": {
        "identifier": "deny-register-action-types",
        "description": "Denies the register_action_types command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["register_action_types"] }
      },
      "deny-register-listener": {
        "identifier": "deny-register-listener",
        "description": "Denies the register_listener command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["register_listener"] }
      },
      "deny-remove-active": {
        "identifier": "deny-remove-active",
        "description": "Denies the remove_active command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["remove_active"] }
      },
      "deny-request-permission": {
        "identifier": "deny-request-permission",
        "description": "Denies the request_permission command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["request_permission"] }
      },
      "deny-show": {
        "identifier": "deny-show",
        "description": "Denies the show command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["show"] }
      }
    },
    "permission_sets": {},
    "global_scope_schema": null
  },
  "shell": {
    "default_permission": {
      "identifier": "default",
      "description": "This permission set configures which\nshell functionality is exposed by default.\n\n#### Granted Permissions\n\nIt allows to use the `open` functionality with a reasonable\nscope pre-configured. It will allow opening `http(s)://`,\n`tel:` and `mailto:` links.\n",
      "permissions": ["allow-open"]
    },
    "permissions": {
      "allow-execute": {
        "identifier": "allow-execute",
        "description": "Enables the execute command without any pre-configured scope.",
        "commands": { "allow": ["execute"], "deny": [] }
      },
      "allow-kill": {
        "identifier": "allow-kill",
        "description": "Enables the kill command without any pre-configured scope.",
        "commands": { "allow": ["kill"], "deny": [] }
      },
      "allow-open": {
        "identifier": "allow-open",
        "description": "Enables the open command without any pre-configured scope.",
        "commands": { "allow": ["open"], "deny": [] }
      },
      "allow-spawn": {
        "identifier": "allow-spawn",
        "description": "Enables the spawn command without any pre-configured scope.",
        "commands": { "allow": ["spawn"], "deny": [] }
      },
      "allow-stdin-write": {
        "identifier": "allow-stdin-write",
        "description": "Enables the stdin_write command without any pre-configured scope.",
        "commands": { "allow": ["stdin_write"], "deny": [] }
      },
      "deny-execute": {
        "identifier": "deny-execute",
        "description": "Denies the execute command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["execute"] }
      },
      "deny-kill": {
        "identifier": "deny-kill",
        "description": "Denies the kill command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["kill"] }
      },
      "deny-open": {
        "identifier": "deny-open",
        "description": "Denies the open command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["open"] }
      },
      "deny-spawn": {
        "identifier": "deny-spawn",
        "description": "Denies the spawn command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["spawn"] }
      },
      "deny-stdin-write": {
        "identifier": "deny-stdin-write",
        "description": "Denies the stdin_write command without any pre-configured scope.",
        "commands": { "allow": [], "deny": ["stdin_write"] }
      }
    },
    "permission_sets": {},
    "global_scope_schema": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "anyOf": [
        {
          "additionalProperties": false,
          "properties": {
            "args": {
              "allOf": [{ "$ref": "#/definitions/ShellScopeEntryAllowedArgs" }],
              "description": "The allowed arguments for the command execution."
            },
            "cmd": {
              "description": "The command name. It can start with a variable that resolves to a system base directory. The variables are: `$AUDIO`, `$CACHE`, `$CONFIG`, `$DATA`, `$LOCALDATA`, `$DESKTOP`, `$DOCUMENT`, `$DOWNLOAD`, `$EXE`, `$FONT`, `$HOME`, `$PICTURE`, `$PUBLIC`, `$RUNTIME`, `$TEMPLATE`, `$VIDEO`, `$RESOURCE`, `$LOG`, `$TEMP`, `$APPCONFIG`, `$APPDATA`, `$APPLOCALDATA`, `$APPCACHE`, `$APPLOG`.",
              "type": "string"
            },
            "name": {
              "description": "The name for this allowed shell command configuration.\n\nThis name will be used inside of the webview API to call this command along with any specified arguments.",
              "type": "string"
            }
          },
          "required": ["cmd", "name"],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "properties": {
            "args": {
              "allOf": [{ "$ref": "#/definitions/ShellScopeEntryAllowedArgs" }],
              "description": "The allowed arguments for the command execution."
            },
            "name": {
              "description": "The name for this allowed shell command configuration.\n\nThis name will be used inside of the webview API to call this command along with any specified arguments.",
              "type": "string"
            },
            "sidecar": {
              "description": "If this command is a sidecar command.",
              "type": "boolean"
            }
          },
          "required": ["name", "sidecar"],
          "type": "object"
        }
      ],
      "definitions": {
        "ShellScopeEntryAllowedArg": {
          "anyOf": [
            {
              "description": "A non-configurable argument that is passed to the command in the order it was specified.",
              "type": "string"
            },
            {
              "additionalProperties": false,
              "description": "A variable that is set while calling the command from the webview API.",
              "properties": {
                "raw": {
                  "default": false,
                  "description": "Marks the validator as a raw regex, meaning the plugin should not make any modification at runtime.\n\nThis means the regex will not match on the entire string by default, which might be exploited if your regex allow unexpected input to be considered valid. When using this option, make sure your regex is correct.",
                  "type": "boolean"
                },
                "validator": {
                  "description": "[regex] validator to require passed values to conform to an expected input.\n\nThis will require the argument value passed to this variable to match the `validator` regex before it will be executed.\n\nThe regex string is by default surrounded by `^...$` to match the full string. For example the `https?://\\w+` regex would be registered as `^https?://\\w+$`.\n\n[regex]: <https://docs.rs/regex/latest/regex/#syntax>",
                  "type": "string"
                }
              },
              "required": ["validator"],
              "type": "object"
            }
          ],
          "description": "A command argument allowed to be executed by the webview API."
        },
        "ShellScopeEntryAllowedArgs": {
          "anyOf": [
            {
              "description": "Use a simple boolean to allow all or disable all arguments to this command configuration.",
              "type": "boolean"
            },
            {
              "description": "A specific set of [`ShellScopeEntryAllowedArg`] that are valid to call for the command configuration.",
              "items": { "$ref": "#/definitions/ShellScopeEntryAllowedArg" },
              "type": "array"
            }
          ],
          "description": "A set of command arguments allowed to be executed by the webview API.\n\nA value of `true` will allow any arguments to be passed to the command. `false` will disable all arguments. A list of [`ShellScopeEntryAllowedArg`] will set those arguments as the only valid arguments to be passed to the attached command configuration."
        }
      },
      "description": "Shell scope entry.",
      "title": "ShellScopeEntry"
    }
  }
}
</file>

<file path="src/frontend/src-tauri/gen/schemas/capabilities.json">
{
  "default": {
    "identifier": "default",
    "description": "Default capabilities for Claudiminder",
    "local": true,
    "windows": ["main"],
    "permissions": [
      "core:default",
      "notification:default",
      "notification:allow-is-permission-granted",
      "notification:allow-request-permission",
      "notification:allow-notify",
      "shell:allow-open"
    ]
  }
}
</file>

<file path="src/frontend/src-tauri/gen/schemas/desktop-schema.json">
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CapabilityFile",
  "description": "Capability formats accepted in a capability file.",
  "anyOf": [
    {
      "description": "A single capability.",
      "allOf": [
        {
          "$ref": "#/definitions/Capability"
        }
      ]
    },
    {
      "description": "A list of capabilities.",
      "type": "array",
      "items": {
        "$ref": "#/definitions/Capability"
      }
    },
    {
      "description": "A list of capabilities.",
      "type": "object",
      "required": ["capabilities"],
      "properties": {
        "capabilities": {
          "description": "The list of capabilities.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Capability"
          }
        }
      }
    }
  ],
  "definitions": {
    "Capability": {
      "description": "A grouping and boundary mechanism developers can use to isolate access to the IPC layer.\n\nIt controls application windows' and webviews' fine grained access to the Tauri core, application, or plugin commands. If a webview or its window is not matching any capability then it has no access to the IPC layer at all.\n\nThis can be done to create groups of windows, based on their required system access, which can reduce impact of frontend vulnerabilities in less privileged windows. Windows can be added to a capability by exact name (e.g. `main-window`) or glob patterns like `*` or `admin-*`. A Window can have none, one, or multiple associated capabilities.\n\n## Example\n\n```json { \"identifier\": \"main-user-files-write\", \"description\": \"This capability allows the `main` window on macOS and Windows access to `filesystem` write related commands and `dialog` commands to enable programmatic access to files selected by the user.\", \"windows\": [ \"main\" ], \"permissions\": [ \"core:default\", \"dialog:open\", { \"identifier\": \"fs:allow-write-text-file\", \"allow\": [{ \"path\": \"$HOME/test.txt\" }] }, ], \"platforms\": [\"macOS\",\"windows\"] } ```",
      "type": "object",
      "required": ["identifier", "permissions"],
      "properties": {
        "identifier": {
          "description": "Identifier of the capability.\n\n## Example\n\n`main-user-files-write`",
          "type": "string"
        },
        "description": {
          "description": "Description of what the capability is intended to allow on associated windows.\n\nIt should contain a description of what the grouped permissions should allow.\n\n## Example\n\nThis capability allows the `main` window access to `filesystem` write related commands and `dialog` commands to enable programmatic access to files selected by the user.",
          "default": "",
          "type": "string"
        },
        "remote": {
          "description": "Configure remote URLs that can use the capability permissions.\n\nThis setting is optional and defaults to not being set, as our default use case is that the content is served from our local application.\n\n:::caution Make sure you understand the security implications of providing remote sources with local system access. :::\n\n## Example\n\n```json { \"urls\": [\"https://*.mydomain.dev\"] } ```",
          "anyOf": [
            {
              "$ref": "#/definitions/CapabilityRemote"
            },
            {
              "type": "null"
            }
          ]
        },
        "local": {
          "description": "Whether this capability is enabled for local app URLs or not. Defaults to `true`.",
          "default": true,
          "type": "boolean"
        },
        "windows": {
          "description": "List of windows that are affected by this capability. Can be a glob pattern.\n\nIf a window label matches any of the patterns in this list, the capability will be enabled on all the webviews of that window, regardless of the value of [`Self::webviews`].\n\nOn multiwebview windows, prefer specifying [`Self::webviews`] and omitting [`Self::windows`] for a fine grained access control.\n\n## Example\n\n`[\"main\"]`",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "webviews": {
          "description": "List of webviews that are affected by this capability. Can be a glob pattern.\n\nThe capability will be enabled on all the webviews whose label matches any of the patterns in this list, regardless of whether the webview's window label matches a pattern in [`Self::windows`].\n\n## Example\n\n`[\"sub-webview-one\", \"sub-webview-two\"]`",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "permissions": {
          "description": "List of permissions attached to this capability.\n\nMust include the plugin name as prefix in the form of `${plugin-name}:${permission-name}`. For commands directly implemented in the application itself only `${permission-name}` is required.\n\n## Example\n\n```json [ \"core:default\", \"shell:allow-open\", \"dialog:open\", { \"identifier\": \"fs:allow-write-text-file\", \"allow\": [{ \"path\": \"$HOME/test.txt\" }] } ] ```",
          "type": "array",
          "items": {
            "$ref": "#/definitions/PermissionEntry"
          },
          "uniqueItems": true
        },
        "platforms": {
          "description": "Limit which target platforms this capability applies to.\n\nBy default all platforms are targeted.\n\n## Example\n\n`[\"macOS\",\"windows\"]`",
          "type": ["array", "null"],
          "items": {
            "$ref": "#/definitions/Target"
          }
        }
      }
    },
    "CapabilityRemote": {
      "description": "Configuration for remote URLs that are associated with the capability.",
      "type": "object",
      "required": ["urls"],
      "properties": {
        "urls": {
          "description": "Remote domains this capability refers to using the [URLPattern standard](https://urlpattern.spec.whatwg.org/).\n\n## Examples\n\n- \"https://*.mydomain.dev\": allows subdomains of mydomain.dev - \"https://mydomain.dev/api/*\": allows any subpath of mydomain.dev/api",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "PermissionEntry": {
      "description": "An entry for a permission value in a [`Capability`] can be either a raw permission [`Identifier`] or an object that references a permission and extends its scope.",
      "anyOf": [
        {
          "description": "Reference a permission or permission set by identifier.",
          "allOf": [
            {
              "$ref": "#/definitions/Identifier"
            }
          ]
        },
        {
          "description": "Reference a permission or permission set by identifier and extends its scope.",
          "type": "object",
          "allOf": [
            {
              "if": {
                "properties": {
                  "identifier": {
                    "anyOf": [
                      {
                        "description": "This permission set configures which\nshell functionality is exposed by default.\n\n#### Granted Permissions\n\nIt allows to use the `open` functionality with a reasonable\nscope pre-configured. It will allow opening `http(s)://`,\n`tel:` and `mailto:` links.\n\n#### This default permission set includes:\n\n- `allow-open`",
                        "type": "string",
                        "const": "shell:default",
                        "markdownDescription": "This permission set configures which\nshell functionality is exposed by default.\n\n#### Granted Permissions\n\nIt allows to use the `open` functionality with a reasonable\nscope pre-configured. It will allow opening `http(s)://`,\n`tel:` and `mailto:` links.\n\n#### This default permission set includes:\n\n- `allow-open`"
                      },
                      {
                        "description": "Enables the execute command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:allow-execute",
                        "markdownDescription": "Enables the execute command without any pre-configured scope."
                      },
                      {
                        "description": "Enables the kill command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:allow-kill",
                        "markdownDescription": "Enables the kill command without any pre-configured scope."
                      },
                      {
                        "description": "Enables the open command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:allow-open",
                        "markdownDescription": "Enables the open command without any pre-configured scope."
                      },
                      {
                        "description": "Enables the spawn command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:allow-spawn",
                        "markdownDescription": "Enables the spawn command without any pre-configured scope."
                      },
                      {
                        "description": "Enables the stdin_write command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:allow-stdin-write",
                        "markdownDescription": "Enables the stdin_write command without any pre-configured scope."
                      },
                      {
                        "description": "Denies the execute command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:deny-execute",
                        "markdownDescription": "Denies the execute command without any pre-configured scope."
                      },
                      {
                        "description": "Denies the kill command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:deny-kill",
                        "markdownDescription": "Denies the kill command without any pre-configured scope."
                      },
                      {
                        "description": "Denies the open command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:deny-open",
                        "markdownDescription": "Denies the open command without any pre-configured scope."
                      },
                      {
                        "description": "Denies the spawn command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:deny-spawn",
                        "markdownDescription": "Denies the spawn command without any pre-configured scope."
                      },
                      {
                        "description": "Denies the stdin_write command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:deny-stdin-write",
                        "markdownDescription": "Denies the stdin_write command without any pre-configured scope."
                      }
                    ]
                  }
                }
              },
              "then": {
                "properties": {
                  "allow": {
                    "items": {
                      "title": "ShellScopeEntry",
                      "description": "Shell scope entry.",
                      "anyOf": [
                        {
                          "type": "object",
                          "required": ["cmd", "name"],
                          "properties": {
                            "args": {
                              "description": "The allowed arguments for the command execution.",
                              "allOf": [
                                {
                                  "$ref": "#/definitions/ShellScopeEntryAllowedArgs"
                                }
                              ]
                            },
                            "cmd": {
                              "description": "The command name. It can start with a variable that resolves to a system base directory. The variables are: `$AUDIO`, `$CACHE`, `$CONFIG`, `$DATA`, `$LOCALDATA`, `$DESKTOP`, `$DOCUMENT`, `$DOWNLOAD`, `$EXE`, `$FONT`, `$HOME`, `$PICTURE`, `$PUBLIC`, `$RUNTIME`, `$TEMPLATE`, `$VIDEO`, `$RESOURCE`, `$LOG`, `$TEMP`, `$APPCONFIG`, `$APPDATA`, `$APPLOCALDATA`, `$APPCACHE`, `$APPLOG`.",
                              "type": "string"
                            },
                            "name": {
                              "description": "The name for this allowed shell command configuration.\n\nThis name will be used inside of the webview API to call this command along with any specified arguments.",
                              "type": "string"
                            }
                          },
                          "additionalProperties": false
                        },
                        {
                          "type": "object",
                          "required": ["name", "sidecar"],
                          "properties": {
                            "args": {
                              "description": "The allowed arguments for the command execution.",
                              "allOf": [
                                {
                                  "$ref": "#/definitions/ShellScopeEntryAllowedArgs"
                                }
                              ]
                            },
                            "name": {
                              "description": "The name for this allowed shell command configuration.\n\nThis name will be used inside of the webview API to call this command along with any specified arguments.",
                              "type": "string"
                            },
                            "sidecar": {
                              "description": "If this command is a sidecar command.",
                              "type": "boolean"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    }
                  },
                  "deny": {
                    "items": {
                      "title": "ShellScopeEntry",
                      "description": "Shell scope entry.",
                      "anyOf": [
                        {
                          "type": "object",
                          "required": ["cmd", "name"],
                          "properties": {
                            "args": {
                              "description": "The allowed arguments for the command execution.",
                              "allOf": [
                                {
                                  "$ref": "#/definitions/ShellScopeEntryAllowedArgs"
                                }
                              ]
                            },
                            "cmd": {
                              "description": "The command name. It can start with a variable that resolves to a system base directory. The variables are: `$AUDIO`, `$CACHE`, `$CONFIG`, `$DATA`, `$LOCALDATA`, `$DESKTOP`, `$DOCUMENT`, `$DOWNLOAD`, `$EXE`, `$FONT`, `$HOME`, `$PICTURE`, `$PUBLIC`, `$RUNTIME`, `$TEMPLATE`, `$VIDEO`, `$RESOURCE`, `$LOG`, `$TEMP`, `$APPCONFIG`, `$APPDATA`, `$APPLOCALDATA`, `$APPCACHE`, `$APPLOG`.",
                              "type": "string"
                            },
                            "name": {
                              "description": "The name for this allowed shell command configuration.\n\nThis name will be used inside of the webview API to call this command along with any specified arguments.",
                              "type": "string"
                            }
                          },
                          "additionalProperties": false
                        },
                        {
                          "type": "object",
                          "required": ["name", "sidecar"],
                          "properties": {
                            "args": {
                              "description": "The allowed arguments for the command execution.",
                              "allOf": [
                                {
                                  "$ref": "#/definitions/ShellScopeEntryAllowedArgs"
                                }
                              ]
                            },
                            "name": {
                              "description": "The name for this allowed shell command configuration.\n\nThis name will be used inside of the webview API to call this command along with any specified arguments.",
                              "type": "string"
                            },
                            "sidecar": {
                              "description": "If this command is a sidecar command.",
                              "type": "boolean"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    }
                  }
                }
              },
              "properties": {
                "identifier": {
                  "description": "Identifier of the permission or permission set.",
                  "allOf": [
                    {
                      "$ref": "#/definitions/Identifier"
                    }
                  ]
                }
              }
            },
            {
              "properties": {
                "identifier": {
                  "description": "Identifier of the permission or permission set.",
                  "allOf": [
                    {
                      "$ref": "#/definitions/Identifier"
                    }
                  ]
                },
                "allow": {
                  "description": "Data that defines what is allowed by the scope.",
                  "type": ["array", "null"],
                  "items": {
                    "$ref": "#/definitions/Value"
                  }
                },
                "deny": {
                  "description": "Data that defines what is denied by the scope. This should be prioritized by validation logic.",
                  "type": ["array", "null"],
                  "items": {
                    "$ref": "#/definitions/Value"
                  }
                }
              }
            }
          ],
          "required": ["identifier"]
        }
      ]
    },
    "Identifier": {
      "description": "Permission identifier",
      "oneOf": [
        {
          "description": "Default core plugins set.\n#### This default permission set includes:\n\n- `core:path:default`\n- `core:event:default`\n- `core:window:default`\n- `core:webview:default`\n- `core:app:default`\n- `core:image:default`\n- `core:resources:default`\n- `core:menu:default`\n- `core:tray:default`",
          "type": "string",
          "const": "core:default",
          "markdownDescription": "Default core plugins set.\n#### This default permission set includes:\n\n- `core:path:default`\n- `core:event:default`\n- `core:window:default`\n- `core:webview:default`\n- `core:app:default`\n- `core:image:default`\n- `core:resources:default`\n- `core:menu:default`\n- `core:tray:default`"
        },
        {
          "description": "Default permissions for the plugin.\n#### This default permission set includes:\n\n- `allow-version`\n- `allow-name`\n- `allow-tauri-version`\n- `allow-identifier`\n- `allow-bundle-type`\n- `allow-register-listener`\n- `allow-remove-listener`",
          "type": "string",
          "const": "core:app:default",
          "markdownDescription": "Default permissions for the plugin.\n#### This default permission set includes:\n\n- `allow-version`\n- `allow-name`\n- `allow-tauri-version`\n- `allow-identifier`\n- `allow-bundle-type`\n- `allow-register-listener`\n- `allow-remove-listener`"
        },
        {
          "description": "Enables the app_hide command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-app-hide",
          "markdownDescription": "Enables the app_hide command without any pre-configured scope."
        },
        {
          "description": "Enables the app_show command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-app-show",
          "markdownDescription": "Enables the app_show command without any pre-configured scope."
        },
        {
          "description": "Enables the bundle_type command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-bundle-type",
          "markdownDescription": "Enables the bundle_type command without any pre-configured scope."
        },
        {
          "description": "Enables the default_window_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-default-window-icon",
          "markdownDescription": "Enables the default_window_icon command without any pre-configured scope."
        },
        {
          "description": "Enables the fetch_data_store_identifiers command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-fetch-data-store-identifiers",
          "markdownDescription": "Enables the fetch_data_store_identifiers command without any pre-configured scope."
        },
        {
          "description": "Enables the identifier command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-identifier",
          "markdownDescription": "Enables the identifier command without any pre-configured scope."
        },
        {
          "description": "Enables the name command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-name",
          "markdownDescription": "Enables the name command without any pre-configured scope."
        },
        {
          "description": "Enables the register_listener command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-register-listener",
          "markdownDescription": "Enables the register_listener command without any pre-configured scope."
        },
        {
          "description": "Enables the remove_data_store command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-remove-data-store",
          "markdownDescription": "Enables the remove_data_store command without any pre-configured scope."
        },
        {
          "description": "Enables the remove_listener command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-remove-listener",
          "markdownDescription": "Enables the remove_listener command without any pre-configured scope."
        },
        {
          "description": "Enables the set_app_theme command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-set-app-theme",
          "markdownDescription": "Enables the set_app_theme command without any pre-configured scope."
        },
        {
          "description": "Enables the set_dock_visibility command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-set-dock-visibility",
          "markdownDescription": "Enables the set_dock_visibility command without any pre-configured scope."
        },
        {
          "description": "Enables the tauri_version command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-tauri-version",
          "markdownDescription": "Enables the tauri_version command without any pre-configured scope."
        },
        {
          "description": "Enables the version command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-version",
          "markdownDescription": "Enables the version command without any pre-configured scope."
        },
        {
          "description": "Denies the app_hide command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-app-hide",
          "markdownDescription": "Denies the app_hide command without any pre-configured scope."
        },
        {
          "description": "Denies the app_show command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-app-show",
          "markdownDescription": "Denies the app_show command without any pre-configured scope."
        },
        {
          "description": "Denies the bundle_type command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-bundle-type",
          "markdownDescription": "Denies the bundle_type command without any pre-configured scope."
        },
        {
          "description": "Denies the default_window_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-default-window-icon",
          "markdownDescription": "Denies the default_window_icon command without any pre-configured scope."
        },
        {
          "description": "Denies the fetch_data_store_identifiers command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-fetch-data-store-identifiers",
          "markdownDescription": "Denies the fetch_data_store_identifiers command without any pre-configured scope."
        },
        {
          "description": "Denies the identifier command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-identifier",
          "markdownDescription": "Denies the identifier command without any pre-configured scope."
        },
        {
          "description": "Denies the name command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-name",
          "markdownDescription": "Denies the name command without any pre-configured scope."
        },
        {
          "description": "Denies the register_listener command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-register-listener",
          "markdownDescription": "Denies the register_listener command without any pre-configured scope."
        },
        {
          "description": "Denies the remove_data_store command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-remove-data-store",
          "markdownDescription": "Denies the remove_data_store command without any pre-configured scope."
        },
        {
          "description": "Denies the remove_listener command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-remove-listener",
          "markdownDescription": "Denies the remove_listener command without any pre-configured scope."
        },
        {
          "description": "Denies the set_app_theme command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-set-app-theme",
          "markdownDescription": "Denies the set_app_theme command without any pre-configured scope."
        },
        {
          "description": "Denies the set_dock_visibility command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-set-dock-visibility",
          "markdownDescription": "Denies the set_dock_visibility command without any pre-configured scope."
        },
        {
          "description": "Denies the tauri_version command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-tauri-version",
          "markdownDescription": "Denies the tauri_version command without any pre-configured scope."
        },
        {
          "description": "Denies the version command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-version",
          "markdownDescription": "Denies the version command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-listen`\n- `allow-unlisten`\n- `allow-emit`\n- `allow-emit-to`",
          "type": "string",
          "const": "core:event:default",
          "markdownDescription": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-listen`\n- `allow-unlisten`\n- `allow-emit`\n- `allow-emit-to`"
        },
        {
          "description": "Enables the emit command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:allow-emit",
          "markdownDescription": "Enables the emit command without any pre-configured scope."
        },
        {
          "description": "Enables the emit_to command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:allow-emit-to",
          "markdownDescription": "Enables the emit_to command without any pre-configured scope."
        },
        {
          "description": "Enables the listen command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:allow-listen",
          "markdownDescription": "Enables the listen command without any pre-configured scope."
        },
        {
          "description": "Enables the unlisten command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:allow-unlisten",
          "markdownDescription": "Enables the unlisten command without any pre-configured scope."
        },
        {
          "description": "Denies the emit command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:deny-emit",
          "markdownDescription": "Denies the emit command without any pre-configured scope."
        },
        {
          "description": "Denies the emit_to command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:deny-emit-to",
          "markdownDescription": "Denies the emit_to command without any pre-configured scope."
        },
        {
          "description": "Denies the listen command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:deny-listen",
          "markdownDescription": "Denies the listen command without any pre-configured scope."
        },
        {
          "description": "Denies the unlisten command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:deny-unlisten",
          "markdownDescription": "Denies the unlisten command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-new`\n- `allow-from-bytes`\n- `allow-from-path`\n- `allow-rgba`\n- `allow-size`",
          "type": "string",
          "const": "core:image:default",
          "markdownDescription": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-new`\n- `allow-from-bytes`\n- `allow-from-path`\n- `allow-rgba`\n- `allow-size`"
        },
        {
          "description": "Enables the from_bytes command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:allow-from-bytes",
          "markdownDescription": "Enables the from_bytes command without any pre-configured scope."
        },
        {
          "description": "Enables the from_path command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:allow-from-path",
          "markdownDescription": "Enables the from_path command without any pre-configured scope."
        },
        {
          "description": "Enables the new command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:allow-new",
          "markdownDescription": "Enables the new command without any pre-configured scope."
        },
        {
          "description": "Enables the rgba command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:allow-rgba",
          "markdownDescription": "Enables the rgba command without any pre-configured scope."
        },
        {
          "description": "Enables the size command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:allow-size",
          "markdownDescription": "Enables the size command without any pre-configured scope."
        },
        {
          "description": "Denies the from_bytes command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:deny-from-bytes",
          "markdownDescription": "Denies the from_bytes command without any pre-configured scope."
        },
        {
          "description": "Denies the from_path command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:deny-from-path",
          "markdownDescription": "Denies the from_path command without any pre-configured scope."
        },
        {
          "description": "Denies the new command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:deny-new",
          "markdownDescription": "Denies the new command without any pre-configured scope."
        },
        {
          "description": "Denies the rgba command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:deny-rgba",
          "markdownDescription": "Denies the rgba command without any pre-configured scope."
        },
        {
          "description": "Denies the size command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:deny-size",
          "markdownDescription": "Denies the size command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-new`\n- `allow-append`\n- `allow-prepend`\n- `allow-insert`\n- `allow-remove`\n- `allow-remove-at`\n- `allow-items`\n- `allow-get`\n- `allow-popup`\n- `allow-create-default`\n- `allow-set-as-app-menu`\n- `allow-set-as-window-menu`\n- `allow-text`\n- `allow-set-text`\n- `allow-is-enabled`\n- `allow-set-enabled`\n- `allow-set-accelerator`\n- `allow-set-as-windows-menu-for-nsapp`\n- `allow-set-as-help-menu-for-nsapp`\n- `allow-is-checked`\n- `allow-set-checked`\n- `allow-set-icon`",
          "type": "string",
          "const": "core:menu:default",
          "markdownDescription": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-new`\n- `allow-append`\n- `allow-prepend`\n- `allow-insert`\n- `allow-remove`\n- `allow-remove-at`\n- `allow-items`\n- `allow-get`\n- `allow-popup`\n- `allow-create-default`\n- `allow-set-as-app-menu`\n- `allow-set-as-window-menu`\n- `allow-text`\n- `allow-set-text`\n- `allow-is-enabled`\n- `allow-set-enabled`\n- `allow-set-accelerator`\n- `allow-set-as-windows-menu-for-nsapp`\n- `allow-set-as-help-menu-for-nsapp`\n- `allow-is-checked`\n- `allow-set-checked`\n- `allow-set-icon`"
        },
        {
          "description": "Enables the append command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-append",
          "markdownDescription": "Enables the append command without any pre-configured scope."
        },
        {
          "description": "Enables the create_default command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-create-default",
          "markdownDescription": "Enables the create_default command without any pre-configured scope."
        },
        {
          "description": "Enables the get command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-get",
          "markdownDescription": "Enables the get command without any pre-configured scope."
        },
        {
          "description": "Enables the insert command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-insert",
          "markdownDescription": "Enables the insert command without any pre-configured scope."
        },
        {
          "description": "Enables the is_checked command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-is-checked",
          "markdownDescription": "Enables the is_checked command without any pre-configured scope."
        },
        {
          "description": "Enables the is_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-is-enabled",
          "markdownDescription": "Enables the is_enabled command without any pre-configured scope."
        },
        {
          "description": "Enables the items command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-items",
          "markdownDescription": "Enables the items command without any pre-configured scope."
        },
        {
          "description": "Enables the new command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-new",
          "markdownDescription": "Enables the new command without any pre-configured scope."
        },
        {
          "description": "Enables the popup command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-popup",
          "markdownDescription": "Enables the popup command without any pre-configured scope."
        },
        {
          "description": "Enables the prepend command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-prepend",
          "markdownDescription": "Enables the prepend command without any pre-configured scope."
        },
        {
          "description": "Enables the remove command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-remove",
          "markdownDescription": "Enables the remove command without any pre-configured scope."
        },
        {
          "description": "Enables the remove_at command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-remove-at",
          "markdownDescription": "Enables the remove_at command without any pre-configured scope."
        },
        {
          "description": "Enables the set_accelerator command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-accelerator",
          "markdownDescription": "Enables the set_accelerator command without any pre-configured scope."
        },
        {
          "description": "Enables the set_as_app_menu command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-as-app-menu",
          "markdownDescription": "Enables the set_as_app_menu command without any pre-configured scope."
        },
        {
          "description": "Enables the set_as_help_menu_for_nsapp command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-as-help-menu-for-nsapp",
          "markdownDescription": "Enables the set_as_help_menu_for_nsapp command without any pre-configured scope."
        },
        {
          "description": "Enables the set_as_window_menu command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-as-window-menu",
          "markdownDescription": "Enables the set_as_window_menu command without any pre-configured scope."
        },
        {
          "description": "Enables the set_as_windows_menu_for_nsapp command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-as-windows-menu-for-nsapp",
          "markdownDescription": "Enables the set_as_windows_menu_for_nsapp command without any pre-configured scope."
        },
        {
          "description": "Enables the set_checked command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-checked",
          "markdownDescription": "Enables the set_checked command without any pre-configured scope."
        },
        {
          "description": "Enables the set_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-enabled",
          "markdownDescription": "Enables the set_enabled command without any pre-configured scope."
        },
        {
          "description": "Enables the set_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-icon",
          "markdownDescription": "Enables the set_icon command without any pre-configured scope."
        },
        {
          "description": "Enables the set_text command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-text",
          "markdownDescription": "Enables the set_text command without any pre-configured scope."
        },
        {
          "description": "Enables the text command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-text",
          "markdownDescription": "Enables the text command without any pre-configured scope."
        },
        {
          "description": "Denies the append command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-append",
          "markdownDescription": "Denies the append command without any pre-configured scope."
        },
        {
          "description": "Denies the create_default command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-create-default",
          "markdownDescription": "Denies the create_default command without any pre-configured scope."
        },
        {
          "description": "Denies the get command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-get",
          "markdownDescription": "Denies the get command without any pre-configured scope."
        },
        {
          "description": "Denies the insert command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-insert",
          "markdownDescription": "Denies the insert command without any pre-configured scope."
        },
        {
          "description": "Denies the is_checked command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-is-checked",
          "markdownDescription": "Denies the is_checked command without any pre-configured scope."
        },
        {
          "description": "Denies the is_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-is-enabled",
          "markdownDescription": "Denies the is_enabled command without any pre-configured scope."
        },
        {
          "description": "Denies the items command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-items",
          "markdownDescription": "Denies the items command without any pre-configured scope."
        },
        {
          "description": "Denies the new command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-new",
          "markdownDescription": "Denies the new command without any pre-configured scope."
        },
        {
          "description": "Denies the popup command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-popup",
          "markdownDescription": "Denies the popup command without any pre-configured scope."
        },
        {
          "description": "Denies the prepend command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-prepend",
          "markdownDescription": "Denies the prepend command without any pre-configured scope."
        },
        {
          "description": "Denies the remove command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-remove",
          "markdownDescription": "Denies the remove command without any pre-configured scope."
        },
        {
          "description": "Denies the remove_at command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-remove-at",
          "markdownDescription": "Denies the remove_at command without any pre-configured scope."
        },
        {
          "description": "Denies the set_accelerator command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-accelerator",
          "markdownDescription": "Denies the set_accelerator command without any pre-configured scope."
        },
        {
          "description": "Denies the set_as_app_menu command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-as-app-menu",
          "markdownDescription": "Denies the set_as_app_menu command without any pre-configured scope."
        },
        {
          "description": "Denies the set_as_help_menu_for_nsapp command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-as-help-menu-for-nsapp",
          "markdownDescription": "Denies the set_as_help_menu_for_nsapp command without any pre-configured scope."
        },
        {
          "description": "Denies the set_as_window_menu command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-as-window-menu",
          "markdownDescription": "Denies the set_as_window_menu command without any pre-configured scope."
        },
        {
          "description": "Denies the set_as_windows_menu_for_nsapp command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-as-windows-menu-for-nsapp",
          "markdownDescription": "Denies the set_as_windows_menu_for_nsapp command without any pre-configured scope."
        },
        {
          "description": "Denies the set_checked command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-checked",
          "markdownDescription": "Denies the set_checked command without any pre-configured scope."
        },
        {
          "description": "Denies the set_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-enabled",
          "markdownDescription": "Denies the set_enabled command without any pre-configured scope."
        },
        {
          "description": "Denies the set_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-icon",
          "markdownDescription": "Denies the set_icon command without any pre-configured scope."
        },
        {
          "description": "Denies the set_text command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-text",
          "markdownDescription": "Denies the set_text command without any pre-configured scope."
        },
        {
          "description": "Denies the text command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-text",
          "markdownDescription": "Denies the text command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-resolve-directory`\n- `allow-resolve`\n- `allow-normalize`\n- `allow-join`\n- `allow-dirname`\n- `allow-extname`\n- `allow-basename`\n- `allow-is-absolute`",
          "type": "string",
          "const": "core:path:default",
          "markdownDescription": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-resolve-directory`\n- `allow-resolve`\n- `allow-normalize`\n- `allow-join`\n- `allow-dirname`\n- `allow-extname`\n- `allow-basename`\n- `allow-is-absolute`"
        },
        {
          "description": "Enables the basename command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-basename",
          "markdownDescription": "Enables the basename command without any pre-configured scope."
        },
        {
          "description": "Enables the dirname command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-dirname",
          "markdownDescription": "Enables the dirname command without any pre-configured scope."
        },
        {
          "description": "Enables the extname command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-extname",
          "markdownDescription": "Enables the extname command without any pre-configured scope."
        },
        {
          "description": "Enables the is_absolute command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-is-absolute",
          "markdownDescription": "Enables the is_absolute command without any pre-configured scope."
        },
        {
          "description": "Enables the join command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-join",
          "markdownDescription": "Enables the join command without any pre-configured scope."
        },
        {
          "description": "Enables the normalize command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-normalize",
          "markdownDescription": "Enables the normalize command without any pre-configured scope."
        },
        {
          "description": "Enables the resolve command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-resolve",
          "markdownDescription": "Enables the resolve command without any pre-configured scope."
        },
        {
          "description": "Enables the resolve_directory command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-resolve-directory",
          "markdownDescription": "Enables the resolve_directory command without any pre-configured scope."
        },
        {
          "description": "Denies the basename command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-basename",
          "markdownDescription": "Denies the basename command without any pre-configured scope."
        },
        {
          "description": "Denies the dirname command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-dirname",
          "markdownDescription": "Denies the dirname command without any pre-configured scope."
        },
        {
          "description": "Denies the extname command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-extname",
          "markdownDescription": "Denies the extname command without any pre-configured scope."
        },
        {
          "description": "Denies the is_absolute command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-is-absolute",
          "markdownDescription": "Denies the is_absolute command without any pre-configured scope."
        },
        {
          "description": "Denies the join command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-join",
          "markdownDescription": "Denies the join command without any pre-configured scope."
        },
        {
          "description": "Denies the normalize command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-normalize",
          "markdownDescription": "Denies the normalize command without any pre-configured scope."
        },
        {
          "description": "Denies the resolve command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-resolve",
          "markdownDescription": "Denies the resolve command without any pre-configured scope."
        },
        {
          "description": "Denies the resolve_directory command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-resolve-directory",
          "markdownDescription": "Denies the resolve_directory command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-close`",
          "type": "string",
          "const": "core:resources:default",
          "markdownDescription": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-close`"
        },
        {
          "description": "Enables the close command without any pre-configured scope.",
          "type": "string",
          "const": "core:resources:allow-close",
          "markdownDescription": "Enables the close command without any pre-configured scope."
        },
        {
          "description": "Denies the close command without any pre-configured scope.",
          "type": "string",
          "const": "core:resources:deny-close",
          "markdownDescription": "Denies the close command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-new`\n- `allow-get-by-id`\n- `allow-remove-by-id`\n- `allow-set-icon`\n- `allow-set-menu`\n- `allow-set-tooltip`\n- `allow-set-title`\n- `allow-set-visible`\n- `allow-set-temp-dir-path`\n- `allow-set-icon-as-template`\n- `allow-set-show-menu-on-left-click`",
          "type": "string",
          "const": "core:tray:default",
          "markdownDescription": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-new`\n- `allow-get-by-id`\n- `allow-remove-by-id`\n- `allow-set-icon`\n- `allow-set-menu`\n- `allow-set-tooltip`\n- `allow-set-title`\n- `allow-set-visible`\n- `allow-set-temp-dir-path`\n- `allow-set-icon-as-template`\n- `allow-set-show-menu-on-left-click`"
        },
        {
          "description": "Enables the get_by_id command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-get-by-id",
          "markdownDescription": "Enables the get_by_id command without any pre-configured scope."
        },
        {
          "description": "Enables the new command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-new",
          "markdownDescription": "Enables the new command without any pre-configured scope."
        },
        {
          "description": "Enables the remove_by_id command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-remove-by-id",
          "markdownDescription": "Enables the remove_by_id command without any pre-configured scope."
        },
        {
          "description": "Enables the set_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-icon",
          "markdownDescription": "Enables the set_icon command without any pre-configured scope."
        },
        {
          "description": "Enables the set_icon_as_template command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-icon-as-template",
          "markdownDescription": "Enables the set_icon_as_template command without any pre-configured scope."
        },
        {
          "description": "Enables the set_menu command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-menu",
          "markdownDescription": "Enables the set_menu command without any pre-configured scope."
        },
        {
          "description": "Enables the set_show_menu_on_left_click command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-show-menu-on-left-click",
          "markdownDescription": "Enables the set_show_menu_on_left_click command without any pre-configured scope."
        },
        {
          "description": "Enables the set_temp_dir_path command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-temp-dir-path",
          "markdownDescription": "Enables the set_temp_dir_path command without any pre-configured scope."
        },
        {
          "description": "Enables the set_title command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-title",
          "markdownDescription": "Enables the set_title command without any pre-configured scope."
        },
        {
          "description": "Enables the set_tooltip command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-tooltip",
          "markdownDescription": "Enables the set_tooltip command without any pre-configured scope."
        },
        {
          "description": "Enables the set_visible command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-visible",
          "markdownDescription": "Enables the set_visible command without any pre-configured scope."
        },
        {
          "description": "Denies the get_by_id command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-get-by-id",
          "markdownDescription": "Denies the get_by_id command without any pre-configured scope."
        },
        {
          "description": "Denies the new command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-new",
          "markdownDescription": "Denies the new command without any pre-configured scope."
        },
        {
          "description": "Denies the remove_by_id command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-remove-by-id",
          "markdownDescription": "Denies the remove_by_id command without any pre-configured scope."
        },
        {
          "description": "Denies the set_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-icon",
          "markdownDescription": "Denies the set_icon command without any pre-configured scope."
        },
        {
          "description": "Denies the set_icon_as_template command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-icon-as-template",
          "markdownDescription": "Denies the set_icon_as_template command without any pre-configured scope."
        },
        {
          "description": "Denies the set_menu command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-menu",
          "markdownDescription": "Denies the set_menu command without any pre-configured scope."
        },
        {
          "description": "Denies the set_show_menu_on_left_click command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-show-menu-on-left-click",
          "markdownDescription": "Denies the set_show_menu_on_left_click command without any pre-configured scope."
        },
        {
          "description": "Denies the set_temp_dir_path command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-temp-dir-path",
          "markdownDescription": "Denies the set_temp_dir_path command without any pre-configured scope."
        },
        {
          "description": "Denies the set_title command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-title",
          "markdownDescription": "Denies the set_title command without any pre-configured scope."
        },
        {
          "description": "Denies the set_tooltip command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-tooltip",
          "markdownDescription": "Denies the set_tooltip command without any pre-configured scope."
        },
        {
          "description": "Denies the set_visible command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-visible",
          "markdownDescription": "Denies the set_visible command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin.\n#### This default permission set includes:\n\n- `allow-get-all-webviews`\n- `allow-webview-position`\n- `allow-webview-size`\n- `allow-internal-toggle-devtools`",
          "type": "string",
          "const": "core:webview:default",
          "markdownDescription": "Default permissions for the plugin.\n#### This default permission set includes:\n\n- `allow-get-all-webviews`\n- `allow-webview-position`\n- `allow-webview-size`\n- `allow-internal-toggle-devtools`"
        },
        {
          "description": "Enables the clear_all_browsing_data command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-clear-all-browsing-data",
          "markdownDescription": "Enables the clear_all_browsing_data command without any pre-configured scope."
        },
        {
          "description": "Enables the create_webview command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-create-webview",
          "markdownDescription": "Enables the create_webview command without any pre-configured scope."
        },
        {
          "description": "Enables the create_webview_window command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-create-webview-window",
          "markdownDescription": "Enables the create_webview_window command without any pre-configured scope."
        },
        {
          "description": "Enables the get_all_webviews command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-get-all-webviews",
          "markdownDescription": "Enables the get_all_webviews command without any pre-configured scope."
        },
        {
          "description": "Enables the internal_toggle_devtools command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-internal-toggle-devtools",
          "markdownDescription": "Enables the internal_toggle_devtools command without any pre-configured scope."
        },
        {
          "description": "Enables the print command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-print",
          "markdownDescription": "Enables the print command without any pre-configured scope."
        },
        {
          "description": "Enables the reparent command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-reparent",
          "markdownDescription": "Enables the reparent command without any pre-configured scope."
        },
        {
          "description": "Enables the set_webview_auto_resize command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-set-webview-auto-resize",
          "markdownDescription": "Enables the set_webview_auto_resize command without any pre-configured scope."
        },
        {
          "description": "Enables the set_webview_background_color command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-set-webview-background-color",
          "markdownDescription": "Enables the set_webview_background_color command without any pre-configured scope."
        },
        {
          "description": "Enables the set_webview_focus command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-set-webview-focus",
          "markdownDescription": "Enables the set_webview_focus command without any pre-configured scope."
        },
        {
          "description": "Enables the set_webview_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-set-webview-position",
          "markdownDescription": "Enables the set_webview_position command without any pre-configured scope."
        },
        {
          "description": "Enables the set_webview_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-set-webview-size",
          "markdownDescription": "Enables the set_webview_size command without any pre-configured scope."
        },
        {
          "description": "Enables the set_webview_zoom command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-set-webview-zoom",
          "markdownDescription": "Enables the set_webview_zoom command without any pre-configured scope."
        },
        {
          "description": "Enables the webview_close command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-webview-close",
          "markdownDescription": "Enables the webview_close command without any pre-configured scope."
        },
        {
          "description": "Enables the webview_hide command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-webview-hide",
          "markdownDescription": "Enables the webview_hide command without any pre-configured scope."
        },
        {
          "description": "Enables the webview_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-webview-position",
          "markdownDescription": "Enables the webview_position command without any pre-configured scope."
        },
        {
          "description": "Enables the webview_show command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-webview-show",
          "markdownDescription": "Enables the webview_show command without any pre-configured scope."
        },
        {
          "description": "Enables the webview_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-webview-size",
          "markdownDescription": "Enables the webview_size command without any pre-configured scope."
        },
        {
          "description": "Denies the clear_all_browsing_data command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-clear-all-browsing-data",
          "markdownDescription": "Denies the clear_all_browsing_data command without any pre-configured scope."
        },
        {
          "description": "Denies the create_webview command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-create-webview",
          "markdownDescription": "Denies the create_webview command without any pre-configured scope."
        },
        {
          "description": "Denies the create_webview_window command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-create-webview-window",
          "markdownDescription": "Denies the create_webview_window command without any pre-configured scope."
        },
        {
          "description": "Denies the get_all_webviews command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-get-all-webviews",
          "markdownDescription": "Denies the get_all_webviews command without any pre-configured scope."
        },
        {
          "description": "Denies the internal_toggle_devtools command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-internal-toggle-devtools",
          "markdownDescription": "Denies the internal_toggle_devtools command without any pre-configured scope."
        },
        {
          "description": "Denies the print command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-print",
          "markdownDescription": "Denies the print command without any pre-configured scope."
        },
        {
          "description": "Denies the reparent command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-reparent",
          "markdownDescription": "Denies the reparent command without any pre-configured scope."
        },
        {
          "description": "Denies the set_webview_auto_resize command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-set-webview-auto-resize",
          "markdownDescription": "Denies the set_webview_auto_resize command without any pre-configured scope."
        },
        {
          "description": "Denies the set_webview_background_color command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-set-webview-background-color",
          "markdownDescription": "Denies the set_webview_background_color command without any pre-configured scope."
        },
        {
          "description": "Denies the set_webview_focus command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-set-webview-focus",
          "markdownDescription": "Denies the set_webview_focus command without any pre-configured scope."
        },
        {
          "description": "Denies the set_webview_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-set-webview-position",
          "markdownDescription": "Denies the set_webview_position command without any pre-configured scope."
        },
        {
          "description": "Denies the set_webview_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-set-webview-size",
          "markdownDescription": "Denies the set_webview_size command without any pre-configured scope."
        },
        {
          "description": "Denies the set_webview_zoom command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-set-webview-zoom",
          "markdownDescription": "Denies the set_webview_zoom command without any pre-configured scope."
        },
        {
          "description": "Denies the webview_close command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-webview-close",
          "markdownDescription": "Denies the webview_close command without any pre-configured scope."
        },
        {
          "description": "Denies the webview_hide command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-webview-hide",
          "markdownDescription": "Denies the webview_hide command without any pre-configured scope."
        },
        {
          "description": "Denies the webview_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-webview-position",
          "markdownDescription": "Denies the webview_position command without any pre-configured scope."
        },
        {
          "description": "Denies the webview_show command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-webview-show",
          "markdownDescription": "Denies the webview_show command without any pre-configured scope."
        },
        {
          "description": "Denies the webview_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-webview-size",
          "markdownDescription": "Denies the webview_size command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin.\n#### This default permission set includes:\n\n- `allow-get-all-windows`\n- `allow-scale-factor`\n- `allow-inner-position`\n- `allow-outer-position`\n- `allow-inner-size`\n- `allow-outer-size`\n- `allow-is-fullscreen`\n- `allow-is-minimized`\n- `allow-is-maximized`\n- `allow-is-focused`\n- `allow-is-decorated`\n- `allow-is-resizable`\n- `allow-is-maximizable`\n- `allow-is-minimizable`\n- `allow-is-closable`\n- `allow-is-visible`\n- `allow-is-enabled`\n- `allow-title`\n- `allow-current-monitor`\n- `allow-primary-monitor`\n- `allow-monitor-from-point`\n- `allow-available-monitors`\n- `allow-cursor-position`\n- `allow-theme`\n- `allow-is-always-on-top`\n- `allow-internal-toggle-maximize`",
          "type": "string",
          "const": "core:window:default",
          "markdownDescription": "Default permissions for the plugin.\n#### This default permission set includes:\n\n- `allow-get-all-windows`\n- `allow-scale-factor`\n- `allow-inner-position`\n- `allow-outer-position`\n- `allow-inner-size`\n- `allow-outer-size`\n- `allow-is-fullscreen`\n- `allow-is-minimized`\n- `allow-is-maximized`\n- `allow-is-focused`\n- `allow-is-decorated`\n- `allow-is-resizable`\n- `allow-is-maximizable`\n- `allow-is-minimizable`\n- `allow-is-closable`\n- `allow-is-visible`\n- `allow-is-enabled`\n- `allow-title`\n- `allow-current-monitor`\n- `allow-primary-monitor`\n- `allow-monitor-from-point`\n- `allow-available-monitors`\n- `allow-cursor-position`\n- `allow-theme`\n- `allow-is-always-on-top`\n- `allow-internal-toggle-maximize`"
        },
        {
          "description": "Enables the available_monitors command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-available-monitors",
          "markdownDescription": "Enables the available_monitors command without any pre-configured scope."
        },
        {
          "description": "Enables the center command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-center",
          "markdownDescription": "Enables the center command without any pre-configured scope."
        },
        {
          "description": "Enables the close command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-close",
          "markdownDescription": "Enables the close command without any pre-configured scope."
        },
        {
          "description": "Enables the create command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-create",
          "markdownDescription": "Enables the create command without any pre-configured scope."
        },
        {
          "description": "Enables the current_monitor command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-current-monitor",
          "markdownDescription": "Enables the current_monitor command without any pre-configured scope."
        },
        {
          "description": "Enables the cursor_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-cursor-position",
          "markdownDescription": "Enables the cursor_position command without any pre-configured scope."
        },
        {
          "description": "Enables the destroy command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-destroy",
          "markdownDescription": "Enables the destroy command without any pre-configured scope."
        },
        {
          "description": "Enables the get_all_windows command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-get-all-windows",
          "markdownDescription": "Enables the get_all_windows command without any pre-configured scope."
        },
        {
          "description": "Enables the hide command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-hide",
          "markdownDescription": "Enables the hide command without any pre-configured scope."
        },
        {
          "description": "Enables the inner_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-inner-position",
          "markdownDescription": "Enables the inner_position command without any pre-configured scope."
        },
        {
          "description": "Enables the inner_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-inner-size",
          "markdownDescription": "Enables the inner_size command without any pre-configured scope."
        },
        {
          "description": "Enables the internal_toggle_maximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-internal-toggle-maximize",
          "markdownDescription": "Enables the internal_toggle_maximize command without any pre-configured scope."
        },
        {
          "description": "Enables the is_always_on_top command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-always-on-top",
          "markdownDescription": "Enables the is_always_on_top command without any pre-configured scope."
        },
        {
          "description": "Enables the is_closable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-closable",
          "markdownDescription": "Enables the is_closable command without any pre-configured scope."
        },
        {
          "description": "Enables the is_decorated command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-decorated",
          "markdownDescription": "Enables the is_decorated command without any pre-configured scope."
        },
        {
          "description": "Enables the is_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-enabled",
          "markdownDescription": "Enables the is_enabled command without any pre-configured scope."
        },
        {
          "description": "Enables the is_focused command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-focused",
          "markdownDescription": "Enables the is_focused command without any pre-configured scope."
        },
        {
          "description": "Enables the is_fullscreen command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-fullscreen",
          "markdownDescription": "Enables the is_fullscreen command without any pre-configured scope."
        },
        {
          "description": "Enables the is_maximizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-maximizable",
          "markdownDescription": "Enables the is_maximizable command without any pre-configured scope."
        },
        {
          "description": "Enables the is_maximized command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-maximized",
          "markdownDescription": "Enables the is_maximized command without any pre-configured scope."
        },
        {
          "description": "Enables the is_minimizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-minimizable",
          "markdownDescription": "Enables the is_minimizable command without any pre-configured scope."
        },
        {
          "description": "Enables the is_minimized command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-minimized",
          "markdownDescription": "Enables the is_minimized command without any pre-configured scope."
        },
        {
          "description": "Enables the is_resizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-resizable",
          "markdownDescription": "Enables the is_resizable command without any pre-configured scope."
        },
        {
          "description": "Enables the is_visible command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-visible",
          "markdownDescription": "Enables the is_visible command without any pre-configured scope."
        },
        {
          "description": "Enables the maximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-maximize",
          "markdownDescription": "Enables the maximize command without any pre-configured scope."
        },
        {
          "description": "Enables the minimize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-minimize",
          "markdownDescription": "Enables the minimize command without any pre-configured scope."
        },
        {
          "description": "Enables the monitor_from_point command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-monitor-from-point",
          "markdownDescription": "Enables the monitor_from_point command without any pre-configured scope."
        },
        {
          "description": "Enables the outer_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-outer-position",
          "markdownDescription": "Enables the outer_position command without any pre-configured scope."
        },
        {
          "description": "Enables the outer_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-outer-size",
          "markdownDescription": "Enables the outer_size command without any pre-configured scope."
        },
        {
          "description": "Enables the primary_monitor command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-primary-monitor",
          "markdownDescription": "Enables the primary_monitor command without any pre-configured scope."
        },
        {
          "description": "Enables the request_user_attention command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-request-user-attention",
          "markdownDescription": "Enables the request_user_attention command without any pre-configured scope."
        },
        {
          "description": "Enables the scale_factor command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-scale-factor",
          "markdownDescription": "Enables the scale_factor command without any pre-configured scope."
        },
        {
          "description": "Enables the set_always_on_bottom command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-always-on-bottom",
          "markdownDescription": "Enables the set_always_on_bottom command without any pre-configured scope."
        },
        {
          "description": "Enables the set_always_on_top command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-always-on-top",
          "markdownDescription": "Enables the set_always_on_top command without any pre-configured scope."
        },
        {
          "description": "Enables the set_background_color command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-background-color",
          "markdownDescription": "Enables the set_background_color command without any pre-configured scope."
        },
        {
          "description": "Enables the set_badge_count command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-badge-count",
          "markdownDescription": "Enables the set_badge_count command without any pre-configured scope."
        },
        {
          "description": "Enables the set_badge_label command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-badge-label",
          "markdownDescription": "Enables the set_badge_label command without any pre-configured scope."
        },
        {
          "description": "Enables the set_closable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-closable",
          "markdownDescription": "Enables the set_closable command without any pre-configured scope."
        },
        {
          "description": "Enables the set_content_protected command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-content-protected",
          "markdownDescription": "Enables the set_content_protected command without any pre-configured scope."
        },
        {
          "description": "Enables the set_cursor_grab command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-cursor-grab",
          "markdownDescription": "Enables the set_cursor_grab command without any pre-configured scope."
        },
        {
          "description": "Enables the set_cursor_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-cursor-icon",
          "markdownDescription": "Enables the set_cursor_icon command without any pre-configured scope."
        },
        {
          "description": "Enables the set_cursor_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-cursor-position",
          "markdownDescription": "Enables the set_cursor_position command without any pre-configured scope."
        },
        {
          "description": "Enables the set_cursor_visible command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-cursor-visible",
          "markdownDescription": "Enables the set_cursor_visible command without any pre-configured scope."
        },
        {
          "description": "Enables the set_decorations command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-decorations",
          "markdownDescription": "Enables the set_decorations command without any pre-configured scope."
        },
        {
          "description": "Enables the set_effects command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-effects",
          "markdownDescription": "Enables the set_effects command without any pre-configured scope."
        },
        {
          "description": "Enables the set_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-enabled",
          "markdownDescription": "Enables the set_enabled command without any pre-configured scope."
        },
        {
          "description": "Enables the set_focus command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-focus",
          "markdownDescription": "Enables the set_focus command without any pre-configured scope."
        },
        {
          "description": "Enables the set_focusable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-focusable",
          "markdownDescription": "Enables the set_focusable command without any pre-configured scope."
        },
        {
          "description": "Enables the set_fullscreen command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-fullscreen",
          "markdownDescription": "Enables the set_fullscreen command without any pre-configured scope."
        },
        {
          "description": "Enables the set_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-icon",
          "markdownDescription": "Enables the set_icon command without any pre-configured scope."
        },
        {
          "description": "Enables the set_ignore_cursor_events command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-ignore-cursor-events",
          "markdownDescription": "Enables the set_ignore_cursor_events command without any pre-configured scope."
        },
        {
          "description": "Enables the set_max_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-max-size",
          "markdownDescription": "Enables the set_max_size command without any pre-configured scope."
        },
        {
          "description": "Enables the set_maximizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-maximizable",
          "markdownDescription": "Enables the set_maximizable command without any pre-configured scope."
        },
        {
          "description": "Enables the set_min_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-min-size",
          "markdownDescription": "Enables the set_min_size command without any pre-configured scope."
        },
        {
          "description": "Enables the set_minimizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-minimizable",
          "markdownDescription": "Enables the set_minimizable command without any pre-configured scope."
        },
        {
          "description": "Enables the set_overlay_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-overlay-icon",
          "markdownDescription": "Enables the set_overlay_icon command without any pre-configured scope."
        },
        {
          "description": "Enables the set_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-position",
          "markdownDescription": "Enables the set_position command without any pre-configured scope."
        },
        {
          "description": "Enables the set_progress_bar command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-progress-bar",
          "markdownDescription": "Enables the set_progress_bar command without any pre-configured scope."
        },
        {
          "description": "Enables the set_resizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-resizable",
          "markdownDescription": "Enables the set_resizable command without any pre-configured scope."
        },
        {
          "description": "Enables the set_shadow command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-shadow",
          "markdownDescription": "Enables the set_shadow command without any pre-configured scope."
        },
        {
          "description": "Enables the set_simple_fullscreen command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-simple-fullscreen",
          "markdownDescription": "Enables the set_simple_fullscreen command without any pre-configured scope."
        },
        {
          "description": "Enables the set_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-size",
          "markdownDescription": "Enables the set_size command without any pre-configured scope."
        },
        {
          "description": "Enables the set_size_constraints command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-size-constraints",
          "markdownDescription": "Enables the set_size_constraints command without any pre-configured scope."
        },
        {
          "description": "Enables the set_skip_taskbar command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-skip-taskbar",
          "markdownDescription": "Enables the set_skip_taskbar command without any pre-configured scope."
        },
        {
          "description": "Enables the set_theme command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-theme",
          "markdownDescription": "Enables the set_theme command without any pre-configured scope."
        },
        {
          "description": "Enables the set_title command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-title",
          "markdownDescription": "Enables the set_title command without any pre-configured scope."
        },
        {
          "description": "Enables the set_title_bar_style command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-title-bar-style",
          "markdownDescription": "Enables the set_title_bar_style command without any pre-configured scope."
        },
        {
          "description": "Enables the set_visible_on_all_workspaces command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-visible-on-all-workspaces",
          "markdownDescription": "Enables the set_visible_on_all_workspaces command without any pre-configured scope."
        },
        {
          "description": "Enables the show command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-show",
          "markdownDescription": "Enables the show command without any pre-configured scope."
        },
        {
          "description": "Enables the start_dragging command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-start-dragging",
          "markdownDescription": "Enables the start_dragging command without any pre-configured scope."
        },
        {
          "description": "Enables the start_resize_dragging command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-start-resize-dragging",
          "markdownDescription": "Enables the start_resize_dragging command without any pre-configured scope."
        },
        {
          "description": "Enables the theme command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-theme",
          "markdownDescription": "Enables the theme command without any pre-configured scope."
        },
        {
          "description": "Enables the title command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-title",
          "markdownDescription": "Enables the title command without any pre-configured scope."
        },
        {
          "description": "Enables the toggle_maximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-toggle-maximize",
          "markdownDescription": "Enables the toggle_maximize command without any pre-configured scope."
        },
        {
          "description": "Enables the unmaximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-unmaximize",
          "markdownDescription": "Enables the unmaximize command without any pre-configured scope."
        },
        {
          "description": "Enables the unminimize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-unminimize",
          "markdownDescription": "Enables the unminimize command without any pre-configured scope."
        },
        {
          "description": "Denies the available_monitors command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-available-monitors",
          "markdownDescription": "Denies the available_monitors command without any pre-configured scope."
        },
        {
          "description": "Denies the center command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-center",
          "markdownDescription": "Denies the center command without any pre-configured scope."
        },
        {
          "description": "Denies the close command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-close",
          "markdownDescription": "Denies the close command without any pre-configured scope."
        },
        {
          "description": "Denies the create command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-create",
          "markdownDescription": "Denies the create command without any pre-configured scope."
        },
        {
          "description": "Denies the current_monitor command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-current-monitor",
          "markdownDescription": "Denies the current_monitor command without any pre-configured scope."
        },
        {
          "description": "Denies the cursor_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-cursor-position",
          "markdownDescription": "Denies the cursor_position command without any pre-configured scope."
        },
        {
          "description": "Denies the destroy command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-destroy",
          "markdownDescription": "Denies the destroy command without any pre-configured scope."
        },
        {
          "description": "Denies the get_all_windows command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-get-all-windows",
          "markdownDescription": "Denies the get_all_windows command without any pre-configured scope."
        },
        {
          "description": "Denies the hide command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-hide",
          "markdownDescription": "Denies the hide command without any pre-configured scope."
        },
        {
          "description": "Denies the inner_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-inner-position",
          "markdownDescription": "Denies the inner_position command without any pre-configured scope."
        },
        {
          "description": "Denies the inner_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-inner-size",
          "markdownDescription": "Denies the inner_size command without any pre-configured scope."
        },
        {
          "description": "Denies the internal_toggle_maximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-internal-toggle-maximize",
          "markdownDescription": "Denies the internal_toggle_maximize command without any pre-configured scope."
        },
        {
          "description": "Denies the is_always_on_top command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-always-on-top",
          "markdownDescription": "Denies the is_always_on_top command without any pre-configured scope."
        },
        {
          "description": "Denies the is_closable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-closable",
          "markdownDescription": "Denies the is_closable command without any pre-configured scope."
        },
        {
          "description": "Denies the is_decorated command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-decorated",
          "markdownDescription": "Denies the is_decorated command without any pre-configured scope."
        },
        {
          "description": "Denies the is_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-enabled",
          "markdownDescription": "Denies the is_enabled command without any pre-configured scope."
        },
        {
          "description": "Denies the is_focused command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-focused",
          "markdownDescription": "Denies the is_focused command without any pre-configured scope."
        },
        {
          "description": "Denies the is_fullscreen command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-fullscreen",
          "markdownDescription": "Denies the is_fullscreen command without any pre-configured scope."
        },
        {
          "description": "Denies the is_maximizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-maximizable",
          "markdownDescription": "Denies the is_maximizable command without any pre-configured scope."
        },
        {
          "description": "Denies the is_maximized command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-maximized",
          "markdownDescription": "Denies the is_maximized command without any pre-configured scope."
        },
        {
          "description": "Denies the is_minimizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-minimizable",
          "markdownDescription": "Denies the is_minimizable command without any pre-configured scope."
        },
        {
          "description": "Denies the is_minimized command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-minimized",
          "markdownDescription": "Denies the is_minimized command without any pre-configured scope."
        },
        {
          "description": "Denies the is_resizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-resizable",
          "markdownDescription": "Denies the is_resizable command without any pre-configured scope."
        },
        {
          "description": "Denies the is_visible command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-visible",
          "markdownDescription": "Denies the is_visible command without any pre-configured scope."
        },
        {
          "description": "Denies the maximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-maximize",
          "markdownDescription": "Denies the maximize command without any pre-configured scope."
        },
        {
          "description": "Denies the minimize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-minimize",
          "markdownDescription": "Denies the minimize command without any pre-configured scope."
        },
        {
          "description": "Denies the monitor_from_point command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-monitor-from-point",
          "markdownDescription": "Denies the monitor_from_point command without any pre-configured scope."
        },
        {
          "description": "Denies the outer_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-outer-position",
          "markdownDescription": "Denies the outer_position command without any pre-configured scope."
        },
        {
          "description": "Denies the outer_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-outer-size",
          "markdownDescription": "Denies the outer_size command without any pre-configured scope."
        },
        {
          "description": "Denies the primary_monitor command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-primary-monitor",
          "markdownDescription": "Denies the primary_monitor command without any pre-configured scope."
        },
        {
          "description": "Denies the request_user_attention command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-request-user-attention",
          "markdownDescription": "Denies the request_user_attention command without any pre-configured scope."
        },
        {
          "description": "Denies the scale_factor command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-scale-factor",
          "markdownDescription": "Denies the scale_factor command without any pre-configured scope."
        },
        {
          "description": "Denies the set_always_on_bottom command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-always-on-bottom",
          "markdownDescription": "Denies the set_always_on_bottom command without any pre-configured scope."
        },
        {
          "description": "Denies the set_always_on_top command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-always-on-top",
          "markdownDescription": "Denies the set_always_on_top command without any pre-configured scope."
        },
        {
          "description": "Denies the set_background_color command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-background-color",
          "markdownDescription": "Denies the set_background_color command without any pre-configured scope."
        },
        {
          "description": "Denies the set_badge_count command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-badge-count",
          "markdownDescription": "Denies the set_badge_count command without any pre-configured scope."
        },
        {
          "description": "Denies the set_badge_label command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-badge-label",
          "markdownDescription": "Denies the set_badge_label command without any pre-configured scope."
        },
        {
          "description": "Denies the set_closable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-closable",
          "markdownDescription": "Denies the set_closable command without any pre-configured scope."
        },
        {
          "description": "Denies the set_content_protected command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-content-protected",
          "markdownDescription": "Denies the set_content_protected command without any pre-configured scope."
        },
        {
          "description": "Denies the set_cursor_grab command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-cursor-grab",
          "markdownDescription": "Denies the set_cursor_grab command without any pre-configured scope."
        },
        {
          "description": "Denies the set_cursor_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-cursor-icon",
          "markdownDescription": "Denies the set_cursor_icon command without any pre-configured scope."
        },
        {
          "description": "Denies the set_cursor_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-cursor-position",
          "markdownDescription": "Denies the set_cursor_position command without any pre-configured scope."
        },
        {
          "description": "Denies the set_cursor_visible command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-cursor-visible",
          "markdownDescription": "Denies the set_cursor_visible command without any pre-configured scope."
        },
        {
          "description": "Denies the set_decorations command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-decorations",
          "markdownDescription": "Denies the set_decorations command without any pre-configured scope."
        },
        {
          "description": "Denies the set_effects command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-effects",
          "markdownDescription": "Denies the set_effects command without any pre-configured scope."
        },
        {
          "description": "Denies the set_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-enabled",
          "markdownDescription": "Denies the set_enabled command without any pre-configured scope."
        },
        {
          "description": "Denies the set_focus command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-focus",
          "markdownDescription": "Denies the set_focus command without any pre-configured scope."
        },
        {
          "description": "Denies the set_focusable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-focusable",
          "markdownDescription": "Denies the set_focusable command without any pre-configured scope."
        },
        {
          "description": "Denies the set_fullscreen command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-fullscreen",
          "markdownDescription": "Denies the set_fullscreen command without any pre-configured scope."
        },
        {
          "description": "Denies the set_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-icon",
          "markdownDescription": "Denies the set_icon command without any pre-configured scope."
        },
        {
          "description": "Denies the set_ignore_cursor_events command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-ignore-cursor-events",
          "markdownDescription": "Denies the set_ignore_cursor_events command without any pre-configured scope."
        },
        {
          "description": "Denies the set_max_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-max-size",
          "markdownDescription": "Denies the set_max_size command without any pre-configured scope."
        },
        {
          "description": "Denies the set_maximizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-maximizable",
          "markdownDescription": "Denies the set_maximizable command without any pre-configured scope."
        },
        {
          "description": "Denies the set_min_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-min-size",
          "markdownDescription": "Denies the set_min_size command without any pre-configured scope."
        },
        {
          "description": "Denies the set_minimizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-minimizable",
          "markdownDescription": "Denies the set_minimizable command without any pre-configured scope."
        },
        {
          "description": "Denies the set_overlay_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-overlay-icon",
          "markdownDescription": "Denies the set_overlay_icon command without any pre-configured scope."
        },
        {
          "description": "Denies the set_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-position",
          "markdownDescription": "Denies the set_position command without any pre-configured scope."
        },
        {
          "description": "Denies the set_progress_bar command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-progress-bar",
          "markdownDescription": "Denies the set_progress_bar command without any pre-configured scope."
        },
        {
          "description": "Denies the set_resizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-resizable",
          "markdownDescription": "Denies the set_resizable command without any pre-configured scope."
        },
        {
          "description": "Denies the set_shadow command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-shadow",
          "markdownDescription": "Denies the set_shadow command without any pre-configured scope."
        },
        {
          "description": "Denies the set_simple_fullscreen command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-simple-fullscreen",
          "markdownDescription": "Denies the set_simple_fullscreen command without any pre-configured scope."
        },
        {
          "description": "Denies the set_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-size",
          "markdownDescription": "Denies the set_size command without any pre-configured scope."
        },
        {
          "description": "Denies the set_size_constraints command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-size-constraints",
          "markdownDescription": "Denies the set_size_constraints command without any pre-configured scope."
        },
        {
          "description": "Denies the set_skip_taskbar command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-skip-taskbar",
          "markdownDescription": "Denies the set_skip_taskbar command without any pre-configured scope."
        },
        {
          "description": "Denies the set_theme command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-theme",
          "markdownDescription": "Denies the set_theme command without any pre-configured scope."
        },
        {
          "description": "Denies the set_title command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-title",
          "markdownDescription": "Denies the set_title command without any pre-configured scope."
        },
        {
          "description": "Denies the set_title_bar_style command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-title-bar-style",
          "markdownDescription": "Denies the set_title_bar_style command without any pre-configured scope."
        },
        {
          "description": "Denies the set_visible_on_all_workspaces command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-visible-on-all-workspaces",
          "markdownDescription": "Denies the set_visible_on_all_workspaces command without any pre-configured scope."
        },
        {
          "description": "Denies the show command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-show",
          "markdownDescription": "Denies the show command without any pre-configured scope."
        },
        {
          "description": "Denies the start_dragging command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-start-dragging",
          "markdownDescription": "Denies the start_dragging command without any pre-configured scope."
        },
        {
          "description": "Denies the start_resize_dragging command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-start-resize-dragging",
          "markdownDescription": "Denies the start_resize_dragging command without any pre-configured scope."
        },
        {
          "description": "Denies the theme command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-theme",
          "markdownDescription": "Denies the theme command without any pre-configured scope."
        },
        {
          "description": "Denies the title command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-title",
          "markdownDescription": "Denies the title command without any pre-configured scope."
        },
        {
          "description": "Denies the toggle_maximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-toggle-maximize",
          "markdownDescription": "Denies the toggle_maximize command without any pre-configured scope."
        },
        {
          "description": "Denies the unmaximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-unmaximize",
          "markdownDescription": "Denies the unmaximize command without any pre-configured scope."
        },
        {
          "description": "Denies the unminimize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-unminimize",
          "markdownDescription": "Denies the unminimize command without any pre-configured scope."
        },
        {
          "description": "This permission set configures which\nnotification features are by default exposed.\n\n#### Granted Permissions\n\nIt allows all notification related features.\n\n\n#### This default permission set includes:\n\n- `allow-is-permission-granted`\n- `allow-request-permission`\n- `allow-notify`\n- `allow-register-action-types`\n- `allow-register-listener`\n- `allow-cancel`\n- `allow-get-pending`\n- `allow-remove-active`\n- `allow-get-active`\n- `allow-check-permissions`\n- `allow-show`\n- `allow-batch`\n- `allow-list-channels`\n- `allow-delete-channel`\n- `allow-create-channel`\n- `allow-permission-state`",
          "type": "string",
          "const": "notification:default",
          "markdownDescription": "This permission set configures which\nnotification features are by default exposed.\n\n#### Granted Permissions\n\nIt allows all notification related features.\n\n\n#### This default permission set includes:\n\n- `allow-is-permission-granted`\n- `allow-request-permission`\n- `allow-notify`\n- `allow-register-action-types`\n- `allow-register-listener`\n- `allow-cancel`\n- `allow-get-pending`\n- `allow-remove-active`\n- `allow-get-active`\n- `allow-check-permissions`\n- `allow-show`\n- `allow-batch`\n- `allow-list-channels`\n- `allow-delete-channel`\n- `allow-create-channel`\n- `allow-permission-state`"
        },
        {
          "description": "Enables the batch command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-batch",
          "markdownDescription": "Enables the batch command without any pre-configured scope."
        },
        {
          "description": "Enables the cancel command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-cancel",
          "markdownDescription": "Enables the cancel command without any pre-configured scope."
        },
        {
          "description": "Enables the check_permissions command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-check-permissions",
          "markdownDescription": "Enables the check_permissions command without any pre-configured scope."
        },
        {
          "description": "Enables the create_channel command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-create-channel",
          "markdownDescription": "Enables the create_channel command without any pre-configured scope."
        },
        {
          "description": "Enables the delete_channel command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-delete-channel",
          "markdownDescription": "Enables the delete_channel command without any pre-configured scope."
        },
        {
          "description": "Enables the get_active command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-get-active",
          "markdownDescription": "Enables the get_active command without any pre-configured scope."
        },
        {
          "description": "Enables the get_pending command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-get-pending",
          "markdownDescription": "Enables the get_pending command without any pre-configured scope."
        },
        {
          "description": "Enables the is_permission_granted command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-is-permission-granted",
          "markdownDescription": "Enables the is_permission_granted command without any pre-configured scope."
        },
        {
          "description": "Enables the list_channels command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-list-channels",
          "markdownDescription": "Enables the list_channels command without any pre-configured scope."
        },
        {
          "description": "Enables the notify command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-notify",
          "markdownDescription": "Enables the notify command without any pre-configured scope."
        },
        {
          "description": "Enables the permission_state command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-permission-state",
          "markdownDescription": "Enables the permission_state command without any pre-configured scope."
        },
        {
          "description": "Enables the register_action_types command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-register-action-types",
          "markdownDescription": "Enables the register_action_types command without any pre-configured scope."
        },
        {
          "description": "Enables the register_listener command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-register-listener",
          "markdownDescription": "Enables the register_listener command without any pre-configured scope."
        },
        {
          "description": "Enables the remove_active command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-remove-active",
          "markdownDescription": "Enables the remove_active command without any pre-configured scope."
        },
        {
          "description": "Enables the request_permission command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-request-permission",
          "markdownDescription": "Enables the request_permission command without any pre-configured scope."
        },
        {
          "description": "Enables the show command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-show",
          "markdownDescription": "Enables the show command without any pre-configured scope."
        },
        {
          "description": "Denies the batch command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-batch",
          "markdownDescription": "Denies the batch command without any pre-configured scope."
        },
        {
          "description": "Denies the cancel command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-cancel",
          "markdownDescription": "Denies the cancel command without any pre-configured scope."
        },
        {
          "description": "Denies the check_permissions command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-check-permissions",
          "markdownDescription": "Denies the check_permissions command without any pre-configured scope."
        },
        {
          "description": "Denies the create_channel command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-create-channel",
          "markdownDescription": "Denies the create_channel command without any pre-configured scope."
        },
        {
          "description": "Denies the delete_channel command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-delete-channel",
          "markdownDescription": "Denies the delete_channel command without any pre-configured scope."
        },
        {
          "description": "Denies the get_active command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-get-active",
          "markdownDescription": "Denies the get_active command without any pre-configured scope."
        },
        {
          "description": "Denies the get_pending command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-get-pending",
          "markdownDescription": "Denies the get_pending command without any pre-configured scope."
        },
        {
          "description": "Denies the is_permission_granted command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-is-permission-granted",
          "markdownDescription": "Denies the is_permission_granted command without any pre-configured scope."
        },
        {
          "description": "Denies the list_channels command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-list-channels",
          "markdownDescription": "Denies the list_channels command without any pre-configured scope."
        },
        {
          "description": "Denies the notify command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-notify",
          "markdownDescription": "Denies the notify command without any pre-configured scope."
        },
        {
          "description": "Denies the permission_state command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-permission-state",
          "markdownDescription": "Denies the permission_state command without any pre-configured scope."
        },
        {
          "description": "Denies the register_action_types command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-register-action-types",
          "markdownDescription": "Denies the register_action_types command without any pre-configured scope."
        },
        {
          "description": "Denies the register_listener command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-register-listener",
          "markdownDescription": "Denies the register_listener command without any pre-configured scope."
        },
        {
          "description": "Denies the remove_active command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-remove-active",
          "markdownDescription": "Denies the remove_active command without any pre-configured scope."
        },
        {
          "description": "Denies the request_permission command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-request-permission",
          "markdownDescription": "Denies the request_permission command without any pre-configured scope."
        },
        {
          "description": "Denies the show command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-show",
          "markdownDescription": "Denies the show command without any pre-configured scope."
        },
        {
          "description": "This permission set configures which\nshell functionality is exposed by default.\n\n#### Granted Permissions\n\nIt allows to use the `open` functionality with a reasonable\nscope pre-configured. It will allow opening `http(s)://`,\n`tel:` and `mailto:` links.\n\n#### This default permission set includes:\n\n- `allow-open`",
          "type": "string",
          "const": "shell:default",
          "markdownDescription": "This permission set configures which\nshell functionality is exposed by default.\n\n#### Granted Permissions\n\nIt allows to use the `open` functionality with a reasonable\nscope pre-configured. It will allow opening `http(s)://`,\n`tel:` and `mailto:` links.\n\n#### This default permission set includes:\n\n- `allow-open`"
        },
        {
          "description": "Enables the execute command without any pre-configured scope.",
          "type": "string",
          "const": "shell:allow-execute",
          "markdownDescription": "Enables the execute command without any pre-configured scope."
        },
        {
          "description": "Enables the kill command without any pre-configured scope.",
          "type": "string",
          "const": "shell:allow-kill",
          "markdownDescription": "Enables the kill command without any pre-configured scope."
        },
        {
          "description": "Enables the open command without any pre-configured scope.",
          "type": "string",
          "const": "shell:allow-open",
          "markdownDescription": "Enables the open command without any pre-configured scope."
        },
        {
          "description": "Enables the spawn command without any pre-configured scope.",
          "type": "string",
          "const": "shell:allow-spawn",
          "markdownDescription": "Enables the spawn command without any pre-configured scope."
        },
        {
          "description": "Enables the stdin_write command without any pre-configured scope.",
          "type": "string",
          "const": "shell:allow-stdin-write",
          "markdownDescription": "Enables the stdin_write command without any pre-configured scope."
        },
        {
          "description": "Denies the execute command without any pre-configured scope.",
          "type": "string",
          "const": "shell:deny-execute",
          "markdownDescription": "Denies the execute command without any pre-configured scope."
        },
        {
          "description": "Denies the kill command without any pre-configured scope.",
          "type": "string",
          "const": "shell:deny-kill",
          "markdownDescription": "Denies the kill command without any pre-configured scope."
        },
        {
          "description": "Denies the open command without any pre-configured scope.",
          "type": "string",
          "const": "shell:deny-open",
          "markdownDescription": "Denies the open command without any pre-configured scope."
        },
        {
          "description": "Denies the spawn command without any pre-configured scope.",
          "type": "string",
          "const": "shell:deny-spawn",
          "markdownDescription": "Denies the spawn command without any pre-configured scope."
        },
        {
          "description": "Denies the stdin_write command without any pre-configured scope.",
          "type": "string",
          "const": "shell:deny-stdin-write",
          "markdownDescription": "Denies the stdin_write command without any pre-configured scope."
        }
      ]
    },
    "Value": {
      "description": "All supported ACL values.",
      "anyOf": [
        {
          "description": "Represents a null JSON value.",
          "type": "null"
        },
        {
          "description": "Represents a [`bool`].",
          "type": "boolean"
        },
        {
          "description": "Represents a valid ACL [`Number`].",
          "allOf": [
            {
              "$ref": "#/definitions/Number"
            }
          ]
        },
        {
          "description": "Represents a [`String`].",
          "type": "string"
        },
        {
          "description": "Represents a list of other [`Value`]s.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Value"
          }
        },
        {
          "description": "Represents a map of [`String`] keys to [`Value`]s.",
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/Value"
          }
        }
      ]
    },
    "Number": {
      "description": "A valid ACL number.",
      "anyOf": [
        {
          "description": "Represents an [`i64`].",
          "type": "integer",
          "format": "int64"
        },
        {
          "description": "Represents a [`f64`].",
          "type": "number",
          "format": "double"
        }
      ]
    },
    "Target": {
      "description": "Platform target.",
      "oneOf": [
        {
          "description": "MacOS.",
          "type": "string",
          "enum": ["macOS"]
        },
        {
          "description": "Windows.",
          "type": "string",
          "enum": ["windows"]
        },
        {
          "description": "Linux.",
          "type": "string",
          "enum": ["linux"]
        },
        {
          "description": "Android.",
          "type": "string",
          "enum": ["android"]
        },
        {
          "description": "iOS.",
          "type": "string",
          "enum": ["iOS"]
        }
      ]
    },
    "ShellScopeEntryAllowedArg": {
      "description": "A command argument allowed to be executed by the webview API.",
      "anyOf": [
        {
          "description": "A non-configurable argument that is passed to the command in the order it was specified.",
          "type": "string"
        },
        {
          "description": "A variable that is set while calling the command from the webview API.",
          "type": "object",
          "required": ["validator"],
          "properties": {
            "raw": {
              "description": "Marks the validator as a raw regex, meaning the plugin should not make any modification at runtime.\n\nThis means the regex will not match on the entire string by default, which might be exploited if your regex allow unexpected input to be considered valid. When using this option, make sure your regex is correct.",
              "default": false,
              "type": "boolean"
            },
            "validator": {
              "description": "[regex] validator to require passed values to conform to an expected input.\n\nThis will require the argument value passed to this variable to match the `validator` regex before it will be executed.\n\nThe regex string is by default surrounded by `^...$` to match the full string. For example the `https?://\\w+` regex would be registered as `^https?://\\w+$`.\n\n[regex]: <https://docs.rs/regex/latest/regex/#syntax>",
              "type": "string"
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "ShellScopeEntryAllowedArgs": {
      "description": "A set of command arguments allowed to be executed by the webview API.\n\nA value of `true` will allow any arguments to be passed to the command. `false` will disable all arguments. A list of [`ShellScopeEntryAllowedArg`] will set those arguments as the only valid arguments to be passed to the attached command configuration.",
      "anyOf": [
        {
          "description": "Use a simple boolean to allow all or disable all arguments to this command configuration.",
          "type": "boolean"
        },
        {
          "description": "A specific set of [`ShellScopeEntryAllowedArg`] that are valid to call for the command configuration.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/ShellScopeEntryAllowedArg"
          }
        }
      ]
    }
  }
}
</file>

<file path="src/frontend/src-tauri/gen/schemas/linux-schema.json">
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CapabilityFile",
  "description": "Capability formats accepted in a capability file.",
  "anyOf": [
    {
      "description": "A single capability.",
      "allOf": [
        {
          "$ref": "#/definitions/Capability"
        }
      ]
    },
    {
      "description": "A list of capabilities.",
      "type": "array",
      "items": {
        "$ref": "#/definitions/Capability"
      }
    },
    {
      "description": "A list of capabilities.",
      "type": "object",
      "required": ["capabilities"],
      "properties": {
        "capabilities": {
          "description": "The list of capabilities.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Capability"
          }
        }
      }
    }
  ],
  "definitions": {
    "Capability": {
      "description": "A grouping and boundary mechanism developers can use to isolate access to the IPC layer.\n\nIt controls application windows' and webviews' fine grained access to the Tauri core, application, or plugin commands. If a webview or its window is not matching any capability then it has no access to the IPC layer at all.\n\nThis can be done to create groups of windows, based on their required system access, which can reduce impact of frontend vulnerabilities in less privileged windows. Windows can be added to a capability by exact name (e.g. `main-window`) or glob patterns like `*` or `admin-*`. A Window can have none, one, or multiple associated capabilities.\n\n## Example\n\n```json { \"identifier\": \"main-user-files-write\", \"description\": \"This capability allows the `main` window on macOS and Windows access to `filesystem` write related commands and `dialog` commands to enable programmatic access to files selected by the user.\", \"windows\": [ \"main\" ], \"permissions\": [ \"core:default\", \"dialog:open\", { \"identifier\": \"fs:allow-write-text-file\", \"allow\": [{ \"path\": \"$HOME/test.txt\" }] }, ], \"platforms\": [\"macOS\",\"windows\"] } ```",
      "type": "object",
      "required": ["identifier", "permissions"],
      "properties": {
        "identifier": {
          "description": "Identifier of the capability.\n\n## Example\n\n`main-user-files-write`",
          "type": "string"
        },
        "description": {
          "description": "Description of what the capability is intended to allow on associated windows.\n\nIt should contain a description of what the grouped permissions should allow.\n\n## Example\n\nThis capability allows the `main` window access to `filesystem` write related commands and `dialog` commands to enable programmatic access to files selected by the user.",
          "default": "",
          "type": "string"
        },
        "remote": {
          "description": "Configure remote URLs that can use the capability permissions.\n\nThis setting is optional and defaults to not being set, as our default use case is that the content is served from our local application.\n\n:::caution Make sure you understand the security implications of providing remote sources with local system access. :::\n\n## Example\n\n```json { \"urls\": [\"https://*.mydomain.dev\"] } ```",
          "anyOf": [
            {
              "$ref": "#/definitions/CapabilityRemote"
            },
            {
              "type": "null"
            }
          ]
        },
        "local": {
          "description": "Whether this capability is enabled for local app URLs or not. Defaults to `true`.",
          "default": true,
          "type": "boolean"
        },
        "windows": {
          "description": "List of windows that are affected by this capability. Can be a glob pattern.\n\nIf a window label matches any of the patterns in this list, the capability will be enabled on all the webviews of that window, regardless of the value of [`Self::webviews`].\n\nOn multiwebview windows, prefer specifying [`Self::webviews`] and omitting [`Self::windows`] for a fine grained access control.\n\n## Example\n\n`[\"main\"]`",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "webviews": {
          "description": "List of webviews that are affected by this capability. Can be a glob pattern.\n\nThe capability will be enabled on all the webviews whose label matches any of the patterns in this list, regardless of whether the webview's window label matches a pattern in [`Self::windows`].\n\n## Example\n\n`[\"sub-webview-one\", \"sub-webview-two\"]`",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "permissions": {
          "description": "List of permissions attached to this capability.\n\nMust include the plugin name as prefix in the form of `${plugin-name}:${permission-name}`. For commands directly implemented in the application itself only `${permission-name}` is required.\n\n## Example\n\n```json [ \"core:default\", \"shell:allow-open\", \"dialog:open\", { \"identifier\": \"fs:allow-write-text-file\", \"allow\": [{ \"path\": \"$HOME/test.txt\" }] } ] ```",
          "type": "array",
          "items": {
            "$ref": "#/definitions/PermissionEntry"
          },
          "uniqueItems": true
        },
        "platforms": {
          "description": "Limit which target platforms this capability applies to.\n\nBy default all platforms are targeted.\n\n## Example\n\n`[\"macOS\",\"windows\"]`",
          "type": ["array", "null"],
          "items": {
            "$ref": "#/definitions/Target"
          }
        }
      }
    },
    "CapabilityRemote": {
      "description": "Configuration for remote URLs that are associated with the capability.",
      "type": "object",
      "required": ["urls"],
      "properties": {
        "urls": {
          "description": "Remote domains this capability refers to using the [URLPattern standard](https://urlpattern.spec.whatwg.org/).\n\n## Examples\n\n- \"https://*.mydomain.dev\": allows subdomains of mydomain.dev - \"https://mydomain.dev/api/*\": allows any subpath of mydomain.dev/api",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "PermissionEntry": {
      "description": "An entry for a permission value in a [`Capability`] can be either a raw permission [`Identifier`] or an object that references a permission and extends its scope.",
      "anyOf": [
        {
          "description": "Reference a permission or permission set by identifier.",
          "allOf": [
            {
              "$ref": "#/definitions/Identifier"
            }
          ]
        },
        {
          "description": "Reference a permission or permission set by identifier and extends its scope.",
          "type": "object",
          "allOf": [
            {
              "if": {
                "properties": {
                  "identifier": {
                    "anyOf": [
                      {
                        "description": "This permission set configures which\nshell functionality is exposed by default.\n\n#### Granted Permissions\n\nIt allows to use the `open` functionality with a reasonable\nscope pre-configured. It will allow opening `http(s)://`,\n`tel:` and `mailto:` links.\n\n#### This default permission set includes:\n\n- `allow-open`",
                        "type": "string",
                        "const": "shell:default",
                        "markdownDescription": "This permission set configures which\nshell functionality is exposed by default.\n\n#### Granted Permissions\n\nIt allows to use the `open` functionality with a reasonable\nscope pre-configured. It will allow opening `http(s)://`,\n`tel:` and `mailto:` links.\n\n#### This default permission set includes:\n\n- `allow-open`"
                      },
                      {
                        "description": "Enables the execute command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:allow-execute",
                        "markdownDescription": "Enables the execute command without any pre-configured scope."
                      },
                      {
                        "description": "Enables the kill command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:allow-kill",
                        "markdownDescription": "Enables the kill command without any pre-configured scope."
                      },
                      {
                        "description": "Enables the open command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:allow-open",
                        "markdownDescription": "Enables the open command without any pre-configured scope."
                      },
                      {
                        "description": "Enables the spawn command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:allow-spawn",
                        "markdownDescription": "Enables the spawn command without any pre-configured scope."
                      },
                      {
                        "description": "Enables the stdin_write command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:allow-stdin-write",
                        "markdownDescription": "Enables the stdin_write command without any pre-configured scope."
                      },
                      {
                        "description": "Denies the execute command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:deny-execute",
                        "markdownDescription": "Denies the execute command without any pre-configured scope."
                      },
                      {
                        "description": "Denies the kill command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:deny-kill",
                        "markdownDescription": "Denies the kill command without any pre-configured scope."
                      },
                      {
                        "description": "Denies the open command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:deny-open",
                        "markdownDescription": "Denies the open command without any pre-configured scope."
                      },
                      {
                        "description": "Denies the spawn command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:deny-spawn",
                        "markdownDescription": "Denies the spawn command without any pre-configured scope."
                      },
                      {
                        "description": "Denies the stdin_write command without any pre-configured scope.",
                        "type": "string",
                        "const": "shell:deny-stdin-write",
                        "markdownDescription": "Denies the stdin_write command without any pre-configured scope."
                      }
                    ]
                  }
                }
              },
              "then": {
                "properties": {
                  "allow": {
                    "items": {
                      "title": "ShellScopeEntry",
                      "description": "Shell scope entry.",
                      "anyOf": [
                        {
                          "type": "object",
                          "required": ["cmd", "name"],
                          "properties": {
                            "args": {
                              "description": "The allowed arguments for the command execution.",
                              "allOf": [
                                {
                                  "$ref": "#/definitions/ShellScopeEntryAllowedArgs"
                                }
                              ]
                            },
                            "cmd": {
                              "description": "The command name. It can start with a variable that resolves to a system base directory. The variables are: `$AUDIO`, `$CACHE`, `$CONFIG`, `$DATA`, `$LOCALDATA`, `$DESKTOP`, `$DOCUMENT`, `$DOWNLOAD`, `$EXE`, `$FONT`, `$HOME`, `$PICTURE`, `$PUBLIC`, `$RUNTIME`, `$TEMPLATE`, `$VIDEO`, `$RESOURCE`, `$LOG`, `$TEMP`, `$APPCONFIG`, `$APPDATA`, `$APPLOCALDATA`, `$APPCACHE`, `$APPLOG`.",
                              "type": "string"
                            },
                            "name": {
                              "description": "The name for this allowed shell command configuration.\n\nThis name will be used inside of the webview API to call this command along with any specified arguments.",
                              "type": "string"
                            }
                          },
                          "additionalProperties": false
                        },
                        {
                          "type": "object",
                          "required": ["name", "sidecar"],
                          "properties": {
                            "args": {
                              "description": "The allowed arguments for the command execution.",
                              "allOf": [
                                {
                                  "$ref": "#/definitions/ShellScopeEntryAllowedArgs"
                                }
                              ]
                            },
                            "name": {
                              "description": "The name for this allowed shell command configuration.\n\nThis name will be used inside of the webview API to call this command along with any specified arguments.",
                              "type": "string"
                            },
                            "sidecar": {
                              "description": "If this command is a sidecar command.",
                              "type": "boolean"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    }
                  },
                  "deny": {
                    "items": {
                      "title": "ShellScopeEntry",
                      "description": "Shell scope entry.",
                      "anyOf": [
                        {
                          "type": "object",
                          "required": ["cmd", "name"],
                          "properties": {
                            "args": {
                              "description": "The allowed arguments for the command execution.",
                              "allOf": [
                                {
                                  "$ref": "#/definitions/ShellScopeEntryAllowedArgs"
                                }
                              ]
                            },
                            "cmd": {
                              "description": "The command name. It can start with a variable that resolves to a system base directory. The variables are: `$AUDIO`, `$CACHE`, `$CONFIG`, `$DATA`, `$LOCALDATA`, `$DESKTOP`, `$DOCUMENT`, `$DOWNLOAD`, `$EXE`, `$FONT`, `$HOME`, `$PICTURE`, `$PUBLIC`, `$RUNTIME`, `$TEMPLATE`, `$VIDEO`, `$RESOURCE`, `$LOG`, `$TEMP`, `$APPCONFIG`, `$APPDATA`, `$APPLOCALDATA`, `$APPCACHE`, `$APPLOG`.",
                              "type": "string"
                            },
                            "name": {
                              "description": "The name for this allowed shell command configuration.\n\nThis name will be used inside of the webview API to call this command along with any specified arguments.",
                              "type": "string"
                            }
                          },
                          "additionalProperties": false
                        },
                        {
                          "type": "object",
                          "required": ["name", "sidecar"],
                          "properties": {
                            "args": {
                              "description": "The allowed arguments for the command execution.",
                              "allOf": [
                                {
                                  "$ref": "#/definitions/ShellScopeEntryAllowedArgs"
                                }
                              ]
                            },
                            "name": {
                              "description": "The name for this allowed shell command configuration.\n\nThis name will be used inside of the webview API to call this command along with any specified arguments.",
                              "type": "string"
                            },
                            "sidecar": {
                              "description": "If this command is a sidecar command.",
                              "type": "boolean"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    }
                  }
                }
              },
              "properties": {
                "identifier": {
                  "description": "Identifier of the permission or permission set.",
                  "allOf": [
                    {
                      "$ref": "#/definitions/Identifier"
                    }
                  ]
                }
              }
            },
            {
              "properties": {
                "identifier": {
                  "description": "Identifier of the permission or permission set.",
                  "allOf": [
                    {
                      "$ref": "#/definitions/Identifier"
                    }
                  ]
                },
                "allow": {
                  "description": "Data that defines what is allowed by the scope.",
                  "type": ["array", "null"],
                  "items": {
                    "$ref": "#/definitions/Value"
                  }
                },
                "deny": {
                  "description": "Data that defines what is denied by the scope. This should be prioritized by validation logic.",
                  "type": ["array", "null"],
                  "items": {
                    "$ref": "#/definitions/Value"
                  }
                }
              }
            }
          ],
          "required": ["identifier"]
        }
      ]
    },
    "Identifier": {
      "description": "Permission identifier",
      "oneOf": [
        {
          "description": "Default core plugins set.\n#### This default permission set includes:\n\n- `core:path:default`\n- `core:event:default`\n- `core:window:default`\n- `core:webview:default`\n- `core:app:default`\n- `core:image:default`\n- `core:resources:default`\n- `core:menu:default`\n- `core:tray:default`",
          "type": "string",
          "const": "core:default",
          "markdownDescription": "Default core plugins set.\n#### This default permission set includes:\n\n- `core:path:default`\n- `core:event:default`\n- `core:window:default`\n- `core:webview:default`\n- `core:app:default`\n- `core:image:default`\n- `core:resources:default`\n- `core:menu:default`\n- `core:tray:default`"
        },
        {
          "description": "Default permissions for the plugin.\n#### This default permission set includes:\n\n- `allow-version`\n- `allow-name`\n- `allow-tauri-version`\n- `allow-identifier`\n- `allow-bundle-type`\n- `allow-register-listener`\n- `allow-remove-listener`",
          "type": "string",
          "const": "core:app:default",
          "markdownDescription": "Default permissions for the plugin.\n#### This default permission set includes:\n\n- `allow-version`\n- `allow-name`\n- `allow-tauri-version`\n- `allow-identifier`\n- `allow-bundle-type`\n- `allow-register-listener`\n- `allow-remove-listener`"
        },
        {
          "description": "Enables the app_hide command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-app-hide",
          "markdownDescription": "Enables the app_hide command without any pre-configured scope."
        },
        {
          "description": "Enables the app_show command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-app-show",
          "markdownDescription": "Enables the app_show command without any pre-configured scope."
        },
        {
          "description": "Enables the bundle_type command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-bundle-type",
          "markdownDescription": "Enables the bundle_type command without any pre-configured scope."
        },
        {
          "description": "Enables the default_window_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-default-window-icon",
          "markdownDescription": "Enables the default_window_icon command without any pre-configured scope."
        },
        {
          "description": "Enables the fetch_data_store_identifiers command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-fetch-data-store-identifiers",
          "markdownDescription": "Enables the fetch_data_store_identifiers command without any pre-configured scope."
        },
        {
          "description": "Enables the identifier command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-identifier",
          "markdownDescription": "Enables the identifier command without any pre-configured scope."
        },
        {
          "description": "Enables the name command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-name",
          "markdownDescription": "Enables the name command without any pre-configured scope."
        },
        {
          "description": "Enables the register_listener command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-register-listener",
          "markdownDescription": "Enables the register_listener command without any pre-configured scope."
        },
        {
          "description": "Enables the remove_data_store command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-remove-data-store",
          "markdownDescription": "Enables the remove_data_store command without any pre-configured scope."
        },
        {
          "description": "Enables the remove_listener command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-remove-listener",
          "markdownDescription": "Enables the remove_listener command without any pre-configured scope."
        },
        {
          "description": "Enables the set_app_theme command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-set-app-theme",
          "markdownDescription": "Enables the set_app_theme command without any pre-configured scope."
        },
        {
          "description": "Enables the set_dock_visibility command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-set-dock-visibility",
          "markdownDescription": "Enables the set_dock_visibility command without any pre-configured scope."
        },
        {
          "description": "Enables the tauri_version command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-tauri-version",
          "markdownDescription": "Enables the tauri_version command without any pre-configured scope."
        },
        {
          "description": "Enables the version command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:allow-version",
          "markdownDescription": "Enables the version command without any pre-configured scope."
        },
        {
          "description": "Denies the app_hide command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-app-hide",
          "markdownDescription": "Denies the app_hide command without any pre-configured scope."
        },
        {
          "description": "Denies the app_show command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-app-show",
          "markdownDescription": "Denies the app_show command without any pre-configured scope."
        },
        {
          "description": "Denies the bundle_type command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-bundle-type",
          "markdownDescription": "Denies the bundle_type command without any pre-configured scope."
        },
        {
          "description": "Denies the default_window_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-default-window-icon",
          "markdownDescription": "Denies the default_window_icon command without any pre-configured scope."
        },
        {
          "description": "Denies the fetch_data_store_identifiers command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-fetch-data-store-identifiers",
          "markdownDescription": "Denies the fetch_data_store_identifiers command without any pre-configured scope."
        },
        {
          "description": "Denies the identifier command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-identifier",
          "markdownDescription": "Denies the identifier command without any pre-configured scope."
        },
        {
          "description": "Denies the name command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-name",
          "markdownDescription": "Denies the name command without any pre-configured scope."
        },
        {
          "description": "Denies the register_listener command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-register-listener",
          "markdownDescription": "Denies the register_listener command without any pre-configured scope."
        },
        {
          "description": "Denies the remove_data_store command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-remove-data-store",
          "markdownDescription": "Denies the remove_data_store command without any pre-configured scope."
        },
        {
          "description": "Denies the remove_listener command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-remove-listener",
          "markdownDescription": "Denies the remove_listener command without any pre-configured scope."
        },
        {
          "description": "Denies the set_app_theme command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-set-app-theme",
          "markdownDescription": "Denies the set_app_theme command without any pre-configured scope."
        },
        {
          "description": "Denies the set_dock_visibility command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-set-dock-visibility",
          "markdownDescription": "Denies the set_dock_visibility command without any pre-configured scope."
        },
        {
          "description": "Denies the tauri_version command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-tauri-version",
          "markdownDescription": "Denies the tauri_version command without any pre-configured scope."
        },
        {
          "description": "Denies the version command without any pre-configured scope.",
          "type": "string",
          "const": "core:app:deny-version",
          "markdownDescription": "Denies the version command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-listen`\n- `allow-unlisten`\n- `allow-emit`\n- `allow-emit-to`",
          "type": "string",
          "const": "core:event:default",
          "markdownDescription": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-listen`\n- `allow-unlisten`\n- `allow-emit`\n- `allow-emit-to`"
        },
        {
          "description": "Enables the emit command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:allow-emit",
          "markdownDescription": "Enables the emit command without any pre-configured scope."
        },
        {
          "description": "Enables the emit_to command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:allow-emit-to",
          "markdownDescription": "Enables the emit_to command without any pre-configured scope."
        },
        {
          "description": "Enables the listen command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:allow-listen",
          "markdownDescription": "Enables the listen command without any pre-configured scope."
        },
        {
          "description": "Enables the unlisten command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:allow-unlisten",
          "markdownDescription": "Enables the unlisten command without any pre-configured scope."
        },
        {
          "description": "Denies the emit command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:deny-emit",
          "markdownDescription": "Denies the emit command without any pre-configured scope."
        },
        {
          "description": "Denies the emit_to command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:deny-emit-to",
          "markdownDescription": "Denies the emit_to command without any pre-configured scope."
        },
        {
          "description": "Denies the listen command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:deny-listen",
          "markdownDescription": "Denies the listen command without any pre-configured scope."
        },
        {
          "description": "Denies the unlisten command without any pre-configured scope.",
          "type": "string",
          "const": "core:event:deny-unlisten",
          "markdownDescription": "Denies the unlisten command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-new`\n- `allow-from-bytes`\n- `allow-from-path`\n- `allow-rgba`\n- `allow-size`",
          "type": "string",
          "const": "core:image:default",
          "markdownDescription": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-new`\n- `allow-from-bytes`\n- `allow-from-path`\n- `allow-rgba`\n- `allow-size`"
        },
        {
          "description": "Enables the from_bytes command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:allow-from-bytes",
          "markdownDescription": "Enables the from_bytes command without any pre-configured scope."
        },
        {
          "description": "Enables the from_path command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:allow-from-path",
          "markdownDescription": "Enables the from_path command without any pre-configured scope."
        },
        {
          "description": "Enables the new command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:allow-new",
          "markdownDescription": "Enables the new command without any pre-configured scope."
        },
        {
          "description": "Enables the rgba command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:allow-rgba",
          "markdownDescription": "Enables the rgba command without any pre-configured scope."
        },
        {
          "description": "Enables the size command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:allow-size",
          "markdownDescription": "Enables the size command without any pre-configured scope."
        },
        {
          "description": "Denies the from_bytes command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:deny-from-bytes",
          "markdownDescription": "Denies the from_bytes command without any pre-configured scope."
        },
        {
          "description": "Denies the from_path command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:deny-from-path",
          "markdownDescription": "Denies the from_path command without any pre-configured scope."
        },
        {
          "description": "Denies the new command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:deny-new",
          "markdownDescription": "Denies the new command without any pre-configured scope."
        },
        {
          "description": "Denies the rgba command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:deny-rgba",
          "markdownDescription": "Denies the rgba command without any pre-configured scope."
        },
        {
          "description": "Denies the size command without any pre-configured scope.",
          "type": "string",
          "const": "core:image:deny-size",
          "markdownDescription": "Denies the size command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-new`\n- `allow-append`\n- `allow-prepend`\n- `allow-insert`\n- `allow-remove`\n- `allow-remove-at`\n- `allow-items`\n- `allow-get`\n- `allow-popup`\n- `allow-create-default`\n- `allow-set-as-app-menu`\n- `allow-set-as-window-menu`\n- `allow-text`\n- `allow-set-text`\n- `allow-is-enabled`\n- `allow-set-enabled`\n- `allow-set-accelerator`\n- `allow-set-as-windows-menu-for-nsapp`\n- `allow-set-as-help-menu-for-nsapp`\n- `allow-is-checked`\n- `allow-set-checked`\n- `allow-set-icon`",
          "type": "string",
          "const": "core:menu:default",
          "markdownDescription": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-new`\n- `allow-append`\n- `allow-prepend`\n- `allow-insert`\n- `allow-remove`\n- `allow-remove-at`\n- `allow-items`\n- `allow-get`\n- `allow-popup`\n- `allow-create-default`\n- `allow-set-as-app-menu`\n- `allow-set-as-window-menu`\n- `allow-text`\n- `allow-set-text`\n- `allow-is-enabled`\n- `allow-set-enabled`\n- `allow-set-accelerator`\n- `allow-set-as-windows-menu-for-nsapp`\n- `allow-set-as-help-menu-for-nsapp`\n- `allow-is-checked`\n- `allow-set-checked`\n- `allow-set-icon`"
        },
        {
          "description": "Enables the append command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-append",
          "markdownDescription": "Enables the append command without any pre-configured scope."
        },
        {
          "description": "Enables the create_default command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-create-default",
          "markdownDescription": "Enables the create_default command without any pre-configured scope."
        },
        {
          "description": "Enables the get command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-get",
          "markdownDescription": "Enables the get command without any pre-configured scope."
        },
        {
          "description": "Enables the insert command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-insert",
          "markdownDescription": "Enables the insert command without any pre-configured scope."
        },
        {
          "description": "Enables the is_checked command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-is-checked",
          "markdownDescription": "Enables the is_checked command without any pre-configured scope."
        },
        {
          "description": "Enables the is_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-is-enabled",
          "markdownDescription": "Enables the is_enabled command without any pre-configured scope."
        },
        {
          "description": "Enables the items command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-items",
          "markdownDescription": "Enables the items command without any pre-configured scope."
        },
        {
          "description": "Enables the new command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-new",
          "markdownDescription": "Enables the new command without any pre-configured scope."
        },
        {
          "description": "Enables the popup command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-popup",
          "markdownDescription": "Enables the popup command without any pre-configured scope."
        },
        {
          "description": "Enables the prepend command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-prepend",
          "markdownDescription": "Enables the prepend command without any pre-configured scope."
        },
        {
          "description": "Enables the remove command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-remove",
          "markdownDescription": "Enables the remove command without any pre-configured scope."
        },
        {
          "description": "Enables the remove_at command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-remove-at",
          "markdownDescription": "Enables the remove_at command without any pre-configured scope."
        },
        {
          "description": "Enables the set_accelerator command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-accelerator",
          "markdownDescription": "Enables the set_accelerator command without any pre-configured scope."
        },
        {
          "description": "Enables the set_as_app_menu command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-as-app-menu",
          "markdownDescription": "Enables the set_as_app_menu command without any pre-configured scope."
        },
        {
          "description": "Enables the set_as_help_menu_for_nsapp command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-as-help-menu-for-nsapp",
          "markdownDescription": "Enables the set_as_help_menu_for_nsapp command without any pre-configured scope."
        },
        {
          "description": "Enables the set_as_window_menu command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-as-window-menu",
          "markdownDescription": "Enables the set_as_window_menu command without any pre-configured scope."
        },
        {
          "description": "Enables the set_as_windows_menu_for_nsapp command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-as-windows-menu-for-nsapp",
          "markdownDescription": "Enables the set_as_windows_menu_for_nsapp command without any pre-configured scope."
        },
        {
          "description": "Enables the set_checked command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-checked",
          "markdownDescription": "Enables the set_checked command without any pre-configured scope."
        },
        {
          "description": "Enables the set_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-enabled",
          "markdownDescription": "Enables the set_enabled command without any pre-configured scope."
        },
        {
          "description": "Enables the set_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-icon",
          "markdownDescription": "Enables the set_icon command without any pre-configured scope."
        },
        {
          "description": "Enables the set_text command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-set-text",
          "markdownDescription": "Enables the set_text command without any pre-configured scope."
        },
        {
          "description": "Enables the text command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:allow-text",
          "markdownDescription": "Enables the text command without any pre-configured scope."
        },
        {
          "description": "Denies the append command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-append",
          "markdownDescription": "Denies the append command without any pre-configured scope."
        },
        {
          "description": "Denies the create_default command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-create-default",
          "markdownDescription": "Denies the create_default command without any pre-configured scope."
        },
        {
          "description": "Denies the get command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-get",
          "markdownDescription": "Denies the get command without any pre-configured scope."
        },
        {
          "description": "Denies the insert command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-insert",
          "markdownDescription": "Denies the insert command without any pre-configured scope."
        },
        {
          "description": "Denies the is_checked command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-is-checked",
          "markdownDescription": "Denies the is_checked command without any pre-configured scope."
        },
        {
          "description": "Denies the is_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-is-enabled",
          "markdownDescription": "Denies the is_enabled command without any pre-configured scope."
        },
        {
          "description": "Denies the items command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-items",
          "markdownDescription": "Denies the items command without any pre-configured scope."
        },
        {
          "description": "Denies the new command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-new",
          "markdownDescription": "Denies the new command without any pre-configured scope."
        },
        {
          "description": "Denies the popup command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-popup",
          "markdownDescription": "Denies the popup command without any pre-configured scope."
        },
        {
          "description": "Denies the prepend command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-prepend",
          "markdownDescription": "Denies the prepend command without any pre-configured scope."
        },
        {
          "description": "Denies the remove command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-remove",
          "markdownDescription": "Denies the remove command without any pre-configured scope."
        },
        {
          "description": "Denies the remove_at command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-remove-at",
          "markdownDescription": "Denies the remove_at command without any pre-configured scope."
        },
        {
          "description": "Denies the set_accelerator command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-accelerator",
          "markdownDescription": "Denies the set_accelerator command without any pre-configured scope."
        },
        {
          "description": "Denies the set_as_app_menu command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-as-app-menu",
          "markdownDescription": "Denies the set_as_app_menu command without any pre-configured scope."
        },
        {
          "description": "Denies the set_as_help_menu_for_nsapp command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-as-help-menu-for-nsapp",
          "markdownDescription": "Denies the set_as_help_menu_for_nsapp command without any pre-configured scope."
        },
        {
          "description": "Denies the set_as_window_menu command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-as-window-menu",
          "markdownDescription": "Denies the set_as_window_menu command without any pre-configured scope."
        },
        {
          "description": "Denies the set_as_windows_menu_for_nsapp command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-as-windows-menu-for-nsapp",
          "markdownDescription": "Denies the set_as_windows_menu_for_nsapp command without any pre-configured scope."
        },
        {
          "description": "Denies the set_checked command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-checked",
          "markdownDescription": "Denies the set_checked command without any pre-configured scope."
        },
        {
          "description": "Denies the set_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-enabled",
          "markdownDescription": "Denies the set_enabled command without any pre-configured scope."
        },
        {
          "description": "Denies the set_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-icon",
          "markdownDescription": "Denies the set_icon command without any pre-configured scope."
        },
        {
          "description": "Denies the set_text command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-set-text",
          "markdownDescription": "Denies the set_text command without any pre-configured scope."
        },
        {
          "description": "Denies the text command without any pre-configured scope.",
          "type": "string",
          "const": "core:menu:deny-text",
          "markdownDescription": "Denies the text command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-resolve-directory`\n- `allow-resolve`\n- `allow-normalize`\n- `allow-join`\n- `allow-dirname`\n- `allow-extname`\n- `allow-basename`\n- `allow-is-absolute`",
          "type": "string",
          "const": "core:path:default",
          "markdownDescription": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-resolve-directory`\n- `allow-resolve`\n- `allow-normalize`\n- `allow-join`\n- `allow-dirname`\n- `allow-extname`\n- `allow-basename`\n- `allow-is-absolute`"
        },
        {
          "description": "Enables the basename command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-basename",
          "markdownDescription": "Enables the basename command without any pre-configured scope."
        },
        {
          "description": "Enables the dirname command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-dirname",
          "markdownDescription": "Enables the dirname command without any pre-configured scope."
        },
        {
          "description": "Enables the extname command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-extname",
          "markdownDescription": "Enables the extname command without any pre-configured scope."
        },
        {
          "description": "Enables the is_absolute command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-is-absolute",
          "markdownDescription": "Enables the is_absolute command without any pre-configured scope."
        },
        {
          "description": "Enables the join command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-join",
          "markdownDescription": "Enables the join command without any pre-configured scope."
        },
        {
          "description": "Enables the normalize command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-normalize",
          "markdownDescription": "Enables the normalize command without any pre-configured scope."
        },
        {
          "description": "Enables the resolve command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-resolve",
          "markdownDescription": "Enables the resolve command without any pre-configured scope."
        },
        {
          "description": "Enables the resolve_directory command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:allow-resolve-directory",
          "markdownDescription": "Enables the resolve_directory command without any pre-configured scope."
        },
        {
          "description": "Denies the basename command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-basename",
          "markdownDescription": "Denies the basename command without any pre-configured scope."
        },
        {
          "description": "Denies the dirname command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-dirname",
          "markdownDescription": "Denies the dirname command without any pre-configured scope."
        },
        {
          "description": "Denies the extname command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-extname",
          "markdownDescription": "Denies the extname command without any pre-configured scope."
        },
        {
          "description": "Denies the is_absolute command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-is-absolute",
          "markdownDescription": "Denies the is_absolute command without any pre-configured scope."
        },
        {
          "description": "Denies the join command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-join",
          "markdownDescription": "Denies the join command without any pre-configured scope."
        },
        {
          "description": "Denies the normalize command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-normalize",
          "markdownDescription": "Denies the normalize command without any pre-configured scope."
        },
        {
          "description": "Denies the resolve command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-resolve",
          "markdownDescription": "Denies the resolve command without any pre-configured scope."
        },
        {
          "description": "Denies the resolve_directory command without any pre-configured scope.",
          "type": "string",
          "const": "core:path:deny-resolve-directory",
          "markdownDescription": "Denies the resolve_directory command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-close`",
          "type": "string",
          "const": "core:resources:default",
          "markdownDescription": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-close`"
        },
        {
          "description": "Enables the close command without any pre-configured scope.",
          "type": "string",
          "const": "core:resources:allow-close",
          "markdownDescription": "Enables the close command without any pre-configured scope."
        },
        {
          "description": "Denies the close command without any pre-configured scope.",
          "type": "string",
          "const": "core:resources:deny-close",
          "markdownDescription": "Denies the close command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-new`\n- `allow-get-by-id`\n- `allow-remove-by-id`\n- `allow-set-icon`\n- `allow-set-menu`\n- `allow-set-tooltip`\n- `allow-set-title`\n- `allow-set-visible`\n- `allow-set-temp-dir-path`\n- `allow-set-icon-as-template`\n- `allow-set-show-menu-on-left-click`",
          "type": "string",
          "const": "core:tray:default",
          "markdownDescription": "Default permissions for the plugin, which enables all commands.\n#### This default permission set includes:\n\n- `allow-new`\n- `allow-get-by-id`\n- `allow-remove-by-id`\n- `allow-set-icon`\n- `allow-set-menu`\n- `allow-set-tooltip`\n- `allow-set-title`\n- `allow-set-visible`\n- `allow-set-temp-dir-path`\n- `allow-set-icon-as-template`\n- `allow-set-show-menu-on-left-click`"
        },
        {
          "description": "Enables the get_by_id command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-get-by-id",
          "markdownDescription": "Enables the get_by_id command without any pre-configured scope."
        },
        {
          "description": "Enables the new command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-new",
          "markdownDescription": "Enables the new command without any pre-configured scope."
        },
        {
          "description": "Enables the remove_by_id command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-remove-by-id",
          "markdownDescription": "Enables the remove_by_id command without any pre-configured scope."
        },
        {
          "description": "Enables the set_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-icon",
          "markdownDescription": "Enables the set_icon command without any pre-configured scope."
        },
        {
          "description": "Enables the set_icon_as_template command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-icon-as-template",
          "markdownDescription": "Enables the set_icon_as_template command without any pre-configured scope."
        },
        {
          "description": "Enables the set_menu command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-menu",
          "markdownDescription": "Enables the set_menu command without any pre-configured scope."
        },
        {
          "description": "Enables the set_show_menu_on_left_click command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-show-menu-on-left-click",
          "markdownDescription": "Enables the set_show_menu_on_left_click command without any pre-configured scope."
        },
        {
          "description": "Enables the set_temp_dir_path command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-temp-dir-path",
          "markdownDescription": "Enables the set_temp_dir_path command without any pre-configured scope."
        },
        {
          "description": "Enables the set_title command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-title",
          "markdownDescription": "Enables the set_title command without any pre-configured scope."
        },
        {
          "description": "Enables the set_tooltip command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-tooltip",
          "markdownDescription": "Enables the set_tooltip command without any pre-configured scope."
        },
        {
          "description": "Enables the set_visible command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:allow-set-visible",
          "markdownDescription": "Enables the set_visible command without any pre-configured scope."
        },
        {
          "description": "Denies the get_by_id command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-get-by-id",
          "markdownDescription": "Denies the get_by_id command without any pre-configured scope."
        },
        {
          "description": "Denies the new command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-new",
          "markdownDescription": "Denies the new command without any pre-configured scope."
        },
        {
          "description": "Denies the remove_by_id command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-remove-by-id",
          "markdownDescription": "Denies the remove_by_id command without any pre-configured scope."
        },
        {
          "description": "Denies the set_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-icon",
          "markdownDescription": "Denies the set_icon command without any pre-configured scope."
        },
        {
          "description": "Denies the set_icon_as_template command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-icon-as-template",
          "markdownDescription": "Denies the set_icon_as_template command without any pre-configured scope."
        },
        {
          "description": "Denies the set_menu command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-menu",
          "markdownDescription": "Denies the set_menu command without any pre-configured scope."
        },
        {
          "description": "Denies the set_show_menu_on_left_click command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-show-menu-on-left-click",
          "markdownDescription": "Denies the set_show_menu_on_left_click command without any pre-configured scope."
        },
        {
          "description": "Denies the set_temp_dir_path command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-temp-dir-path",
          "markdownDescription": "Denies the set_temp_dir_path command without any pre-configured scope."
        },
        {
          "description": "Denies the set_title command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-title",
          "markdownDescription": "Denies the set_title command without any pre-configured scope."
        },
        {
          "description": "Denies the set_tooltip command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-tooltip",
          "markdownDescription": "Denies the set_tooltip command without any pre-configured scope."
        },
        {
          "description": "Denies the set_visible command without any pre-configured scope.",
          "type": "string",
          "const": "core:tray:deny-set-visible",
          "markdownDescription": "Denies the set_visible command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin.\n#### This default permission set includes:\n\n- `allow-get-all-webviews`\n- `allow-webview-position`\n- `allow-webview-size`\n- `allow-internal-toggle-devtools`",
          "type": "string",
          "const": "core:webview:default",
          "markdownDescription": "Default permissions for the plugin.\n#### This default permission set includes:\n\n- `allow-get-all-webviews`\n- `allow-webview-position`\n- `allow-webview-size`\n- `allow-internal-toggle-devtools`"
        },
        {
          "description": "Enables the clear_all_browsing_data command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-clear-all-browsing-data",
          "markdownDescription": "Enables the clear_all_browsing_data command without any pre-configured scope."
        },
        {
          "description": "Enables the create_webview command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-create-webview",
          "markdownDescription": "Enables the create_webview command without any pre-configured scope."
        },
        {
          "description": "Enables the create_webview_window command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-create-webview-window",
          "markdownDescription": "Enables the create_webview_window command without any pre-configured scope."
        },
        {
          "description": "Enables the get_all_webviews command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-get-all-webviews",
          "markdownDescription": "Enables the get_all_webviews command without any pre-configured scope."
        },
        {
          "description": "Enables the internal_toggle_devtools command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-internal-toggle-devtools",
          "markdownDescription": "Enables the internal_toggle_devtools command without any pre-configured scope."
        },
        {
          "description": "Enables the print command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-print",
          "markdownDescription": "Enables the print command without any pre-configured scope."
        },
        {
          "description": "Enables the reparent command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-reparent",
          "markdownDescription": "Enables the reparent command without any pre-configured scope."
        },
        {
          "description": "Enables the set_webview_auto_resize command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-set-webview-auto-resize",
          "markdownDescription": "Enables the set_webview_auto_resize command without any pre-configured scope."
        },
        {
          "description": "Enables the set_webview_background_color command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-set-webview-background-color",
          "markdownDescription": "Enables the set_webview_background_color command without any pre-configured scope."
        },
        {
          "description": "Enables the set_webview_focus command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-set-webview-focus",
          "markdownDescription": "Enables the set_webview_focus command without any pre-configured scope."
        },
        {
          "description": "Enables the set_webview_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-set-webview-position",
          "markdownDescription": "Enables the set_webview_position command without any pre-configured scope."
        },
        {
          "description": "Enables the set_webview_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-set-webview-size",
          "markdownDescription": "Enables the set_webview_size command without any pre-configured scope."
        },
        {
          "description": "Enables the set_webview_zoom command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-set-webview-zoom",
          "markdownDescription": "Enables the set_webview_zoom command without any pre-configured scope."
        },
        {
          "description": "Enables the webview_close command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-webview-close",
          "markdownDescription": "Enables the webview_close command without any pre-configured scope."
        },
        {
          "description": "Enables the webview_hide command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-webview-hide",
          "markdownDescription": "Enables the webview_hide command without any pre-configured scope."
        },
        {
          "description": "Enables the webview_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-webview-position",
          "markdownDescription": "Enables the webview_position command without any pre-configured scope."
        },
        {
          "description": "Enables the webview_show command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-webview-show",
          "markdownDescription": "Enables the webview_show command without any pre-configured scope."
        },
        {
          "description": "Enables the webview_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:allow-webview-size",
          "markdownDescription": "Enables the webview_size command without any pre-configured scope."
        },
        {
          "description": "Denies the clear_all_browsing_data command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-clear-all-browsing-data",
          "markdownDescription": "Denies the clear_all_browsing_data command without any pre-configured scope."
        },
        {
          "description": "Denies the create_webview command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-create-webview",
          "markdownDescription": "Denies the create_webview command without any pre-configured scope."
        },
        {
          "description": "Denies the create_webview_window command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-create-webview-window",
          "markdownDescription": "Denies the create_webview_window command without any pre-configured scope."
        },
        {
          "description": "Denies the get_all_webviews command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-get-all-webviews",
          "markdownDescription": "Denies the get_all_webviews command without any pre-configured scope."
        },
        {
          "description": "Denies the internal_toggle_devtools command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-internal-toggle-devtools",
          "markdownDescription": "Denies the internal_toggle_devtools command without any pre-configured scope."
        },
        {
          "description": "Denies the print command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-print",
          "markdownDescription": "Denies the print command without any pre-configured scope."
        },
        {
          "description": "Denies the reparent command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-reparent",
          "markdownDescription": "Denies the reparent command without any pre-configured scope."
        },
        {
          "description": "Denies the set_webview_auto_resize command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-set-webview-auto-resize",
          "markdownDescription": "Denies the set_webview_auto_resize command without any pre-configured scope."
        },
        {
          "description": "Denies the set_webview_background_color command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-set-webview-background-color",
          "markdownDescription": "Denies the set_webview_background_color command without any pre-configured scope."
        },
        {
          "description": "Denies the set_webview_focus command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-set-webview-focus",
          "markdownDescription": "Denies the set_webview_focus command without any pre-configured scope."
        },
        {
          "description": "Denies the set_webview_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-set-webview-position",
          "markdownDescription": "Denies the set_webview_position command without any pre-configured scope."
        },
        {
          "description": "Denies the set_webview_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-set-webview-size",
          "markdownDescription": "Denies the set_webview_size command without any pre-configured scope."
        },
        {
          "description": "Denies the set_webview_zoom command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-set-webview-zoom",
          "markdownDescription": "Denies the set_webview_zoom command without any pre-configured scope."
        },
        {
          "description": "Denies the webview_close command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-webview-close",
          "markdownDescription": "Denies the webview_close command without any pre-configured scope."
        },
        {
          "description": "Denies the webview_hide command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-webview-hide",
          "markdownDescription": "Denies the webview_hide command without any pre-configured scope."
        },
        {
          "description": "Denies the webview_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-webview-position",
          "markdownDescription": "Denies the webview_position command without any pre-configured scope."
        },
        {
          "description": "Denies the webview_show command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-webview-show",
          "markdownDescription": "Denies the webview_show command without any pre-configured scope."
        },
        {
          "description": "Denies the webview_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:webview:deny-webview-size",
          "markdownDescription": "Denies the webview_size command without any pre-configured scope."
        },
        {
          "description": "Default permissions for the plugin.\n#### This default permission set includes:\n\n- `allow-get-all-windows`\n- `allow-scale-factor`\n- `allow-inner-position`\n- `allow-outer-position`\n- `allow-inner-size`\n- `allow-outer-size`\n- `allow-is-fullscreen`\n- `allow-is-minimized`\n- `allow-is-maximized`\n- `allow-is-focused`\n- `allow-is-decorated`\n- `allow-is-resizable`\n- `allow-is-maximizable`\n- `allow-is-minimizable`\n- `allow-is-closable`\n- `allow-is-visible`\n- `allow-is-enabled`\n- `allow-title`\n- `allow-current-monitor`\n- `allow-primary-monitor`\n- `allow-monitor-from-point`\n- `allow-available-monitors`\n- `allow-cursor-position`\n- `allow-theme`\n- `allow-is-always-on-top`\n- `allow-internal-toggle-maximize`",
          "type": "string",
          "const": "core:window:default",
          "markdownDescription": "Default permissions for the plugin.\n#### This default permission set includes:\n\n- `allow-get-all-windows`\n- `allow-scale-factor`\n- `allow-inner-position`\n- `allow-outer-position`\n- `allow-inner-size`\n- `allow-outer-size`\n- `allow-is-fullscreen`\n- `allow-is-minimized`\n- `allow-is-maximized`\n- `allow-is-focused`\n- `allow-is-decorated`\n- `allow-is-resizable`\n- `allow-is-maximizable`\n- `allow-is-minimizable`\n- `allow-is-closable`\n- `allow-is-visible`\n- `allow-is-enabled`\n- `allow-title`\n- `allow-current-monitor`\n- `allow-primary-monitor`\n- `allow-monitor-from-point`\n- `allow-available-monitors`\n- `allow-cursor-position`\n- `allow-theme`\n- `allow-is-always-on-top`\n- `allow-internal-toggle-maximize`"
        },
        {
          "description": "Enables the available_monitors command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-available-monitors",
          "markdownDescription": "Enables the available_monitors command without any pre-configured scope."
        },
        {
          "description": "Enables the center command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-center",
          "markdownDescription": "Enables the center command without any pre-configured scope."
        },
        {
          "description": "Enables the close command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-close",
          "markdownDescription": "Enables the close command without any pre-configured scope."
        },
        {
          "description": "Enables the create command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-create",
          "markdownDescription": "Enables the create command without any pre-configured scope."
        },
        {
          "description": "Enables the current_monitor command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-current-monitor",
          "markdownDescription": "Enables the current_monitor command without any pre-configured scope."
        },
        {
          "description": "Enables the cursor_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-cursor-position",
          "markdownDescription": "Enables the cursor_position command without any pre-configured scope."
        },
        {
          "description": "Enables the destroy command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-destroy",
          "markdownDescription": "Enables the destroy command without any pre-configured scope."
        },
        {
          "description": "Enables the get_all_windows command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-get-all-windows",
          "markdownDescription": "Enables the get_all_windows command without any pre-configured scope."
        },
        {
          "description": "Enables the hide command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-hide",
          "markdownDescription": "Enables the hide command without any pre-configured scope."
        },
        {
          "description": "Enables the inner_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-inner-position",
          "markdownDescription": "Enables the inner_position command without any pre-configured scope."
        },
        {
          "description": "Enables the inner_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-inner-size",
          "markdownDescription": "Enables the inner_size command without any pre-configured scope."
        },
        {
          "description": "Enables the internal_toggle_maximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-internal-toggle-maximize",
          "markdownDescription": "Enables the internal_toggle_maximize command without any pre-configured scope."
        },
        {
          "description": "Enables the is_always_on_top command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-always-on-top",
          "markdownDescription": "Enables the is_always_on_top command without any pre-configured scope."
        },
        {
          "description": "Enables the is_closable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-closable",
          "markdownDescription": "Enables the is_closable command without any pre-configured scope."
        },
        {
          "description": "Enables the is_decorated command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-decorated",
          "markdownDescription": "Enables the is_decorated command without any pre-configured scope."
        },
        {
          "description": "Enables the is_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-enabled",
          "markdownDescription": "Enables the is_enabled command without any pre-configured scope."
        },
        {
          "description": "Enables the is_focused command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-focused",
          "markdownDescription": "Enables the is_focused command without any pre-configured scope."
        },
        {
          "description": "Enables the is_fullscreen command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-fullscreen",
          "markdownDescription": "Enables the is_fullscreen command without any pre-configured scope."
        },
        {
          "description": "Enables the is_maximizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-maximizable",
          "markdownDescription": "Enables the is_maximizable command without any pre-configured scope."
        },
        {
          "description": "Enables the is_maximized command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-maximized",
          "markdownDescription": "Enables the is_maximized command without any pre-configured scope."
        },
        {
          "description": "Enables the is_minimizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-minimizable",
          "markdownDescription": "Enables the is_minimizable command without any pre-configured scope."
        },
        {
          "description": "Enables the is_minimized command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-minimized",
          "markdownDescription": "Enables the is_minimized command without any pre-configured scope."
        },
        {
          "description": "Enables the is_resizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-resizable",
          "markdownDescription": "Enables the is_resizable command without any pre-configured scope."
        },
        {
          "description": "Enables the is_visible command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-is-visible",
          "markdownDescription": "Enables the is_visible command without any pre-configured scope."
        },
        {
          "description": "Enables the maximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-maximize",
          "markdownDescription": "Enables the maximize command without any pre-configured scope."
        },
        {
          "description": "Enables the minimize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-minimize",
          "markdownDescription": "Enables the minimize command without any pre-configured scope."
        },
        {
          "description": "Enables the monitor_from_point command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-monitor-from-point",
          "markdownDescription": "Enables the monitor_from_point command without any pre-configured scope."
        },
        {
          "description": "Enables the outer_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-outer-position",
          "markdownDescription": "Enables the outer_position command without any pre-configured scope."
        },
        {
          "description": "Enables the outer_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-outer-size",
          "markdownDescription": "Enables the outer_size command without any pre-configured scope."
        },
        {
          "description": "Enables the primary_monitor command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-primary-monitor",
          "markdownDescription": "Enables the primary_monitor command without any pre-configured scope."
        },
        {
          "description": "Enables the request_user_attention command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-request-user-attention",
          "markdownDescription": "Enables the request_user_attention command without any pre-configured scope."
        },
        {
          "description": "Enables the scale_factor command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-scale-factor",
          "markdownDescription": "Enables the scale_factor command without any pre-configured scope."
        },
        {
          "description": "Enables the set_always_on_bottom command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-always-on-bottom",
          "markdownDescription": "Enables the set_always_on_bottom command without any pre-configured scope."
        },
        {
          "description": "Enables the set_always_on_top command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-always-on-top",
          "markdownDescription": "Enables the set_always_on_top command without any pre-configured scope."
        },
        {
          "description": "Enables the set_background_color command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-background-color",
          "markdownDescription": "Enables the set_background_color command without any pre-configured scope."
        },
        {
          "description": "Enables the set_badge_count command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-badge-count",
          "markdownDescription": "Enables the set_badge_count command without any pre-configured scope."
        },
        {
          "description": "Enables the set_badge_label command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-badge-label",
          "markdownDescription": "Enables the set_badge_label command without any pre-configured scope."
        },
        {
          "description": "Enables the set_closable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-closable",
          "markdownDescription": "Enables the set_closable command without any pre-configured scope."
        },
        {
          "description": "Enables the set_content_protected command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-content-protected",
          "markdownDescription": "Enables the set_content_protected command without any pre-configured scope."
        },
        {
          "description": "Enables the set_cursor_grab command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-cursor-grab",
          "markdownDescription": "Enables the set_cursor_grab command without any pre-configured scope."
        },
        {
          "description": "Enables the set_cursor_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-cursor-icon",
          "markdownDescription": "Enables the set_cursor_icon command without any pre-configured scope."
        },
        {
          "description": "Enables the set_cursor_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-cursor-position",
          "markdownDescription": "Enables the set_cursor_position command without any pre-configured scope."
        },
        {
          "description": "Enables the set_cursor_visible command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-cursor-visible",
          "markdownDescription": "Enables the set_cursor_visible command without any pre-configured scope."
        },
        {
          "description": "Enables the set_decorations command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-decorations",
          "markdownDescription": "Enables the set_decorations command without any pre-configured scope."
        },
        {
          "description": "Enables the set_effects command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-effects",
          "markdownDescription": "Enables the set_effects command without any pre-configured scope."
        },
        {
          "description": "Enables the set_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-enabled",
          "markdownDescription": "Enables the set_enabled command without any pre-configured scope."
        },
        {
          "description": "Enables the set_focus command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-focus",
          "markdownDescription": "Enables the set_focus command without any pre-configured scope."
        },
        {
          "description": "Enables the set_focusable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-focusable",
          "markdownDescription": "Enables the set_focusable command without any pre-configured scope."
        },
        {
          "description": "Enables the set_fullscreen command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-fullscreen",
          "markdownDescription": "Enables the set_fullscreen command without any pre-configured scope."
        },
        {
          "description": "Enables the set_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-icon",
          "markdownDescription": "Enables the set_icon command without any pre-configured scope."
        },
        {
          "description": "Enables the set_ignore_cursor_events command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-ignore-cursor-events",
          "markdownDescription": "Enables the set_ignore_cursor_events command without any pre-configured scope."
        },
        {
          "description": "Enables the set_max_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-max-size",
          "markdownDescription": "Enables the set_max_size command without any pre-configured scope."
        },
        {
          "description": "Enables the set_maximizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-maximizable",
          "markdownDescription": "Enables the set_maximizable command without any pre-configured scope."
        },
        {
          "description": "Enables the set_min_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-min-size",
          "markdownDescription": "Enables the set_min_size command without any pre-configured scope."
        },
        {
          "description": "Enables the set_minimizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-minimizable",
          "markdownDescription": "Enables the set_minimizable command without any pre-configured scope."
        },
        {
          "description": "Enables the set_overlay_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-overlay-icon",
          "markdownDescription": "Enables the set_overlay_icon command without any pre-configured scope."
        },
        {
          "description": "Enables the set_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-position",
          "markdownDescription": "Enables the set_position command without any pre-configured scope."
        },
        {
          "description": "Enables the set_progress_bar command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-progress-bar",
          "markdownDescription": "Enables the set_progress_bar command without any pre-configured scope."
        },
        {
          "description": "Enables the set_resizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-resizable",
          "markdownDescription": "Enables the set_resizable command without any pre-configured scope."
        },
        {
          "description": "Enables the set_shadow command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-shadow",
          "markdownDescription": "Enables the set_shadow command without any pre-configured scope."
        },
        {
          "description": "Enables the set_simple_fullscreen command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-simple-fullscreen",
          "markdownDescription": "Enables the set_simple_fullscreen command without any pre-configured scope."
        },
        {
          "description": "Enables the set_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-size",
          "markdownDescription": "Enables the set_size command without any pre-configured scope."
        },
        {
          "description": "Enables the set_size_constraints command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-size-constraints",
          "markdownDescription": "Enables the set_size_constraints command without any pre-configured scope."
        },
        {
          "description": "Enables the set_skip_taskbar command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-skip-taskbar",
          "markdownDescription": "Enables the set_skip_taskbar command without any pre-configured scope."
        },
        {
          "description": "Enables the set_theme command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-theme",
          "markdownDescription": "Enables the set_theme command without any pre-configured scope."
        },
        {
          "description": "Enables the set_title command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-title",
          "markdownDescription": "Enables the set_title command without any pre-configured scope."
        },
        {
          "description": "Enables the set_title_bar_style command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-title-bar-style",
          "markdownDescription": "Enables the set_title_bar_style command without any pre-configured scope."
        },
        {
          "description": "Enables the set_visible_on_all_workspaces command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-set-visible-on-all-workspaces",
          "markdownDescription": "Enables the set_visible_on_all_workspaces command without any pre-configured scope."
        },
        {
          "description": "Enables the show command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-show",
          "markdownDescription": "Enables the show command without any pre-configured scope."
        },
        {
          "description": "Enables the start_dragging command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-start-dragging",
          "markdownDescription": "Enables the start_dragging command without any pre-configured scope."
        },
        {
          "description": "Enables the start_resize_dragging command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-start-resize-dragging",
          "markdownDescription": "Enables the start_resize_dragging command without any pre-configured scope."
        },
        {
          "description": "Enables the theme command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-theme",
          "markdownDescription": "Enables the theme command without any pre-configured scope."
        },
        {
          "description": "Enables the title command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-title",
          "markdownDescription": "Enables the title command without any pre-configured scope."
        },
        {
          "description": "Enables the toggle_maximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-toggle-maximize",
          "markdownDescription": "Enables the toggle_maximize command without any pre-configured scope."
        },
        {
          "description": "Enables the unmaximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-unmaximize",
          "markdownDescription": "Enables the unmaximize command without any pre-configured scope."
        },
        {
          "description": "Enables the unminimize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:allow-unminimize",
          "markdownDescription": "Enables the unminimize command without any pre-configured scope."
        },
        {
          "description": "Denies the available_monitors command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-available-monitors",
          "markdownDescription": "Denies the available_monitors command without any pre-configured scope."
        },
        {
          "description": "Denies the center command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-center",
          "markdownDescription": "Denies the center command without any pre-configured scope."
        },
        {
          "description": "Denies the close command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-close",
          "markdownDescription": "Denies the close command without any pre-configured scope."
        },
        {
          "description": "Denies the create command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-create",
          "markdownDescription": "Denies the create command without any pre-configured scope."
        },
        {
          "description": "Denies the current_monitor command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-current-monitor",
          "markdownDescription": "Denies the current_monitor command without any pre-configured scope."
        },
        {
          "description": "Denies the cursor_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-cursor-position",
          "markdownDescription": "Denies the cursor_position command without any pre-configured scope."
        },
        {
          "description": "Denies the destroy command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-destroy",
          "markdownDescription": "Denies the destroy command without any pre-configured scope."
        },
        {
          "description": "Denies the get_all_windows command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-get-all-windows",
          "markdownDescription": "Denies the get_all_windows command without any pre-configured scope."
        },
        {
          "description": "Denies the hide command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-hide",
          "markdownDescription": "Denies the hide command without any pre-configured scope."
        },
        {
          "description": "Denies the inner_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-inner-position",
          "markdownDescription": "Denies the inner_position command without any pre-configured scope."
        },
        {
          "description": "Denies the inner_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-inner-size",
          "markdownDescription": "Denies the inner_size command without any pre-configured scope."
        },
        {
          "description": "Denies the internal_toggle_maximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-internal-toggle-maximize",
          "markdownDescription": "Denies the internal_toggle_maximize command without any pre-configured scope."
        },
        {
          "description": "Denies the is_always_on_top command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-always-on-top",
          "markdownDescription": "Denies the is_always_on_top command without any pre-configured scope."
        },
        {
          "description": "Denies the is_closable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-closable",
          "markdownDescription": "Denies the is_closable command without any pre-configured scope."
        },
        {
          "description": "Denies the is_decorated command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-decorated",
          "markdownDescription": "Denies the is_decorated command without any pre-configured scope."
        },
        {
          "description": "Denies the is_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-enabled",
          "markdownDescription": "Denies the is_enabled command without any pre-configured scope."
        },
        {
          "description": "Denies the is_focused command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-focused",
          "markdownDescription": "Denies the is_focused command without any pre-configured scope."
        },
        {
          "description": "Denies the is_fullscreen command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-fullscreen",
          "markdownDescription": "Denies the is_fullscreen command without any pre-configured scope."
        },
        {
          "description": "Denies the is_maximizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-maximizable",
          "markdownDescription": "Denies the is_maximizable command without any pre-configured scope."
        },
        {
          "description": "Denies the is_maximized command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-maximized",
          "markdownDescription": "Denies the is_maximized command without any pre-configured scope."
        },
        {
          "description": "Denies the is_minimizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-minimizable",
          "markdownDescription": "Denies the is_minimizable command without any pre-configured scope."
        },
        {
          "description": "Denies the is_minimized command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-minimized",
          "markdownDescription": "Denies the is_minimized command without any pre-configured scope."
        },
        {
          "description": "Denies the is_resizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-resizable",
          "markdownDescription": "Denies the is_resizable command without any pre-configured scope."
        },
        {
          "description": "Denies the is_visible command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-is-visible",
          "markdownDescription": "Denies the is_visible command without any pre-configured scope."
        },
        {
          "description": "Denies the maximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-maximize",
          "markdownDescription": "Denies the maximize command without any pre-configured scope."
        },
        {
          "description": "Denies the minimize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-minimize",
          "markdownDescription": "Denies the minimize command without any pre-configured scope."
        },
        {
          "description": "Denies the monitor_from_point command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-monitor-from-point",
          "markdownDescription": "Denies the monitor_from_point command without any pre-configured scope."
        },
        {
          "description": "Denies the outer_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-outer-position",
          "markdownDescription": "Denies the outer_position command without any pre-configured scope."
        },
        {
          "description": "Denies the outer_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-outer-size",
          "markdownDescription": "Denies the outer_size command without any pre-configured scope."
        },
        {
          "description": "Denies the primary_monitor command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-primary-monitor",
          "markdownDescription": "Denies the primary_monitor command without any pre-configured scope."
        },
        {
          "description": "Denies the request_user_attention command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-request-user-attention",
          "markdownDescription": "Denies the request_user_attention command without any pre-configured scope."
        },
        {
          "description": "Denies the scale_factor command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-scale-factor",
          "markdownDescription": "Denies the scale_factor command without any pre-configured scope."
        },
        {
          "description": "Denies the set_always_on_bottom command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-always-on-bottom",
          "markdownDescription": "Denies the set_always_on_bottom command without any pre-configured scope."
        },
        {
          "description": "Denies the set_always_on_top command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-always-on-top",
          "markdownDescription": "Denies the set_always_on_top command without any pre-configured scope."
        },
        {
          "description": "Denies the set_background_color command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-background-color",
          "markdownDescription": "Denies the set_background_color command without any pre-configured scope."
        },
        {
          "description": "Denies the set_badge_count command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-badge-count",
          "markdownDescription": "Denies the set_badge_count command without any pre-configured scope."
        },
        {
          "description": "Denies the set_badge_label command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-badge-label",
          "markdownDescription": "Denies the set_badge_label command without any pre-configured scope."
        },
        {
          "description": "Denies the set_closable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-closable",
          "markdownDescription": "Denies the set_closable command without any pre-configured scope."
        },
        {
          "description": "Denies the set_content_protected command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-content-protected",
          "markdownDescription": "Denies the set_content_protected command without any pre-configured scope."
        },
        {
          "description": "Denies the set_cursor_grab command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-cursor-grab",
          "markdownDescription": "Denies the set_cursor_grab command without any pre-configured scope."
        },
        {
          "description": "Denies the set_cursor_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-cursor-icon",
          "markdownDescription": "Denies the set_cursor_icon command without any pre-configured scope."
        },
        {
          "description": "Denies the set_cursor_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-cursor-position",
          "markdownDescription": "Denies the set_cursor_position command without any pre-configured scope."
        },
        {
          "description": "Denies the set_cursor_visible command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-cursor-visible",
          "markdownDescription": "Denies the set_cursor_visible command without any pre-configured scope."
        },
        {
          "description": "Denies the set_decorations command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-decorations",
          "markdownDescription": "Denies the set_decorations command without any pre-configured scope."
        },
        {
          "description": "Denies the set_effects command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-effects",
          "markdownDescription": "Denies the set_effects command without any pre-configured scope."
        },
        {
          "description": "Denies the set_enabled command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-enabled",
          "markdownDescription": "Denies the set_enabled command without any pre-configured scope."
        },
        {
          "description": "Denies the set_focus command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-focus",
          "markdownDescription": "Denies the set_focus command without any pre-configured scope."
        },
        {
          "description": "Denies the set_focusable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-focusable",
          "markdownDescription": "Denies the set_focusable command without any pre-configured scope."
        },
        {
          "description": "Denies the set_fullscreen command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-fullscreen",
          "markdownDescription": "Denies the set_fullscreen command without any pre-configured scope."
        },
        {
          "description": "Denies the set_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-icon",
          "markdownDescription": "Denies the set_icon command without any pre-configured scope."
        },
        {
          "description": "Denies the set_ignore_cursor_events command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-ignore-cursor-events",
          "markdownDescription": "Denies the set_ignore_cursor_events command without any pre-configured scope."
        },
        {
          "description": "Denies the set_max_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-max-size",
          "markdownDescription": "Denies the set_max_size command without any pre-configured scope."
        },
        {
          "description": "Denies the set_maximizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-maximizable",
          "markdownDescription": "Denies the set_maximizable command without any pre-configured scope."
        },
        {
          "description": "Denies the set_min_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-min-size",
          "markdownDescription": "Denies the set_min_size command without any pre-configured scope."
        },
        {
          "description": "Denies the set_minimizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-minimizable",
          "markdownDescription": "Denies the set_minimizable command without any pre-configured scope."
        },
        {
          "description": "Denies the set_overlay_icon command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-overlay-icon",
          "markdownDescription": "Denies the set_overlay_icon command without any pre-configured scope."
        },
        {
          "description": "Denies the set_position command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-position",
          "markdownDescription": "Denies the set_position command without any pre-configured scope."
        },
        {
          "description": "Denies the set_progress_bar command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-progress-bar",
          "markdownDescription": "Denies the set_progress_bar command without any pre-configured scope."
        },
        {
          "description": "Denies the set_resizable command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-resizable",
          "markdownDescription": "Denies the set_resizable command without any pre-configured scope."
        },
        {
          "description": "Denies the set_shadow command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-shadow",
          "markdownDescription": "Denies the set_shadow command without any pre-configured scope."
        },
        {
          "description": "Denies the set_simple_fullscreen command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-simple-fullscreen",
          "markdownDescription": "Denies the set_simple_fullscreen command without any pre-configured scope."
        },
        {
          "description": "Denies the set_size command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-size",
          "markdownDescription": "Denies the set_size command without any pre-configured scope."
        },
        {
          "description": "Denies the set_size_constraints command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-size-constraints",
          "markdownDescription": "Denies the set_size_constraints command without any pre-configured scope."
        },
        {
          "description": "Denies the set_skip_taskbar command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-skip-taskbar",
          "markdownDescription": "Denies the set_skip_taskbar command without any pre-configured scope."
        },
        {
          "description": "Denies the set_theme command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-theme",
          "markdownDescription": "Denies the set_theme command without any pre-configured scope."
        },
        {
          "description": "Denies the set_title command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-title",
          "markdownDescription": "Denies the set_title command without any pre-configured scope."
        },
        {
          "description": "Denies the set_title_bar_style command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-title-bar-style",
          "markdownDescription": "Denies the set_title_bar_style command without any pre-configured scope."
        },
        {
          "description": "Denies the set_visible_on_all_workspaces command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-set-visible-on-all-workspaces",
          "markdownDescription": "Denies the set_visible_on_all_workspaces command without any pre-configured scope."
        },
        {
          "description": "Denies the show command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-show",
          "markdownDescription": "Denies the show command without any pre-configured scope."
        },
        {
          "description": "Denies the start_dragging command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-start-dragging",
          "markdownDescription": "Denies the start_dragging command without any pre-configured scope."
        },
        {
          "description": "Denies the start_resize_dragging command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-start-resize-dragging",
          "markdownDescription": "Denies the start_resize_dragging command without any pre-configured scope."
        },
        {
          "description": "Denies the theme command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-theme",
          "markdownDescription": "Denies the theme command without any pre-configured scope."
        },
        {
          "description": "Denies the title command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-title",
          "markdownDescription": "Denies the title command without any pre-configured scope."
        },
        {
          "description": "Denies the toggle_maximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-toggle-maximize",
          "markdownDescription": "Denies the toggle_maximize command without any pre-configured scope."
        },
        {
          "description": "Denies the unmaximize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-unmaximize",
          "markdownDescription": "Denies the unmaximize command without any pre-configured scope."
        },
        {
          "description": "Denies the unminimize command without any pre-configured scope.",
          "type": "string",
          "const": "core:window:deny-unminimize",
          "markdownDescription": "Denies the unminimize command without any pre-configured scope."
        },
        {
          "description": "This permission set configures which\nnotification features are by default exposed.\n\n#### Granted Permissions\n\nIt allows all notification related features.\n\n\n#### This default permission set includes:\n\n- `allow-is-permission-granted`\n- `allow-request-permission`\n- `allow-notify`\n- `allow-register-action-types`\n- `allow-register-listener`\n- `allow-cancel`\n- `allow-get-pending`\n- `allow-remove-active`\n- `allow-get-active`\n- `allow-check-permissions`\n- `allow-show`\n- `allow-batch`\n- `allow-list-channels`\n- `allow-delete-channel`\n- `allow-create-channel`\n- `allow-permission-state`",
          "type": "string",
          "const": "notification:default",
          "markdownDescription": "This permission set configures which\nnotification features are by default exposed.\n\n#### Granted Permissions\n\nIt allows all notification related features.\n\n\n#### This default permission set includes:\n\n- `allow-is-permission-granted`\n- `allow-request-permission`\n- `allow-notify`\n- `allow-register-action-types`\n- `allow-register-listener`\n- `allow-cancel`\n- `allow-get-pending`\n- `allow-remove-active`\n- `allow-get-active`\n- `allow-check-permissions`\n- `allow-show`\n- `allow-batch`\n- `allow-list-channels`\n- `allow-delete-channel`\n- `allow-create-channel`\n- `allow-permission-state`"
        },
        {
          "description": "Enables the batch command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-batch",
          "markdownDescription": "Enables the batch command without any pre-configured scope."
        },
        {
          "description": "Enables the cancel command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-cancel",
          "markdownDescription": "Enables the cancel command without any pre-configured scope."
        },
        {
          "description": "Enables the check_permissions command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-check-permissions",
          "markdownDescription": "Enables the check_permissions command without any pre-configured scope."
        },
        {
          "description": "Enables the create_channel command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-create-channel",
          "markdownDescription": "Enables the create_channel command without any pre-configured scope."
        },
        {
          "description": "Enables the delete_channel command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-delete-channel",
          "markdownDescription": "Enables the delete_channel command without any pre-configured scope."
        },
        {
          "description": "Enables the get_active command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-get-active",
          "markdownDescription": "Enables the get_active command without any pre-configured scope."
        },
        {
          "description": "Enables the get_pending command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-get-pending",
          "markdownDescription": "Enables the get_pending command without any pre-configured scope."
        },
        {
          "description": "Enables the is_permission_granted command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-is-permission-granted",
          "markdownDescription": "Enables the is_permission_granted command without any pre-configured scope."
        },
        {
          "description": "Enables the list_channels command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-list-channels",
          "markdownDescription": "Enables the list_channels command without any pre-configured scope."
        },
        {
          "description": "Enables the notify command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-notify",
          "markdownDescription": "Enables the notify command without any pre-configured scope."
        },
        {
          "description": "Enables the permission_state command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-permission-state",
          "markdownDescription": "Enables the permission_state command without any pre-configured scope."
        },
        {
          "description": "Enables the register_action_types command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-register-action-types",
          "markdownDescription": "Enables the register_action_types command without any pre-configured scope."
        },
        {
          "description": "Enables the register_listener command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-register-listener",
          "markdownDescription": "Enables the register_listener command without any pre-configured scope."
        },
        {
          "description": "Enables the remove_active command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-remove-active",
          "markdownDescription": "Enables the remove_active command without any pre-configured scope."
        },
        {
          "description": "Enables the request_permission command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-request-permission",
          "markdownDescription": "Enables the request_permission command without any pre-configured scope."
        },
        {
          "description": "Enables the show command without any pre-configured scope.",
          "type": "string",
          "const": "notification:allow-show",
          "markdownDescription": "Enables the show command without any pre-configured scope."
        },
        {
          "description": "Denies the batch command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-batch",
          "markdownDescription": "Denies the batch command without any pre-configured scope."
        },
        {
          "description": "Denies the cancel command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-cancel",
          "markdownDescription": "Denies the cancel command without any pre-configured scope."
        },
        {
          "description": "Denies the check_permissions command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-check-permissions",
          "markdownDescription": "Denies the check_permissions command without any pre-configured scope."
        },
        {
          "description": "Denies the create_channel command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-create-channel",
          "markdownDescription": "Denies the create_channel command without any pre-configured scope."
        },
        {
          "description": "Denies the delete_channel command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-delete-channel",
          "markdownDescription": "Denies the delete_channel command without any pre-configured scope."
        },
        {
          "description": "Denies the get_active command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-get-active",
          "markdownDescription": "Denies the get_active command without any pre-configured scope."
        },
        {
          "description": "Denies the get_pending command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-get-pending",
          "markdownDescription": "Denies the get_pending command without any pre-configured scope."
        },
        {
          "description": "Denies the is_permission_granted command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-is-permission-granted",
          "markdownDescription": "Denies the is_permission_granted command without any pre-configured scope."
        },
        {
          "description": "Denies the list_channels command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-list-channels",
          "markdownDescription": "Denies the list_channels command without any pre-configured scope."
        },
        {
          "description": "Denies the notify command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-notify",
          "markdownDescription": "Denies the notify command without any pre-configured scope."
        },
        {
          "description": "Denies the permission_state command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-permission-state",
          "markdownDescription": "Denies the permission_state command without any pre-configured scope."
        },
        {
          "description": "Denies the register_action_types command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-register-action-types",
          "markdownDescription": "Denies the register_action_types command without any pre-configured scope."
        },
        {
          "description": "Denies the register_listener command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-register-listener",
          "markdownDescription": "Denies the register_listener command without any pre-configured scope."
        },
        {
          "description": "Denies the remove_active command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-remove-active",
          "markdownDescription": "Denies the remove_active command without any pre-configured scope."
        },
        {
          "description": "Denies the request_permission command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-request-permission",
          "markdownDescription": "Denies the request_permission command without any pre-configured scope."
        },
        {
          "description": "Denies the show command without any pre-configured scope.",
          "type": "string",
          "const": "notification:deny-show",
          "markdownDescription": "Denies the show command without any pre-configured scope."
        },
        {
          "description": "This permission set configures which\nshell functionality is exposed by default.\n\n#### Granted Permissions\n\nIt allows to use the `open` functionality with a reasonable\nscope pre-configured. It will allow opening `http(s)://`,\n`tel:` and `mailto:` links.\n\n#### This default permission set includes:\n\n- `allow-open`",
          "type": "string",
          "const": "shell:default",
          "markdownDescription": "This permission set configures which\nshell functionality is exposed by default.\n\n#### Granted Permissions\n\nIt allows to use the `open` functionality with a reasonable\nscope pre-configured. It will allow opening `http(s)://`,\n`tel:` and `mailto:` links.\n\n#### This default permission set includes:\n\n- `allow-open`"
        },
        {
          "description": "Enables the execute command without any pre-configured scope.",
          "type": "string",
          "const": "shell:allow-execute",
          "markdownDescription": "Enables the execute command without any pre-configured scope."
        },
        {
          "description": "Enables the kill command without any pre-configured scope.",
          "type": "string",
          "const": "shell:allow-kill",
          "markdownDescription": "Enables the kill command without any pre-configured scope."
        },
        {
          "description": "Enables the open command without any pre-configured scope.",
          "type": "string",
          "const": "shell:allow-open",
          "markdownDescription": "Enables the open command without any pre-configured scope."
        },
        {
          "description": "Enables the spawn command without any pre-configured scope.",
          "type": "string",
          "const": "shell:allow-spawn",
          "markdownDescription": "Enables the spawn command without any pre-configured scope."
        },
        {
          "description": "Enables the stdin_write command without any pre-configured scope.",
          "type": "string",
          "const": "shell:allow-stdin-write",
          "markdownDescription": "Enables the stdin_write command without any pre-configured scope."
        },
        {
          "description": "Denies the execute command without any pre-configured scope.",
          "type": "string",
          "const": "shell:deny-execute",
          "markdownDescription": "Denies the execute command without any pre-configured scope."
        },
        {
          "description": "Denies the kill command without any pre-configured scope.",
          "type": "string",
          "const": "shell:deny-kill",
          "markdownDescription": "Denies the kill command without any pre-configured scope."
        },
        {
          "description": "Denies the open command without any pre-configured scope.",
          "type": "string",
          "const": "shell:deny-open",
          "markdownDescription": "Denies the open command without any pre-configured scope."
        },
        {
          "description": "Denies the spawn command without any pre-configured scope.",
          "type": "string",
          "const": "shell:deny-spawn",
          "markdownDescription": "Denies the spawn command without any pre-configured scope."
        },
        {
          "description": "Denies the stdin_write command without any pre-configured scope.",
          "type": "string",
          "const": "shell:deny-stdin-write",
          "markdownDescription": "Denies the stdin_write command without any pre-configured scope."
        }
      ]
    },
    "Value": {
      "description": "All supported ACL values.",
      "anyOf": [
        {
          "description": "Represents a null JSON value.",
          "type": "null"
        },
        {
          "description": "Represents a [`bool`].",
          "type": "boolean"
        },
        {
          "description": "Represents a valid ACL [`Number`].",
          "allOf": [
            {
              "$ref": "#/definitions/Number"
            }
          ]
        },
        {
          "description": "Represents a [`String`].",
          "type": "string"
        },
        {
          "description": "Represents a list of other [`Value`]s.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Value"
          }
        },
        {
          "description": "Represents a map of [`String`] keys to [`Value`]s.",
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/Value"
          }
        }
      ]
    },
    "Number": {
      "description": "A valid ACL number.",
      "anyOf": [
        {
          "description": "Represents an [`i64`].",
          "type": "integer",
          "format": "int64"
        },
        {
          "description": "Represents a [`f64`].",
          "type": "number",
          "format": "double"
        }
      ]
    },
    "Target": {
      "description": "Platform target.",
      "oneOf": [
        {
          "description": "MacOS.",
          "type": "string",
          "enum": ["macOS"]
        },
        {
          "description": "Windows.",
          "type": "string",
          "enum": ["windows"]
        },
        {
          "description": "Linux.",
          "type": "string",
          "enum": ["linux"]
        },
        {
          "description": "Android.",
          "type": "string",
          "enum": ["android"]
        },
        {
          "description": "iOS.",
          "type": "string",
          "enum": ["iOS"]
        }
      ]
    },
    "ShellScopeEntryAllowedArg": {
      "description": "A command argument allowed to be executed by the webview API.",
      "anyOf": [
        {
          "description": "A non-configurable argument that is passed to the command in the order it was specified.",
          "type": "string"
        },
        {
          "description": "A variable that is set while calling the command from the webview API.",
          "type": "object",
          "required": ["validator"],
          "properties": {
            "raw": {
              "description": "Marks the validator as a raw regex, meaning the plugin should not make any modification at runtime.\n\nThis means the regex will not match on the entire string by default, which might be exploited if your regex allow unexpected input to be considered valid. When using this option, make sure your regex is correct.",
              "default": false,
              "type": "boolean"
            },
            "validator": {
              "description": "[regex] validator to require passed values to conform to an expected input.\n\nThis will require the argument value passed to this variable to match the `validator` regex before it will be executed.\n\nThe regex string is by default surrounded by `^...$` to match the full string. For example the `https?://\\w+` regex would be registered as `^https?://\\w+$`.\n\n[regex]: <https://docs.rs/regex/latest/regex/#syntax>",
              "type": "string"
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "ShellScopeEntryAllowedArgs": {
      "description": "A set of command arguments allowed to be executed by the webview API.\n\nA value of `true` will allow any arguments to be passed to the command. `false` will disable all arguments. A list of [`ShellScopeEntryAllowedArg`] will set those arguments as the only valid arguments to be passed to the attached command configuration.",
      "anyOf": [
        {
          "description": "Use a simple boolean to allow all or disable all arguments to this command configuration.",
          "type": "boolean"
        },
        {
          "description": "A specific set of [`ShellScopeEntryAllowedArg`] that are valid to call for the command configuration.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/ShellScopeEntryAllowedArg"
          }
        }
      ]
    }
  }
}
</file>

<file path="src/frontend/src-tauri/src/commands/mod.rs">
pub mod usage;
</file>

<file path="src/frontend/src-tauri/src/commands/usage.rs">
use crate::sidecar::backend::call_backend;
use serde::{Deserialize, Serialize};
use tauri::AppHandle;

#[derive(Debug, Serialize, Deserialize)]
pub struct FiveHourUsage {
    pub utilization: f64,
    pub resets_at: String,
}

#[derive(Debug, Serialize, Deserialize)]
pub struct GoalsStatus {
    pub enabled: bool,
    pub is_on_track: bool,
    pub current_usage: f64,
    pub expected_usage: f64,
    pub message: String,
}

#[derive(Debug, Serialize, Deserialize)]
pub struct FocusModeStatus {
    pub is_snoozed: bool,
    pub snooze_remaining: i64,
    pub is_quiet_hours: bool,
    pub is_dnd: bool,
    pub notifications_suppressed: bool,
}

#[derive(Debug, Serialize, Deserialize)]
pub struct UsageResponse {
    pub five_hour: Option<FiveHourUsage>,
    pub goals: Option<GoalsStatus>,
    pub focus_mode: Option<FocusModeStatus>,
    pub error: Option<String>,
}

#[tauri::command]
pub async fn get_usage(app: AppHandle) -> Result<UsageResponse, String> {
    let output = call_backend(&app, "get_usage", &[]).await?;
    serde_json::from_str(&output).map_err(|e| e.to_string())
}

#[tauri::command]
pub async fn refresh_usage(app: AppHandle) -> Result<UsageResponse, String> {
    let output = call_backend(&app, "refresh_usage", &[]).await?;
    serde_json::from_str(&output).map_err(|e| e.to_string())
}

#[tauri::command]
pub async fn snooze(app: AppHandle, minutes: i32) -> Result<serde_json::Value, String> {
    let output = call_backend(&app, "snooze", &[&minutes.to_string()]).await?;
    serde_json::from_str(&output).map_err(|e| e.to_string())
}
</file>

<file path="src/frontend/src-tauri/src/sidecar/backend.rs">
use tauri::AppHandle;
use tauri_plugin_shell::ShellExt;

pub async fn call_backend(app: &AppHandle, action: &str, args: &[&str]) -> Result<String, String> {
    let mut command = app
        .shell()
        .sidecar("claudiminder-sidecar")
        .map_err(|e| e.to_string())?
        .arg(action);

    for arg in args {
        command = command.arg(*arg);
    }

    let output = command.output().await.map_err(|e| e.to_string())?;

    if output.status.success() {
        Ok(String::from_utf8_lossy(&output.stdout).to_string())
    } else {
        let stderr = String::from_utf8_lossy(&output.stderr).to_string();
        if stderr.is_empty() {
            Err("Sidecar execution failed".to_string())
        } else {
            Err(stderr)
        }
    }
}
</file>

<file path="src/frontend/src-tauri/src/sidecar/mod.rs">
pub mod backend;
</file>

<file path="src/frontend/src-tauri/src/tray/mod.rs">
pub mod setup;
</file>

<file path="src/frontend/src-tauri/src/tray/setup.rs">
use tauri::{
    menu::{Menu, MenuItem},
    tray::{MouseButton, MouseButtonState, TrayIconBuilder, TrayIconEvent, TrayIconId},
    App, Emitter, Manager,
};

pub fn setup_tray(app: &App) -> Result<TrayIconId, Box<dyn std::error::Error>> {
    let show = MenuItem::with_id(app, "show", "Show", true, None::<&str>)?;
    let refresh = MenuItem::with_id(app, "refresh", "Refresh", true, None::<&str>)?;
    let quit = MenuItem::with_id(app, "quit", "Quit", true, None::<&str>)?;

    let menu = Menu::with_items(app, &[&show, &refresh, &quit])?;

    let tray = TrayIconBuilder::new()
        .icon(app.default_window_icon().unwrap().clone())
        .menu(&menu)
        .tooltip("Claudiminder: Loading...")
        .on_menu_event(|app, event| match event.id().as_ref() {
            "quit" => app.exit(0),
            "show" => {
                if let Some(window) = app.get_webview_window("main") {
                    let _ = window.show();
                    let _ = window.set_focus();
                }
            }
            "refresh" => {
                let _ = app.emit("refresh-usage", ());
            }
            _ => {}
        })
        .on_tray_icon_event(|tray, event| {
            if let TrayIconEvent::Click {
                button: MouseButton::Left,
                button_state: MouseButtonState::Up,
                ..
            } = event
            {
                if let Some(window) = tray.app_handle().get_webview_window("main") {
                    let _ = window.show();
                    let _ = window.set_focus();
                }
            }
        })
        .build(app)?;

    Ok(tray.id().clone())
}
</file>

<file path="src/frontend/src-tauri/src/events.rs">
use serde::{Deserialize, Serialize};

// Event names
pub const EVENT_USAGE_UPDATED: &str = "usage-updated";
pub const EVENT_TRAY_UPDATE: &str = "tray-update";
pub const EVENT_TRAY_ANIMATE: &str = "tray-animate";
pub const EVENT_SNOOZE: &str = "snooze";

/// Payload for usage-updated event
#[derive(Clone, Serialize, Deserialize, Debug)]
pub struct UsageUpdatedPayload {
    pub messages_used: u32,
    pub messages_limit: u32,
    pub messages_percent: f32,
    pub reset_at: String,
    pub time_until_reset: String,
}

/// Payload for tray-update event
#[derive(Clone, Serialize, Deserialize, Debug)]
pub struct TrayUpdatePayload {
    pub tooltip: String,
    pub icon: Option<String>, // Optional: base64 icon data
}

/// Payload for tray-animate event
#[derive(Clone, Serialize, Deserialize, Debug)]
pub struct TrayAnimatePayload {
    pub animate: bool,
}

/// Payload for snooze event
#[derive(Clone, Serialize, Deserialize, Debug)]
pub struct SnoozePayload {
    pub duration_minutes: u32,
}
</file>

<file path="src/frontend/src-tauri/src/lib.rs">
mod commands;
mod events;
mod sidecar;
mod tray;

use tauri::{Listener, Manager};

#[cfg_attr(mobile, tauri::mobile_entry_point)]
pub fn run() {
    let builder = tauri::Builder::default()
        .plugin(tauri_plugin_shell::init())
        .plugin(tauri_plugin_notification::init())
        .plugin(tauri_plugin_single_instance::init(|app, _args, _cwd| {
            if let Some(window) = app.get_webview_window("main") {
                let _ = window.show();
                let _ = window.set_focus();
            }
        }));

    builder
        .setup(|app| {
            let tray_id = tray::setup::setup_tray(app)?;

            // Setup window close -> hide behavior
            if let Some(window) = app.get_webview_window("main") {
                let window_clone = window.clone();
                window.on_window_event(move |event| {
                    if let tauri::WindowEvent::CloseRequested { api, .. } = event {
                        api.prevent_close();
                        let _ = window_clone.hide();
                    }
                });
            }

            // Setup event listeners
            let app_handle = app.handle().clone();
            let tray_id_clone = tray_id.clone();
            app.listen(events::EVENT_TRAY_UPDATE, move |event: tauri::Event| {
                let payload = event.payload();
                if let Ok(data) = serde_json::from_str::<events::TrayUpdatePayload>(payload) {
                    if let Some(tray) = app_handle.tray_by_id(&tray_id_clone) {
                        let _ = tray.set_tooltip(Some(&data.tooltip));
                    }
                }
            });

            let app_handle = app.handle().clone();
            app.listen(events::EVENT_TRAY_ANIMATE, move |event: tauri::Event| {
                let payload = event.payload();
                if let Ok(_data) = serde_json::from_str::<events::TrayAnimatePayload>(payload) {
                    let _ = &app_handle;
                }
            });

            let app_handle = app.handle().clone();
            app.listen(events::EVENT_SNOOZE, move |event: tauri::Event| {
                let payload = event.payload();
                if let Ok(_data) = serde_json::from_str::<events::SnoozePayload>(payload) {
                    let _ = &app_handle;
                }
            });

            // Request notification permission (sync in this version)
            #[cfg(desktop)]
            {
                let handle = app.handle().clone();
                let _ = tauri_plugin_notification::NotificationExt::notification(&handle)
                    .request_permission();
            }

            Ok(())
        })
        .invoke_handler(tauri::generate_handler![
            commands::usage::get_usage,
            commands::usage::refresh_usage,
            commands::usage::snooze,
        ])
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
</file>

<file path="src/frontend/src-tauri/src/main.rs">
// Prevents additional console window on Windows in release, DO NOT REMOVE!!
#![cfg_attr(not(debug_assertions), windows_subsystem = "windows")]

fn main() {
    claudiminder_lib::run();
}
</file>

<file path="src/frontend/src-tauri/build.rs">
fn main() {
    tauri_build::build()
}
</file>

<file path="src/frontend/src-tauri/Cargo.toml">
[package]
name = "claudiminder"
version = "0.1.0"
description = "Claude usage tracking & reminder tool"
authors = ["claudiminder"]
edition = "2021"

[lib]
name = "claudiminder_lib"
crate-type = ["staticlib", "cdylib", "rlib"]

[build-dependencies]
tauri-build = { version = "2.0", features = [] }

[dependencies]
tauri = { version = "2.0", features = ["tray-icon", "image-png"] }
tauri-plugin-notification = "2.0"
tauri-plugin-shell = "2.0"
tauri-plugin-single-instance = "2.0"
serde = { version = "1", features = ["derive"] }
serde_json = "1"
tokio = { version = "1", features = ["full"] }
reqwest = { version = "0.12", features = ["json"] }
</file>

<file path="src/frontend/src-tauri/tauri.conf.json">
{
  "productName": "Claudiminder",
  "version": "0.1.0",
  "identifier": "com.claudiminder.desktop",
  "build": {
    "beforeDevCommand": "bun run dev",
    "devUrl": "http://localhost:5173",
    "beforeBuildCommand": "bun run build",
    "frontendDist": "../dist"
  },
  "bundle": {
    "active": true,
    "targets": "all",
    "icon": [
      "icons/32x32.png",
      "icons/128x128.png",
      "icons/128x128@2x.png",
      "icons/icon.icns",
      "icons/icon.ico"
    ]
  },
  "app": {
    "windows": [
      {
        "title": "Claudiminder",
        "width": 400,
        "height": 600,
        "resizable": true,
        "fullscreen": false,
        "decorations": true,
        "visible": true
      }
    ],
    "security": {
      "csp": null
    },
    "trayIcon": {
      "id": "main",
      "iconPath": "icons/icon.png",
      "tooltip": "Claudiminder"
    }
  },
  "plugins": {
    "notification": {
      "all": true
    },
    "shell": {
      "open": true
    }
  }
}
</file>

<file path="src/frontend/tests/hooks/use-countdown.test.ts">
import { renderHook, act } from "@testing-library/react";
import { describe, it, expect, vi, beforeEach, afterEach } from "vitest";
import { useCountdown } from "../../src/hooks/use-countdown";

describe("useCountdown", () => {
  beforeEach(() => {
    vi.useFakeTimers();
  });

  afterEach(() => {
    vi.useRealTimers();
  });

  it("calculates remaining time correctly for 1 hour", () => {
    const targetDate = new Date(Date.now() + 3600000).toISOString();
    const { result } = renderHook(() => useCountdown(targetDate));

    expect(result.current.hours).toBe(1);
    expect(result.current.minutes).toBe(0);
    expect(result.current.seconds).toBe(0);
    expect(result.current.isExpired).toBe(false);
  });

  it("calculates remaining time correctly for 30 minutes", () => {
    const targetDate = new Date(Date.now() + 30 * 60 * 1000).toISOString();
    const { result } = renderHook(() => useCountdown(targetDate));

    expect(result.current.hours).toBe(0);
    expect(result.current.minutes).toBe(30);
    expect(result.current.isExpired).toBe(false);
  });

  it("updates every second", () => {
    const targetDate = new Date(Date.now() + 65000).toISOString();
    const { result } = renderHook(() => useCountdown(targetDate));

    expect(result.current.minutes).toBe(1);
    expect(result.current.seconds).toBe(5);

    act(() => {
      vi.advanceTimersByTime(1000);
    });

    expect(result.current.seconds).toBe(4);
  });

  it("sets isExpired when countdown reaches zero", () => {
    const targetDate = new Date(Date.now() + 1000).toISOString();
    const { result } = renderHook(() => useCountdown(targetDate));

    expect(result.current.isExpired).toBe(false);

    act(() => {
      vi.advanceTimersByTime(2000);
    });

    expect(result.current.isExpired).toBe(true);
    expect(result.current.totalSeconds).toBe(0);
  });

  it("returns correct humanReadable format for hours", () => {
    const targetDate = new Date(
      Date.now() + 2 * 3600000 + 30 * 60000,
    ).toISOString();
    const { result } = renderHook(() => useCountdown(targetDate));

    expect(result.current.humanReadable).toContain("h");
    expect(result.current.humanReadable).toContain("left");
  });

  it("returns correct humanReadable format for minutes only", () => {
    const targetDate = new Date(Date.now() + 15 * 60000 + 30000).toISOString();
    const { result } = renderHook(() => useCountdown(targetDate));

    expect(result.current.humanReadable).toContain("m");
    expect(result.current.humanReadable).toContain("s");
    expect(result.current.humanReadable).toContain("left");
  });

  it("returns 'Expired' when time is up", () => {
    const targetDate = new Date(Date.now() - 1000).toISOString();
    const { result } = renderHook(() => useCountdown(targetDate));

    expect(result.current.humanReadable).toBe("Expired");
  });

  it("handles past dates correctly", () => {
    const targetDate = new Date(Date.now() - 3600000).toISOString();
    const { result } = renderHook(() => useCountdown(targetDate));

    expect(result.current.totalSeconds).toBe(0);
    expect(result.current.isExpired).toBe(true);
  });

  it("recalculates when targetDate changes", () => {
    const initialTarget = new Date(Date.now() + 3600000).toISOString();
    const { result, rerender } = renderHook(
      ({ target }) => useCountdown(target),
      { initialProps: { target: initialTarget } },
    );

    expect(result.current.hours).toBe(1);

    const newTarget = new Date(Date.now() + 7200000).toISOString();
    rerender({ target: newTarget });

    expect(result.current.hours).toBe(2);
  });
});
</file>

<file path="src/frontend/tests/stores/theme-store.test.ts">
import { describe, it, expect, beforeEach, vi } from "vitest";
import { act } from "@testing-library/react";

// Reset zustand store state between tests
const mockLocalStorage: Record<string, string> = {};

vi.mock("zustand/middleware", async () => {
  const actual =
    await vi.importActual<typeof import("zustand/middleware")>(
      "zustand/middleware",
    );
  return {
    ...actual,
    persist: (config: unknown) => config,
  };
});

describe("themeStore", () => {
  beforeEach(async () => {
    vi.resetModules();
    // Clear mock localStorage
    Object.keys(mockLocalStorage).forEach(
      (key) => delete mockLocalStorage[key],
    );

    // Mock document.documentElement
    Object.defineProperty(document, "documentElement", {
      value: {
        className: "",
        style: {
          setProperty: vi.fn(),
        },
      },
      writable: true,
    });
  });

  it("has neon-dark as default theme", async () => {
    const { useThemeStore } = await import("../../src/stores/theme-store");
    const { theme } = useThemeStore.getState();
    expect(theme).toBe("neon-dark");
  });

  it("has basic as default color level", async () => {
    const { useThemeStore } = await import("../../src/stores/theme-store");
    const { colorLevel } = useThemeStore.getState();
    expect(colorLevel).toBe("basic");
  });

  it("sets theme correctly", async () => {
    const { useThemeStore } = await import("../../src/stores/theme-store");

    act(() => {
      useThemeStore.getState().setTheme("glass-light");
    });

    const { theme } = useThemeStore.getState();
    expect(theme).toBe("glass-light");
  });

  it("sets color level correctly", async () => {
    const { useThemeStore } = await import("../../src/stores/theme-store");

    act(() => {
      useThemeStore.getState().setColorLevel("advanced");
    });

    const { colorLevel } = useThemeStore.getState();
    expect(colorLevel).toBe("advanced");
  });

  it("sets accent color and applies to DOM in advanced mode", async () => {
    const { useThemeStore } = await import("../../src/stores/theme-store");
    const mockSetProperty = vi.fn();

    Object.defineProperty(document, "documentElement", {
      value: {
        className: "",
        style: { setProperty: mockSetProperty },
      },
      writable: true,
    });

    act(() => {
      useThemeStore.getState().setColorLevel("advanced");
      useThemeStore.getState().setAccentColor("#ff0000");
    });

    const { accentColor } = useThemeStore.getState();
    expect(accentColor).toBe("#ff0000");
    expect(mockSetProperty).toHaveBeenCalledWith("--accent", "#ff0000");
  });

  it("sets custom colors and applies to DOM in expert mode", async () => {
    const { useThemeStore } = await import("../../src/stores/theme-store");
    const mockSetProperty = vi.fn();

    Object.defineProperty(document, "documentElement", {
      value: {
        className: "",
        style: { setProperty: mockSetProperty },
      },
      writable: true,
    });

    act(() => {
      useThemeStore.getState().setColorLevel("expert");
      useThemeStore.getState().setCustomColors({
        bgPrimary: "#111111",
        textPrimary: "#ffffff",
      });
    });

    const { customColors } = useThemeStore.getState();
    expect(customColors.bgPrimary).toBe("#111111");
    expect(customColors.textPrimary).toBe("#ffffff");
    expect(mockSetProperty).toHaveBeenCalled();
  });

  it("applies theme class to document element", async () => {
    const { useThemeStore } = await import("../../src/stores/theme-store");

    act(() => {
      useThemeStore.getState().setTheme("minimal-light");
    });

    expect(document.documentElement.className).toBe("minimal-light");
  });

  it("handles system theme correctly", async () => {
    const { useThemeStore } = await import("../../src/stores/theme-store");

    act(() => {
      useThemeStore.getState().setTheme("system");
    });

    // Our mock matchMedia returns dark
    expect(document.documentElement.className).toBe("dark");
  });
});
</file>

<file path="src/frontend/tests/setup.ts">
import "@testing-library/jest-dom/vitest";
import { vi } from "vitest";

// Mock Tauri APIs
vi.mock("@tauri-apps/api/core", () => ({
  invoke: vi.fn(),
}));

vi.mock("@tauri-apps/api/event", () => ({
  emit: vi.fn(),
  listen: vi.fn(() => Promise.resolve(() => {})),
}));

vi.mock("@tauri-apps/plugin-notification", () => ({
  isPermissionGranted: vi.fn().mockResolvedValue(true),
  requestPermission: vi.fn().mockResolvedValue("granted"),
  sendNotification: vi.fn(),
}));

vi.mock("@tauri-apps/plugin-shell", () => ({
  open: vi.fn(),
}));

// Mock matchMedia
Object.defineProperty(window, "matchMedia", {
  writable: true,
  value: vi.fn().mockImplementation((query: string) => ({
    matches: query.includes("dark"),
    media: query,
    onchange: null,
    addListener: vi.fn(),
    removeListener: vi.fn(),
    addEventListener: vi.fn(),
    removeEventListener: vi.fn(),
    dispatchEvent: vi.fn(),
  })),
});

// Mock localStorage
const localStorageMock = {
  getItem: vi.fn(),
  setItem: vi.fn(),
  removeItem: vi.fn(),
  clear: vi.fn(),
  length: 0,
  key: vi.fn(),
};

Object.defineProperty(window, "localStorage", {
  value: localStorageMock,
});

// Reset all mocks before each test
beforeEach(() => {
  vi.clearAllMocks();
  localStorageMock.getItem.mockReturnValue(null);
});
</file>

<file path="src/frontend/index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Claudiminder</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="src/frontend/package.json">
{
  "name": "claudiminder-frontend",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "tauri": "tauri",
    "test": "vitest",
    "test:coverage": "vitest --coverage",
    "test:e2e": "playwright test",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "format": "prettier --write \"src/**/*.{ts,tsx,json,css}\"",
    "format:check": "prettier --check \"src/**/*.{ts,tsx,json,css}\"",
    "typecheck": "tsc --noEmit"
  },
  "dependencies": {
    "@tauri-apps/api": "^2.0.0",
    "@tauri-apps/plugin-notification": "^2.0.0",
    "@tauri-apps/plugin-shell": "^2.0.0",
    "@types/react-grid-layout": "^2.1.0",
    "i18next": "^25.7.4",
    "react": "^18.3.0",
    "react-dom": "^18.3.0",
    "react-grid-layout": "^2.2.2",
    "react-i18next": "^16.5.3",
    "zustand": "^5.0.0"
  },
  "devDependencies": {
    "@tauri-apps/cli": "^2.0.0",
    "@testing-library/jest-dom": "^6.6.0",
    "@testing-library/react": "^16.0.0",
    "@types/react": "^18.3.0",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react": "^4.3.0",
    "@vitest/coverage-v8": "^2.0.0",
    "jsdom": "^25.0.0",
    "playwright": "^1.45.0",
    "typescript": "^5.5.0",
    "vite": "^6.0.0",
    "vitest": "^2.0.0"
  }
}
</file>

<file path="src/frontend/tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
</file>

<file path="src/frontend/tsconfig.node.json">
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true,
    "strict": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="src/frontend/vite.config.ts">
import react from "@vitejs/plugin-react";
import { defineConfig } from "vite";

export default defineConfig({
  plugins: [react()],
  clearScreen: false,
  server: {
    port: 5173,
    strictPort: true,
  },
  envPrefix: ["VITE_", "TAURI_"],
  build: {
    target: "esnext",
    minify: !process.env.TAURI_DEBUG ? "esbuild" : false,
    sourcemap: !!process.env.TAURI_DEBUG,
  },
});
</file>

<file path="src/frontend/vitest.config.ts">
import react from "@vitejs/plugin-react";
import { defineConfig } from "vitest/config";

export default defineConfig({
  plugins: [react()],
  test: {
    environment: "jsdom",
    globals: true,
    setupFiles: ["./tests/setup.ts"],
    include: ["tests/**/*.{test,spec}.{ts,tsx}"],
    coverage: {
      provider: "v8",
      reporter: ["text", "html", "lcov"],
      exclude: [
        "node_modules/",
        "tests/",
        "src-tauri/",
        "**/*.d.ts",
        "**/*.config.ts",
        "**/index.ts",
      ],
      thresholds: {
        lines: 70,
        functions: 70,
        branches: 70,
        statements: 70,
      },
    },
  },
});
</file>

<file path="tests/backend/scheduler/test_reminder.py">
"""Tests for reminder service."""

from __future__ import annotations

from datetime import datetime, timedelta
from unittest.mock import MagicMock, patch

import pytest

from claudiminder.scheduler.reminder_service import (
    ReminderService,
    ReminderType,
    get_reminder_service,
)


@pytest.fixture
def reminder_service() -> ReminderService:
    """Create fresh reminder service instance."""
    return ReminderService()


@pytest.fixture
def mock_config():
    """Mock reminder config."""
    mock = MagicMock()
    mock.reminder.enabled = True
    mock.reminder.percentage_thresholds = [50, 75, 90, 100]
    mock.reminder.before_reset_minutes = [15, 30, 60]
    mock.reminder.on_reset = True
    return mock


class TestReminderService:
    """Tests for ReminderService class."""

    def test_initial_state(self, reminder_service: ReminderService):
        """Test initial state is empty."""
        assert len(reminder_service._triggered_percentages) == 0
        assert len(reminder_service._triggered_before_reset) == 0
        assert reminder_service._reset_triggered is False

    def test_reset_triggers(self, reminder_service: ReminderService):
        """Test reset_triggers clears all state."""
        reminder_service._triggered_percentages.add(50)
        reminder_service._triggered_before_reset.add(15)
        reminder_service._reset_triggered = True

        reminder_service.reset_triggers()

        assert len(reminder_service._triggered_percentages) == 0
        assert len(reminder_service._triggered_before_reset) == 0
        assert reminder_service._reset_triggered is False

    def test_add_and_remove_callback(self, reminder_service: ReminderService):
        """Test adding and removing callbacks."""

        def test_callback(t: ReminderType, m: str) -> None:
            pass

        reminder_service.add_callback(test_callback)
        assert test_callback in reminder_service._callbacks

        reminder_service.remove_callback(test_callback)
        assert test_callback not in reminder_service._callbacks

    def test_remove_nonexistent_callback(self, reminder_service: ReminderService):
        """Test removing non-existent callback doesn't raise."""

        def test_callback(t: ReminderType, m: str) -> None:
            pass

        reminder_service.remove_callback(test_callback)  # Should not raise


class TestCheckAndTrigger:
    """Tests for check_and_trigger method."""

    def test_returns_empty_when_disabled(
        self,
        reminder_service: ReminderService,
        mock_config: MagicMock,
    ):
        """Test returns empty when reminders disabled."""
        mock_config.reminder.enabled = False

        with patch("claudiminder.scheduler.reminder_service.load_config", return_value=mock_config):
            result = reminder_service.check_and_trigger(95.0, None)
            assert result == []

    def test_returns_empty_when_suppressed(
        self,
        reminder_service: ReminderService,
        mock_config: MagicMock,
    ):
        """Test returns empty when notifications suppressed."""
        with patch("claudiminder.scheduler.reminder_service.load_config", return_value=mock_config):
            with patch(
                "claudiminder.scheduler.reminder_service.get_focus_mode_service"
            ) as mock_focus:
                mock_instance = MagicMock()
                mock_instance.should_suppress_notification.return_value = True
                mock_instance.get_suppression_reason.return_value = "Snoozed"
                mock_focus.return_value = mock_instance

                result = reminder_service.check_and_trigger(95.0, None)
                assert result == []

    def test_triggers_percentage_threshold(
        self,
        reminder_service: ReminderService,
        mock_config: MagicMock,
    ):
        """Test triggers percentage threshold reminders."""
        with patch("claudiminder.scheduler.reminder_service.load_config", return_value=mock_config):
            with patch(
                "claudiminder.scheduler.reminder_service.get_focus_mode_service"
            ) as mock_focus:
                mock_instance = MagicMock()
                mock_instance.should_suppress_notification.return_value = False
                mock_focus.return_value = mock_instance

                with patch(
                    "claudiminder.scheduler.reminder_service.send_notification_sync"
                ):
                    result = reminder_service.check_and_trigger(75.0, None)

                    # Should trigger 50 and 75 thresholds
                    types = [r[0] for r in result]
                    assert ReminderType.PERCENTAGE in types
                    assert 50 in reminder_service._triggered_percentages
                    assert 75 in reminder_service._triggered_percentages

    def test_does_not_retrigger_percentage(
        self,
        reminder_service: ReminderService,
        mock_config: MagicMock,
    ):
        """Test does not re-trigger same percentage."""
        reminder_service._triggered_percentages.add(50)

        with patch("claudiminder.scheduler.reminder_service.load_config", return_value=mock_config):
            with patch(
                "claudiminder.scheduler.reminder_service.get_focus_mode_service"
            ) as mock_focus:
                mock_instance = MagicMock()
                mock_instance.should_suppress_notification.return_value = False
                mock_focus.return_value = mock_instance

                with patch(
                    "claudiminder.scheduler.reminder_service.send_notification_sync"
                ):
                    result = reminder_service.check_and_trigger(55.0, None)

                    # 50 already triggered, should not be in result
                    messages = [r[1] for r in result]
                    assert not any("50%" in m for m in messages)

    def test_triggers_before_reset(
        self,
        reminder_service: ReminderService,
        mock_config: MagicMock,
    ):
        """Test triggers before-reset reminders."""
        reset_time = datetime.now() + timedelta(minutes=14)

        with patch("claudiminder.scheduler.reminder_service.load_config", return_value=mock_config):
            with patch(
                "claudiminder.scheduler.reminder_service.get_focus_mode_service"
            ) as mock_focus:
                mock_instance = MagicMock()
                mock_instance.should_suppress_notification.return_value = False
                mock_focus.return_value = mock_instance

                with patch(
                    "claudiminder.scheduler.reminder_service.send_notification_sync"
                ):
                    result = reminder_service.check_and_trigger(30.0, reset_time)

                    types = [r[0] for r in result]
                    assert ReminderType.BEFORE_RESET in types
                    assert 15 in reminder_service._triggered_before_reset

    def test_callback_is_called(
        self,
        reminder_service: ReminderService,
        mock_config: MagicMock,
    ):
        """Test callback is invoked on trigger."""
        callback_called = []

        def test_callback(t: ReminderType, m: str) -> None:
            callback_called.append((t, m))

        reminder_service.add_callback(test_callback)

        with patch("claudiminder.scheduler.reminder_service.load_config", return_value=mock_config):
            with patch(
                "claudiminder.scheduler.reminder_service.get_focus_mode_service"
            ) as mock_focus:
                mock_instance = MagicMock()
                mock_instance.should_suppress_notification.return_value = False
                mock_focus.return_value = mock_instance

                with patch(
                    "claudiminder.scheduler.reminder_service.send_notification_sync"
                ):
                    reminder_service.check_and_trigger(50.0, None)

                    assert len(callback_called) > 0
                    assert callback_called[0][0] == ReminderType.PERCENTAGE

    def test_callback_error_handled(
        self,
        reminder_service: ReminderService,
        mock_config: MagicMock,
    ):
        """Test callback error is handled gracefully."""

        def bad_callback(t: ReminderType, m: str) -> None:
            raise Exception("Callback error")

        reminder_service.add_callback(bad_callback)

        with patch("claudiminder.scheduler.reminder_service.load_config", return_value=mock_config):
            with patch(
                "claudiminder.scheduler.reminder_service.get_focus_mode_service"
            ) as mock_focus:
                mock_instance = MagicMock()
                mock_instance.should_suppress_notification.return_value = False
                mock_focus.return_value = mock_instance

                with patch(
                    "claudiminder.scheduler.reminder_service.send_notification_sync"
                ):
                    # Should not raise
                    result = reminder_service.check_and_trigger(50.0, None)
                    assert len(result) > 0


class TestSnooze:
    """Tests for snooze method."""

    def test_calls_focus_service(self, reminder_service: ReminderService):
        """Test snooze calls focus service."""
        with patch(
            "claudiminder.scheduler.reminder_service.get_focus_mode_service"
        ) as mock_focus:
            mock_instance = MagicMock()
            mock_focus.return_value = mock_instance

            reminder_service.snooze(15)

            mock_instance.snooze.assert_called_once_with(15)


class TestGetReminderService:
    """Tests for get_reminder_service singleton."""

    def test_returns_same_instance(self):
        """Test returns same singleton instance."""
        import claudiminder.scheduler.reminder_service as module

        module._service = None  # Reset singleton

        service1 = get_reminder_service()
        service2 = get_reminder_service()

        assert service1 is service2

        module._service = None  # Cleanup
</file>

<file path="tests/backend/tui/test_widgets.py">
"""Tests for TUI widgets."""

from __future__ import annotations

import pytest
from textual.app import App, ComposeResult

from claudiminder.tui.widgets.usage_display import UsageDisplay


class TestUsageDisplayWidget:
    """Tests for UsageDisplay widget."""

    @pytest.mark.asyncio
    async def test_initial_state(self):
        """Test initial widget state."""

        class TestApp(App):
            def compose(self) -> ComposeResult:
                yield UsageDisplay()

        async with TestApp().run_test() as pilot:
            widget = pilot.app.query_one(UsageDisplay)
            assert widget.five_hour_usage == 0.0
            assert widget.seven_day_usage is None
            assert widget.extra_usage is None

    @pytest.mark.asyncio
    async def test_update_five_hour_usage(self):
        """Test updating five hour usage."""

        class TestApp(App):
            def compose(self) -> ComposeResult:
                yield UsageDisplay()

        async with TestApp().run_test() as pilot:
            widget = pilot.app.query_one(UsageDisplay)
            widget.five_hour_usage = 50.0
            await pilot.pause()

            assert widget.five_hour_usage == 50.0

    @pytest.mark.asyncio
    async def test_update_all_usage(self):
        """Test updating all usage values."""

        class TestApp(App):
            def compose(self) -> ComposeResult:
                yield UsageDisplay()

        async with TestApp().run_test() as pilot:
            widget = pilot.app.query_one(UsageDisplay)
            widget.update_usage(
                five_hour=45.0,
                seven_day=30.0,
                extra=10.0,
            )
            await pilot.pause()

            assert widget.five_hour_usage == 45.0
            assert widget.seven_day_usage == 30.0
            assert widget.extra_usage == 10.0


class TestProgressBar:
    """Tests for progress bar rendering."""

    @pytest.mark.asyncio
    async def test_green_color_under_75(self):
        """Test progress bar is green under 75%."""

        class TestApp(App):
            def compose(self) -> ComposeResult:
                yield UsageDisplay()

        async with TestApp().run_test() as pilot:
            widget = pilot.app.query_one(UsageDisplay)
            bar = widget._progress_bar(50.0)
            assert "green" in bar

    @pytest.mark.asyncio
    async def test_yellow_color_at_75(self):
        """Test progress bar is yellow at 75%."""

        class TestApp(App):
            def compose(self) -> ComposeResult:
                yield UsageDisplay()

        async with TestApp().run_test() as pilot:
            widget = pilot.app.query_one(UsageDisplay)
            bar = widget._progress_bar(80.0)
            assert "yellow" in bar

    @pytest.mark.asyncio
    async def test_red_color_at_90(self):
        """Test progress bar is red at 90%."""

        class TestApp(App):
            def compose(self) -> ComposeResult:
                yield UsageDisplay()

        async with TestApp().run_test() as pilot:
            widget = pilot.app.query_one(UsageDisplay)
            bar = widget._progress_bar(95.0)
            assert "red" in bar

    @pytest.mark.asyncio
    async def test_bar_width(self):
        """Test progress bar respects width."""

        class TestApp(App):
            def compose(self) -> ComposeResult:
                yield UsageDisplay()

        async with TestApp().run_test() as pilot:
            widget = pilot.app.query_one(UsageDisplay)
            bar = widget._progress_bar(50.0, width=20)
            # Bar should have 10 filled + 10 empty chars
            assert "█" * 10 in bar
            assert "░" * 10 in bar

    @pytest.mark.asyncio
    async def test_bar_caps_at_100(self):
        """Test progress bar caps at 100%."""

        class TestApp(App):
            def compose(self) -> ComposeResult:
                yield UsageDisplay()

        async with TestApp().run_test() as pilot:
            widget = pilot.app.query_one(UsageDisplay)
            bar = widget._progress_bar(150.0, width=10)
            # Should be fully filled
            assert "█" * 10 in bar
</file>

<file path="tests/backend/conftest.py">
"""Shared fixtures for backend tests."""

from __future__ import annotations

import json
from pathlib import Path
from typing import Any
from unittest.mock import patch

import pytest

from claudiminder.models.usage import ExtraUsage, FiveHourUsage, UsageResponse


@pytest.fixture
def mock_five_hour_usage() -> FiveHourUsage:
    """Create mock FiveHourUsage."""
    return FiveHourUsage(
        utilization=0.45,
        resets_at="2026-01-17T12:00:00Z",
    )


@pytest.fixture
def mock_extra_usage() -> ExtraUsage:
    """Create mock ExtraUsage."""
    return ExtraUsage(
        is_enabled=False,
        monthly_limit=None,
        used_credits=None,
        utilization=None,
    )


@pytest.fixture
def mock_usage_response(
    mock_five_hour_usage: FiveHourUsage,
    mock_extra_usage: ExtraUsage,
) -> UsageResponse:
    """Create mock UsageResponse."""
    return UsageResponse(
        five_hour=mock_five_hour_usage,
        extra_usage=mock_extra_usage,
    )


@pytest.fixture
def mock_usage_json(mock_usage_response: UsageResponse) -> dict[str, Any]:
    """Create mock usage JSON response."""
    return mock_usage_response.model_dump()


@pytest.fixture
def mock_credentials_file(tmp_path: Path) -> Path:
    """Create mock credentials file."""
    creds_data = {
        "claudeAiOauth": {
            "access_token": "test-token-12345",
            "refresh_token": "test-refresh-token",
            "expires_at": 9999999999,
            "subscription_type": "pro",
            "rate_limit_tier": "tier1",
        }
    }
    creds_file = tmp_path / ".credentials.json"
    creds_file.write_text(json.dumps(creds_data))
    return creds_file


@pytest.fixture
def mock_empty_credentials_file(tmp_path: Path) -> Path:
    """Create empty credentials file."""
    creds_file = tmp_path / ".credentials.json"
    creds_file.write_text("{}")
    return creds_file


@pytest.fixture(autouse=True)
def reset_caches():
    """Reset module caches before each test."""
    from claudiminder.api.usage import clear_usage_cache
    from claudiminder.utils.credentials import clear_credentials_cache

    clear_usage_cache()
    clear_credentials_cache()
    yield
    clear_usage_cache()
    clear_credentials_cache()


@pytest.fixture
def mock_settings(tmp_path: Path):
    """Mock settings with test values."""
    from claudiminder.models.settings import Settings

    test_settings = Settings(
        api_base_url="https://api.claude.ai",
        cache_duration_seconds=30,
        credentials_path=tmp_path / ".credentials.json",
        config_dir=tmp_path / "config",
    )

    with patch("claudiminder.models.settings.get_settings", return_value=test_settings):
        yield test_settings
</file>

<file path="tests/backend/test_api_usage.py">
"""Tests for API usage module."""

from __future__ import annotations

from typing import Any
from unittest.mock import AsyncMock, MagicMock, patch

import httpx
import pytest

from claudiminder.api.usage import (
    RateLimitError,
    TokenExpiredError,
    UsageAPI,
    UsageCache,
    clear_usage_cache,
    get_usage_async,
    get_usage_sync,
    is_token_expired,
)
from claudiminder.models.usage import UsageResponse


class TestGetUsageAsync:
    """Tests for get_usage_async function."""

    @pytest.mark.asyncio
    async def test_returns_cached_data_when_valid(
        self,
        mock_usage_response: UsageResponse,
    ):
        """Test cached data is returned when still valid."""
        with patch("claudiminder.api.usage._usage_cache") as mock_cache:
            mock_cache.data = mock_usage_response
            mock_cache.timestamp = 9999999999  # Far future
            mock_cache.token_expired = False

            with patch("claudiminder.api.usage._is_cache_valid", return_value=True):
                result = await get_usage_async()
                assert result == mock_usage_response

    @pytest.mark.asyncio
    async def test_raises_token_expired_when_no_token(self):
        """Test TokenExpiredError when no token available."""
        with patch("claudiminder.api.usage.get_access_token", return_value=None):
            with pytest.raises(TokenExpiredError, match="No OAuth token"):
                await get_usage_async()

    @pytest.mark.asyncio
    async def test_fetches_fresh_data_when_cache_invalid(
        self,
        mock_usage_json: dict[str, Any],
    ):
        """Test fetches fresh data when cache is invalid."""
        clear_usage_cache()

        mock_response = MagicMock()
        mock_response.status_code = 200
        mock_response.json.return_value = mock_usage_json

        with patch("claudiminder.api.usage.get_access_token", return_value="test-token"):
            with patch("claudiminder.api.usage.httpx.AsyncClient") as mock_client:
                mock_instance = AsyncMock()
                mock_instance.get.return_value = mock_response
                mock_client.return_value.__aenter__.return_value = mock_instance

                result = await get_usage_async()

                assert result is not None
                assert result.five_hour is not None
                assert result.five_hour.utilization == 0.45

    @pytest.mark.asyncio
    async def test_raises_token_expired_on_401(self):
        """Test TokenExpiredError on 401 response."""
        with patch("claudiminder.api.usage.get_access_token", return_value="test-token"):
            with patch(
                "claudiminder.api.usage._fetch_usage_async",
                new_callable=AsyncMock,
                side_effect=TokenExpiredError("Token expired"),
            ):
                with pytest.raises(TokenExpiredError):
                    await get_usage_async()

    @pytest.mark.asyncio
    async def test_raises_rate_limit_on_429(self):
        """Test RateLimitError on 429 response."""
        with patch("claudiminder.api.usage.get_access_token", return_value="test-token"):
            with patch(
                "claudiminder.api.usage._fetch_usage_async",
                new_callable=AsyncMock,
                side_effect=RateLimitError("Rate limited"),
            ):
                with pytest.raises(RateLimitError):
                    await get_usage_async()


class TestGetUsageSync:
    """Tests for get_usage_sync function."""

    def test_returns_none_when_no_token(self):
        """Test returns None when no token available."""
        with patch("claudiminder.api.usage.get_access_token", return_value=None):
            result = get_usage_sync()
            assert result is None

    def test_returns_cached_data_when_valid(
        self,
        mock_usage_response: UsageResponse,
    ):
        """Test cached data is returned when still valid."""
        with patch("claudiminder.api.usage._usage_cache") as mock_cache:
            mock_cache.data = mock_usage_response
            mock_cache.timestamp = 9999999999

            with patch("claudiminder.api.usage._is_cache_valid", return_value=True):
                result = get_usage_sync()
                assert result == mock_usage_response

    def test_returns_none_on_401(self):
        """Test returns None on 401 response."""
        mock_response = MagicMock()
        mock_response.status_code = 401

        with patch("claudiminder.api.usage.get_access_token", return_value="test-token"):
            with patch("claudiminder.api.usage.httpx.Client") as mock_client:
                mock_instance = MagicMock()
                mock_instance.get.return_value = mock_response
                mock_client.return_value.__enter__.return_value = mock_instance

                result = get_usage_sync()
                assert result is None
                assert is_token_expired() is True

    def test_returns_none_on_http_error(self):
        """Test returns None on HTTP error."""
        with patch("claudiminder.api.usage.get_access_token", return_value="test-token"):
            with patch("claudiminder.api.usage.httpx.Client") as mock_client:
                mock_instance = MagicMock()
                mock_instance.get.side_effect = httpx.HTTPError("Network error")
                mock_client.return_value.__enter__.return_value = mock_instance

                result = get_usage_sync()
                assert result is None


class TestUsageCache:
    """Tests for UsageCache class."""

    def test_cache_creation(self, mock_usage_response: UsageResponse):
        """Test cache creation with data."""
        cache = UsageCache(
            data=mock_usage_response,
            timestamp=1234567890.0,
            token_expired=False,
        )
        assert cache.data == mock_usage_response
        assert cache.timestamp == 1234567890.0
        assert cache.token_expired is False

    def test_cache_with_token_expired(self):
        """Test cache with token expired flag."""
        cache = UsageCache(
            data=None,
            timestamp=1234567890.0,
            token_expired=True,
        )
        assert cache.data is None
        assert cache.token_expired is True


class TestIsTokenExpired:
    """Tests for is_token_expired function."""

    def test_returns_false_when_no_cache(self):
        """Test returns False when no cache exists."""
        clear_usage_cache()
        assert is_token_expired() is False

    def test_returns_true_when_token_expired_in_cache(self):
        """Test returns True when token is expired in cache."""
        import claudiminder.api.usage as usage_module

        usage_module._usage_cache = UsageCache(
            data=None,
            timestamp=1234567890.0,
            token_expired=True,
        )
        assert is_token_expired() is True


class TestUsageAPI:
    """Tests for UsageAPI class."""

    @pytest.mark.asyncio
    async def test_get_usage_success(self, mock_usage_response: UsageResponse):
        """Test successful usage fetch."""
        api = UsageAPI()

        with patch(
            "claudiminder.api.usage.get_usage_async",
            new_callable=AsyncMock,
            return_value=mock_usage_response,
        ):
            result = await api.get_usage()
            assert result == mock_usage_response

    @pytest.mark.asyncio
    async def test_get_usage_raises_on_token_expired(self):
        """Test raises RuntimeError on token expiry."""
        api = UsageAPI()

        with patch(
            "claudiminder.api.usage.get_usage_async",
            new_callable=AsyncMock,
            return_value=None,
        ):
            with patch("claudiminder.api.usage.is_token_expired", return_value=True):
                with pytest.raises(RuntimeError, match="Token expired"):
                    await api.get_usage()

    def test_get_usage_sync_wrapped_success(self, mock_usage_response: UsageResponse):
        """Test successful sync usage fetch."""
        api = UsageAPI()

        with patch(
            "claudiminder.api.usage.get_usage_sync",
            return_value=mock_usage_response,
        ):
            result = api.get_usage_sync_wrapped()
            assert result == mock_usage_response

    def test_get_usage_sync_wrapped_raises_on_failure(self):
        """Test raises RuntimeError on failure."""
        api = UsageAPI()

        with patch("claudiminder.api.usage.get_usage_sync", return_value=None):
            with patch("claudiminder.api.usage.is_token_expired", return_value=False):
                with pytest.raises(RuntimeError, match="Failed to fetch"):
                    api.get_usage_sync_wrapped()
</file>

<file path="tests/backend/test_config_manager.py">
"""Tests for config manager module."""
import pytest
from pathlib import Path
import tempfile
import os

from claudiminder.core.config_manager import (
    AppConfig,
    ReminderConfig,
    FocusModeConfig,
    GoalsConfig,
    load_config,
    save_config,
    CONFIG_DIR,
    CONFIG_FILE,
)


class TestConfigModels:
    """Test configuration Pydantic models."""

    def test_reminder_config_defaults(self):
        """Test ReminderConfig has correct defaults."""
        config = ReminderConfig()
        assert config.enabled is True
        assert config.before_reset_minutes == [15, 30, 60]
        assert config.on_reset is True
        assert config.percentage_thresholds == [50, 75, 90, 100]
        assert config.snooze_minutes == [5, 15, 30]
        assert config.custom_command is None
        assert config.custom_url is None

    def test_focus_mode_config_defaults(self):
        """Test FocusModeConfig has correct defaults."""
        config = FocusModeConfig()
        assert config.enabled is False
        assert config.dnd_threshold == 80
        assert config.quiet_hours_start is None
        assert config.quiet_hours_end is None

    def test_goals_config_defaults(self):
        """Test GoalsConfig has correct defaults."""
        config = GoalsConfig()
        assert config.enabled is False
        assert config.daily_budget_percent == 100
        assert config.warn_when_pace_exceeded is True

    def test_app_config_defaults(self):
        """Test AppConfig has correct defaults."""
        config = AppConfig()
        assert config.language == "en"
        assert config.log_level == "INFO"
        assert config.poll_interval_seconds == 60
        assert isinstance(config.reminder, ReminderConfig)
        assert isinstance(config.focus_mode, FocusModeConfig)
        assert isinstance(config.goals, GoalsConfig)

    def test_app_config_custom_values(self):
        """Test AppConfig with custom values."""
        config = AppConfig(
            language="vi",
            log_level="DEBUG",
            poll_interval_seconds=30,
            reminder=ReminderConfig(enabled=False),
            focus_mode=FocusModeConfig(enabled=True, dnd_threshold=90),
            goals=GoalsConfig(enabled=True, daily_budget_percent=80),
        )
        assert config.language == "vi"
        assert config.log_level == "DEBUG"
        assert config.poll_interval_seconds == 30
        assert config.reminder.enabled is False
        assert config.focus_mode.enabled is True
        assert config.focus_mode.dnd_threshold == 90
        assert config.goals.enabled is True
        assert config.goals.daily_budget_percent == 80


class TestConfigIO:
    """Test config file I/O operations."""

    def test_load_config_no_file(self, monkeypatch, tmp_path):
        """Test loading config when file doesn't exist returns defaults."""
        # Point to non-existent file
        fake_config = tmp_path / "nonexistent" / "config.toml"
        monkeypatch.setattr("claudiminder.core.config_manager.CONFIG_FILE", fake_config)

        config = load_config()
        assert isinstance(config, AppConfig)
        assert config.language == "en"

    def test_save_and_load_config(self, monkeypatch, tmp_path):
        """Test saving and loading config round-trip."""
        fake_dir = tmp_path / "claudiminder"
        fake_file = fake_dir / "config.toml"
        monkeypatch.setattr("claudiminder.core.config_manager.CONFIG_DIR", fake_dir)
        monkeypatch.setattr("claudiminder.core.config_manager.CONFIG_FILE", fake_file)

        # Create and save config
        original = AppConfig(
            language="vi",
            poll_interval_seconds=120,
            focus_mode=FocusModeConfig(enabled=True),
        )
        save_config(original)

        # Verify file exists
        assert fake_file.exists()

        # Load and verify
        loaded = load_config()
        assert loaded.language == "vi"
        assert loaded.poll_interval_seconds == 120
        assert loaded.focus_mode.enabled is True
</file>

<file path="tests/backend/test_credentials.py">
"""Tests for credentials module."""

from __future__ import annotations

import json
from pathlib import Path
from unittest.mock import patch

import pytest

from claudiminder.utils.credentials import (
    CredentialsFile,
    OAuthCredentials,
    clear_credentials_cache,
    get_access_token,
    get_credentials_path,
    is_token_available,
    load_credentials,
)


class TestOAuthCredentials:
    """Tests for OAuthCredentials model."""

    def test_create_minimal(self):
        """Test creating with only required fields."""
        creds = OAuthCredentials(access_token="test-token")
        assert creds.access_token.get_secret_value() == "test-token"
        assert creds.refresh_token is None
        assert creds.expires_at is None

    def test_create_full(self):
        """Test creating with all fields."""
        creds = OAuthCredentials(
            access_token="test-token",
            refresh_token="refresh-token",
            expires_at=1234567890,
            subscription_type="pro",
            rate_limit_tier="tier1",
        )
        assert creds.access_token.get_secret_value() == "test-token"
        assert creds.refresh_token is not None
        assert creds.refresh_token.get_secret_value() == "refresh-token"
        assert creds.expires_at == 1234567890
        assert creds.subscription_type == "pro"
        assert creds.rate_limit_tier == "tier1"

    def test_secret_str_hidden(self):
        """Test that SecretStr hides token in repr."""
        creds = OAuthCredentials(access_token="secret-value")
        repr_str = repr(creds.access_token)
        assert "secret-value" not in repr_str
        assert "**********" in repr_str


class TestCredentialsFile:
    """Tests for CredentialsFile model."""

    def test_empty_file(self):
        """Test parsing empty credentials file."""
        creds_file = CredentialsFile.model_validate({})
        assert creds_file.claudeAiOauth is None

    def test_with_oauth(self):
        """Test parsing file with OAuth credentials."""
        data = {
            "claudeAiOauth": {
                "access_token": "test-token",
                "subscription_type": "pro",
            }
        }
        creds_file = CredentialsFile.model_validate(data)
        assert creds_file.claudeAiOauth is not None
        assert creds_file.claudeAiOauth.access_token.get_secret_value() == "test-token"


class TestLoadCredentials:
    """Tests for load_credentials function."""

    def test_returns_none_when_file_missing(self, tmp_path: Path):
        """Test returns None when file doesn't exist."""
        clear_credentials_cache()
        with patch(
            "claudiminder.utils.credentials.get_credentials_path",
            return_value=tmp_path / "nonexistent.json",
        ):
            result = load_credentials()
            assert result is None

    def test_loads_valid_credentials(self, mock_credentials_file: Path):
        """Test loads valid credentials from file."""
        clear_credentials_cache()
        with patch(
            "claudiminder.utils.credentials.get_credentials_path",
            return_value=mock_credentials_file,
        ):
            result = load_credentials()
            assert result is not None
            assert result.access_token.get_secret_value() == "test-token-12345"

    def test_returns_none_for_empty_oauth(self, mock_empty_credentials_file: Path):
        """Test returns None when no OAuth in file."""
        clear_credentials_cache()
        with patch(
            "claudiminder.utils.credentials.get_credentials_path",
            return_value=mock_empty_credentials_file,
        ):
            result = load_credentials()
            assert result is None

    def test_returns_none_for_invalid_json(self, tmp_path: Path):
        """Test returns None for invalid JSON."""
        clear_credentials_cache()
        invalid_file = tmp_path / ".credentials.json"
        invalid_file.write_text("not valid json{")

        with patch(
            "claudiminder.utils.credentials.get_credentials_path",
            return_value=invalid_file,
        ):
            result = load_credentials()
            assert result is None

    def test_uses_cache_on_second_call(self, mock_credentials_file: Path):
        """Test uses cache on second call."""
        clear_credentials_cache()
        with patch(
            "claudiminder.utils.credentials.get_credentials_path",
            return_value=mock_credentials_file,
        ):
            result1 = load_credentials()
            result2 = load_credentials()
            assert result1 is result2


class TestGetAccessToken:
    """Tests for get_access_token function."""

    def test_returns_token_when_available(self, mock_credentials_file: Path):
        """Test returns token when credentials available."""
        clear_credentials_cache()
        with patch(
            "claudiminder.utils.credentials.get_credentials_path",
            return_value=mock_credentials_file,
        ):
            token = get_access_token()
            assert token == "test-token-12345"

    def test_returns_none_when_no_credentials(self, tmp_path: Path):
        """Test returns None when no credentials."""
        clear_credentials_cache()
        with patch(
            "claudiminder.utils.credentials.get_credentials_path",
            return_value=tmp_path / "nonexistent.json",
        ):
            token = get_access_token()
            assert token is None


class TestIsTokenAvailable:
    """Tests for is_token_available function."""

    def test_returns_true_when_token_exists(self, mock_credentials_file: Path):
        """Test returns True when token exists."""
        clear_credentials_cache()
        with patch(
            "claudiminder.utils.credentials.get_credentials_path",
            return_value=mock_credentials_file,
        ):
            assert is_token_available() is True

    def test_returns_false_when_no_token(self, tmp_path: Path):
        """Test returns False when no token."""
        clear_credentials_cache()
        with patch(
            "claudiminder.utils.credentials.get_credentials_path",
            return_value=tmp_path / "nonexistent.json",
        ):
            assert is_token_available() is False


class TestClearCredentialsCache:
    """Tests for clear_credentials_cache function."""

    def test_clears_cache(self, mock_credentials_file: Path):
        """Test cache is cleared."""
        with patch(
            "claudiminder.utils.credentials.get_credentials_path",
            return_value=mock_credentials_file,
        ):
            load_credentials()  # Load into cache
            clear_credentials_cache()

            # Modify file
            mock_credentials_file.write_text(
                json.dumps(
                    {
                        "claudeAiOauth": {
                            "access_token": "new-token",
                        }
                    }
                )
            )

            result = load_credentials()
            assert result is not None
            assert result.access_token.get_secret_value() == "new-token"
</file>

<file path="tests/backend/test_focus_mode.py">
"""Tests for focus mode service."""
import pytest
from datetime import datetime, timedelta

from claudiminder.scheduler.focus_mode import (
    FocusModeService,
    get_focus_mode_service,
)
from claudiminder.core.config_manager import AppConfig, FocusModeConfig


class TestFocusModeService:
    """Test FocusModeService functionality."""

    def test_snooze(self):
        """Test snoozing notifications."""
        service = FocusModeService()
        assert service.is_snoozed() is False

        service.snooze(5)
        assert service.is_snoozed() is True
        assert service.get_snooze_remaining() > 0

    def test_clear_snooze(self):
        """Test clearing snooze."""
        service = FocusModeService()
        service.snooze(5)
        assert service.is_snoozed() is True

        service.clear_snooze()
        assert service.is_snoozed() is False
        assert service.get_snooze_remaining() == 0

    def test_is_dnd_by_usage_disabled(self, monkeypatch):
        """Test DND when focus mode disabled."""
        monkeypatch.setattr(
            "claudiminder.scheduler.focus_mode.load_config",
            lambda: AppConfig(focus_mode=FocusModeConfig(enabled=False)),
        )

        service = FocusModeService()
        assert service.is_dnd_by_usage(100.0) is False

    def test_is_dnd_by_usage_enabled(self, monkeypatch):
        """Test DND when usage exceeds threshold."""
        monkeypatch.setattr(
            "claudiminder.scheduler.focus_mode.load_config",
            lambda: AppConfig(
                focus_mode=FocusModeConfig(enabled=True, dnd_threshold=80)
            ),
        )

        service = FocusModeService()
        assert service.is_dnd_by_usage(50.0) is False
        assert service.is_dnd_by_usage(85.0) is True

    def test_is_in_quiet_hours_disabled(self, monkeypatch):
        """Test quiet hours when disabled."""
        monkeypatch.setattr(
            "claudiminder.scheduler.focus_mode.load_config",
            lambda: AppConfig(focus_mode=FocusModeConfig(enabled=False)),
        )

        service = FocusModeService()
        assert service.is_in_quiet_hours() is False

    def test_is_in_quiet_hours_no_config(self, monkeypatch):
        """Test quiet hours when not configured."""
        monkeypatch.setattr(
            "claudiminder.scheduler.focus_mode.load_config",
            lambda: AppConfig(
                focus_mode=FocusModeConfig(
                    enabled=True,
                    quiet_hours_start=None,
                    quiet_hours_end=None,
                )
            ),
        )

        service = FocusModeService()
        assert service.is_in_quiet_hours() is False

    def test_should_suppress_notification_snoozed(self, monkeypatch):
        """Test suppression when snoozed."""
        monkeypatch.setattr(
            "claudiminder.scheduler.focus_mode.load_config",
            lambda: AppConfig(focus_mode=FocusModeConfig(enabled=False)),
        )

        service = FocusModeService()
        service.snooze(5)
        assert service.should_suppress_notification(50.0) is True

    def test_get_suppression_reason_snoozed(self, monkeypatch):
        """Test getting suppression reason when snoozed."""
        monkeypatch.setattr(
            "claudiminder.scheduler.focus_mode.load_config",
            lambda: AppConfig(focus_mode=FocusModeConfig(enabled=False)),
        )

        service = FocusModeService()
        service.snooze(5)
        reason = service.get_suppression_reason(50.0)
        assert "Snoozed" in reason

    def test_get_suppression_reason_none(self, monkeypatch):
        """Test getting suppression reason when not suppressed."""
        monkeypatch.setattr(
            "claudiminder.scheduler.focus_mode.load_config",
            lambda: AppConfig(focus_mode=FocusModeConfig(enabled=False)),
        )

        service = FocusModeService()
        reason = service.get_suppression_reason(50.0)
        assert reason is None

    def test_singleton_instance(self):
        """Test get_focus_mode_service returns singleton."""
        service1 = get_focus_mode_service()
        service2 = get_focus_mode_service()
        assert service1 is service2
</file>

<file path="tests/backend/test_goals_tracker.py">
"""Tests for goals tracker module."""
import pytest
from datetime import datetime

from claudiminder.core.goals_tracker import (
    GoalsTracker,
    PaceStatus,
    get_goals_tracker,
)
from claudiminder.core.config_manager import AppConfig, GoalsConfig


class TestPaceStatus:
    """Test PaceStatus named tuple."""

    def test_pace_status_creation(self):
        """Test creating PaceStatus."""
        status = PaceStatus(
            is_on_track=True,
            current_usage=50.0,
            expected_usage=60.0,
            message="On track",
        )
        assert status.is_on_track is True
        assert status.current_usage == 50.0
        assert status.expected_usage == 60.0
        assert status.message == "On track"


class TestGoalsTracker:
    """Test GoalsTracker class."""

    def test_calculate_pace_disabled(self, monkeypatch):
        """Test pace calculation when goals disabled."""
        # Mock config to return disabled goals
        monkeypatch.setattr(
            "claudiminder.core.goals_tracker.load_config",
            lambda: AppConfig(goals=GoalsConfig(enabled=False)),
        )

        tracker = GoalsTracker()
        pace = tracker.calculate_pace(50.0)

        assert pace.is_on_track is True
        assert pace.current_usage == 50.0
        assert pace.expected_usage == 0
        assert pace.message == ""

    def test_calculate_pace_on_track(self, monkeypatch):
        """Test pace calculation when on track."""
        monkeypatch.setattr(
            "claudiminder.core.goals_tracker.load_config",
            lambda: AppConfig(goals=GoalsConfig(enabled=True, daily_budget_percent=100)),
        )

        tracker = GoalsTracker()
        # With 100% daily budget, any reasonable usage should be on track
        pace = tracker.calculate_pace(10.0)

        assert pace.is_on_track is True
        assert pace.current_usage == 10.0
        assert "On track" in pace.message or pace.message != ""

    def test_get_budget_status(self, monkeypatch):
        """Test budget status calculation."""
        monkeypatch.setattr(
            "claudiminder.core.goals_tracker.load_config",
            lambda: AppConfig(goals=GoalsConfig(enabled=True, daily_budget_percent=80)),
        )

        tracker = GoalsTracker()
        used, budget, exceeded = tracker.get_budget_status(75.0)

        assert used == 75.0
        assert budget == 80
        assert exceeded is False

    def test_get_budget_status_exceeded(self, monkeypatch):
        """Test budget status when exceeded."""
        monkeypatch.setattr(
            "claudiminder.core.goals_tracker.load_config",
            lambda: AppConfig(goals=GoalsConfig(enabled=True, daily_budget_percent=50)),
        )

        tracker = GoalsTracker()
        used, budget, exceeded = tracker.get_budget_status(75.0)

        assert used == 75.0
        assert budget == 50
        assert exceeded is True

    def test_should_warn(self, monkeypatch):
        """Test should_warn when goals enabled."""
        monkeypatch.setattr(
            "claudiminder.core.goals_tracker.load_config",
            lambda: AppConfig(
                goals=GoalsConfig(
                    enabled=True,
                    daily_budget_percent=100,
                    warn_when_pace_exceeded=True,
                )
            ),
        )

        tracker = GoalsTracker()
        # Low usage should not warn
        assert tracker.should_warn(10.0) is False

    def test_should_warn_disabled(self, monkeypatch):
        """Test should_warn when goals disabled."""
        monkeypatch.setattr(
            "claudiminder.core.goals_tracker.load_config",
            lambda: AppConfig(goals=GoalsConfig(enabled=False)),
        )

        tracker = GoalsTracker()
        assert tracker.should_warn(100.0) is False

    def test_singleton_instance(self):
        """Test get_goals_tracker returns singleton."""
        tracker1 = get_goals_tracker()
        tracker2 = get_goals_tracker()
        assert tracker1 is tracker2
</file>

<file path="tests/backend/test_i18n.py">
"""Tests for i18n module."""
import pytest

from claudiminder.i18n import (
    set_language,
    get_language,
    get_string,
    get_all_strings,
    LANGUAGES,
)


class TestI18n:
    """Test internationalization functionality."""

    def test_default_language(self):
        """Test default language is English."""
        set_language("en")  # Reset to default
        assert get_language() == "en"

    def test_set_language_english(self):
        """Test setting language to English."""
        set_language("en")
        assert get_language() == "en"

    def test_set_language_vietnamese(self):
        """Test setting language to Vietnamese."""
        set_language("vi")
        assert get_language() == "vi"
        # Reset for other tests
        set_language("en")

    def test_set_language_invalid(self):
        """Test setting invalid language raises error."""
        with pytest.raises(ValueError) as exc_info:
            set_language("fr")
        assert "Unsupported language" in str(exc_info.value)

    def test_get_string_english(self):
        """Test getting string in English."""
        set_language("en")
        assert get_string("usage_title") == "Claude Usage"
        assert get_string("loading") == "Loading..."

    def test_get_string_vietnamese(self):
        """Test getting string in Vietnamese."""
        set_language("vi")
        assert get_string("usage_title") == "Sử dụng Claude"
        assert get_string("loading") == "Đang tải..."
        set_language("en")

    def test_get_string_with_formatting(self):
        """Test getting string with format kwargs."""
        set_language("en")
        result = get_string("reminder_soon", minutes=15)
        assert "15" in result
        assert "minutes" in result

    def test_get_string_unknown_key(self):
        """Test getting unknown key returns the key."""
        set_language("en")
        result = get_string("unknown_key_xyz")
        assert result == "unknown_key_xyz"

    def test_get_all_strings(self):
        """Test getting all strings for current language."""
        set_language("en")
        strings = get_all_strings()
        assert isinstance(strings, dict)
        assert "usage_title" in strings
        assert strings["usage_title"] == "Claude Usage"

    def test_languages_available(self):
        """Test available languages."""
        assert "en" in LANGUAGES
        assert "vi" in LANGUAGES
        assert len(LANGUAGES) == 2
</file>

<file path="tests/backend/test_instance_lock.py">
"""Tests for instance lock module."""
import pytest
from pathlib import Path

from claudiminder.core.instance_lock import (
    acquire_instance_lock,
    release_instance_lock,
    is_another_instance_running,
)


class TestInstanceLock:
    """Test single instance lock functionality."""

    def test_acquire_lock_success(self, monkeypatch, tmp_path):
        """Test acquiring lock when no other instance."""
        fake_lock = tmp_path / ".lock"
        monkeypatch.setattr("claudiminder.core.instance_lock.LOCK_FILE", fake_lock)
        # Reset global state
        monkeypatch.setattr("claudiminder.core.instance_lock._current_lock", None)

        lock = acquire_instance_lock()
        assert lock is not None

        # Clean up
        release_instance_lock()

    def test_is_another_instance_running_false(self, monkeypatch, tmp_path):
        """Test detecting no other instance running."""
        fake_lock = tmp_path / ".lock"
        monkeypatch.setattr("claudiminder.core.instance_lock.LOCK_FILE", fake_lock)

        result = is_another_instance_running()
        assert result is False

    def test_release_lock(self, monkeypatch, tmp_path):
        """Test releasing acquired lock."""
        fake_lock = tmp_path / ".lock"
        monkeypatch.setattr("claudiminder.core.instance_lock.LOCK_FILE", fake_lock)
        monkeypatch.setattr("claudiminder.core.instance_lock._current_lock", None)

        # Acquire first
        lock = acquire_instance_lock()
        assert lock is not None

        # Release
        release_instance_lock()

        # Should be able to acquire again
        assert is_another_instance_running() is False
</file>

<file path="tests/backend/test_models.py">
"""Tests for Pydantic models."""

from __future__ import annotations

import pytest
from pydantic import ValidationError

from claudiminder.models.usage import ExtraUsage, FiveHourUsage, UsageResponse


class TestFiveHourUsage:
    """Tests for FiveHourUsage model."""

    def test_valid_creation(self):
        """Test creating valid FiveHourUsage."""
        usage = FiveHourUsage(
            utilization=0.5,
            resets_at="2026-01-17T12:00:00Z",
        )
        assert usage.utilization == 0.5
        assert usage.resets_at == "2026-01-17T12:00:00Z"

    def test_utilization_zero(self):
        """Test utilization at zero."""
        usage = FiveHourUsage(utilization=0.0, resets_at="2026-01-17T12:00:00Z")
        assert usage.utilization == 0.0

    def test_utilization_full(self):
        """Test utilization at full."""
        usage = FiveHourUsage(utilization=1.0, resets_at="2026-01-17T12:00:00Z")
        assert usage.utilization == 1.0

    def test_utilization_over_full(self):
        """Test utilization over 100% is valid."""
        usage = FiveHourUsage(utilization=1.5, resets_at="2026-01-17T12:00:00Z")
        assert usage.utilization == 1.5

    def test_missing_utilization_raises(self):
        """Test missing utilization raises ValidationError."""
        with pytest.raises(ValidationError):
            FiveHourUsage(resets_at="2026-01-17T12:00:00Z")  # type: ignore

    def test_missing_resets_at_raises(self):
        """Test missing resets_at raises ValidationError."""
        with pytest.raises(ValidationError):
            FiveHourUsage(utilization=0.5)  # type: ignore


class TestExtraUsage:
    """Tests for ExtraUsage model."""

    def test_disabled_extra_usage(self):
        """Test disabled extra usage."""
        usage = ExtraUsage(is_enabled=False)
        assert usage.is_enabled is False
        assert usage.monthly_limit is None
        assert usage.used_credits is None
        assert usage.utilization is None

    def test_enabled_extra_usage(self):
        """Test enabled extra usage with limits."""
        usage = ExtraUsage(
            is_enabled=True,
            monthly_limit=100.0,
            used_credits=45.0,
            utilization=0.45,
        )
        assert usage.is_enabled is True
        assert usage.monthly_limit == 100.0
        assert usage.used_credits == 45.0
        assert usage.utilization == 0.45


class TestUsageResponse:
    """Tests for UsageResponse model."""

    def test_full_response(self):
        """Test full response with all fields."""
        response = UsageResponse(
            five_hour=FiveHourUsage(
                utilization=0.3,
                resets_at="2026-01-17T12:00:00Z",
            ),
            extra_usage=ExtraUsage(is_enabled=False),
        )
        assert response.five_hour is not None
        assert response.five_hour.utilization == 0.3
        assert response.extra_usage is not None
        assert response.extra_usage.is_enabled is False

    def test_minimal_response(self):
        """Test minimal response with only required fields."""
        response = UsageResponse()
        assert response.five_hour is None
        assert response.extra_usage is None

    def test_from_api_json(self):
        """Test creating from API JSON response."""
        json_data = {
            "five_hour": {
                "utilization": 0.75,
                "resets_at": "2026-01-17T15:30:00Z",
            },
            "extra_usage": {
                "is_enabled": True,
                "monthly_limit": 50.0,
                "used_credits": 25.0,
                "utilization": 0.5,
            },
        }
        response = UsageResponse.model_validate(json_data)
        assert response.five_hour is not None
        assert response.five_hour.utilization == 0.75
        assert response.extra_usage is not None
        assert response.extra_usage.monthly_limit == 50.0

    def test_model_dump(self):
        """Test model serialization."""
        response = UsageResponse(
            five_hour=FiveHourUsage(
                utilization=0.5,
                resets_at="2026-01-17T12:00:00Z",
            ),
        )
        dumped = response.model_dump()
        assert "five_hour" in dumped
        assert dumped["five_hour"]["utilization"] == 0.5
</file>

<file path="tests/backend/test_sidecar.py">
"""Tests for sidecar module."""

from __future__ import annotations

import json
from datetime import datetime
from unittest.mock import AsyncMock, MagicMock, patch

import pytest

from claudiminder.sidecar import (
    _deep_merge,
    _json_response,
    check_reminders,
    check_token,
    clear_snooze,
    get_config,
    get_usage,
    refresh_usage,
    set_config,
    snooze,
)


class TestJsonResponse:
    """Tests for _json_response helper."""

    def test_empty_response(self):
        """Test empty response."""
        result = _json_response()
        assert json.loads(result) == {}

    def test_data_response(self):
        """Test response with data."""
        result = _json_response(data={"key": "value"})
        parsed = json.loads(result)
        assert parsed["key"] == "value"

    def test_error_response(self):
        """Test response with error."""
        result = _json_response(error="Test error")
        parsed = json.loads(result)
        assert parsed["error"] == "Test error"

    def test_data_and_error(self):
        """Test response with both data and error."""
        result = _json_response(data={"status": "partial"}, error="Warning")
        parsed = json.loads(result)
        assert parsed["status"] == "partial"
        assert parsed["error"] == "Warning"


class TestDeepMerge:
    """Tests for _deep_merge helper."""

    def test_simple_merge(self):
        """Test simple merge."""
        base = {"a": 1, "b": 2}
        updates = {"b": 3, "c": 4}
        _deep_merge(base, updates)
        assert base == {"a": 1, "b": 3, "c": 4}

    def test_nested_merge(self):
        """Test nested dict merge."""
        base = {"a": {"x": 1, "y": 2}}
        updates = {"a": {"y": 3, "z": 4}}
        _deep_merge(base, updates)
        assert base == {"a": {"x": 1, "y": 3, "z": 4}}

    def test_replace_non_dict(self):
        """Test replacing non-dict values."""
        base = {"a": {"x": 1}}
        updates = {"a": "string"}
        _deep_merge(base, updates)
        assert base == {"a": "string"}


class TestGetUsage:
    """Tests for get_usage function."""

    @pytest.mark.asyncio
    async def test_returns_error_when_no_token(self):
        """Test returns error when no token available."""
        with patch("claudiminder.sidecar.is_token_available", return_value=False):
            result = await get_usage()
            parsed = json.loads(result)
            assert "error" in parsed
            assert parsed["token_expired"] is True

    @pytest.mark.asyncio
    async def test_returns_usage_data(self):
        """Test returns usage data on success."""
        mock_usage = MagicMock()
        mock_usage.five_hour = MagicMock()
        mock_usage.five_hour.utilization = 0.45
        mock_usage.five_hour.resets_at = "2026-01-17T12:00:00Z"

        with patch("claudiminder.sidecar.is_token_available", return_value=True):
            with patch(
                "claudiminder.sidecar.get_usage_async",
                new_callable=AsyncMock,
                return_value=mock_usage,
            ):
                with patch("claudiminder.sidecar.get_goals_tracker") as mock_tracker:
                    mock_pace = MagicMock()
                    mock_pace.is_on_track = True
                    mock_pace.current_usage = 0.45
                    mock_pace.expected_usage = 0.5
                    mock_pace.message = "On track"
                    mock_tracker.return_value.calculate_pace.return_value = mock_pace

                    with patch("claudiminder.sidecar.load_config") as mock_config:
                        mock_config.return_value.goals.enabled = True

                        with patch(
                            "claudiminder.sidecar.get_focus_mode_service"
                        ) as mock_focus:
                            mock_focus_instance = MagicMock()
                            mock_focus_instance.is_snoozed.return_value = False
                            mock_focus_instance.get_snooze_remaining.return_value = 0
                            mock_focus_instance.is_in_quiet_hours.return_value = False
                            mock_focus_instance.is_dnd_by_usage.return_value = False
                            mock_focus_instance.should_suppress_notification.return_value = (
                                False
                            )
                            mock_focus.return_value = mock_focus_instance

                            result = await get_usage()
                            parsed = json.loads(result)

                            assert "five_hour" in parsed
                            assert parsed["five_hour"]["utilization"] == 0.45

    @pytest.mark.asyncio
    async def test_handles_token_expired_error(self):
        """Test handles TokenExpiredError."""
        from claudiminder.api.usage import TokenExpiredError

        with patch("claudiminder.sidecar.is_token_available", return_value=True):
            with patch(
                "claudiminder.sidecar.get_usage_async",
                new_callable=AsyncMock,
                side_effect=TokenExpiredError("Token expired"),
            ):
                result = await get_usage()
                parsed = json.loads(result)
                assert parsed["token_expired"] is True

    @pytest.mark.asyncio
    async def test_handles_rate_limit_error(self):
        """Test handles RateLimitError."""
        from claudiminder.api.usage import RateLimitError

        with patch("claudiminder.sidecar.is_token_available", return_value=True):
            with patch(
                "claudiminder.sidecar.get_usage_async",
                new_callable=AsyncMock,
                side_effect=RateLimitError("Rate limited"),
            ):
                result = await get_usage()
                parsed = json.loads(result)
                assert parsed["rate_limited"] is True

    @pytest.mark.asyncio
    async def test_handles_network_error(self):
        """Test handles network error for offline mode."""
        with patch("claudiminder.sidecar.is_token_available", return_value=True):
            with patch(
                "claudiminder.sidecar.get_usage_async",
                new_callable=AsyncMock,
                side_effect=Exception("Connection timeout"),
            ):
                result = await get_usage()
                parsed = json.loads(result)
                assert parsed["offline"] is True


class TestRefreshUsage:
    """Tests for refresh_usage function."""

    @pytest.mark.asyncio
    async def test_clears_cache_and_fetches(self):
        """Test clears cache before fetching."""
        with patch("claudiminder.sidecar.clear_usage_cache") as mock_clear:
            with patch(
                "claudiminder.sidecar.get_usage",
                new_callable=AsyncMock,
                return_value='{"five_hour": null}',
            ):
                await refresh_usage()
                mock_clear.assert_called_once()


class TestCheckToken:
    """Tests for check_token function."""

    def test_returns_true_when_available(self):
        """Test returns True when token available."""
        with patch("claudiminder.sidecar.is_token_available", return_value=True):
            result = check_token()
            parsed = json.loads(result)
            assert parsed["available"] is True

    def test_returns_false_when_not_available(self):
        """Test returns False when token not available."""
        with patch("claudiminder.sidecar.is_token_available", return_value=False):
            result = check_token()
            parsed = json.loads(result)
            assert parsed["available"] is False


class TestSnooze:
    """Tests for snooze function."""

    def test_snoozes_notifications(self):
        """Test snoozes notifications for specified minutes."""
        with patch("claudiminder.sidecar.get_focus_mode_service") as mock_focus:
            mock_instance = MagicMock()
            mock_instance.get_snooze_remaining.return_value = 15 * 60
            mock_focus.return_value = mock_instance

            result = snooze(15)
            parsed = json.loads(result)

            assert parsed["success"] is True
            mock_instance.snooze.assert_called_once_with(15)


class TestClearSnooze:
    """Tests for clear_snooze function."""

    def test_clears_snooze(self):
        """Test clears active snooze."""
        with patch("claudiminder.sidecar.get_focus_mode_service") as mock_focus:
            mock_instance = MagicMock()
            mock_focus.return_value = mock_instance

            result = clear_snooze()
            parsed = json.loads(result)

            assert parsed["success"] is True
            mock_instance.clear_snooze.assert_called_once()


class TestGetConfig:
    """Tests for get_config function."""

    def test_returns_config(self):
        """Test returns current config."""
        with patch("claudiminder.sidecar.load_config") as mock_load:
            mock_config = MagicMock()
            mock_config.model_dump.return_value = {"language": "en"}
            mock_load.return_value = mock_config

            result = get_config()
            parsed = json.loads(result)

            assert "config" in parsed
            assert parsed["config"]["language"] == "en"


class TestSetConfig:
    """Tests for set_config function."""

    def test_updates_config(self):
        """Test updates config with new values."""
        with patch("claudiminder.sidecar.load_config") as mock_load:
            mock_config = MagicMock()
            mock_config.model_dump.return_value = {"language": "en", "theme": "dark"}
            mock_load.return_value = mock_config

            with patch("claudiminder.sidecar.save_config"):
                with patch("claudiminder.sidecar.AppConfig") as mock_app_config:
                    mock_new_config = MagicMock()
                    mock_new_config.model_dump.return_value = {
                        "language": "vi",
                        "theme": "dark",
                    }
                    mock_app_config.model_validate.return_value = mock_new_config

                    result = set_config('{"language": "vi"}')
                    parsed = json.loads(result)

                    assert parsed["success"] is True

    def test_handles_invalid_json(self):
        """Test handles invalid JSON input."""
        result = set_config("not valid json")
        parsed = json.loads(result)
        assert "error" in parsed


class TestCheckReminders:
    """Tests for check_reminders function."""

    def test_triggers_reminders(self):
        """Test triggers reminders based on state."""
        with patch("claudiminder.sidecar.get_reminder_service") as mock_service:
            from claudiminder.scheduler.reminder_service import ReminderType

            mock_instance = MagicMock()
            mock_instance.check_and_trigger.return_value = [
                (ReminderType.PERCENTAGE, "90% usage reached")
            ]
            mock_service.return_value = mock_instance

            result = check_reminders(0.9, "2026-01-17T12:00:00Z")
            parsed = json.loads(result)

            assert "triggered" in parsed
            assert len(parsed["triggered"]) == 1
            assert parsed["triggered"][0]["type"] == "percentage"

    def test_handles_no_reset_time(self):
        """Test handles missing reset time."""
        with patch("claudiminder.sidecar.get_reminder_service") as mock_service:
            mock_instance = MagicMock()
            mock_instance.check_and_trigger.return_value = []
            mock_service.return_value = mock_instance

            result = check_reminders(0.5, None)
            parsed = json.loads(result)

            assert parsed["triggered"] == []
</file>

<file path=".pre-commit-config.yaml">
repos:
  # Python linting and formatting
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.0
    hooks:
      - id: ruff
        args: [--fix]
      - id: ruff-format

  # Python type checking
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.14.0
    hooks:
      - id: mypy
        additional_dependencies:
          - pydantic>=2.10.0
          - types-toml
        args: [--config-file=pyproject.toml]
        exclude: ^tests/

  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
        args: [--unsafe]
      - id: check-json
      - id: check-toml
      - id: check-added-large-files
        args: [--maxkb=1000]
      - id: check-merge-conflict
      - id: detect-private-key

  # Frontend linting and formatting
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        types_or: [javascript, jsx, ts, tsx, json, css]
        files: ^src/frontend/

default_language_version:
  python: python3.12
</file>

<file path="docs/01-plans/260117-024834-claudiminder-implementation/phase-01-backend-core.md">
---
title: "Phase 1: Backend Core"
status: pending
priority: P1
effort: 6h
updated: 2026-01-17
---

# Phase 1: Backend Core

## Context Links

- [Python TUI Research](../reports/researcher-260117-024702-python-tui-libraries.md)
- [Requirements Summary](./requirements-summary.md)
- [Python Rules](../../02-general/rules/01-python.md)
- Existing: `src/backend/api/usage.py`, `src/backend/models/`

## Overview

Implement Textual-based TUI (simple ANSI), reminder system with all presets, focus mode, usage goals, and i18n (En + Vi).

## Key Insights (from interview)

- **TUI style**: Simple terminal ANSI colors (not full themes like GUI)
- **Polling**: Hybrid (60s auto + manual refresh)
- **Reminders**: All presets (before reset, on reset, percentage thresholds)
- **Custom action**: Shell command OR URL
- **Notification**: System native + in-app toast + TUI bell
- **Snooze**: 5/15/30 min options
- **Focus mode**: DND when >80% + scheduled quiet hours
- **Goals**: Daily budget + pace indicator
- **i18n**: English + Vietnamese
- **Config**: TOML at ~/.config/claudiminder/
- **Logging**: User configurable level, stdout + file

## Requirements

### Functional

- Real-time usage % display (all metrics: 5h, 7d, extra usage)
- Countdown: HH:MM:SS + human readable toggle
- Keyboard shortcuts: q=quit, r=refresh, h=help
- Reminders: before reset (15/30/60m), on reset, percentage (50/75/90/100%)
- Custom actions: execute shell command OR open URL
- Snooze: 5/15/30 min dismiss options
- Focus mode: auto DND when usage >80%, scheduled quiet hours
- Goals: daily budget setting, pace indicator (on track/too fast)
- i18n: English + Vietnamese
- Single instance enforcement
- Offline mode: cached data + warning
- JSON sidecar output for Tauri

### Non-Functional

- <100ms UI response time
- Poll API every 60s (not every frame)
- Retry → toast → degraded mode on errors
- User configurable log level
- Logs to stdout + ~/.config/claudiminder/logs/

## Architecture

```
src/backend/
├── tui/
│   ├── __init__.py
│   ├── app.py                    # Main Textual App
│   ├── widgets/
│   │   ├── __init__.py
│   │   ├── usage-display.py      # All metrics widget
│   │   ├── reset-countdown.py    # Timer (both formats)
│   │   ├── goals-indicator.py    # Budget + pace
│   │   └── offline-banner.py     # Offline mode UI
│   └── styles.tcss
├── scheduler/
│   ├── __init__.py
│   ├── reminder-service.py       # All reminder logic
│   ├── focus-mode.py             # DND + quiet hours
│   └── notifier.py               # Multi-channel notify
├── i18n/
│   ├── __init__.py
│   ├── en.py                     # English strings
│   └── vi.py                     # Vietnamese strings
├── core/
│   ├── __init__.py
│   ├── instance-lock.py          # Single instance
│   ├── goals-tracker.py          # Budget + pace calc
│   └── config-manager.py         # TOML config R/W
└── sidecar.py                    # JSON output for Tauri
```

## Related Code Files

### Create

- `src/backend/tui/__init__.py`
- `src/backend/tui/app.py`
- `src/backend/tui/widgets/__init__.py`
- `src/backend/tui/widgets/usage-display.py`
- `src/backend/tui/widgets/reset-countdown.py`
- `src/backend/tui/widgets/goals-indicator.py`
- `src/backend/tui/widgets/offline-banner.py`
- `src/backend/tui/styles.tcss`
- `src/backend/scheduler/__init__.py`
- `src/backend/scheduler/reminder-service.py`
- `src/backend/scheduler/focus-mode.py`
- `src/backend/scheduler/notifier.py`
- `src/backend/i18n/__init__.py`
- `src/backend/i18n/en.py`
- `src/backend/i18n/vi.py`
- `src/backend/core/__init__.py`
- `src/backend/core/instance-lock.py`
- `src/backend/core/goals-tracker.py`
- `src/backend/core/config-manager.py`
- `src/backend/sidecar.py`

### Modify

- `src/backend/cli.py` - Add `tui` command
- `src/backend/models/settings.py` - Add focus mode, goals, i18n settings
- `pyproject.toml` - Add dependencies

## Implementation Steps

### Step 1: Add Dependencies

```bash
uv add desktop-notifier tomli tomli-w filelock babel
```

### Step 2: Config Manager (TOML)

```python
# src/backend/core/config-manager.py
from pathlib import Path
import tomli
import tomli_w
from pydantic import BaseModel

CONFIG_DIR = Path.home() / ".config" / "claudiminder"
CONFIG_FILE = CONFIG_DIR / "config.toml"

class ReminderConfig(BaseModel):
    enabled: bool = True
    before_reset_minutes: list[int] = [15, 30, 60]
    on_reset: bool = True
    percentage_thresholds: list[int] = [50, 75, 90, 100]
    snooze_minutes: list[int] = [5, 15, 30]
    custom_command: str | None = None
    custom_url: str | None = None

class FocusModeConfig(BaseModel):
    enabled: bool = False
    dnd_threshold: int = 80  # Auto DND when usage > 80%
    quiet_hours_start: str | None = None  # "22:00"
    quiet_hours_end: str | None = None    # "08:00"

class GoalsConfig(BaseModel):
    enabled: bool = False
    daily_budget_percent: int = 100
    warn_when_pace_exceeded: bool = True

class AppConfig(BaseModel):
    language: str = "en"  # en | vi
    log_level: str = "INFO"
    poll_interval_seconds: int = 60
    reminder: ReminderConfig = ReminderConfig()
    focus_mode: FocusModeConfig = FocusModeConfig()
    goals: GoalsConfig = GoalsConfig()

def load_config() -> AppConfig:
    if not CONFIG_FILE.exists():
        return AppConfig()
    with open(CONFIG_FILE, "rb") as f:
        data = tomli.load(f)
    return AppConfig.model_validate(data)

def save_config(config: AppConfig) -> None:
    CONFIG_DIR.mkdir(parents=True, exist_ok=True)
    with open(CONFIG_FILE, "wb") as f:
        tomli_w.dump(config.model_dump(), f)
```

### Step 3: Single Instance Lock

```python
# src/backend/core/instance-lock.py
from pathlib import Path
from filelock import FileLock, Timeout

LOCK_FILE = Path.home() / ".config" / "claudiminder" / ".lock"

def acquire_instance_lock() -> FileLock | None:
    LOCK_FILE.parent.mkdir(parents=True, exist_ok=True)
    lock = FileLock(str(LOCK_FILE), timeout=0)
    try:
        lock.acquire()
        return lock
    except Timeout:
        return None

def is_another_instance_running() -> bool:
    return acquire_instance_lock() is None
```

### Step 4: i18n Strings

```python
# src/backend/i18n/en.py
STRINGS = {
    "usage_title": "Claude Usage",
    "reset_in": "Reset in",
    "reset_complete": "Reset complete!",
    "offline_mode": "Offline - showing cached data",
    "reminder_soon": "Token reset in {minutes} minutes!",
    "reminder_reset": "Your token has reset!",
    "reminder_threshold": "Usage reached {percent}%",
    "pace_ok": "On track",
    "pace_exceeded": "Using too fast!",
    "budget_used": "Budget: {used}% of {total}%",
}

# src/backend/i18n/vi.py
STRINGS = {
    "usage_title": "Sử dụng Claude",
    "reset_in": "Reset sau",
    "reset_complete": "Đã reset xong!",
    "offline_mode": "Ngoại tuyến - hiển thị dữ liệu đã lưu",
    "reminder_soon": "Token sẽ reset trong {minutes} phút!",
    "reminder_reset": "Token của bạn đã reset!",
    "reminder_threshold": "Đã sử dụng {percent}%",
    "pace_ok": "Đúng tiến độ",
    "pace_exceeded": "Đang dùng quá nhanh!",
    "budget_used": "Ngân sách: {used}% / {total}%",
}
```

### Step 5: Focus Mode Service

```python
# src/backend/scheduler/focus-mode.py
from datetime import datetime, time
from ..core.config-manager import load_config

class FocusModeService:
    def __init__(self) -> None:
        self._snoozed_until: datetime | None = None

    def should_suppress_notification(self, current_usage: float) -> bool:
        config = load_config().focus_mode
        if not config.enabled:
            return False

        # Check snooze
        if self._snoozed_until and datetime.now() < self._snoozed_until:
            return True

        # Check DND threshold
        if current_usage > config.dnd_threshold:
            return True

        # Check quiet hours
        if config.quiet_hours_start and config.quiet_hours_end:
            now = datetime.now().time()
            start = time.fromisoformat(config.quiet_hours_start)
            end = time.fromisoformat(config.quiet_hours_end)
            if start <= now or now <= end:  # Handle overnight
                return True

        return False

    def snooze(self, minutes: int) -> None:
        from datetime import timedelta
        self._snoozed_until = datetime.now() + timedelta(minutes=minutes)
```

### Step 6: Goals Tracker

```python
# src/backend/core/goals-tracker.py
from datetime import datetime
from ..core.config-manager import load_config

class GoalsTracker:
    def __init__(self) -> None:
        self._session_start = datetime.now()

    def calculate_pace(self, current_usage: float) -> tuple[bool, str]:
        """Returns (is_on_track, message)."""
        config = load_config().goals
        if not config.enabled:
            return True, ""

        # Calculate expected usage at this time of day
        hours_elapsed = (datetime.now() - self._session_start.replace(
            hour=0, minute=0, second=0
        )).total_seconds() / 3600
        expected_usage = (hours_elapsed / 24) * config.daily_budget_percent

        is_on_track = current_usage <= expected_usage * 1.1  # 10% buffer
        return is_on_track, f"{current_usage:.1f}% / {expected_usage:.1f}% expected"
```

### Step 7: Multi-channel Notifier

```python
# src/backend/scheduler/notifier.py
import subprocess
import webbrowser
from desktop_notifier import DesktopNotifier
from ..core.config-manager import load_config

_notifier: DesktopNotifier | None = None

def _get_notifier() -> DesktopNotifier:
    global _notifier
    if _notifier is None:
        _notifier = DesktopNotifier(app_name="claudiminder")
    return _notifier

async def send_notification(title: str, body: str) -> None:
    config = load_config()

    # System notification
    try:
        notifier = _get_notifier()
        await notifier.send(title=title, message=body)
    except Exception:
        # Fallback to terminal bell
        print("\a", end="", flush=True)

    # Execute custom action if configured
    if config.reminder.custom_command:
        try:
            subprocess.Popen(config.reminder.custom_command, shell=True)
        except Exception:
            pass

    if config.reminder.custom_url:
        try:
            webbrowser.open(config.reminder.custom_url)
        except Exception:
            pass
```

### Step 8: TUI App with All Features

```python
# src/backend/tui/app.py
from textual.app import App, ComposeResult
from textual.widgets import Header, Footer
from ..core.instance-lock import is_another_instance_running
from ..i18n import get_string
from .widgets.usage_display import UsageDisplay
from .widgets.reset_countdown import ResetCountdown
from .widgets.goals_indicator import GoalsIndicator
from .widgets.offline_banner import OfflineBanner

class ClaudiminderApp(App):
    CSS_PATH = "styles.tcss"
    BINDINGS = [
        ("q", "quit", "Quit"),
        ("r", "refresh", "Refresh"),
        ("h", "help", "Help"),
    ]

    def __init__(self) -> None:
        super().__init__()
        if is_another_instance_running():
            raise RuntimeError("Another instance is already running")

    def compose(self) -> ComposeResult:
        yield Header()
        yield OfflineBanner()
        yield UsageDisplay()
        yield ResetCountdown()
        yield GoalsIndicator()
        yield Footer()

    def action_refresh(self) -> None:
        self.query_one(UsageDisplay).refresh_usage()
```

## Todo List

- [ ] Add dependencies (desktop-notifier, tomli, tomli-w, filelock, babel)
- [ ] Create config manager with TOML R/W
- [ ] Create single instance lock
- [ ] Create i18n module (en + vi)
- [ ] Create focus mode service (DND + quiet hours)
- [ ] Create goals tracker (budget + pace)
- [ ] Create multi-channel notifier (system + command + URL + bell)
- [ ] Create TUI widgets (usage, countdown, goals, offline)
- [ ] Create reminder service with all presets
- [ ] Create sidecar.py for Tauri
- [ ] Update CLI with tui command
- [ ] Test manually: `uv run claudiminder tui`

## Success Criteria

- Single instance enforcement works
- All metrics displayed (5h, 7d, extra usage)
- Countdown shows both formats
- All reminder presets trigger correctly
- Custom command/URL executes
- Snooze works (5/15/30 min)
- Focus mode suppresses notifications
- Goals tracker shows pace
- i18n switches between En/Vi
- Offline mode shows cached data
- `python -m src.backend.sidecar get_usage` outputs JSON

## Risk Assessment

| Risk                   | Mitigation                       |
| ---------------------- | -------------------------------- |
| desktop-notifier fails | Fallback to terminal bell        |
| Nuitka compile issues  | Document C compiler requirements |
| filelock on Windows    | Test cross-platform              |

## Security Considerations

- No credentials stored in TUI code
- Use existing `get_access_token()` from credentials module
- Log errors without exposing tokens
- Custom command execution is user-configured (trusted)
</file>

<file path="docs/01-plans/260117-024834-claudiminder-implementation/phase-02-tauri-scaffold.md">
---
title: "Phase 2: Tauri Scaffold"
status: pending
priority: P1
effort: 4h
---

# Phase 2: Tauri v2 + React Project Scaffold

## Context Links

- [Tauri v2 Research](../reports/researcher-260117-024702-tauri-v2-features.md)
- [Tauri Rules](../../02-general/rules/02-tauri.md)

## Overview

Scaffold Tauri v2 desktop app with React + TypeScript frontend using Bun package manager. Configure Python sidecar (Nuitka build), tray icon, notifications, single instance, global hotkey, macOS menu bar, Touch Bar, update checker, HTTPS cert pinning, and proxy support.

## Key Insights (from research)

- `create-tauri-app` supports Bun natively
- Sidecar configured via `bundle.externalBin` (use Nuitka instead of PyInstaller)
- Shell plugin required for sidecar execution
- Notification plugin needs permission request at startup
- Tray uses `TrayIconBuilder` with `on_tray_icon_event`
- Single instance via `tauri-plugin-single-instance`
- Global hotkey via `tauri-plugin-global-shortcut` (user customizable)
- macOS menu bar mode uses NSStatusBar API
- Touch Bar widgets via macOS-specific API
- HTTPS cert pinning implemented in Rust HTTP client
- HTTP_PROXY env var support for corporate networks
- Update checker via `tauri-plugin-updater` (notify only, no auto-update)

## Requirements

### Functional

- React 18 + TypeScript strict mode
- Bun as package manager
- System tray with dynamic tooltip (full menu: Show, Refresh, Settings, About, Quit)
- macOS menu bar mode (NSStatusBar)
- macOS Touch Bar widgets (usage percentage, reset time)
- Window hide-to-tray behavior (resizable window)
- Python sidecar integration (Nuitka build instead of PyInstaller)
- Single instance enforcement (Rust plugin)
- Global hotkey (user customizable via settings)
- Update checker (notify only, no auto-update)
- HTTPS cert pinning for Anthropic API
- HTTP_PROXY environment variable support

### Non-Functional

- Dev hot-reload for both React & Rust
- < 50MB bundle size
- Cross-platform build targets

## Architecture

```
src/frontend/
├── src/                    # React frontend
│   ├── components/         # UI components
│   ├── hooks/              # Custom React hooks
│   ├── stores/             # Zustand state
│   ├── styles/             # CSS/theme files
│   ├── types/              # TypeScript types
│   ├── utils/              # Utility functions
│   ├── App.tsx
│   └── main.tsx
├── src-tauri/              # Rust backend
│   ├── src/
│   │   ├── main.rs         # Entry point
│   │   ├── lib.rs          # Library exports
│   │   ├── commands/       # IPC commands
│   │   │   ├── mod.rs
│   │   │   └── usage.rs
│   │   ├── tray/           # System tray
│   │   │   ├── mod.rs
│   │   │   └── setup.rs
│   │   └── sidecar/        # Python sidecar
│   │       ├── mod.rs
│   │       └── backend.rs
│   ├── icons/              # App icons
│   ├── capabilities/       # Permission files
│   ├── Cargo.toml
│   └── tauri.conf.json
├── index.html
├── package.json
├── tsconfig.json
├── vite.config.ts
└── bun.lockb
```

## Related Code Files

### Create (Tauri scaffold generates most, then customize)

- `src/frontend/src-tauri/src/main.rs`
- `src/frontend/src-tauri/src/lib.rs`
- `src/frontend/src-tauri/src/commands/mod.rs`
- `src/frontend/src-tauri/src/commands/usage.rs`
- `src/frontend/src-tauri/src/commands/settings.rs`
- `src/frontend/src-tauri/src/tray/mod.rs`
- `src/frontend/src-tauri/src/tray/setup.rs`
- `src/frontend/src-tauri/src/sidecar/mod.rs`
- `src/frontend/src-tauri/src/sidecar/backend.rs`
- `src/frontend/src-tauri/src/http_client/mod.rs`
- `src/frontend/src-tauri/src/macos/mod.rs` (macOS only)
- `src/frontend/src-tauri/capabilities/default.json`
- `src/frontend/src-tauri/certs/anthropic.pem`
- `src/frontend/src/types/usage.ts`
- `src/frontend/src/hooks/use-usage.ts`
- `scripts/build-sidecar.sh` (Nuitka build)

### Modify (after scaffold)

- `src/frontend/src-tauri/tauri.conf.json`
- `src/frontend/src-tauri/Cargo.toml`
- `README.md` (add proxy support docs)

## Implementation Steps

### Step 1: Create Tauri Project

```bash
cd /home/hieubt/Documents/ai-hub/claudiminder/src
bun create tauri-app frontend --template react-ts
cd frontend
```

Select options:

- Package manager: bun
- Frontend: React
- TypeScript: Yes

### Step 2: Initialize Tauri

```bash
cd src/frontend
bun install
bun add @tauri-apps/plugin-notification @tauri-apps/plugin-shell @tauri-apps/plugin-single-instance @tauri-apps/plugin-global-shortcut @tauri-apps/plugin-updater zustand
```

### Step 3: Configure tauri.conf.json

```json
{
  "$schema": "../node_modules/@tauri-apps/cli/config.schema.json",
  "productName": "claudiminder",
  "identifier": "com.claudiminder.app",
  "build": {
    "beforeDevCommand": "bun run dev",
    "devUrl": "http://localhost:5173",
    "beforeBuildCommand": "bun run build",
    "frontendDist": "../dist"
  },
  "bundle": {
    "active": true,
    "targets": "all",
    "externalBin": ["binaries/claudiminder-backend"],
    "icon": [
      "icons/32x32.png",
      "icons/128x128.png",
      "icons/icon.icns",
      "icons/icon.ico"
    ]
  },
  "app": {
    "windows": [
      {
        "title": "claudiminder",
        "width": 400,
        "height": 300,
        "resizable": true,
        "fullscreen": false,
        "visible": true,
        "center": true
      }
    ],
    "trayIcon": {
      "iconPath": "icons/tray.png",
      "iconAsTemplate": true
    },
    "security": {
      "csp": null
    }
  }
}
```

### Step 4: Configure Cargo.toml

Add to `src/frontend/src-tauri/Cargo.toml`:

```toml
[dependencies]
tauri = { version = "2", features = ["tray-icon", "macos-private-api"] }
tauri-plugin-shell = "2"
tauri-plugin-notification = "2"
tauri-plugin-single-instance = "2"
tauri-plugin-global-shortcut = "2"
tauri-plugin-updater = "2"
serde = { version = "1", features = ["derive"] }
serde_json = "1"
tokio = { version = "1", features = ["full"] }
reqwest = { version = "0.11", features = ["rustls-tls", "json"] }
rustls = "0.21"
rustls-native-certs = "0.6"

[target.'cfg(target_os = "macos")'.dependencies]
cocoa = "0.25"
objc = "0.2"
```

### Step 5: Create main.rs

```rust
#![cfg_attr(not(debug_assertions), windows_subsystem = "windows")]

mod commands;
mod sidecar;
mod tray;
mod http_client;
#[cfg(target_os = "macos")]
mod macos;

use tauri::Manager;

fn main() {
    tauri::Builder::default()
        .plugin(tauri_plugin_shell::init())
        .plugin(tauri_plugin_notification::init())
        .plugin(tauri_plugin_single_instance::init(|app, _args, _cwd| {
            // Bring existing instance to front
            if let Some(window) = app.get_webview_window("main") {
                let _ = window.show();
                let _ = window.set_focus();
            }
        }))
        .plugin(tauri_plugin_global_shortcut::Builder::new().build())
        .plugin(tauri_plugin_updater::Builder::new().build())
        .setup(|app| {
            tray::setup::setup_tray(app)?;

            // Request notification permission
            #[cfg(desktop)]
            {
                let handle = app.handle().clone();
                tauri::async_runtime::spawn(async move {
                    let _ = tauri_plugin_notification::NotificationExt::notification(&handle)
                        .request_permission()
                        .await;
                });
            }

            // macOS-specific setup
            #[cfg(target_os = "macos")]
            {
                macos::setup_menu_bar(app)?;
                macos::setup_touch_bar(app)?;
            }

            // Register default global hotkey (Cmd+Shift+C on macOS, Ctrl+Shift+C on others)
            #[cfg(target_os = "macos")]
            let default_hotkey = "Cmd+Shift+C";
            #[cfg(not(target_os = "macos"))]
            let default_hotkey = "Ctrl+Shift+C";

            app.handle()
                .plugin(tauri_plugin_global_shortcut::GlobalShortcutExt::global_shortcut())
                .on_shortcut(default_hotkey, move |app, _shortcut, _event| {
                    if let Some(window) = app.get_webview_window("main") {
                        let _ = window.show();
                        let _ = window.set_focus();
                    }
                });

            // Check for updates on startup (notify only)
            let app_handle = app.handle().clone();
            tauri::async_runtime::spawn(async move {
                if let Ok(update) = app_handle.updater().check().await {
                    if update.is_update_available() {
                        let _ = tauri_plugin_notification::NotificationExt::notification(&app_handle)
                            .title("Update Available")
                            .body(format!("Version {} is available", update.version))
                            .show();
                    }
                }
            });

            Ok(())
        })
        .invoke_handler(tauri::generate_handler![
            commands::usage::get_usage,
            commands::usage::refresh_usage,
            commands::settings::set_global_hotkey,
        ])
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

### Step 6: Create lib.rs

```rust
pub mod commands;
pub mod sidecar;
pub mod tray;
pub mod http_client;
#[cfg(target_os = "macos")]
pub mod macos;
```

### Step 7: Create Commands Module

**commands/mod.rs:**

```rust
pub mod usage;
pub mod settings;
```

**commands/usage.rs:**

```rust
use crate::sidecar::backend::call_backend;
use serde::{Deserialize, Serialize};
use tauri::AppHandle;

#[derive(Debug, Serialize, Deserialize)]
pub struct UsageResponse {
    pub five_hour: Option<FiveHourUsage>,
    pub error: Option<String>,
}

#[derive(Debug, Serialize, Deserialize)]
pub struct FiveHourUsage {
    pub utilization: f64,
    pub resets_at: String,
}

#[tauri::command]
pub async fn get_usage(app: AppHandle) -> Result<UsageResponse, String> {
    let output = call_backend(&app, "get_usage").await?;
    serde_json::from_str(&output).map_err(|e| e.to_string())
}

#[tauri::command]
pub async fn refresh_usage(app: AppHandle) -> Result<UsageResponse, String> {
    let output = call_backend(&app, "refresh_usage").await?;
    serde_json::from_str(&output).map_err(|e| e.to_string())
}
```

### Step 8: Create Sidecar Module

**sidecar/mod.rs:**

```rust
pub mod backend;
```

**sidecar/backend.rs:**

```rust
use tauri::AppHandle;
use tauri_plugin_shell::ShellExt;

pub async fn call_backend(app: &AppHandle, action: &str) -> Result<String, String> {
    let output = app
        .shell()
        .sidecar("claudiminder-backend")
        .map_err(|e| e.to_string())?
        .arg(action)
        .output()
        .await
        .map_err(|e| e.to_string())?;

    if output.status.success() {
        Ok(String::from_utf8_lossy(&output.stdout).to_string())
    } else {
        Err(String::from_utf8_lossy(&output.stderr).to_string())
    }
}
```

### Step 9: Create Tray Module

**tray/mod.rs:**

```rust
pub mod setup;
```

**tray/setup.rs:**

```rust
use tauri::{
    menu::{Menu, MenuItem},
    tray::{MouseButton, MouseButtonState, TrayIconBuilder, TrayIconEvent},
    App, Manager,
};

pub fn setup_tray(app: &App) -> Result<(), Box<dyn std::error::Error>> {
    let show = MenuItem::with_id(app, "show", "Show", true, None::<&str>)?;
    let refresh = MenuItem::with_id(app, "refresh", "Refresh", true, None::<&str>)?;
    let settings = MenuItem::with_id(app, "settings", "Settings", true, None::<&str>)?;
    let about = MenuItem::with_id(app, "about", "About", true, None::<&str>)?;
    let quit = MenuItem::with_id(app, "quit", "Quit", true, None::<&str>)?;

    let menu = Menu::with_items(app, &[&show, &refresh, &settings, &about, &quit])?;

    TrayIconBuilder::new()
        .icon(app.default_window_icon().unwrap().clone())
        .menu(&menu)
        .tooltip("claudiminder: Loading...")
        .on_menu_event(|app, event| match event.id().as_ref() {
            "quit" => app.exit(0),
            "show" => {
                if let Some(window) = app.get_webview_window("main") {
                    let _ = window.show();
                    let _ = window.set_focus();
                }
            }
            "refresh" => {
                // Emit refresh event to frontend
                let _ = app.emit("refresh-usage", ());
            }
            "settings" => {
                if let Some(window) = app.get_webview_window("main") {
                    let _ = window.show();
                    let _ = window.set_focus();
                    let _ = app.emit("navigate-to-settings", ());
                }
            }
            "about" => {
                if let Some(window) = app.get_webview_window("main") {
                    let _ = window.show();
                    let _ = window.set_focus();
                    let _ = app.emit("navigate-to-about", ());
                }
            }
            _ => {}
        })
        .on_tray_icon_event(|tray, event| {
            if let TrayIconEvent::Click {
                button: MouseButton::Left,
                button_state: MouseButtonState::Up,
                ..
            } = event
            {
                if let Some(window) = tray.app_handle().get_webview_window("main") {
                    let _ = window.unminimize();
                    let _ = window.show();
                    let _ = window.set_focus();
                }
            }
        })
        .build(app)?;

    Ok(())
}
```

### Step 10: Create HTTP Client with Cert Pinning

**http_client/mod.rs:**

```rust
use reqwest::{Client, ClientBuilder};
use rustls::{Certificate, ClientConfig, RootCertStore};
use std::sync::Arc;

const ANTHROPIC_CERT_PEM: &str = include_str!("../../certs/anthropic.pem");

pub fn create_client() -> Result<Client, Box<dyn std::error::Error>> {
    let mut root_store = RootCertStore::empty();

    // Add system certificates
    for cert in rustls_native_certs::load_native_certs()? {
        root_store.add(&Certificate(cert.0))?;
    }

    // Add pinned Anthropic certificate
    let anthropic_cert = pem::parse(ANTHROPIC_CERT_PEM)?;
    root_store.add(&Certificate(anthropic_cert.contents))?;

    let tls_config = ClientConfig::builder()
        .with_safe_defaults()
        .with_root_certificates(root_store)
        .with_no_client_auth();

    let client = ClientBuilder::new()
        .use_preconfigured_tls(tls_config)
        .build()?;

    Ok(client)
}
```

### Step 11: Create macOS-specific Module

**macos/mod.rs:**

```rust
#[cfg(target_os = "macos")]
use cocoa::appkit::{NSStatusBar, NSStatusItem};
#[cfg(target_os = "macos")]
use cocoa::base::{id, nil};
#[cfg(target_os = "macos")]
use objc::{msg_send, sel, sel_impl};
use tauri::App;

#[cfg(target_os = "macos")]
pub fn setup_menu_bar(app: &App) -> Result<(), Box<dyn std::error::Error>> {
    unsafe {
        let status_bar = NSStatusBar::systemStatusBar(nil);
        let status_item: id = msg_send![status_bar, statusItemWithLength: -1.0];

        // Set icon and title
        let button: id = msg_send![status_item, button];
        let title = NSString::alloc(nil).init_str("📊");
        let _: () = msg_send![button, setTitle: title];
    }
    Ok(())
}

#[cfg(target_os = "macos")]
pub fn setup_touch_bar(app: &App) -> Result<(), Box<dyn std::error::Error>> {
    // Touch Bar setup will be implemented with usage data integration
    Ok(())
}

#[cfg(not(target_os = "macos"))]
pub fn setup_menu_bar(_app: &App) -> Result<(), Box<dyn std::error::Error>> {
    Ok(())
}

#[cfg(not(target_os = "macos"))]
pub fn setup_touch_bar(_app: &App) -> Result<(), Box<dyn std::error::Error>> {
    Ok(())
}
```

### Step 12: Create Settings Commands

**commands/settings.rs:**

```rust
use tauri::{AppHandle, State};
use tauri_plugin_global_shortcut::GlobalShortcutExt;

#[tauri::command]
pub async fn set_global_hotkey(app: AppHandle, hotkey: String) -> Result<(), String> {
    // Unregister old hotkey
    let shortcuts = app.global_shortcut();
    shortcuts.unregister_all().map_err(|e| e.to_string())?;

    // Register new hotkey
    shortcuts
        .on_shortcut(&hotkey, move |app, _shortcut, _event| {
            if let Some(window) = app.get_webview_window("main") {
                let _ = window.show();
                let _ = window.set_focus();
            }
        })
        .map_err(|e| e.to_string())?;

    Ok(())
}
```

### Step 13: Create Capabilities

**capabilities/default.json:**

```json
{
  "$schema": "../gen/schemas/desktop-schema.json",
  "identifier": "default",
  "description": "Default capabilities for claudiminder",
  "windows": ["main"],
  "permissions": [
    "core:default",
    "shell:allow-execute",
    "shell:allow-spawn",
    "notification:default",
    "notification:allow-is-permission-granted",
    "notification:allow-request-permission",
    "notification:allow-notify",
    "global-shortcut:allow-register",
    "global-shortcut:allow-unregister",
    "global-shortcut:allow-is-registered",
    "updater:default",
    "updater:allow-check"
  ]
}
```

### Step 14: Create TypeScript Types

**src/types/usage.ts:**

```typescript
export interface FiveHourUsage {
  utilization: number;
  resets_at: string;
}

export interface UsageResponse {
  five_hour: FiveHourUsage | null;
  error?: string;
}
```

### Step 15: Create Usage Hook

**src/hooks/use-usage.ts:**

```typescript
import { invoke } from "@tauri-apps/api/core";
import { useCallback, useEffect, useState } from "react";
import type { UsageResponse } from "../types/usage";

export function useUsage(pollInterval = 60000) {
  const [usage, setUsage] = useState<UsageResponse | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  const fetchUsage = useCallback(async () => {
    try {
      setLoading(true);
      const result = await invoke<UsageResponse>("get_usage");
      setUsage(result);
      setError(result.error || null);
    } catch (e) {
      setError(String(e));
    } finally {
      setLoading(false);
    }
  }, []);

  useEffect(() => {
    fetchUsage();
    const interval = setInterval(fetchUsage, pollInterval);
    return () => clearInterval(interval);
  }, [fetchUsage, pollInterval]);

  return { usage, loading, error, refresh: fetchUsage };
}
```

### Step 16: Prepare Sidecar Binary with Nuitka

Create build script for Python sidecar using Nuitka:

```bash
# scripts/build-sidecar.sh
#!/bin/bash
set -e

cd src/backend

# Install Nuitka if not available
uv pip install nuitka

# Build with Nuitka (faster startup, no Python runtime required)
uv run nuitka3 \
  --standalone \
  --onefile \
  --output-dir=dist \
  --output-filename=claudiminder-backend \
  --remove-output \
  --assume-yes-for-downloads \
  claudiminder/cli.py

# Copy to frontend binaries
mkdir -p ../frontend/src-tauri/binaries
cp dist/claudiminder-backend ../frontend/src-tauri/binaries/

# Make executable
chmod +x ../frontend/src-tauri/binaries/claudiminder-backend

echo "Sidecar binary built successfully with Nuitka"
```

### Step 17: Add Proxy Support Environment

Document HTTP_PROXY support in README:

````markdown
## Proxy Support

claudiminder respects the `HTTP_PROXY` and `HTTPS_PROXY` environment variables for corporate network access.

### Linux/macOS

```bash
export HTTPS_PROXY=http://proxy.company.com:8080
claudiminder
```
````

### Windows

```powershell
$env:HTTPS_PROXY="http://proxy.company.com:8080"
claudiminder
```

```

## Todo List

- [ ] Run `bun create tauri-app frontend --template react-ts`
- [ ] Install Tauri plugins (shell, notification, single-instance, global-shortcut, updater)
- [ ] Configure `tauri.conf.json` with sidecar, tray, and resizable window
- [ ] Add dependencies to `Cargo.toml` (plugins, rustls, reqwest, macOS libs)
- [ ] Create `main.rs` with all plugin initialization
- [ ] Implement single instance enforcement
- [ ] Implement global hotkey registration (default + customizable)
- [ ] Implement update checker (notify only)
- [ ] Create `commands/usage.rs` IPC commands
- [ ] Create `commands/settings.rs` for hotkey management
- [ ] Create `sidecar/backend.rs` for Python execution
- [ ] Create `tray/setup.rs` with full menu (Show, Refresh, Settings, About, Quit)
- [ ] Create `http_client/mod.rs` with cert pinning and proxy support
- [ ] Create `macos/mod.rs` for menu bar and Touch Bar (macOS only)
- [ ] Create `capabilities/default.json` with all permissions
- [ ] Create TypeScript types for usage response
- [ ] Create `use-usage.ts` React hook
- [ ] Create Nuitka build script for sidecar
- [ ] Download and pin Anthropic SSL certificate
- [ ] Document HTTP_PROXY environment variable support
- [ ] Test with `bun run tauri dev`
- [ ] Test single instance behavior
- [ ] Test global hotkey registration
- [ ] Test update checker notification
- [ ] Test on macOS (menu bar + Touch Bar)

## Success Criteria

- `bun run tauri dev` launches app window (resizable)
- System tray icon appears with full menu (Show, Refresh, Settings, About, Quit)
- Tray left-click shows window
- Tray right-click shows full menu
- Only one instance can run (second launch brings first to front)
- Global hotkey (Cmd/Ctrl+Shift+C) shows window
- Update checker notifies on startup if update available
- `invoke("get_usage")` returns data from sidecar (Nuitka build)
- `invoke("set_global_hotkey")` updates hotkey successfully
- macOS: Menu bar icon shows in status bar
- macOS: Touch Bar widgets display (basic setup)
- HTTP_PROXY environment variable respected by HTTP client
- HTTPS connections use cert pinning for Anthropic API

## Risk Assessment

| Risk                                  | Mitigation                                    |
| ------------------------------------- | --------------------------------------------- |
| Sidecar path resolution varies by OS  | Use Tauri's target-triple naming              |
| Nuitka build complexity               | Test on all platforms, fallback to PyInstaller|
| Notification permission denied        | Show in-app fallback notification             |
| Rust compile errors                   | Follow Tauri v2 docs exactly                  |
| macOS private API rejection           | Use documented NSStatusBar APIs only          |
| Global hotkey conflicts               | Allow user customization, validate input      |
| Certificate pinning breaks with renewal| Monitor Anthropic cert updates, auto-update  |
| Proxy authentication                  | Document manual proxy auth configuration      |
| Touch Bar hardware unavailable        | Graceful fallback on non-Touch Bar Macs       |

## Security Considerations

- Minimal capabilities: shell, notification, global-shortcut, updater
- No file system access granted
- Sidecar runs in sandboxed context
- HTTPS cert pinning for Anthropic API prevents MITM attacks
- Proxy support respects system environment variables
- Single instance prevents resource exhaustion
- CSP disabled for dev, will configure for prod
- Update checker uses secure HTTPS channel
```
</file>

<file path="docs/01-plans/260117-024834-claudiminder-implementation/phase-03-frontend-ui.md">
---
title: "Phase 3: Frontend UI"
status: pending
priority: P1
effort: 8h
---

# Phase 3: React Components with Themes & Customization

## Context Links

- [UI Themes Research](../reports/researcher-260117-024115-ui-themes-design.md)
- [Tauri Rules](../../02-general/rules/02-tauri.md)

## Overview

Build React UI components for dashboard with 6 theme variants (default: Neon Dark), customizable layout, 3 progress bar styles, layered color customization, font size control, and i18n (en + vi). Use Zustand for state, CSS custom properties for theming, react-grid-layout for drag-drop, react-i18next for translations.

## Key Insights (from research + interview)

- Glassmorphism: `backdrop-filter: blur(12px)` + rgba backgrounds
- Neon: Layered `text-shadow` + `box-shadow` glows
- Default theme: Neon Dark (user customizable)
- Color customization: 3 levels (preset → accent picker → full scheme)
- Dashboard layout: User can drag-drop widgets
- Progress bar: 3 variants (linear/circular/gauge) - user choice
- Countdown: Show both HH:MM:SS + human readable (e.g., "2h 34m left")
- Font size: 80%-150% slider
- i18n: en + vi with react-i18next
- Goals: Budget bar + pace indicator
- Focus mode: Status indicator in UI

## Requirements

### Functional

- Dashboard displays: usage %, reset countdown, stats, goals
- Theme switcher with 6 options + system auto (default: neon-dark)
- Progress bar with 3 variants: linear/circular/gauge (user setting)
- Layered color customization:
  - Basic: Theme presets (6 themes)
  - Advanced: Accent color picker
  - Expert: Full color scheme editor
- Drag-drop dashboard layout (save positions)
- Font size slider (80%-150%)
- i18n: English + Vietnamese
- Countdown: Dual format (HH:MM:SS + human readable)
- Goals widget: Budget bar + pace indicator
- Focus mode UI indicator
- Smooth theme transitions (0.3s ease)

### Non-Functional

- WCAG AA contrast compliance
- < 16ms render time
- Works without JS (basic HTML fallback)
- Responsive layout (desktop + system tray)

## Architecture

```
src/frontend/src/
├── components/
│   ├── dashboard/
│   │   ├── dashboard-widget.tsx       # Main container
│   │   ├── usage-display.tsx          # Progress bar (3 variants)
│   │   ├── reset-countdown.tsx        # Timer (dual format)
│   │   ├── stats-panel.tsx            # Requests/tokens
│   │   ├── goals-widget.tsx           # Budget + pace
│   │   ├── focus-mode-indicator.tsx   # Focus status
│   │   └── grid-layout-wrapper.tsx    # Drag-drop container
│   ├── settings/
│   │   ├── theme-switcher.tsx         # Theme selector
│   │   ├── color-customizer.tsx       # 3-tier color panel
│   │   ├── progress-bar-picker.tsx    # Linear/circular/gauge
│   │   ├── font-size-slider.tsx       # 80%-150%
│   │   └── language-switcher.tsx      # en/vi
│   └── ui/
│       ├── glass-card.tsx             # Reusable glass container
│       ├── neon-text.tsx              # Neon glow text
│       ├── circular-progress.tsx      # Circular variant
│       └── gauge-progress.tsx         # Gauge variant
├── styles/
│   ├── globals.css                    # CSS reset + vars
│   ├── themes/
│   │   ├── light.css
│   │   ├── dark.css
│   │   ├── neon-light.css
│   │   ├── neon-dark.css              # DEFAULT
│   │   ├── glass-light.css
│   │   └── glass-dark.css
│   └── components/
│       ├── dashboard.css
│       ├── progress-bar.css
│       └── settings.css
├── stores/
│   ├── usage-store.ts                 # Usage data state
│   ├── theme-store.ts                 # Theme + colors
│   ├── settings-store.ts              # Layout, fontSize, progressType
│   └── i18n-store.ts                  # Language preference
├── hooks/
│   ├── use-usage.ts                   # (from Phase 2)
│   ├── use-countdown.ts               # Timer logic
│   ├── use-theme.ts                   # Theme management
│   └── use-grid-layout.ts             # Layout state
├── i18n/
│   ├── index.ts                       # i18next setup
│   ├── en.json                        # English translations
│   └── vi.json                        # Vietnamese translations
└── App.tsx                            # Root component
```

## Related Code Files

### Create

- `src/frontend/src/components/dashboard/dashboard-widget.tsx`
- `src/frontend/src/components/dashboard/usage-display.tsx`
- `src/frontend/src/components/dashboard/reset-countdown.tsx`
- `src/frontend/src/components/dashboard/stats-panel.tsx`
- `src/frontend/src/components/dashboard/goals-widget.tsx`
- `src/frontend/src/components/dashboard/focus-mode-indicator.tsx`
- `src/frontend/src/components/dashboard/grid-layout-wrapper.tsx`
- `src/frontend/src/components/settings/theme-switcher.tsx`
- `src/frontend/src/components/settings/color-customizer.tsx`
- `src/frontend/src/components/settings/progress-bar-picker.tsx`
- `src/frontend/src/components/settings/font-size-slider.tsx`
- `src/frontend/src/components/settings/language-switcher.tsx`
- `src/frontend/src/components/ui/glass-card.tsx`
- `src/frontend/src/components/ui/neon-text.tsx`
- `src/frontend/src/components/ui/circular-progress.tsx`
- `src/frontend/src/components/ui/gauge-progress.tsx`
- `src/frontend/src/styles/globals.css`
- `src/frontend/src/styles/themes/light.css`
- `src/frontend/src/styles/themes/dark.css`
- `src/frontend/src/styles/themes/neon-light.css`
- `src/frontend/src/styles/themes/neon-dark.css`
- `src/frontend/src/styles/themes/glass-light.css`
- `src/frontend/src/styles/themes/glass-dark.css`
- `src/frontend/src/styles/components/settings.css`
- `src/frontend/src/stores/usage-store.ts`
- `src/frontend/src/stores/theme-store.ts`
- `src/frontend/src/stores/settings-store.ts`
- `src/frontend/src/stores/i18n-store.ts`
- `src/frontend/src/hooks/use-countdown.ts`
- `src/frontend/src/hooks/use-theme.ts`
- `src/frontend/src/hooks/use-grid-layout.ts`
- `src/frontend/src/i18n/index.ts`
- `src/frontend/src/i18n/en.json`
- `src/frontend/src/i18n/vi.json`

### Modify

- `src/frontend/src/App.tsx`
- `src/frontend/src/main.tsx`
- `src/frontend/package.json` (add react-grid-layout, react-i18next)

## Implementation Steps

### Step 1: Install Dependencies

```bash
cd src/frontend
bun add react-grid-layout react-i18next i18next @types/react-grid-layout
```

### Step 2: Create i18n Setup

**i18n/index.ts:**

```typescript
import i18n from "i18next";
import { initReactI18next } from "react-i18next";
import en from "./en.json";
import vi from "./vi.json";

i18n.use(initReactI18next).init({
  resources: {
    en: { translation: en },
    vi: { translation: vi },
  },
  lng: "en",
  fallbackLng: "en",
  interpolation: {
    escapeValue: false,
  },
});

export default i18n;
```

**i18n/en.json:**

```json
{
  "dashboard": {
    "title": "Claude Usage",
    "usage": "Usage",
    "resetsIn": "Resets in",
    "resetComplete": "Reset Complete!",
    "refresh": "Refresh",
    "goals": "Goals",
    "budget": "Budget",
    "pace": "Pace",
    "focusMode": "Focus Mode"
  },
  "settings": {
    "theme": "Theme",
    "language": "Language",
    "fontSize": "Font Size",
    "progressBar": "Progress Bar Style",
    "colors": "Colors",
    "layout": "Layout"
  },
  "themes": {
    "system": "System",
    "light": "Light",
    "dark": "Dark",
    "neonLight": "Neon Light",
    "neonDark": "Neon Dark",
    "glassLight": "Glass Light",
    "glassDark": "Glass Dark"
  },
  "progressTypes": {
    "linear": "Linear",
    "circular": "Circular",
    "gauge": "Gauge"
  },
  "colorLevels": {
    "basic": "Theme Presets",
    "advanced": "Accent Color",
    "expert": "Full Customization"
  }
}
```

**i18n/vi.json:**

```json
{
  "dashboard": {
    "title": "Sử Dụng Claude",
    "usage": "Đã dùng",
    "resetsIn": "Reset sau",
    "resetComplete": "Đã Reset!",
    "refresh": "Làm mới",
    "goals": "Mục tiêu",
    "budget": "Ngân sách",
    "pace": "Tốc độ",
    "focusMode": "Chế độ tập trung"
  },
  "settings": {
    "theme": "Giao diện",
    "language": "Ngôn ngữ",
    "fontSize": "Cỡ chữ",
    "progressBar": "Kiểu thanh tiến trình",
    "colors": "Màu sắc",
    "layout": "Bố cục"
  },
  "themes": {
    "system": "Hệ thống",
    "light": "Sáng",
    "dark": "Tối",
    "neonLight": "Neon Sáng",
    "neonDark": "Neon Tối",
    "glassLight": "Thủy tinh Sáng",
    "glassDark": "Thủy tinh Tối"
  },
  "progressTypes": {
    "linear": "Dạng thanh",
    "circular": "Dạng tròn",
    "gauge": "Dạng đồng hồ"
  },
  "colorLevels": {
    "basic": "Giao diện có sẵn",
    "advanced": "Màu nhấn",
    "expert": "Tùy chỉnh đầy đủ"
  }
}
```

### Step 3: Create Settings Store

**stores/settings-store.ts:**

```typescript
import { create } from "zustand";
import { persist } from "zustand/middleware";

export type ProgressBarType = "linear" | "circular" | "gauge";

interface Layout {
  i: string;
  x: number;
  y: number;
  w: number;
  h: number;
}

interface SettingsStore {
  fontSize: number; // 80-150
  progressBarType: ProgressBarType;
  layout: Layout[];
  setFontSize: (size: number) => void;
  setProgressBarType: (type: ProgressBarType) => void;
  setLayout: (layout: Layout[]) => void;
}

export const useSettingsStore = create<SettingsStore>()(
  persist(
    (set) => ({
      fontSize: 100,
      progressBarType: "linear",
      layout: [
        { i: "usage", x: 0, y: 0, w: 6, h: 4 },
        { i: "countdown", x: 6, y: 0, w: 6, h: 2 },
        { i: "goals", x: 6, y: 2, w: 6, h: 2 },
        { i: "stats", x: 0, y: 4, w: 12, h: 2 },
      ],
      setFontSize: (size) => {
        set({ fontSize: Math.max(80, Math.min(150, size)) });
        document.documentElement.style.fontSize = `${size}%`;
      },
      setProgressBarType: (type) => set({ progressBarType: type }),
      setLayout: (layout) => set({ layout }),
    }),
    { name: "claudiminder-settings" },
  ),
);
```

### Step 4: Create Theme Store with Color Customization

**stores/theme-store.ts:**

```typescript
import { create } from "zustand";
import { persist } from "zustand/middleware";

export type Theme =
  | "light"
  | "dark"
  | "neon-light"
  | "neon-dark"
  | "glass-light"
  | "glass-dark"
  | "system";

export type ColorLevel = "basic" | "advanced" | "expert";

interface ColorScheme {
  bgPrimary?: string;
  bgSecondary?: string;
  textPrimary?: string;
  textSecondary?: string;
  accent?: string;
  success?: string;
  warning?: string;
  danger?: string;
}

interface ThemeStore {
  theme: Theme;
  colorLevel: ColorLevel;
  accentColor: string;
  customColors: ColorScheme;
  setTheme: (theme: Theme) => void;
  setColorLevel: (level: ColorLevel) => void;
  setAccentColor: (color: string) => void;
  setCustomColors: (colors: ColorScheme) => void;
}

export const useThemeStore = create<ThemeStore>()(
  persist(
    (set, get) => ({
      theme: "neon-dark", // DEFAULT
      colorLevel: "basic",
      accentColor: "#00e5ff",
      customColors: {},
      setTheme: (theme) => {
        set({ theme });
        applyTheme(theme, get().customColors, get().accentColor);
      },
      setColorLevel: (level) => set({ colorLevel: level }),
      setAccentColor: (color) => {
        set({ accentColor: color });
        if (get().colorLevel === "advanced") {
          document.documentElement.style.setProperty("--accent", color);
        }
      },
      setCustomColors: (colors) => {
        set({ customColors: colors });
        if (get().colorLevel === "expert") {
          Object.entries(colors).forEach(([key, value]) => {
            const cssVar = `--${key.replace(/([A-Z])/g, "-$1").toLowerCase()}`;
            document.documentElement.style.setProperty(cssVar, value);
          });
        }
      },
    }),
    { name: "claudiminder-theme" },
  ),
);

function applyTheme(theme: Theme, customColors: ColorScheme, accent: string) {
  const root = document.documentElement;

  if (theme === "system") {
    const prefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)",
    ).matches;
    root.className = prefersDark ? "dark" : "light";
  } else {
    root.className = theme;
  }

  // Apply custom colors if in advanced/expert mode
  if (Object.keys(customColors).length > 0) {
    Object.entries(customColors).forEach(([key, value]) => {
      const cssVar = `--${key.replace(/([A-Z])/g, "-$1").toLowerCase()}`;
      root.style.setProperty(cssVar, value);
    });
  }
}
```

### Step 5: Create i18n Store

**stores/i18n-store.ts:**

```typescript
import { create } from "zustand";
import { persist } from "zustand/middleware";
import i18n from "../i18n";

interface I18nStore {
  language: "en" | "vi";
  setLanguage: (lang: "en" | "vi") => void;
}

export const useI18nStore = create<I18nStore>()(
  persist(
    (set) => ({
      language: "en",
      setLanguage: (lang) => {
        set({ language: lang });
        i18n.changeLanguage(lang);
      },
    }),
    { name: "claudiminder-language" },
  ),
);
```

### Step 6: Create Global CSS with Custom Properties

**styles/globals.css:**

```css
:root {
  color-scheme: light dark;

  /* Base colors (overridden by themes/customization) */
  --bg-primary: #ffffff;
  --bg-secondary: #f5f5f5;
  --text-primary: #1a1a1a;
  --text-secondary: #666666;
  --accent: #00e5ff;
  --success: #39ff14;
  --warning: #ffff00;
  --danger: #ff0000;

  /* Glass effect */
  --glass-bg: rgba(255, 255, 255, 0.1);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-blur: 12px;

  /* Neon glow */
  --neon-glow: 0 0 8px var(--accent), 0 0 12px var(--accent);

  /* Transitions */
  --transition-theme: background-color 0.3s ease, color 0.3s ease;
}

@media (prefers-reduced-motion: reduce) {
  :root {
    --transition-theme: none;
  }
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family:
    system-ui,
    -apple-system,
    sans-serif;
  background-color: var(--bg-primary);
  color: var(--text-primary);
  transition: var(--transition-theme);
  min-height: 100vh;
  font-size: 100%; /* Dynamic via settings */
}
```

### Step 7: Create Theme CSS Files

**themes/neon-dark.css (DEFAULT):**

```css
.neon-dark {
  --bg-primary: #05081a;
  --bg-secondary: #0a0f2e;
  --text-primary: #00e5ff;
  --text-secondary: #ff00ff;
  --accent: #00e5ff;
  --neon-glow: 0 0 8px #00e5ff, 0 0 12px #00e5ff, 0 0 20px #ff00ff;
}

.neon-dark .neon-text {
  text-shadow: var(--neon-glow);
}

.neon-dark .neon-box {
  border: 2px solid var(--accent);
  box-shadow:
    0 0 10px var(--accent),
    inset 0 0 10px rgba(0, 229, 255, 0.1);
}
```

**themes/dark.css:**

```css
.dark {
  --bg-primary: #1a1a1a;
  --bg-secondary: #2a2a2a;
  --text-primary: #ffffff;
  --text-secondary: #a0a0a0;
  --glass-bg: rgba(0, 0, 0, 0.3);
}
```

**themes/light.css:**

```css
.light {
  --bg-primary: #ffffff;
  --bg-secondary: #f5f5f5;
  --text-primary: #1a1a1a;
  --text-secondary: #666666;
  --accent: #007acc;
}
```

**themes/neon-light.css:**

```css
.neon-light {
  --bg-primary: #f0f0ff;
  --bg-secondary: #e0e0ff;
  --text-primary: #ff00ff;
  --text-secondary: #00e5ff;
  --accent: #ff00ff;
  --neon-glow: 0 0 6px #ff00ff, 0 0 10px #ff00ff, 0 0 16px #00e5ff;
}

.neon-light .neon-text {
  text-shadow: var(--neon-glow);
}

.neon-light .neon-box {
  border: 2px solid var(--accent);
  box-shadow:
    0 0 8px var(--accent),
    inset 0 0 8px rgba(255, 0, 255, 0.1);
}
```

**themes/glass-dark.css:**

```css
.glass-dark {
  --bg-primary: #1a1a2e;
  --bg-secondary: transparent;
  --text-primary: #ffffff;
  --glass-bg: rgba(255, 255, 255, 0.08);
  --glass-border: rgba(255, 255, 255, 0.15);
  --glass-blur: 12px;
}
```

**themes/glass-light.css:**

```css
.glass-light {
  --bg-primary: #e8e8ff;
  --bg-secondary: transparent;
  --text-primary: #1a1a1a;
  --glass-bg: rgba(255, 255, 255, 0.5);
  --glass-border: rgba(0, 0, 0, 0.1);
  --glass-blur: 12px;
}
```

### Step 8: Create UI Components

**components/ui/glass-card.tsx:**

```tsx
import { ReactNode } from "react";

interface GlassCardProps {
  children: ReactNode;
  className?: string;
}

export function GlassCard({ children, className = "" }: GlassCardProps) {
  return (
    <div
      className={`glass-card ${className}`}
      style={{
        background: "var(--glass-bg)",
        backdropFilter: `blur(var(--glass-blur))`,
        WebkitBackdropFilter: `blur(var(--glass-blur))`,
        borderRadius: "16px",
        border: "1px solid var(--glass-border)",
        boxShadow: "0 8px 32px rgba(31, 38, 135, 0.37)",
        padding: "16px",
      }}
    >
      {children}
    </div>
  );
}
```

**components/ui/circular-progress.tsx:**

```tsx
interface CircularProgressProps {
  percentage: number;
  size?: number;
  strokeWidth?: number;
}

export function CircularProgress({
  percentage,
  size = 120,
  strokeWidth = 8,
}: CircularProgressProps) {
  const radius = (size - strokeWidth) / 2;
  const circumference = 2 * Math.PI * radius;
  const offset = circumference - (percentage / 100) * circumference;

  return (
    <svg width={size} height={size} className="circular-progress">
      <circle
        cx={size / 2}
        cy={size / 2}
        r={radius}
        fill="none"
        stroke="var(--bg-secondary)"
        strokeWidth={strokeWidth}
      />
      <circle
        cx={size / 2}
        cy={size / 2}
        r={radius}
        fill="none"
        stroke="var(--accent)"
        strokeWidth={strokeWidth}
        strokeDasharray={circumference}
        strokeDashoffset={offset}
        strokeLinecap="round"
        transform={`rotate(-90 ${size / 2} ${size / 2})`}
        style={{ transition: "stroke-dashoffset 0.3s ease" }}
      />
      <text
        x="50%"
        y="50%"
        textAnchor="middle"
        dy="0.3em"
        className="neon-text"
        style={{ fontSize: "24px", fontWeight: "bold" }}
      >
        {percentage.toFixed(1)}%
      </text>
    </svg>
  );
}
```

**components/ui/gauge-progress.tsx:**

```tsx
interface GaugeProgressProps {
  percentage: number;
  size?: number;
}

export function GaugeProgress({ percentage, size = 160 }: GaugeProgressProps) {
  const angle = (percentage / 100) * 180 - 90; // -90 to 90 degrees
  const needleLength = size / 2 - 20;

  return (
    <svg width={size} height={size / 2 + 20} className="gauge-progress">
      <defs>
        <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stopColor="var(--success)" />
          <stop offset="50%" stopColor="var(--warning)" />
          <stop offset="100%" stopColor="var(--danger)" />
        </linearGradient>
      </defs>

      {/* Arc background */}
      <path
        d={`M 20,${size / 2} A ${size / 2 - 20},${size / 2 - 20} 0 0,1 ${size - 20},${size / 2}`}
        fill="none"
        stroke="var(--bg-secondary)"
        strokeWidth="12"
        strokeLinecap="round"
      />

      {/* Arc progress */}
      <path
        d={`M 20,${size / 2} A ${size / 2 - 20},${size / 2 - 20} 0 0,1 ${size - 20},${size / 2}`}
        fill="none"
        stroke="url(#gaugeGradient)"
        strokeWidth="12"
        strokeLinecap="round"
        strokeDasharray={`${(percentage / 100) * Math.PI * (size / 2 - 20)} ${Math.PI * (size / 2 - 20)}`}
      />

      {/* Needle */}
      <line
        x1={size / 2}
        y1={size / 2}
        x2={size / 2 + needleLength * Math.cos((angle * Math.PI) / 180)}
        y2={size / 2 + needleLength * Math.sin((angle * Math.PI) / 180)}
        stroke="var(--accent)"
        strokeWidth="3"
        strokeLinecap="round"
      />

      {/* Center dot */}
      <circle cx={size / 2} cy={size / 2} r="6" fill="var(--accent)" />

      {/* Value text */}
      <text
        x="50%"
        y={size / 2 + 30}
        textAnchor="middle"
        className="neon-text"
        style={{ fontSize: "20px", fontWeight: "bold" }}
      >
        {percentage.toFixed(1)}%
      </text>
    </svg>
  );
}
```

### Step 9: Create Usage Display with 3 Variants

**components/dashboard/usage-display.tsx:**

```tsx
import { useTranslation } from "react-i18next";
import { useSettingsStore } from "../../stores/settings-store";
import { CircularProgress } from "../ui/circular-progress";
import { GaugeProgress } from "../ui/gauge-progress";

interface UsageDisplayProps {
  percentage: number;
}

export function UsageDisplay({ percentage }: UsageDisplayProps) {
  const { t } = useTranslation();
  const { progressBarType } = useSettingsStore();

  const getColor = (pct: number) => {
    if (pct < 33) return "var(--success)";
    if (pct < 66) return "var(--warning)";
    if (pct < 90) return "#ff8800";
    return "var(--danger)";
  };

  return (
    <div className="usage-display">
      <div className="usage-header">
        <span className="label">{t("dashboard.usage")}</span>
        {progressBarType === "linear" && (
          <span className="value neon-text">{percentage.toFixed(1)}%</span>
        )}
      </div>

      {progressBarType === "linear" && (
        <div className="progress-container">
          <div
            className="progress-fill"
            style={{
              width: `${percentage}%`,
              background: `linear-gradient(90deg, var(--accent), ${getColor(percentage)})`,
            }}
          />
        </div>
      )}

      {progressBarType === "circular" && (
        <div className="progress-circular-wrapper">
          <CircularProgress percentage={percentage} />
        </div>
      )}

      {progressBarType === "gauge" && (
        <div className="progress-gauge-wrapper">
          <GaugeProgress percentage={percentage} />
        </div>
      )}
    </div>
  );
}
```

### Step 10: Create Reset Countdown with Dual Format

**components/dashboard/reset-countdown.tsx:**

```tsx
import { useTranslation } from "react-i18next";
import { useCountdown } from "../../hooks/use-countdown";

interface ResetCountdownProps {
  resetsAt: string;
}

export function ResetCountdown({ resetsAt }: ResetCountdownProps) {
  const { t } = useTranslation();
  const { hours, minutes, seconds, isExpired, humanReadable } =
    useCountdown(resetsAt);

  if (isExpired) {
    return (
      <div className="reset-countdown complete">
        <span className="neon-text">{t("dashboard.resetComplete")}</span>
      </div>
    );
  }

  return (
    <div className="reset-countdown">
      <span className="label">{t("dashboard.resetsIn")}</span>
      <span className="timer neon-text">
        {String(hours).padStart(2, "0")}:{String(minutes).padStart(2, "0")}:
        {String(seconds).padStart(2, "0")}
      </span>
      <span className="human-readable">{humanReadable}</span>
    </div>
  );
}
```

### Step 11: Create Countdown Hook with Human Readable

**hooks/use-countdown.ts:**

```typescript
import { useEffect, useState } from "react";

interface CountdownResult {
  hours: number;
  minutes: number;
  seconds: number;
  totalSeconds: number;
  isExpired: boolean;
  humanReadable: string;
}

export function useCountdown(targetDate: string): CountdownResult {
  const [totalSeconds, setTotalSeconds] = useState(0);

  useEffect(() => {
    const calculate = () => {
      const target = new Date(targetDate).getTime();
      const now = Date.now();
      const diff = Math.max(0, Math.floor((target - now) / 1000));
      setTotalSeconds(diff);
    };

    calculate();
    const interval = setInterval(calculate, 1000);
    return () => clearInterval(interval);
  }, [targetDate]);

  const hours = Math.floor(totalSeconds / 3600);
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const seconds = totalSeconds % 60;

  const humanReadable = (() => {
    if (hours > 0) {
      return `${hours}h ${minutes}m left`;
    }
    if (minutes > 0) {
      return `${minutes}m ${seconds}s left`;
    }
    return `${seconds}s left`;
  })();

  return {
    hours,
    minutes,
    seconds,
    totalSeconds,
    isExpired: totalSeconds === 0,
    humanReadable,
  };
}
```

### Step 12: Create Goals Widget

**components/dashboard/goals-widget.tsx:**

```tsx
import { useTranslation } from "react-i18next";

interface GoalsWidgetProps {
  budget: number; // e.g., 1000 requests
  current: number; // e.g., 450 requests
  pace: "on-track" | "ahead" | "behind";
}

export function GoalsWidget({ budget, current, pace }: GoalsWidgetProps) {
  const { t } = useTranslation();
  const percentage = (current / budget) * 100;

  const paceIcons = {
    "on-track": "✓",
    ahead: "↑",
    behind: "↓",
  };

  const paceColors = {
    "on-track": "var(--success)",
    ahead: "var(--accent)",
    behind: "var(--warning)",
  };

  return (
    <div className="goals-widget">
      <div className="goals-header">
        <span className="label">{t("dashboard.goals")}</span>
        <span className="pace" style={{ color: paceColors[pace] }}>
          {paceIcons[pace]} {pace}
        </span>
      </div>

      <div className="budget-bar-container">
        <div className="budget-bar">
          <div
            className="budget-fill"
            style={{
              width: `${Math.min(percentage, 100)}%`,
              background: percentage > 100 ? "var(--danger)" : "var(--accent)",
            }}
          />
        </div>
        <div className="budget-text">
          <span className="current">{current}</span>
          <span className="separator">/</span>
          <span className="total">{budget}</span>
        </div>
      </div>
    </div>
  );
}
```

### Step 13: Create Focus Mode Indicator

**components/dashboard/focus-mode-indicator.tsx:**

```tsx
import { useTranslation } from "react-i18next";

interface FocusModeIndicatorProps {
  enabled: boolean;
  onToggle: () => void;
}

export function FocusModeIndicator({
  enabled,
  onToggle,
}: FocusModeIndicatorProps) {
  const { t } = useTranslation();

  return (
    <div className={`focus-mode-indicator ${enabled ? "active" : ""}`}>
      <button onClick={onToggle} className="focus-toggle">
        <span className="icon">{enabled ? "🎯" : "💤"}</span>
        <span className="label">{t("dashboard.focusMode")}</span>
        <span className="status">{enabled ? "ON" : "OFF"}</span>
      </button>
    </div>
  );
}
```

### Step 14: Create Grid Layout Wrapper

**hooks/use-grid-layout.ts:**

```typescript
import { useSettingsStore } from "../stores/settings-store";

export function useGridLayout() {
  const { layout, setLayout } = useSettingsStore();

  const handleLayoutChange = (newLayout: any[]) => {
    setLayout(newLayout);
  };

  return { layout, handleLayoutChange };
}
```

**components/dashboard/grid-layout-wrapper.tsx:**

```tsx
import { ReactNode } from "react";
import { Responsive, WidthProvider, Layout } from "react-grid-layout";
import { useGridLayout } from "../../hooks/use-grid-layout";
import "react-grid-layout/css/styles.css";
import "react-resizable/css/styles.css";

const ResponsiveGridLayout = WidthProvider(Responsive);

interface GridLayoutWrapperProps {
  children: ReactNode;
}

export function GridLayoutWrapper({ children }: GridLayoutWrapperProps) {
  const { layout, handleLayoutChange } = useGridLayout();

  return (
    <ResponsiveGridLayout
      className="dashboard-grid"
      layouts={{ lg: layout }}
      breakpoints={{ lg: 1200, md: 996, sm: 768, xs: 480, xxs: 0 }}
      cols={{ lg: 12, md: 10, sm: 6, xs: 4, xxs: 2 }}
      rowHeight={40}
      onLayoutChange={handleLayoutChange}
      draggableHandle=".drag-handle"
    >
      {children}
    </ResponsiveGridLayout>
  );
}
```

### Step 15: Create Settings Components

**components/settings/theme-switcher.tsx:**

```tsx
import { useTranslation } from "react-i18next";
import { useThemeStore, Theme } from "../../stores/theme-store";

const themes: { value: Theme; label: string }[] = [
  { value: "system", label: "themes.system" },
  { value: "light", label: "themes.light" },
  { value: "dark", label: "themes.dark" },
  { value: "neon-light", label: "themes.neonLight" },
  { value: "neon-dark", label: "themes.neonDark" },
  { value: "glass-light", label: "themes.glassLight" },
  { value: "glass-dark", label: "themes.glassDark" },
];

export function ThemeSwitcher() {
  const { t } = useTranslation();
  const { theme, setTheme } = useThemeStore();

  return (
    <div className="theme-switcher">
      <label htmlFor="theme-select">{t("settings.theme")}</label>
      <select
        id="theme-select"
        value={theme}
        onChange={(e) => setTheme(e.target.value as Theme)}
      >
        {themes.map((t) => (
          <option key={t.value} value={t.value}>
            {t(t.label)}
          </option>
        ))}
      </select>
    </div>
  );
}
```

**components/settings/color-customizer.tsx:**

```tsx
import { useTranslation } from "react-i18next";
import { useThemeStore, ColorLevel } from "../../stores/theme-store";

export function ColorCustomizer() {
  const { t } = useTranslation();
  const {
    colorLevel,
    setColorLevel,
    accentColor,
    setAccentColor,
    customColors,
    setCustomColors,
  } = useThemeStore();

  return (
    <div className="color-customizer">
      <label>{t("settings.colors")}</label>

      <div className="color-level-selector">
        <button
          className={colorLevel === "basic" ? "active" : ""}
          onClick={() => setColorLevel("basic")}
        >
          {t("colorLevels.basic")}
        </button>
        <button
          className={colorLevel === "advanced" ? "active" : ""}
          onClick={() => setColorLevel("advanced")}
        >
          {t("colorLevels.advanced")}
        </button>
        <button
          className={colorLevel === "expert" ? "active" : ""}
          onClick={() => setColorLevel("expert")}
        >
          {t("colorLevels.expert")}
        </button>
      </div>

      {colorLevel === "advanced" && (
        <div className="accent-picker">
          <label htmlFor="accent-color">Accent Color</label>
          <input
            type="color"
            id="accent-color"
            value={accentColor}
            onChange={(e) => setAccentColor(e.target.value)}
          />
        </div>
      )}

      {colorLevel === "expert" && (
        <div className="full-customization">
          <div className="color-input">
            <label>Background Primary</label>
            <input
              type="color"
              value={customColors.bgPrimary || "#1a1a1a"}
              onChange={(e) =>
                setCustomColors({ ...customColors, bgPrimary: e.target.value })
              }
            />
          </div>
          <div className="color-input">
            <label>Text Primary</label>
            <input
              type="color"
              value={customColors.textPrimary || "#ffffff"}
              onChange={(e) =>
                setCustomColors({
                  ...customColors,
                  textPrimary: e.target.value,
                })
              }
            />
          </div>
          <div className="color-input">
            <label>Accent</label>
            <input
              type="color"
              value={customColors.accent || "#00e5ff"}
              onChange={(e) =>
                setCustomColors({ ...customColors, accent: e.target.value })
              }
            />
          </div>
        </div>
      )}
    </div>
  );
}
```

**components/settings/progress-bar-picker.tsx:**

```tsx
import { useTranslation } from "react-i18next";
import { useSettingsStore, ProgressBarType } from "../../stores/settings-store";

export function ProgressBarPicker() {
  const { t } = useTranslation();
  const { progressBarType, setProgressBarType } = useSettingsStore();

  const types: ProgressBarType[] = ["linear", "circular", "gauge"];

  return (
    <div className="progress-bar-picker">
      <label>{t("settings.progressBar")}</label>
      <div className="type-buttons">
        {types.map((type) => (
          <button
            key={type}
            className={progressBarType === type ? "active" : ""}
            onClick={() => setProgressBarType(type)}
          >
            {t(`progressTypes.${type}`)}
          </button>
        ))}
      </div>
    </div>
  );
}
```

**components/settings/font-size-slider.tsx:**

```tsx
import { useTranslation } from "react-i18next";
import { useSettingsStore } from "../../stores/settings-store";

export function FontSizeSlider() {
  const { t } = useTranslation();
  const { fontSize, setFontSize } = useSettingsStore();

  return (
    <div className="font-size-slider">
      <label htmlFor="font-size">
        {t("settings.fontSize")}: {fontSize}%
      </label>
      <input
        type="range"
        id="font-size"
        min="80"
        max="150"
        step="5"
        value={fontSize}
        onChange={(e) => setFontSize(Number(e.target.value))}
      />
      <div className="range-labels">
        <span>80%</span>
        <span>100%</span>
        <span>150%</span>
      </div>
    </div>
  );
}
```

**components/settings/language-switcher.tsx:**

```tsx
import { useTranslation } from "react-i18next";
import { useI18nStore } from "../../stores/i18n-store";

export function LanguageSwitcher() {
  const { t } = useTranslation();
  const { language, setLanguage } = useI18nStore();

  return (
    <div className="language-switcher">
      <label htmlFor="language-select">{t("settings.language")}</label>
      <select
        id="language-select"
        value={language}
        onChange={(e) => setLanguage(e.target.value as "en" | "vi")}
      >
        <option value="en">English</option>
        <option value="vi">Tiếng Việt</option>
      </select>
    </div>
  );
}
```

### Step 16: Create Dashboard Widget with Grid

**components/dashboard/dashboard-widget.tsx:**

```tsx
import { GlassCard } from "../ui/glass-card";
import { GridLayoutWrapper } from "./grid-layout-wrapper";
import { ResetCountdown } from "./reset-countdown";
import { UsageDisplay } from "./usage-display";
import { GoalsWidget } from "./goals-widget";
import { FocusModeIndicator } from "./focus-mode-indicator";
import { useUsage } from "../../hooks/use-usage";
import { useTranslation } from "react-i18next";
import { useState } from "react";

export function DashboardWidget() {
  const { t } = useTranslation();
  const { usage, loading, error, refresh } = useUsage();
  const [focusMode, setFocusMode] = useState(false);

  if (loading && !usage) {
    return (
      <GlassCard className="dashboard-widget">
        <div className="loading">Loading...</div>
      </GlassCard>
    );
  }

  if (error && !usage) {
    return (
      <GlassCard className="dashboard-widget error">
        <div className="error-message">{error}</div>
        <button onClick={refresh}>Retry</button>
      </GlassCard>
    );
  }

  const fiveHour = usage?.five_hour;

  return (
    <div className="dashboard-container">
      <header className="dashboard-header">
        <h1>{t("dashboard.title")}</h1>
        <FocusModeIndicator
          enabled={focusMode}
          onToggle={() => setFocusMode(!focusMode)}
        />
        <button onClick={refresh} className="refresh-btn">
          {t("dashboard.refresh")}
        </button>
      </header>

      <GridLayoutWrapper>
        <div key="usage" className="grid-item">
          <GlassCard className="drag-handle">
            {fiveHour && (
              <UsageDisplay percentage={fiveHour.utilization * 100} />
            )}
          </GlassCard>
        </div>

        <div key="countdown" className="grid-item">
          <GlassCard className="drag-handle">
            {fiveHour && <ResetCountdown resetsAt={fiveHour.resets_at} />}
          </GlassCard>
        </div>

        <div key="goals" className="grid-item">
          <GlassCard className="drag-handle">
            <GoalsWidget budget={1000} current={450} pace="on-track" />
          </GlassCard>
        </div>

        <div key="stats" className="grid-item">
          <GlassCard className="drag-handle">
            <div>Stats Panel (Phase 4)</div>
          </GlassCard>
        </div>
      </GridLayoutWrapper>
    </div>
  );
}
```

### Step 17: Update App.tsx

```tsx
import { useEffect } from "react";
import { DashboardWidget } from "./components/dashboard/dashboard-widget";
import { ThemeSwitcher } from "./components/settings/theme-switcher";
import { ColorCustomizer } from "./components/settings/color-customizer";
import { ProgressBarPicker } from "./components/settings/progress-bar-picker";
import { FontSizeSlider } from "./components/settings/font-size-slider";
import { LanguageSwitcher } from "./components/settings/language-switcher";
import { useThemeStore } from "./stores/theme-store";
import { useI18nStore } from "./stores/i18n-store";
import { useSettingsStore } from "./stores/settings-store";
import "./i18n";
import "./styles/globals.css";
import "./styles/themes/light.css";
import "./styles/themes/dark.css";
import "./styles/themes/neon-light.css";
import "./styles/themes/neon-dark.css";
import "./styles/themes/glass-light.css";
import "./styles/themes/glass-dark.css";
import "./styles/components/dashboard.css";
import "./styles/components/settings.css";

function App() {
  const { theme } = useThemeStore();
  const { language } = useI18nStore();
  const { fontSize } = useSettingsStore();

  // Apply theme on mount and detect system preference
  useEffect(() => {
    const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
    const updateSystemTheme = () => {
      if (theme === "system") {
        document.documentElement.className = mediaQuery.matches
          ? "dark"
          : "light";
      } else {
        document.documentElement.className = theme;
      }
    };

    updateSystemTheme();
    mediaQuery.addEventListener("change", updateSystemTheme);
    return () => mediaQuery.removeEventListener("change", updateSystemTheme);
  }, [theme]);

  // Apply font size
  useEffect(() => {
    document.documentElement.style.fontSize = `${fontSize}%`;
  }, [fontSize]);

  return (
    <main className="app-container">
      <DashboardWidget />

      <aside className="settings-panel">
        <h2>Settings</h2>
        <LanguageSwitcher />
        <ThemeSwitcher />
        <ColorCustomizer />
        <ProgressBarPicker />
        <FontSizeSlider />
      </aside>
    </main>
  );
}

export default App;
```

### Step 18: Create Settings CSS

**styles/components/settings.css:**

```css
.settings-panel {
  padding: 16px;
  background: var(--bg-secondary);
  border-radius: 8px;
  margin-top: 16px;
}

.settings-panel > * + * {
  margin-top: 16px;
}

.theme-switcher,
.language-switcher {
  display: flex;
  align-items: center;
  gap: 8px;
}

.theme-switcher select,
.language-switcher select {
  background: var(--bg-primary);
  color: var(--text-primary);
  border: 1px solid var(--glass-border);
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
}

.color-customizer {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.color-level-selector {
  display: flex;
  gap: 8px;
}

.color-level-selector button {
  flex: 1;
  padding: 6px 12px;
  background: var(--bg-primary);
  color: var(--text-primary);
  border: 1px solid var(--glass-border);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.color-level-selector button.active {
  background: var(--accent);
  color: var(--bg-primary);
  border-color: var(--accent);
}

.accent-picker,
.full-customization {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 8px;
  background: var(--bg-primary);
  border-radius: 4px;
}

.color-input {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.color-input input[type="color"] {
  width: 60px;
  height: 30px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.progress-bar-picker {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.type-buttons {
  display: flex;
  gap: 8px;
}

.type-buttons button {
  flex: 1;
  padding: 6px 12px;
  background: var(--bg-primary);
  color: var(--text-primary);
  border: 1px solid var(--glass-border);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.type-buttons button.active {
  background: var(--accent);
  color: var(--bg-primary);
  border-color: var(--accent);
}

.font-size-slider {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.font-size-slider input[type="range"] {
  width: 100%;
}

.range-labels {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  opacity: 0.7;
}

.focus-mode-indicator {
  display: inline-block;
}

.focus-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  border: 1px solid var(--glass-border);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.focus-mode-indicator.active .focus-toggle {
  background: var(--accent);
  color: var(--bg-primary);
  border-color: var(--accent);
}

.goals-widget {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.goals-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.pace {
  font-weight: bold;
  font-size: 14px;
}

.budget-bar-container {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.budget-bar {
  height: 12px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 6px;
  overflow: hidden;
}

.budget-fill {
  height: 100%;
  transition: width 0.3s ease;
  border-radius: 6px;
}

.budget-text {
  display: flex;
  justify-content: center;
  gap: 4px;
  font-size: 14px;
}

.budget-text .current {
  font-weight: bold;
  color: var(--accent);
}

.dashboard-grid {
  margin-top: 16px;
}

.grid-item {
  cursor: move;
}

.drag-handle {
  cursor: move;
}

.progress-circular-wrapper,
.progress-gauge-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 16px;
}
```

## Todo List

- [ ] Install dependencies: react-grid-layout, react-i18next, i18next
- [ ] Create i18n setup with en.json + vi.json
- [ ] Create `stores/settings-store.ts` (fontSize, progressBarType, layout)
- [ ] Create `stores/theme-store.ts` (theme, colorLevel, accentColor, customColors)
- [ ] Create `stores/i18n-store.ts` (language)
- [ ] Create `styles/globals.css` with CSS variables
- [ ] Create 6 theme CSS files (default: neon-dark)
- [ ] Create `GlassCard`, `CircularProgress`, `GaugeProgress` UI components
- [ ] Create `UsageDisplay` with 3 progress bar variants
- [ ] Create `ResetCountdown` with dual format (HH:MM:SS + human readable)
- [ ] Create `GoalsWidget` with budget bar + pace indicator
- [ ] Create `FocusModeIndicator` with status toggle
- [ ] Create `GridLayoutWrapper` with drag-drop
- [ ] Create `ThemeSwitcher`, `ColorCustomizer`, `ProgressBarPicker`, `FontSizeSlider`, `LanguageSwitcher`
- [ ] Create `use-countdown.ts` hook with humanReadable
- [ ] Create `use-grid-layout.ts` hook
- [ ] Create `DashboardWidget` with grid layout
- [ ] Create `settings.css` component styles
- [ ] Update `App.tsx` with theme detection + settings panel
- [ ] Test all 6 themes visually (default: neon-dark)
- [ ] Test drag-drop layout persistence
- [ ] Test 3 progress bar variants
- [ ] Test color customization (3 levels)
- [ ] Test font size slider (80%-150%)
- [ ] Test i18n switching (en ↔ vi)

## Success Criteria

- All 6 themes display correctly (default: neon-dark)
- Progress bar has 3 working variants (linear/circular/gauge)
- Countdown shows dual format (HH:MM:SS + human readable)
- Color customization works at 3 levels (basic/advanced/expert)
- Dashboard layout is draggable and persists
- Font size slider works (80%-150%)
- i18n switches between English and Vietnamese
- Goals widget shows budget bar + pace indicator
- Focus mode indicator toggles correctly
- Theme/layout/settings persist after refresh (localStorage)
- Smooth 0.3s transitions between themes
- WCAG AA contrast on all themes

## Risk Assessment

| Risk                          | Mitigation                             |
| ----------------------------- | -------------------------------------- |
| backdrop-filter not supported | Fallback to solid background           |
| Neon too bright               | Reduce glow intensity on light themes  |
| Theme flicker on load         | Use CSS `:root` defaults               |
| Grid layout performance       | Limit max widgets to 8, debounce saves |
| i18n missing translations     | Fallback to English, add dev warnings  |
| Color picker browser compat   | Provide hex input fallback             |
| Circular/gauge rendering perf | Use CSS transforms over repaints       |

## Security Considerations

- No user data stored in themes/settings
- localStorage only stores: theme preference, layout positions, fontSize, language
- CSS-only styling, no JS injection risks
- Color picker values sanitized before CSS var injection

## Next Steps

- Phase 4: System Tray Integration (depends on usage display)
- Phase 5: Reminders & Notifications (depends on countdown)
- Phase 6: Settings Persistence (merge with current settings store)
</file>

<file path="docs/01-plans/260117-024834-claudiminder-implementation/phase-04-integration.md">
---
title: "Phase 4: Integration"
status: pending
priority: P1
effort: 6h
---

# Phase 4: Sidecar Integration, Tray, Notifications

## Context Links

- [Tauri v2 Research](../reports/researcher-260117-024702-tauri-v2-features.md)
- [UI Themes Research](../reports/researcher-260117-024115-ui-themes-design.md)
- Phase 1: Backend sidecar.py
- Phase 2: Rust sidecar module

## Overview

Complete integration between Python backend sidecar and Tauri frontend. Implement dynamic tray icon updates with configurable styles, desktop notifications with reminder schedules, snooze functionality, offline mode detection, rate limit handling, token refresh flow, and window management. Build Python backend using Nuitka (NOT PyInstaller).

## Key Insights (from research)

- Sidecar binary needs target-triple naming (e.g., `claudiminder-backend-x86_64-unknown-linux-gnu`)
- Tray tooltip updates via frontend event → Rust listener
- Notification plugin requires permission check at startup
- Dynamic SVG icons show percentage as circular progress
- Nuitka produces smaller, faster binaries than PyInstaller
- Certificate pinning prevents MITM attacks
- Notification throttling prevents spam (max 1/min)
- Snooze actions need notification buttons
- Offline mode requires special UI state
- Rate limiting needs exponential backoff strategy

## Requirements

### Functional

- Sidecar executes Nuitka-compiled Python backend and returns JSON
- Tray icon shows configurable style (number + progress + color)
- Tray tooltip shows full details (usage %, reset time, requests)
- Tray icon animation (pulse) on notification
- Desktop notifications at configured reminder times
- Notification throttling (max 1/min)
- Snooze buttons (5/15/30 min) in notifications
- Token expired notification + button to open login
- Offline mode detection and special UI state
- Rate limit handling with exponential backoff
- HTTP proxy support via environment variable
- Certificate pinning for API requests
- Window hide-to-tray on close button

### Non-Functional

- Sidecar response < 2s
- Icon updates on usage change only
- Notification throttling (max 1/minute)
- Nuitka binary < 30MB

## Architecture

```
Integration Flow:
┌─────────────┐     invoke()     ┌──────────────┐   sidecar()   ┌────────────────┐
│   React UI  │ ───────────────► │ Rust Command │ ────────────► │ Python Backend │
│             │ ◄─────────────── │              │ ◄──────────── │  (Nuitka)      │
└─────────────┘  UsageResponse   └──────────────┘     JSON      └────────────────┘
       │                                                                  │
       │  emit("usage-updated")                             HTTPS + cert pinning
       ▼                                                     + HTTP_PROXY support
┌─────────────┐                                                          │
│  Tray Icon  │  ← Updates tooltip + icon + animation                    ▼
└─────────────┘                                                  ┌────────────────┐
       │                                                         │ Anthropic API  │
       │  emit("notification")                                  └────────────────┘
       ▼
┌─────────────┐
│ Notification│  ← Throttled (1/min) + Snooze buttons
└─────────────┘

Rate Limit Strategy:
1. Detect 429 response
2. Exponential backoff (1s → 2s → 4s → 8s)
3. Show warning notification
4. Retry or fail gracefully

Offline Detection:
1. Network error → Set offline mode
2. Show special UI state
3. Retry with exponential backoff
4. Resume on reconnection

Token Expired Flow:
1. Detect 401 response or missing token
2. Show notification: "Token expired. Click to login."
3. Button opens Claude login page
4. Wait for token in ~/.claude/.credentials.json
5. Auto-retry when token available
```

## Related Code Files

### Create

- `scripts/build-sidecar-nuitka.sh` - Nuitka build script for Python binary
- `src/frontend/src-tauri/src/events.rs` - Event definitions
- `src/frontend/src-tauri/src/http_client.rs` - HTTP client with cert pinning + proxy
- `src/frontend/src/utils/tray.ts` - Tray update utilities (icon generation)
- `src/frontend/src/utils/notifications.ts` - Notification helpers (throttling + snooze)
- `src/frontend/src/utils/rate-limit.ts` - Rate limit handler with backoff
- `src/frontend/src/utils/offline-detector.ts` - Offline mode detection
- `src/frontend/src/utils/token-refresh.ts` - Token expired handler
- `src/frontend/src-tauri/icons/tray/` - Dynamic tray icons (SVG-based)

### Modify

- `src/backend/sidecar.py` - Add proxy support + rate limit detection
- `src/backend/api/client.py` - Add cert pinning + proxy config
- `src/frontend/src-tauri/src/main.rs` - Add event listeners + snooze handlers
- `src/frontend/src-tauri/src/tray/setup.rs` - Dynamic updates + animation
- `src/frontend/src/hooks/use-usage.ts` - Emit tray events + offline detection
- `src/frontend/src/App.tsx` - Notification scheduling + snooze logic
- `src/frontend/src/components/dashboard/dashboard-widget.tsx` - Offline UI state

## Implementation Steps

### Step 1: Create Nuitka Build Script

**scripts/build-sidecar-nuitka.sh:**

```bash
#!/bin/bash
set -e

# Detect target triple
case "$(uname -s)-$(uname -m)" in
    Linux-x86_64) TARGET="x86_64-unknown-linux-gnu" ;;
    Linux-aarch64) TARGET="aarch64-unknown-linux-gnu" ;;
    Darwin-x86_64) TARGET="x86_64-apple-darwin" ;;
    Darwin-arm64) TARGET="aarch64-apple-darwin" ;;
    MINGW*|MSYS*) TARGET="x86_64-pc-windows-msvc"; EXT=".exe" ;;
    *) echo "Unknown platform"; exit 1 ;;
esac

echo "Building sidecar for $TARGET with Nuitka..."

# Build Python with Nuitka
cd src/backend
uv run nuitka --standalone \
    --onefile \
    --output-filename="claudiminder-backend-$TARGET$EXT" \
    --enable-plugin=anti-bloat \
    --assume-yes-for-downloads \
    --remove-output \
    sidecar.py

# Copy to Tauri binaries
mkdir -p ../frontend/src-tauri/binaries
cp claudiminder-backend-$TARGET$EXT ../frontend/src-tauri/binaries/

echo "Sidecar built: binaries/claudiminder-backend-$TARGET$EXT"
echo "Size: $(du -h ../frontend/src-tauri/binaries/claudiminder-backend-$TARGET$EXT | cut -f1)"
```

### Step 2: Update API Client with Cert Pinning + Proxy

**src/backend/api/client.py:**

```python
"""HTTP client with certificate pinning and proxy support."""
from __future__ import annotations

import os
from typing import Any

import httpx
from loguru import logger
from tenacity import retry, stop_after_attempt, wait_exponential

# Anthropic API certificate fingerprints (SHA256)
CERT_FINGERPRINTS = [
    "sha256/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",  # Primary cert
    "sha256/BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB=",  # Backup cert
]


class RateLimitError(Exception):
    """Raised when rate limit is exceeded."""

    pass


class TokenExpiredError(Exception):
    """Raised when OAuth token is expired."""

    pass


def get_http_client() -> httpx.AsyncClient:
    """Create HTTP client with cert pinning and proxy support."""
    proxies = {}
    if http_proxy := os.getenv("HTTP_PROXY") or os.getenv("http_proxy"):
        proxies["http://"] = http_proxy
    if https_proxy := os.getenv("HTTPS_PROXY") or os.getenv("https_proxy"):
        proxies["https://"] = https_proxy

    return httpx.AsyncClient(
        timeout=30.0,
        proxies=proxies if proxies else None,
        verify=True,  # Enable SSL verification
        # TODO: Implement certificate pinning with custom transport
    )


@retry(
    stop=stop_after_attempt(3),
    wait=wait_exponential(multiplier=1, min=1, max=8),
    reraise=True,
)
async def api_request(
    method: str,
    url: str,
    token: str,
    **kwargs: Any,
) -> dict[str, Any]:
    """Make API request with retry and error handling."""
    async with get_http_client() as client:
        headers = {"Authorization": f"Bearer {token}"}
        response = await client.request(method, url, headers=headers, **kwargs)

        if response.status_code == 401:
            raise TokenExpiredError("OAuth token expired")

        if response.status_code == 429:
            logger.warning("Rate limit exceeded")
            raise RateLimitError("Rate limit exceeded")

        response.raise_for_status()
        return response.json()
```

### Step 3: Update sidecar.py with Enhanced Error Handling

**src/backend/sidecar.py:**

```python
"""Sidecar entry point for Tauri integration."""
from __future__ import annotations

import asyncio
import json
import sys

from .api.client import RateLimitError, TokenExpiredError
from .api.usage import clear_usage_cache, get_usage_async
from .utils.credentials import is_token_available


async def handle_action(action: str) -> dict:
    """Handle sidecar action and return JSON response."""
    match action:
        case "get_usage":
            if not is_token_available():
                return {
                    "error": "No OAuth token",
                    "token_expired": True,
                }

            try:
                usage = await get_usage_async()
                if usage:
                    return usage.model_dump()
                return {"error": "Failed to fetch usage"}
            except TokenExpiredError:
                return {
                    "error": "OAuth token expired",
                    "token_expired": True,
                }
            except RateLimitError:
                return {
                    "error": "Rate limit exceeded",
                    "rate_limited": True,
                }
            except Exception as e:
                # Network error → offline mode
                if "connection" in str(e).lower() or "network" in str(e).lower():
                    return {
                        "error": "Network error",
                        "offline": True,
                    }
                return {"error": str(e)}

        case "refresh_usage":
            clear_usage_cache()
            return await handle_action("get_usage")

        case "check_token":
            return {"available": is_token_available()}

        case _:
            return {"error": f"Unknown action: {action}"}


async def main() -> None:
    action = sys.argv[1] if len(sys.argv) > 1 else "get_usage"
    result = await handle_action(action)
    print(json.dumps(result))


if __name__ == "__main__":
    asyncio.run(main())
```

### Step 4: Create Event Definitions (Rust)

**src/frontend/src-tauri/src/events.rs:**

```rust
use serde::{Deserialize, Serialize};

pub const EVENT_USAGE_UPDATED: &str = "usage-updated";
pub const EVENT_TRAY_UPDATE: &str = "tray-update";
pub const EVENT_TRAY_ANIMATE: &str = "tray-animate";
pub const EVENT_SNOOZE: &str = "snooze";

#[derive(Clone, Serialize, Deserialize)]
pub struct UsageUpdatedPayload {
    pub utilization: f64,
    pub resets_at: String,
    pub requests_used: u32,
    pub requests_limit: u32,
}

#[derive(Clone, Serialize, Deserialize)]
pub struct TrayUpdatePayload {
    pub percentage: f64,
    pub tooltip: String,
    pub color: String, // "green", "yellow", "orange", "red"
}

#[derive(Clone, Serialize, Deserialize)]
pub struct TrayAnimatePayload {
    pub duration_ms: u32,
}

#[derive(Clone, Serialize, Deserialize)]
pub struct SnoozePayload {
    pub minutes: u32, // 5, 15, 30
}
```

### Step 5: Update main.rs with Event Listeners

**src/frontend/src-tauri/src/main.rs:**

```rust
#![cfg_attr(not(debug_assertions), windows_subsystem = "windows")]

mod commands;
mod events;
mod sidecar;
mod tray;

use events::{SnoozePayload, TrayAnimatePayload, TrayUpdatePayload};
use events::{EVENT_SNOOZE, EVENT_TRAY_ANIMATE, EVENT_TRAY_UPDATE};
use tauri::{Listener, Manager};

fn main() {
    tauri::Builder::default()
        .plugin(tauri_plugin_shell::init())
        .plugin(tauri_plugin_notification::init())
        .setup(|app| {
            let tray_id = tray::setup::setup_tray(app)?;

            // Listen for tray update events from frontend
            let app_handle = app.handle().clone();
            let tray_id_clone = tray_id.clone();
            app.listen(EVENT_TRAY_UPDATE, move |event| {
                if let Ok(payload) = serde_json::from_str::<TrayUpdatePayload>(event.payload()) {
                    if let Some(tray) = app_handle.tray_by_id(&tray_id_clone) {
                        let _ = tray.set_tooltip(Some(&payload.tooltip));
                        // TODO: Update icon based on percentage + color
                    }
                }
            });

            // Listen for tray animation events
            let app_handle = app.handle().clone();
            let tray_id_clone = tray_id.clone();
            app.listen(EVENT_TRAY_ANIMATE, move |event| {
                if let Ok(payload) = serde_json::from_str::<TrayAnimatePayload>(event.payload()) {
                    if let Some(_tray) = app_handle.tray_by_id(&tray_id_clone) {
                        // TODO: Implement pulse animation
                        // For now, just log
                        println!("Tray pulse animation: {}ms", payload.duration_ms);
                    }
                }
            });

            // Listen for snooze events
            let app_handle = app.handle().clone();
            app.listen(EVENT_SNOOZE, move |event| {
                if let Ok(payload) = serde_json::from_str::<SnoozePayload>(event.payload()) {
                    println!("Snooze for {} minutes", payload.minutes);
                    // Emit to frontend to handle snooze logic
                    let _ = app_handle.emit("snooze-activated", payload);
                }
            });

            // Intercept window close to hide instead
            let main_window = app.get_webview_window("main").unwrap();
            main_window.on_window_event(move |event| {
                if let tauri::WindowEvent::CloseRequested { api, .. } = event {
                    api.prevent_close();
                    if let Err(e) = event.window().hide() {
                        eprintln!("Failed to hide window: {}", e);
                    }
                }
            });

            // Request notification permission
            #[cfg(desktop)]
            {
                let handle = app.handle().clone();
                tauri::async_runtime::spawn(async move {
                    let _ = tauri_plugin_notification::NotificationExt::notification(&handle)
                        .request_permission()
                        .await;
                });
            }

            Ok(())
        })
        .invoke_handler(tauri::generate_handler![
            commands::usage::get_usage,
            commands::usage::refresh_usage,
        ])
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

### Step 6: Update Tray Setup to Return ID

**src/frontend/src-tauri/src/tray/setup.rs:**

```rust
use tauri::{
    menu::{Menu, MenuItem},
    tray::{MouseButton, MouseButtonState, TrayIconBuilder, TrayIconEvent, TrayIconId},
    App, Manager,
};

pub fn setup_tray(app: &App) -> Result<TrayIconId, Box<dyn std::error::Error>> {
    let quit = MenuItem::with_id(app, "quit", "Quit", true, None::<&str>)?;
    let show = MenuItem::with_id(app, "show", "Show", true, None::<&str>)?;
    let menu = Menu::with_items(app, &[&show, &quit])?;

    let tray = TrayIconBuilder::with_id("main-tray")
        .icon(app.default_window_icon().unwrap().clone())
        .menu(&menu)
        .tooltip("claudiminder: Loading...")
        .on_menu_event(|app, event| match event.id().as_ref() {
            "quit" => app.exit(0),
            "show" => {
                if let Some(window) = app.get_webview_window("main") {
                    let _ = window.show();
                    let _ = window.set_focus();
                }
            }
            _ => {}
        })
        .on_tray_icon_event(|tray, event| {
            if let TrayIconEvent::Click {
                button: MouseButton::Left,
                button_state: MouseButtonState::Up,
                ..
            } = event
            {
                if let Some(window) = tray.app_handle().get_webview_window("main") {
                    let _ = window.unminimize();
                    let _ = window.show();
                    let _ = window.set_focus();
                }
            }
        })
        .build(app)?;

    Ok(tray.id().clone())
}
```

### Step 7: Create Tray Update Utility (TypeScript)

**src/frontend/src/utils/tray.ts:**

```typescript
import { emit } from "@tauri-apps/api/event";

export interface TrayUpdatePayload {
  percentage: number;
  tooltip: string;
  color: "green" | "yellow" | "orange" | "red";
}

export async function updateTray(
  utilization: number,
  resetsAt: string,
  requestsUsed: number,
  requestsLimit: number,
): Promise<void> {
  const percentage = utilization * 100;

  // Calculate time remaining
  const resetTime = new Date(resetsAt).getTime();
  const now = Date.now();
  const remainingMs = Math.max(0, resetTime - now);
  const remainingMins = Math.floor(remainingMs / 60000);

  // Determine color based on usage
  let color: "green" | "yellow" | "orange" | "red";
  if (percentage < 50) color = "green";
  else if (percentage < 75) color = "yellow";
  else if (percentage < 90) color = "orange";
  else color = "red";

  // Build tooltip with full details
  let timeStr: string;
  if (remainingMins >= 60) {
    const hours = Math.floor(remainingMins / 60);
    const mins = remainingMins % 60;
    timeStr = `${hours}h ${mins}m`;
  } else if (remainingMins > 0) {
    timeStr = `${remainingMins}m`;
  } else {
    timeStr = "now!";
  }

  const tooltip = `claudiminder: ${percentage.toFixed(1)}% | ${requestsUsed}/${requestsLimit} requests | Reset in ${timeStr}`;

  await emit("tray-update", { percentage, tooltip, color });
}

export async function animateTray(durationMs = 500): Promise<void> {
  await emit("tray-animate", { duration_ms: durationMs });
}
```

### Step 8: Create Notification Utility with Throttling + Snooze

**src/frontend/src/utils/notifications.ts:**

```typescript
import {
  isPermissionGranted,
  requestPermission,
  sendNotification,
} from "@tauri-apps/plugin-notification";
import { emit } from "@tauri-apps/api/event";

let lastNotificationTime = 0;
const NOTIFICATION_THROTTLE_MS = 60000; // 1 minute

export async function ensureNotificationPermission(): Promise<boolean> {
  let granted = await isPermissionGranted();
  if (!granted) {
    const permission = await requestPermission();
    granted = permission === "granted";
  }
  return granted;
}

async function canNotify(): Promise<boolean> {
  const now = Date.now();
  if (now - lastNotificationTime < NOTIFICATION_THROTTLE_MS) {
    console.log("Notification throttled");
    return false;
  }

  const granted = await ensureNotificationPermission();
  if (!granted) {
    console.warn("Notification permission not granted");
    return false;
  }

  lastNotificationTime = now;
  return true;
}

export async function notifyReminder(
  title: string,
  body: string,
): Promise<void> {
  if (!(await canNotify())) return;

  sendNotification({
    title,
    body,
    // TODO: Add snooze action buttons (requires Tauri plugin enhancement)
  });

  // Emit tray animation
  emit("tray-animate", { duration_ms: 500 });
}

export async function notifyUsageWarning(percentage: number): Promise<void> {
  if (percentage >= 90) {
    await notifyReminder(
      "Claude Usage Critical",
      `You've used ${percentage.toFixed(0)}% of your quota!`,
    );
  } else if (percentage >= 75) {
    await notifyReminder(
      "Claude Usage Warning",
      `You've used ${percentage.toFixed(0)}% of your quota.`,
    );
  }
}

export async function notifyResetSoon(minutesRemaining: number): Promise<void> {
  await notifyReminder(
    "Claude Reset Soon",
    `Your token quota resets in ${minutesRemaining} minutes!`,
  );
}

export async function notifyTokenExpired(): Promise<void> {
  if (!(await canNotify())) return;

  sendNotification({
    title: "Claude Token Expired",
    body: "Click to login and refresh your token.",
    // TODO: Add action button to open login page
  });
}

export async function notifyOffline(): Promise<void> {
  if (!(await canNotify())) return;

  sendNotification({
    title: "Network Error",
    body: "Claudiminder is offline. Will retry automatically.",
  });
}

export async function notifyRateLimited(): Promise<void> {
  if (!(await canNotify())) return;

  sendNotification({
    title: "Rate Limited",
    body: "API rate limit exceeded. Retrying with backoff...",
  });
}

export function handleSnooze(minutes: number): void {
  console.log(`Snoozed for ${minutes} minutes`);
  emit("snooze", { minutes });
}
```

### Step 9: Create Rate Limit Handler

**src/frontend/src/utils/rate-limit.ts:**

```typescript
export class RateLimitHandler {
  private retryCount = 0;
  private maxRetries = 4;

  async executeWithBackoff<T>(
    fn: () => Promise<T>,
    onRetry?: (attempt: number, delayMs: number) => void,
  ): Promise<T> {
    for (let attempt = 0; attempt <= this.maxRetries; attempt++) {
      try {
        const result = await fn();
        this.retryCount = 0; // Reset on success
        return result;
      } catch (error: any) {
        if (error.rate_limited && attempt < this.maxRetries) {
          const delayMs = Math.pow(2, attempt) * 1000; // 1s, 2s, 4s, 8s
          console.warn(
            `Rate limited. Retry ${attempt + 1}/${this.maxRetries} after ${delayMs}ms`,
          );
          onRetry?.(attempt + 1, delayMs);

          await new Promise((resolve) => setTimeout(resolve, delayMs));
        } else {
          throw error;
        }
      }
    }

    throw new Error("Max retries exceeded");
  }
}
```

### Step 10: Create Offline Detector

**src/frontend/src/utils/offline-detector.ts:**

```typescript
import { emit } from "@tauri-apps/api/event";

export class OfflineDetector {
  private isOffline = false;
  private retryAttempts = 0;
  private maxRetries = 5;

  checkNetworkError(error: any): boolean {
    const isNetworkError =
      error.offline === true ||
      error.message?.includes("network") ||
      error.message?.includes("connection");

    if (isNetworkError && !this.isOffline) {
      this.isOffline = true;
      this.retryAttempts = 0;
      emit("offline-mode", { offline: true });
    }

    return isNetworkError;
  }

  async retryWithBackoff(
    fn: () => Promise<any>,
  ): Promise<{ success: boolean; data?: any }> {
    if (!this.isOffline) {
      return { success: true, data: await fn() };
    }

    while (this.retryAttempts < this.maxRetries) {
      const delayMs = Math.pow(2, this.retryAttempts) * 2000; // 2s, 4s, 8s, 16s, 32s
      console.log(
        `Offline retry ${this.retryAttempts + 1}/${this.maxRetries} after ${delayMs}ms`,
      );

      await new Promise((resolve) => setTimeout(resolve, delayMs));

      try {
        const data = await fn();
        this.isOffline = false;
        this.retryAttempts = 0;
        emit("offline-mode", { offline: false });
        return { success: true, data };
      } catch (error) {
        this.retryAttempts++;
        if (!this.checkNetworkError(error)) {
          // Not a network error, stop retrying
          throw error;
        }
      }
    }

    return { success: false };
  }
}
```

### Step 11: Create Token Refresh Handler

**src/frontend/src/utils/token-refresh.ts:**

```typescript
import { open } from "@tauri-apps/plugin-shell";
import { notifyTokenExpired } from "./notifications";

const CLAUDE_LOGIN_URL = "https://claude.ai/login";

export async function handleTokenExpired(): Promise<void> {
  await notifyTokenExpired();

  // TODO: Add notification action button to trigger this
  // For now, user can manually click notification
}

export async function openClaudeLogin(): Promise<void> {
  await open(CLAUDE_LOGIN_URL);
}

export function watchTokenFile(onTokenAvailable: () => void): () => void {
  // TODO: Implement file watcher for ~/.claude/.credentials.json
  // For now, poll every 5 seconds
  const interval = setInterval(async () => {
    try {
      // Check if token is available via sidecar
      const result = await invoke("check_token");
      if (result.available) {
        onTokenAvailable();
        clearInterval(interval);
      }
    } catch (error) {
      console.error("Token check failed:", error);
    }
  }, 5000);

  return () => clearInterval(interval);
}
```

### Step 12: Update use-usage Hook with All Features

**src/frontend/src/hooks/use-usage.ts:**

```typescript
import { invoke } from "@tauri-apps/api/core";
import { useCallback, useEffect, useRef, useState } from "react";
import type { UsageResponse } from "../types/usage";
import { updateTray } from "../utils/tray";
import {
  notifyUsageWarning,
  notifyOffline,
  notifyRateLimited,
} from "../utils/notifications";
import { RateLimitHandler } from "../utils/rate-limit";
import { OfflineDetector } from "../utils/offline-detector";
import { handleTokenExpired } from "../utils/token-refresh";

export function useUsage(pollInterval = 60000) {
  const [usage, setUsage] = useState<UsageResponse | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [isOffline, setIsOffline] = useState(false);
  const [isRateLimited, setIsRateLimited] = useState(false);

  const lastPercentageRef = useRef<number | null>(null);
  const rateLimitHandler = useRef(new RateLimitHandler());
  const offlineDetector = useRef(new OfflineDetector());

  const fetchUsage = useCallback(async () => {
    try {
      setLoading(true);

      const result = await rateLimitHandler.current.executeWithBackoff(
        async () => {
          const res = await invoke<UsageResponse>("get_usage");

          // Check for errors
          if (res.token_expired) {
            await handleTokenExpired();
            throw new Error("Token expired");
          }

          if (res.rate_limited) {
            setIsRateLimited(true);
            await notifyRateLimited();
            throw new Error("Rate limited");
          }

          if (res.offline) {
            throw new Error("Network error");
          }

          return res;
        },
        (attempt, delayMs) => {
          console.log(`Rate limit retry ${attempt}, waiting ${delayMs}ms`);
        },
      );

      setIsRateLimited(false);
      setIsOffline(false);
      setUsage(result);
      setError(result.error || null);

      // Update tray and check notifications
      if (result.five_hour) {
        const { utilization, resets_at } = result.five_hour;
        const percentage = utilization * 100;

        // Update tray with full details
        await updateTray(
          utilization,
          resets_at,
          result.five_hour.input_tokens_used || 0,
          result.five_hour.input_tokens_limit || 0,
        );

        // Check for usage warnings (only on increase)
        if (
          lastPercentageRef.current !== null &&
          percentage > lastPercentageRef.current
        ) {
          await notifyUsageWarning(percentage);
        }
        lastPercentageRef.current = percentage;
      }
    } catch (e: any) {
      // Check if offline
      if (offlineDetector.current.checkNetworkError(e)) {
        setIsOffline(true);
        await notifyOffline();

        // Retry with exponential backoff
        const retry = await offlineDetector.current.retryWithBackoff(async () =>
          invoke<UsageResponse>("get_usage"),
        );

        if (retry.success) {
          setIsOffline(false);
          setUsage(retry.data);
        }
      } else {
        setError(String(e));
      }
    } finally {
      setLoading(false);
    }
  }, []);

  useEffect(() => {
    fetchUsage();
    const interval = setInterval(fetchUsage, pollInterval);
    return () => clearInterval(interval);
  }, [fetchUsage, pollInterval]);

  return {
    usage,
    loading,
    error,
    isOffline,
    isRateLimited,
    refresh: fetchUsage,
  };
}
```

### Step 13: Update Dashboard Widget with Offline State

**src/frontend/src/components/dashboard/dashboard-widget.tsx:**

```typescript
// ... existing imports
import { useUsage } from "../../hooks/use-usage";

export function DashboardWidget() {
  const { usage, loading, error, isOffline, isRateLimited, refresh } =
    useUsage();

  if (loading) {
    return <div className="dashboard-loading">Loading...</div>;
  }

  if (isOffline) {
    return (
      <div className="dashboard-offline">
        <h3>Offline Mode</h3>
        <p>Claudiminder is offline. Retrying automatically...</p>
        <button onClick={refresh}>Retry Now</button>
      </div>
    );
  }

  if (isRateLimited) {
    return (
      <div className="dashboard-rate-limited">
        <h3>Rate Limited</h3>
        <p>API rate limit exceeded. Retrying with backoff...</p>
      </div>
    );
  }

  if (error) {
    return <div className="dashboard-error">Error: {error}</div>;
  }

  // ... rest of existing component
}
```

### Step 14: Add Reminder Scheduler to App with Snooze

**src/frontend/src/App.tsx (updated):**

```typescript
import { useEffect, useRef, useState } from "react";
import { listen } from "@tauri-apps/api/event";
import { DashboardWidget } from "./components/dashboard/dashboard-widget";
import { ThemeSwitcher } from "./components/settings/theme-switcher";
import { useThemeStore } from "./stores/theme-store";
import { useUsage } from "./hooks/use-usage";
import {
  notifyResetSoon,
  ensureNotificationPermission,
} from "./utils/notifications";
// ... CSS imports

const REMINDER_MINUTES = [30, 15, 5]; // Minutes before reset to notify

function App() {
  const { theme } = useThemeStore();
  const { usage } = useUsage();
  const notifiedMinutesRef = useRef<Set<number>>(new Set());
  const [snoozeUntil, setSnoozeUntil] = useState<number | null>(null);

  // Apply theme
  useEffect(() => {
    const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
    const updateTheme = () => {
      document.documentElement.className =
        theme === "system" ? (mediaQuery.matches ? "dark" : "light") : theme;
    };
    updateTheme();
    mediaQuery.addEventListener("change", updateTheme);
    return () => mediaQuery.removeEventListener("change", updateTheme);
  }, [theme]);

  // Request notification permission on mount
  useEffect(() => {
    ensureNotificationPermission();
  }, []);

  // Listen for snooze events
  useEffect(() => {
    const unlisten = listen("snooze-activated", (event: any) => {
      const { minutes } = event.payload;
      const snoozeUntilTime = Date.now() + minutes * 60000;
      setSnoozeUntil(snoozeUntilTime);
      console.log(`Snoozed until ${new Date(snoozeUntilTime).toLocaleString()}`);
    });

    return () => {
      unlisten.then((fn) => fn());
    };
  }, []);

  // Reminder scheduler
  useEffect(() => {
    if (!usage?.five_hour) return;

    const checkReminders = () => {
      // Skip if snoozed
      if (snoozeUntil && Date.now() < snoozeUntil) {
        return;
      }

      const resetTime = new Date(usage.five_hour!.resets_at).getTime();
      const now = Date.now();
      const remainingMins = Math.floor((resetTime - now) / 60000);

      for (const reminderMin of REMINDER_MINUTES) {
        if (
          remainingMins <= reminderMin &&
          remainingMins > reminderMin - 1 &&
          !notifiedMinutesRef.current.has(reminderMin)
        ) {
          notifyResetSoon(remainingMins);
          notifiedMinutesRef.current.add(reminderMin);
        }
      }

      // Reset notified set when quota resets
      if (remainingMins <= 0) {
        notifiedMinutesRef.current.clear();
        setSnoozeUntil(null);
      }
    };

    checkReminders();
    const interval = setInterval(checkReminders, 30000); // Check every 30s
    return () => clearInterval(interval);
  }, [usage, snoozeUntil]);

  return (
    <main className="app-container">
      <DashboardWidget />
      <ThemeSwitcher />
    </main>
  );
}

export default App;
```

### Step 15: Add Nuitka to Dependencies

**src/backend/pyproject.toml:**

```toml
[project]
# ... existing fields

[project.optional-dependencies]
dev = [
    "pytest>=8.0.0",
    "pytest-asyncio>=0.23.0",
    "nuitka>=2.0.0",  # Add Nuitka for production builds
]
```

## Todo List

- [ ] Install Nuitka: `uv add --dev nuitka`
- [ ] Create `scripts/build-sidecar-nuitka.sh` with target detection
- [ ] Update `src/backend/api/client.py` with cert pinning + proxy support
- [ ] Update `sidecar.py` with error handling (token expired, rate limit, offline)
- [ ] Create `events.rs` with all event definitions
- [ ] Update `main.rs` with event listeners (tray, animation, snooze)
- [ ] Update `tray/setup.rs` to return TrayIconId
- [ ] Create `src/utils/tray.ts` for tray updates (icon generation)
- [ ] Create `src/utils/notifications.ts` with throttling + snooze
- [ ] Create `src/utils/rate-limit.ts` with exponential backoff
- [ ] Create `src/utils/offline-detector.ts` for offline mode detection
- [ ] Create `src/utils/token-refresh.ts` for token expired handler
- [ ] Update `use-usage.ts` to emit tray events + handle errors
- [ ] Update `dashboard-widget.tsx` with offline/rate-limited UI states
- [ ] Update `App.tsx` with reminder scheduler + snooze logic
- [ ] Add window close → hide behavior
- [ ] Test Nuitka build on current platform
- [ ] Test tray tooltip updates with full details
- [ ] Test notifications at reminder times
- [ ] Test snooze functionality (5/15/30 min)
- [ ] Test offline mode detection and retry
- [ ] Test rate limit handling with backoff
- [ ] Test token expired notification + login flow
- [ ] Test HTTP proxy support (HTTP_PROXY env var)

## Success Criteria

- Nuitka sidecar builds successfully (< 30MB)
- Sidecar executes and returns JSON in < 2s
- Tray tooltip shows "claudiminder: XX.X% | XXX/XXXX requests | Reset in Xh Xm"
- Tray icon changes color based on usage (green/yellow/orange/red)
- Tray icon animates (pulse) on notification
- Desktop notification appears 30/15/5 min before reset
- Notification throttling works (max 1/min)
- Snooze buttons work (5/15/30 min)
- Token expired notification shows with login button
- Offline mode shows special UI state and auto-retries
- Rate limit handling works with exponential backoff
- HTTP proxy support works (HTTP_PROXY env var)
- Window hides to tray on close button
- Window restores on tray click

## Risk Assessment

| Risk                                   | Mitigation                                |
| -------------------------------------- | ----------------------------------------- |
| Nuitka build issues on different OS    | Test on each target platform              |
| Certificate pinning breaks on cert rot | Use multiple cert fingerprints + fallback |
| Notification permission denied         | Fallback to console log + UI indicator    |
| Tray tooltip truncated on Windows      | Limit to 64 chars                         |
| Snooze state lost on app restart       | Persist to localStorage                   |
| Offline retry causing battery drain    | Max 5 retries with exponential backoff    |
| Rate limit causing infinite loop       | Max 4 retries then fail gracefully        |

## Security Considerations

- Sidecar runs with user permissions only
- No sensitive data in tray tooltip (no tokens)
- Notifications contain no tokens/credentials
- Event payloads validated before processing
- Certificate pinning prevents MITM attacks
- HTTP proxy respects system environment variables
- Token expiry detected before making API calls
</file>

<file path="docs/01-plans/260117-024834-claudiminder-implementation/phase-05-testing.md">
---
title: "Phase 5: Testing & Quality Assurance"
status: pending
priority: P2
effort: 6h
---

# Phase 5: Comprehensive Testing & CI/CD

## Context Links

- [Python Rules](../../02-general/rules/01-python.md)
- [Core Principles](../../02-general/rules/00-principles.md)
- Existing: `tests/backend/`, `pyproject.toml` pytest config

## Overview

Implement comprehensive testing suite with 90%+ coverage for both backend (Python) and frontend (TypeScript/React). Include E2E tests with Playwright, pre-commit hooks (lint + format + type), and full CI/CD pipeline with cross-platform builds and release automation.

## Key Insights

- 90%+ coverage target for production readiness
- pytest-asyncio + pytest-httpx for async backend tests
- Vitest + React Testing Library + Playwright for frontend
- Pre-commit hooks: ruff, prettier, mypy, pyright
- CI/CD: test → build → sign → publish on tag
- Coverage thresholds enforced in CI (fail if < 90%)
- E2E tests for critical user flows

## Requirements

### Functional

- Unit tests for all business logic (backend + frontend)
- Integration tests for API client + sidecar
- Component tests for React widgets
- Hook tests for state management
- E2E tests for GUI user flows (Playwright)
- Pre-commit hooks for code quality gates

### Non-Functional

- **>= 90% code coverage** for backend
- **>= 90% code coverage** for frontend
- All tests pass in CI (GitHub Actions)
- Test execution < 2min (unit + integration)
- E2E tests < 5min
- Type checking with mypy + pyright
- Linting + formatting checks on every commit
- Cross-platform builds (Linux, macOS, Windows)
- Release automation on git tag

## Architecture

```
tests/
├── backend/
│   ├── conftest.py              # Shared fixtures
│   ├── test_api_usage.py        # API client tests
│   ├── test_models.py           # Pydantic model tests
│   ├── test_credentials.py      # Credentials tests
│   ├── test_sidecar.py          # Sidecar entry point tests
│   ├── tui/
│   │   ├── test_app.py          # TUI app tests
│   │   └── test_widgets.py      # Widget tests
│   └── scheduler/
│       ├── test_reminder.py     # Reminder service tests
│       └── test_notifier.py     # Notifier tests
└── frontend/
    ├── setup.ts                 # Vitest setup
    ├── components/
    │   ├── dashboard.test.tsx
    │   └── theme-switcher.test.tsx
    ├── hooks/
    │   ├── use-usage.test.ts
    │   └── use-countdown.test.ts
    ├── stores/
    │   └── theme-store.test.ts
    └── e2e/
        ├── playwright.config.ts
        ├── dashboard.spec.ts
        ├── notifications.spec.ts
        └── theme-switcher.spec.ts

.github/
└── workflows/
    ├── test.yml                 # Test + coverage CI
    ├── build.yml                # Cross-platform build
    └── release.yml              # Release automation

.pre-commit-config.yaml          # Pre-commit hooks config
```

## Related Code Files

### Create

- `tests/backend/conftest.py`
- `tests/backend/test_api_usage.py`
- `tests/backend/test_models.py`
- `tests/backend/test_credentials.py`
- `tests/backend/test_sidecar.py`
- `tests/backend/tui/test_app.py`
- `tests/backend/tui/test_widgets.py`
- `tests/backend/scheduler/test_reminder.py`
- `tests/backend/scheduler/test_notifier.py`
- `tests/frontend/setup.ts`
- `tests/frontend/components/dashboard.test.tsx`
- `tests/frontend/components/theme-switcher.test.tsx`
- `tests/frontend/hooks/use-usage.test.ts`
- `tests/frontend/hooks/use-countdown.test.ts`
- `tests/frontend/stores/theme-store.test.ts`
- `tests/frontend/e2e/playwright.config.ts`
- `tests/frontend/e2e/dashboard.spec.ts`
- `tests/frontend/e2e/notifications.spec.ts`
- `tests/frontend/e2e/theme-switcher.spec.ts`
- `.pre-commit-config.yaml`
- `.github/workflows/test.yml`
- `.github/workflows/build.yml`
- `.github/workflows/release.yml`

### Modify

- `pyproject.toml` - Add pytest-httpx, mypy, pyright, coverage thresholds
- `src/frontend/package.json` - Add vitest, playwright, testing-library
- `src/frontend/vitest.config.ts` - Update coverage thresholds to 90%

## Implementation Steps

### Step 1: Add Test Dependencies

**pyproject.toml (add to dev):**

```toml
[project.optional-dependencies]
dev = [
    "pytest>=8.3.0",
    "pytest-asyncio>=0.25.0",
    "pytest-cov>=6.0.0",
    "pytest-httpx>=0.35.0",
    "textual-dev>=1.0.0",
    "ruff>=0.8.0",
    "mypy>=1.14.0",
    "pyright>=1.1.380",
    "pre-commit>=4.0.0",
]

[tool.pytest.ini_options]
testpaths = ["tests/backend"]
asyncio_mode = "auto"
addopts = "--cov=src/backend --cov-report=term-missing --cov-report=html --cov-fail-under=90"

[tool.coverage.run]
branch = true
source = ["src/backend"]

[tool.coverage.report]
fail_under = 90
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "raise AssertionError",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "if TYPE_CHECKING:",
]
```

```bash
uv sync --dev
```

**Frontend (package.json):**

```bash
cd src/frontend
bun add -d vitest @testing-library/react @testing-library/jest-dom @testing-library/user-event jsdom @types/node
bun add -d @playwright/test playwright
```

### Step 2: Create Backend conftest.py

**tests/backend/conftest.py:**

```python
"""Shared fixtures for backend tests."""
from __future__ import annotations

import pytest
from unittest.mock import patch, MagicMock
from src.backend.models.usage import UsageResponse, FiveHourUsage


@pytest.fixture
def mock_usage_response() -> UsageResponse:
    """Create mock usage response."""
    return UsageResponse(
        five_hour=FiveHourUsage(
            utilization=0.45,
            resets_at="2026-01-17T12:00:00Z",
        )
    )


@pytest.fixture
def mock_credentials():
    """Mock credentials module."""
    with patch("src.backend.utils.credentials.get_access_token") as mock:
        mock.return_value = "test-token-12345"
        yield mock


@pytest.fixture
def mock_httpx_response(mock_usage_response: UsageResponse):
    """Mock httpx client response."""
    mock_response = MagicMock()
    mock_response.status_code = 200
    mock_response.json.return_value = mock_usage_response.model_dump()
    return mock_response
```

### Step 3: Test API Usage Module (Comprehensive)

**tests/backend/test_api_usage.py:**

```python
"""Tests for API usage module."""
from __future__ import annotations

import pytest
from unittest.mock import patch, AsyncMock
from src.backend.api.usage import (
    get_usage_async,
    get_usage_sync,
    clear_usage_cache,
    is_token_expired,
)
from src.backend.models.usage import UsageResponse


@pytest.fixture(autouse=True)
def clear_cache():
    """Clear cache before each test."""
    clear_usage_cache()
    yield
    clear_usage_cache()


@pytest.mark.asyncio
async def test_get_usage_async_success(mock_credentials, mock_usage_response):
    """Test successful async usage fetch."""
    with patch("src.backend.api.usage.httpx.AsyncClient") as mock_client:
        mock_response = AsyncMock()
        mock_response.status_code = 200
        mock_response.json.return_value = mock_usage_response.model_dump()

        mock_client_instance = AsyncMock()
        mock_client_instance.get.return_value = mock_response
        mock_client.return_value.__aenter__.return_value = mock_client_instance

        result = await get_usage_async()

        assert result is not None
        assert result.five_hour is not None
        assert result.five_hour.utilization == 0.45


@pytest.mark.asyncio
async def test_get_usage_async_no_token():
    """Test usage fetch with no token."""
    with patch("src.backend.api.usage.get_access_token", return_value=None):
        result = await get_usage_async()
        assert result is None
        assert is_token_expired() is True


@pytest.mark.asyncio
async def test_get_usage_async_api_error():
    """Test handling of API errors."""
    with patch("src.backend.api.usage.get_access_token", return_value="token"):
        with patch("src.backend.api.usage.httpx.AsyncClient") as mock_client:
            mock_response = AsyncMock()
            mock_response.status_code = 500
            mock_response.raise_for_status.side_effect = Exception("Server Error")

            mock_client_instance = AsyncMock()
            mock_client_instance.get.return_value = mock_response
            mock_client.return_value.__aenter__.return_value = mock_client_instance

            result = await get_usage_async()
            assert result is None


def test_get_usage_sync_success(mock_credentials, mock_usage_response):
    """Test successful sync usage fetch."""
    with patch("src.backend.api.usage.httpx.Client") as mock_client:
        mock_response = AsyncMock()
        mock_response.status_code = 200
        mock_response.json.return_value = mock_usage_response.model_dump()

        mock_client_instance = AsyncMock()
        mock_client_instance.get.return_value = mock_response
        mock_client.return_value.__enter__.return_value = mock_client_instance

        result = get_usage_sync()

        assert result is not None


def test_cache_prevents_duplicate_calls(mock_credentials):
    """Test that cache prevents duplicate API calls."""
    with patch("src.backend.api.usage.httpx.Client") as mock_client:
        mock_response = AsyncMock()
        mock_response.status_code = 200
        mock_response.json.return_value = {
            "five_hour": {"utilization": 0.5, "resets_at": "2026-01-17T12:00:00Z"}
        }

        mock_client_instance = AsyncMock()
        mock_client_instance.get.return_value = mock_response
        mock_client.return_value.__enter__.return_value = mock_client_instance

        # First call
        get_usage_sync()
        # Second call should use cache
        get_usage_sync()

        # Client should only be called once
        assert mock_client.call_count == 1


def test_cache_expires_after_ttl(mock_credentials):
    """Test cache expiration after TTL."""
    import time

    with patch("src.backend.api.usage.httpx.Client") as mock_client:
        mock_response = AsyncMock()
        mock_response.status_code = 200
        mock_response.json.return_value = {
            "five_hour": {"utilization": 0.5, "resets_at": "2026-01-17T12:00:00Z"}
        }

        mock_client_instance = AsyncMock()
        mock_client_instance.get.return_value = mock_response
        mock_client.return_value.__enter__.return_value = mock_client_instance

        # First call
        get_usage_sync()

        # Simulate cache expiration (mock time if TTL is short)
        clear_usage_cache()

        # Second call after cache clear
        get_usage_sync()

        # Client should be called twice
        assert mock_client.call_count == 2
```

### Step 4: Test Models Module

**tests/backend/test_models.py:**

```python
"""Tests for Pydantic models."""
from __future__ import annotations

import pytest
from pydantic import ValidationError
from src.backend.models.usage import FiveHourUsage, UsageResponse


def test_five_hour_usage_valid():
    """Test valid FiveHourUsage model."""
    usage = FiveHourUsage(
        utilization=0.75,
        resets_at="2026-01-17T12:00:00Z"
    )
    assert usage.utilization == 0.75
    assert usage.resets_at == "2026-01-17T12:00:00Z"


def test_five_hour_usage_invalid_utilization():
    """Test FiveHourUsage with invalid utilization."""
    with pytest.raises(ValidationError):
        FiveHourUsage(
            utilization=1.5,  # > 1.0
            resets_at="2026-01-17T12:00:00Z"
        )


def test_usage_response_valid():
    """Test valid UsageResponse model."""
    response = UsageResponse(
        five_hour=FiveHourUsage(
            utilization=0.5,
            resets_at="2026-01-17T12:00:00Z"
        )
    )
    assert response.five_hour.utilization == 0.5


def test_usage_response_dict_conversion():
    """Test UsageResponse to dict conversion."""
    response = UsageResponse(
        five_hour=FiveHourUsage(
            utilization=0.33,
            resets_at="2026-01-17T15:30:00Z"
        )
    )
    data = response.model_dump()
    assert data["five_hour"]["utilization"] == 0.33
    assert "resets_at" in data["five_hour"]
```

### Step 5: Test Credentials Module

**tests/backend/test_credentials.py:**

```python
"""Tests for credentials module."""
from __future__ import annotations

import pytest
from pathlib import Path
from unittest.mock import patch, mock_open
from src.backend.utils.credentials import (
    get_access_token,
    get_credentials_path,
    is_token_available,
)


def test_get_credentials_path():
    """Test credentials path resolution."""
    path = get_credentials_path()
    assert path.name == ".credentials.json"
    assert ".claude" in str(path)


@patch("pathlib.Path.exists", return_value=True)
@patch("builtins.open", new_callable=mock_open, read_data='{"sessionToken": "test-token"}')
def test_get_access_token_success(mock_file, mock_exists):
    """Test successful token retrieval."""
    token = get_access_token()
    assert token == "test-token"


@patch("pathlib.Path.exists", return_value=False)
def test_get_access_token_file_not_found(mock_exists):
    """Test token retrieval when file doesn't exist."""
    token = get_access_token()
    assert token is None


@patch("pathlib.Path.exists", return_value=True)
@patch("builtins.open", new_callable=mock_open, read_data='{"invalid": "json"}')
def test_get_access_token_invalid_format(mock_file, mock_exists):
    """Test token retrieval with invalid JSON format."""
    token = get_access_token()
    assert token is None


@patch("src.backend.utils.credentials.get_access_token", return_value="token")
def test_is_token_available_true(mock_get_token):
    """Test token availability check when token exists."""
    assert is_token_available() is True


@patch("src.backend.utils.credentials.get_access_token", return_value=None)
def test_is_token_available_false(mock_get_token):
    """Test token availability check when token missing."""
    assert is_token_available() is False
```

### Step 6: Test Sidecar Module

**tests/backend/test_sidecar.py:**

```python
"""Tests for sidecar entry point."""
from __future__ import annotations

import json
import pytest
from unittest.mock import patch, AsyncMock
from src.backend.sidecar import handle_action


@pytest.mark.asyncio
async def test_handle_action_get_usage_success():
    """Test get_usage action with valid response."""
    mock_usage = AsyncMock()
    mock_usage.model_dump.return_value = {
        "five_hour": {"utilization": 0.3, "resets_at": "2026-01-17T12:00:00Z"}
    }

    with patch("src.backend.sidecar.is_token_available", return_value=True):
        with patch("src.backend.sidecar.get_usage_async", return_value=mock_usage):
            result = await handle_action("get_usage")

    assert "five_hour" in result
    assert result["five_hour"]["utilization"] == 0.3


@pytest.mark.asyncio
async def test_handle_action_no_token():
    """Test get_usage action with no token."""
    with patch("src.backend.sidecar.is_token_available", return_value=False):
        result = await handle_action("get_usage")

    assert "error" in result
    assert result["token_expired"] is True


@pytest.mark.asyncio
async def test_handle_action_check_token():
    """Test check_token action."""
    with patch("src.backend.sidecar.is_token_available", return_value=True):
        result = await handle_action("check_token")

    assert result["available"] is True


@pytest.mark.asyncio
async def test_handle_action_unknown():
    """Test unknown action returns error."""
    result = await handle_action("unknown_action")
    assert "error" in result
    assert "Unknown action" in result["error"]


@pytest.mark.asyncio
async def test_handle_action_refresh_cache():
    """Test refresh_cache action."""
    with patch("src.backend.sidecar.clear_usage_cache") as mock_clear:
        result = await handle_action("refresh_cache")
        mock_clear.assert_called_once()
        assert result["success"] is True
```

### Step 7: Test TUI Widgets (Comprehensive)

**tests/backend/tui/test_widgets.py:**

```python
"""Tests for TUI widgets."""
from __future__ import annotations

import pytest
from textual.pilot import Pilot


@pytest.mark.asyncio
async def test_usage_display_updates():
    """Test UsageDisplay widget updates on percentage change."""
    from src.backend.tui.widgets.usage_display import UsageDisplay
    from textual.app import App

    class TestApp(App):
        def compose(self):
            yield UsageDisplay()

    async with TestApp().run_test() as pilot:
        widget = pilot.app.query_one(UsageDisplay)
        widget.percentage = 50.0
        await pilot.pause()

        # Check display contains percentage
        assert "50.0%" in str(widget.render())


@pytest.mark.asyncio
async def test_usage_display_color_changes():
    """Test UsageDisplay color changes based on percentage."""
    from src.backend.tui.widgets.usage_display import UsageDisplay
    from textual.app import App

    class TestApp(App):
        def compose(self):
            yield UsageDisplay()

    async with TestApp().run_test() as pilot:
        widget = pilot.app.query_one(UsageDisplay)

        # Test low usage (green)
        widget.percentage = 30.0
        await pilot.pause()
        assert widget.get_color_class() == "success"

        # Test medium usage (yellow)
        widget.percentage = 70.0
        await pilot.pause()
        assert widget.get_color_class() == "warning"

        # Test high usage (red)
        widget.percentage = 95.0
        await pilot.pause()
        assert widget.get_color_class() == "danger"


@pytest.mark.asyncio
async def test_reset_countdown_displays_time():
    """Test ResetCountdown widget displays time correctly."""
    from src.backend.tui.widgets.reset_countdown import ResetCountdown
    from textual.app import App
    from datetime import datetime, timedelta, timezone

    class TestApp(App):
        def compose(self):
            yield ResetCountdown()

    async with TestApp().run_test() as pilot:
        widget = pilot.app.query_one(ResetCountdown)
        # Set reset time to 1 hour from now
        reset_time = datetime.now(timezone.utc) + timedelta(hours=1)
        widget.reset_at = reset_time.isoformat()
        await pilot.pause()

        # Check display contains time format
        content = str(widget.render())
        assert "01:" in content or "00:" in content


@pytest.mark.asyncio
async def test_reset_countdown_updates_every_second():
    """Test ResetCountdown updates every second."""
    from src.backend.tui.widgets.reset_countdown import ResetCountdown
    from textual.app import App
    from datetime import datetime, timedelta, timezone

    class TestApp(App):
        def compose(self):
            yield ResetCountdown()

    async with TestApp().run_test() as pilot:
        widget = pilot.app.query_one(ResetCountdown)
        reset_time = datetime.now(timezone.utc) + timedelta(seconds=65)
        widget.reset_at = reset_time.isoformat()

        await pilot.pause(1)
        first_render = str(widget.render())

        await pilot.pause(1)
        second_render = str(widget.render())

        # Time should have changed
        assert first_render != second_render
```

### Step 8: Test TUI App

**tests/backend/tui/test_app.py:**

```python
"""Tests for TUI app."""
from __future__ import annotations

import pytest
from unittest.mock import patch, AsyncMock
from src.backend.tui.app import ClaudiminderApp


@pytest.mark.asyncio
async def test_app_starts_successfully():
    """Test TUI app starts without errors."""
    app = ClaudiminderApp()
    async with app.run_test() as pilot:
        assert app.is_running
        assert pilot.app.query_one("UsageDisplay") is not None


@pytest.mark.asyncio
async def test_app_loads_usage_data():
    """Test app loads usage data on start."""
    mock_usage = AsyncMock()
    mock_usage.five_hour.utilization = 0.55

    with patch("src.backend.tui.app.get_usage_async", return_value=mock_usage):
        app = ClaudiminderApp()
        async with app.run_test() as pilot:
            await pilot.pause(0.1)
            usage_widget = pilot.app.query_one("UsageDisplay")
            assert usage_widget.percentage == 55.0


@pytest.mark.asyncio
async def test_app_handles_refresh_action():
    """Test app refresh action."""
    app = ClaudiminderApp()
    async with app.run_test() as pilot:
        await pilot.press("r")  # Refresh hotkey
        await pilot.pause(0.1)
        # Should trigger usage data reload
        assert app.is_running
```

### Step 9: Test Reminder Service

**tests/backend/scheduler/test_reminder.py:**

```python
"""Tests for reminder service."""
from __future__ import annotations

import pytest
from datetime import datetime, timedelta, timezone
from unittest.mock import patch, AsyncMock
from src.backend.scheduler.reminder_service import ReminderService


@pytest.fixture
def reminder_service():
    """Create reminder service instance."""
    return ReminderService()


def test_update_reset_time(reminder_service):
    """Test updating reset time."""
    reset_at = "2026-01-17T12:00:00Z"
    reminder_service.update_reset_time(reset_at)

    assert reminder_service._reset_at is not None
    assert reminder_service._reset_at.isoformat().startswith("2026-01-17")


@pytest.mark.asyncio
async def test_check_reminders_sends_notification(reminder_service):
    """Test reminder triggers notification at correct time."""
    # Set reset time to 15 minutes from now
    reset_time = datetime.now(timezone.utc) + timedelta(minutes=15)
    reminder_service.update_reset_time(reset_time.isoformat())

    with patch("src.backend.scheduler.reminder_service.send_notification") as mock_notify:
        mock_notify.return_value = None
        await reminder_service._check_reminders()

        # Should trigger 15-minute reminder
        mock_notify.assert_called_once()
        assert "15" in str(mock_notify.call_args)


@pytest.mark.asyncio
async def test_no_reminder_if_far_from_reset(reminder_service):
    """Test no reminder sent when far from reset time."""
    # Set reset time to 3 hours from now
    reset_time = datetime.now(timezone.utc) + timedelta(hours=3)
    reminder_service.update_reset_time(reset_time.isoformat())

    with patch("src.backend.scheduler.reminder_service.send_notification") as mock_notify:
        await reminder_service._check_reminders()
        mock_notify.assert_not_called()


def test_configure_reminders(reminder_service):
    """Test configuring custom reminders."""
    reminder_service.configure_reminders([10, 30, 60])  # 10min, 30min, 1h
    assert len(reminder_service._reminder_thresholds) == 3
    assert 10 in reminder_service._reminder_thresholds
```

### Step 10: Test Notifier

**tests/backend/scheduler/test_notifier.py:**

```python
"""Tests for system notifier."""
from __future__ import annotations

import pytest
from unittest.mock import patch
from src.backend.scheduler.notifier import send_notification, NotificationLevel


@patch("src.backend.scheduler.notifier.plyer.notification.notify")
def test_send_notification_success(mock_notify):
    """Test sending notification successfully."""
    send_notification("Test Title", "Test Message", NotificationLevel.INFO)
    mock_notify.assert_called_once()

    call_args = mock_notify.call_args[1]
    assert call_args["title"] == "Test Title"
    assert call_args["message"] == "Test Message"


@patch("src.backend.scheduler.notifier.plyer.notification.notify", side_effect=Exception("Failed"))
def test_send_notification_failure(mock_notify):
    """Test handling notification send failure."""
    # Should not raise exception
    send_notification("Title", "Message", NotificationLevel.WARNING)
    mock_notify.assert_called_once()


def test_notification_levels():
    """Test notification level enum values."""
    assert NotificationLevel.INFO.value == "info"
    assert NotificationLevel.WARNING.value == "warning"
    assert NotificationLevel.CRITICAL.value == "critical"
```

### Step 11: Setup Vitest for Frontend (90% Coverage)

**src/frontend/vitest.config.ts:**

```typescript
import { defineConfig } from "vitest/config";
import react from "@vitejs/plugin-react";
import path from "path";

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
  test: {
    environment: "jsdom",
    globals: true,
    setupFiles: ["./tests/setup.ts"],
    coverage: {
      provider: "v8",
      reporter: ["text", "html", "lcov"],
      exclude: ["node_modules/", "tests/", "dist/", "**/*.config.*"],
      thresholds: {
        lines: 90,
        functions: 90,
        branches: 90,
        statements: 90,
      },
    },
  },
});
```

**tests/frontend/setup.ts:**

```typescript
import "@testing-library/jest-dom/vitest";
import { vi } from "vitest";

// Mock Tauri APIs
vi.mock("@tauri-apps/api/core", () => ({
  invoke: vi.fn(),
}));

vi.mock("@tauri-apps/api/event", () => ({
  emit: vi.fn(),
  listen: vi.fn(),
}));

vi.mock("@tauri-apps/plugin-notification", () => ({
  isPermissionGranted: vi.fn().mockResolvedValue(true),
  requestPermission: vi.fn().mockResolvedValue("granted"),
  sendNotification: vi.fn(),
}));

// Mock window.matchMedia for theme tests
Object.defineProperty(window, "matchMedia", {
  writable: true,
  value: vi.fn().mockImplementation((query) => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: vi.fn(),
    removeListener: vi.fn(),
    addEventListener: vi.fn(),
    removeEventListener: vi.fn(),
    dispatchEvent: vi.fn(),
  })),
});
```

### Step 12: Test Frontend Hooks (Comprehensive)

**tests/frontend/hooks/use-countdown.test.ts:**

```typescript
import { renderHook, act } from "@testing-library/react";
import { describe, it, expect, vi, beforeEach, afterEach } from "vitest";
import { useCountdown } from "../../src/hooks/use-countdown";

describe("useCountdown", () => {
  beforeEach(() => {
    vi.useFakeTimers();
  });

  afterEach(() => {
    vi.useRealTimers();
  });

  it("calculates remaining time correctly", () => {
    const targetDate = new Date(Date.now() + 3600000).toISOString(); // 1 hour
    const { result } = renderHook(() => useCountdown(targetDate));

    expect(result.current.hours).toBe(1);
    expect(result.current.minutes).toBe(0);
    expect(result.current.isExpired).toBe(false);
  });

  it("updates every second", () => {
    const targetDate = new Date(Date.now() + 65000).toISOString(); // 65 seconds
    const { result } = renderHook(() => useCountdown(targetDate));

    expect(result.current.seconds).toBe(5);

    act(() => {
      vi.advanceTimersByTime(1000);
    });

    expect(result.current.seconds).toBe(4);
  });

  it("sets isExpired when countdown reaches zero", () => {
    const targetDate = new Date(Date.now() + 1000).toISOString(); // 1 second
    const { result } = renderHook(() => useCountdown(targetDate));

    act(() => {
      vi.advanceTimersByTime(2000);
    });

    expect(result.current.isExpired).toBe(true);
    expect(result.current.totalSeconds).toBe(0);
  });

  it("handles negative time correctly", () => {
    const targetDate = new Date(Date.now() - 5000).toISOString(); // Past time
    const { result } = renderHook(() => useCountdown(targetDate));

    expect(result.current.isExpired).toBe(true);
    expect(result.current.hours).toBe(0);
    expect(result.current.minutes).toBe(0);
    expect(result.current.seconds).toBe(0);
  });

  it("formats time with leading zeros", () => {
    const targetDate = new Date(Date.now() + 125000).toISOString(); // 2min 5sec
    const { result } = renderHook(() => useCountdown(targetDate));

    expect(result.current.minutes).toBe(2);
    expect(result.current.seconds).toBe(5);
    expect(result.current.formatted).toBe("00:02:05");
  });
});
```

**tests/frontend/hooks/use-usage.test.ts:**

```typescript
import { renderHook, waitFor } from "@testing-library/react";
import { describe, it, expect, vi, beforeEach } from "vitest";
import { useUsage } from "../../src/hooks/use-usage";
import { invoke } from "@tauri-apps/api/core";

vi.mock("@tauri-apps/api/core");

describe("useUsage", () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });

  it("fetches usage data on mount", async () => {
    const mockUsage = {
      five_hour: {
        utilization: 0.65,
        resets_at: "2026-01-17T15:00:00Z",
      },
    };

    (invoke as any).mockResolvedValue(mockUsage);

    const { result } = renderHook(() => useUsage());

    expect(result.current.loading).toBe(true);

    await waitFor(() => {
      expect(result.current.loading).toBe(false);
    });

    expect(result.current.usage).toEqual(mockUsage);
    expect(result.current.error).toBeNull();
  });

  it("handles fetch error", async () => {
    (invoke as any).mockRejectedValue(new Error("Network error"));

    const { result } = renderHook(() => useUsage());

    await waitFor(() => {
      expect(result.current.loading).toBe(false);
    });

    expect(result.current.usage).toBeNull();
    expect(result.current.error).toBe("Network error");
  });

  it("refreshes usage data", async () => {
    const mockUsage = {
      five_hour: {
        utilization: 0.5,
        resets_at: "2026-01-17T15:00:00Z",
      },
    };

    (invoke as any).mockResolvedValue(mockUsage);

    const { result } = renderHook(() => useUsage());

    await waitFor(() => {
      expect(result.current.loading).toBe(false);
    });

    const newMockUsage = {
      ...mockUsage,
      five_hour: { ...mockUsage.five_hour, utilization: 0.7 },
    };
    (invoke as any).mockResolvedValue(newMockUsage);

    result.current.refresh();

    await waitFor(() => {
      expect(result.current.usage?.five_hour.utilization).toBe(0.7);
    });
  });
});
```

### Step 13: Test Frontend Components (Comprehensive)

**tests/frontend/components/dashboard.test.tsx:**

```tsx
import { render, screen, fireEvent, waitFor } from "@testing-library/react";
import { describe, it, expect, vi, beforeEach } from "vitest";
import { DashboardWidget } from "../../src/components/dashboard/dashboard-widget";
import { invoke } from "@tauri-apps/api/core";

vi.mock("../../src/hooks/use-usage", () => ({
  useUsage: vi.fn(),
}));

import { useUsage } from "../../src/hooks/use-usage";

describe("DashboardWidget", () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });

  it("shows loading state initially", () => {
    (useUsage as any).mockReturnValue({
      usage: null,
      loading: true,
      error: null,
      refresh: vi.fn(),
    });

    render(<DashboardWidget />);
    expect(screen.getByText(/loading/i)).toBeInTheDocument();
  });

  it("displays usage percentage", () => {
    (useUsage as any).mockReturnValue({
      usage: {
        five_hour: {
          utilization: 0.45,
          resets_at: "2026-01-17T12:00:00Z",
        },
      },
      loading: false,
      error: null,
      refresh: vi.fn(),
    });

    render(<DashboardWidget />);
    expect(screen.getByText(/45\.0%/)).toBeInTheDocument();
  });

  it("shows error message on failure", () => {
    (useUsage as any).mockReturnValue({
      usage: null,
      loading: false,
      error: "Failed to fetch",
      refresh: vi.fn(),
    });

    render(<DashboardWidget />);
    expect(screen.getByText(/failed to fetch/i)).toBeInTheDocument();
  });

  it("shows token expired message", () => {
    (useUsage as any).mockReturnValue({
      usage: null,
      loading: false,
      error: "Token expired",
      tokenExpired: true,
      refresh: vi.fn(),
    });

    render(<DashboardWidget />);
    expect(screen.getByText(/token expired/i)).toBeInTheDocument();
    expect(screen.getByText(/login/i)).toBeInTheDocument();
  });

  it("handles refresh button click", async () => {
    const mockRefresh = vi.fn();
    (useUsage as any).mockReturnValue({
      usage: {
        five_hour: {
          utilization: 0.5,
          resets_at: "2026-01-17T12:00:00Z",
        },
      },
      loading: false,
      error: null,
      refresh: mockRefresh,
    });

    render(<DashboardWidget />);
    const refreshBtn = screen.getByRole("button", { name: /refresh/i });
    fireEvent.click(refreshBtn);

    expect(mockRefresh).toHaveBeenCalledOnce();
  });

  it("displays countdown timer", () => {
    (useUsage as any).mockReturnValue({
      usage: {
        five_hour: {
          utilization: 0.3,
          resets_at: new Date(Date.now() + 3600000).toISOString(), // 1 hour
        },
      },
      loading: false,
      error: null,
      refresh: vi.fn(),
    });

    render(<DashboardWidget />);
    expect(screen.getByText(/resets in/i)).toBeInTheDocument();
    expect(screen.getByText(/01:00:/)).toBeInTheDocument();
  });
});
```

**tests/frontend/components/theme-switcher.test.tsx:**

```tsx
import { render, screen, fireEvent } from "@testing-library/react";
import { describe, it, expect, vi, beforeEach } from "vitest";
import { ThemeSwitcher } from "../../src/components/theme/theme-switcher";
import { useThemeStore } from "../../src/stores/theme-store";

describe("ThemeSwitcher", () => {
  beforeEach(() => {
    useThemeStore.setState({ theme: "system", resolvedTheme: "dark" });
  });

  it("renders theme options", () => {
    render(<ThemeSwitcher />);

    const button = screen.getByRole("button");
    fireEvent.click(button);

    expect(screen.getByText(/neon dark/i)).toBeInTheDocument();
    expect(screen.getByText(/glass light/i)).toBeInTheDocument();
    expect(screen.getByText(/terminal/i)).toBeInTheDocument();
  });

  it("switches theme on selection", () => {
    render(<ThemeSwitcher />);

    const button = screen.getByRole("button");
    fireEvent.click(button);

    const neonOption = screen.getByText(/neon dark/i);
    fireEvent.click(neonOption);

    const { theme } = useThemeStore.getState();
    expect(theme).toBe("neon-dark");
  });

  it("shows current theme as selected", () => {
    useThemeStore.setState({ theme: "glass-light" });

    render(<ThemeSwitcher />);
    const button = screen.getByRole("button");

    expect(button).toHaveTextContent(/glass light/i);
  });
});
```

### Step 14: Test Theme Store

**tests/frontend/stores/theme-store.test.ts:**

```typescript
import { describe, it, expect, beforeEach } from "vitest";
import { useThemeStore } from "../../src/stores/theme-store";

describe("themeStore", () => {
  beforeEach(() => {
    // Reset store state
    useThemeStore.setState({ theme: "system", resolvedTheme: "dark" });
    localStorage.clear();
  });

  it("has system as default theme", () => {
    const { theme } = useThemeStore.getState();
    expect(theme).toBe("system");
  });

  it("sets theme correctly", () => {
    const { setTheme } = useThemeStore.getState();
    setTheme("neon-dark");

    const { theme } = useThemeStore.getState();
    expect(theme).toBe("neon-dark");
  });

  it("persists theme in localStorage", () => {
    const { setTheme } = useThemeStore.getState();
    setTheme("glass-light");

    // Zustand persist should save to localStorage
    const stored = localStorage.getItem("claudiminder-theme");
    expect(stored).toContain("glass-light");
  });

  it("resolves system theme based on matchMedia", () => {
    window.matchMedia = vi.fn().mockImplementation((query) => ({
      matches: query === "(prefers-color-scheme: dark)",
      media: query,
      onchange: null,
      addListener: vi.fn(),
      removeListener: vi.fn(),
      addEventListener: vi.fn(),
      removeEventListener: vi.fn(),
      dispatchEvent: vi.fn(),
    }));

    const { resolveTheme } = useThemeStore.getState();
    resolveTheme();

    const { resolvedTheme } = useThemeStore.getState();
    expect(resolvedTheme).toBe("dark");
  });

  it("supports all available themes", () => {
    const { setTheme } = useThemeStore.getState();
    const themes = ["neon-dark", "glass-light", "terminal", "system"];

    themes.forEach((themeId) => {
      setTheme(themeId);
      const { theme } = useThemeStore.getState();
      expect(theme).toBe(themeId);
    });
  });
});
```

### Step 15: Setup Playwright E2E Tests

**tests/frontend/e2e/playwright.config.ts:**

```typescript
import { defineConfig, devices } from "@playwright/test";

export default defineConfig({
  testDir: "./",
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: "html",
  use: {
    baseURL: "http://localhost:1420",
    trace: "on-first-retry",
    screenshot: "only-on-failure",
  },
  projects: [
    {
      name: "chromium",
      use: { ...devices["Desktop Chrome"] },
    },
  ],
  webServer: {
    command: "bun run tauri dev",
    url: "http://localhost:1420",
    timeout: 120 * 1000,
    reuseExistingServer: !process.env.CI,
  },
});
```

**tests/frontend/e2e/dashboard.spec.ts:**

```typescript
import { test, expect } from "@playwright/test";

test.describe("Dashboard", () => {
  test("loads and displays usage data", async ({ page }) => {
    await page.goto("/");

    // Wait for usage data to load
    await expect(page.getByText(/loading/i)).toBeVisible();
    await expect(page.getByText(/loading/i)).not.toBeVisible({
      timeout: 10000,
    });

    // Check percentage is displayed
    await expect(page.getByText(/%/)).toBeVisible();
  });

  test("shows countdown timer", async ({ page }) => {
    await page.goto("/");

    await page.waitForSelector('[data-testid="countdown-timer"]');
    const timer = page.getByTestId("countdown-timer");

    await expect(timer).toBeVisible();
    await expect(timer).toContainText(/:/);
  });

  test("refreshes usage on button click", async ({ page }) => {
    await page.goto("/");

    await page.waitForSelector('[data-testid="refresh-btn"]');
    const refreshBtn = page.getByTestId("refresh-btn");

    await refreshBtn.click();
    await expect(page.getByText(/loading/i)).toBeVisible();
  });

  test("handles token expired state", async ({ page }) => {
    // Mock expired token response
    await page.route("**/api/usage", (route) => {
      route.fulfill({
        status: 401,
        body: JSON.stringify({ error: "Token expired" }),
      });
    });

    await page.goto("/");

    await expect(page.getByText(/token expired/i)).toBeVisible();
    await expect(page.getByText(/login/i)).toBeVisible();
  });
});
```

**tests/frontend/e2e/notifications.spec.ts:**

```typescript
import { test, expect } from "@playwright/test";

test.describe("Notifications", () => {
  test("requests notification permission", async ({ page, context }) => {
    await context.grantPermissions(["notifications"]);
    await page.goto("/");

    // Check notification permission is granted
    const permission = await page.evaluate(() => Notification.permission);
    expect(permission).toBe("granted");
  });

  test("sends reminder notification", async ({ page }) => {
    await page.goto("/");

    // Mock reset time to 10 minutes from now
    await page.evaluate(() => {
      const resetTime = new Date(Date.now() + 10 * 60 * 1000).toISOString();
      localStorage.setItem("mockResetTime", resetTime);
    });

    // Wait for reminder notification
    const notificationPromise = page.waitForEvent("notification");

    // Fast-forward time to trigger reminder
    await page.evaluate(() => {
      // Trigger reminder check
      window.dispatchEvent(new Event("check-reminders"));
    });

    const notification = await notificationPromise;
    expect(notification.title).toContain("Reminder");
  });
});
```

**tests/frontend/e2e/theme-switcher.spec.ts:**

```typescript
import { test, expect } from "@playwright/test";

test.describe("Theme Switcher", () => {
  test("switches between themes", async ({ page }) => {
    await page.goto("/");

    // Open theme switcher
    await page.click('[data-testid="theme-switcher-btn"]');

    // Select neon-dark theme
    await page.click('text="Neon Dark"');

    // Check theme is applied
    const html = page.locator("html");
    await expect(html).toHaveAttribute("data-theme", "neon-dark");
  });

  test("persists theme selection", async ({ page }) => {
    await page.goto("/");

    // Select glass-light theme
    await page.click('[data-testid="theme-switcher-btn"]');
    await page.click('text="Glass Light"');

    // Reload page
    await page.reload();

    // Check theme persisted
    const html = page.locator("html");
    await expect(html).toHaveAttribute("data-theme", "glass-light");
  });

  test("respects system theme", async ({ page, context }) => {
    await page.goto("/");

    // Select system theme
    await page.click('[data-testid="theme-switcher-btn"]');
    await page.click('text="System"');

    // Check theme matches system preference
    const isDark = await page.evaluate(
      () => window.matchMedia("(prefers-color-scheme: dark)").matches,
    );

    const html = page.locator("html");
    const theme = isDark ? "dark" : "light";
    await expect(html).toHaveAttribute("data-theme", new RegExp(theme));
  });
});
```

### Step 16: Setup Pre-commit Hooks

**.pre-commit-config.yaml:**

```yaml
repos:
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.5
    hooks:
      - id: ruff
        args: [--fix]
      - id: ruff-format

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.14.0
    hooks:
      - id: mypy
        additional_dependencies: [types-all]
        args: [--strict, --ignore-missing-imports]

  - repo: local
    hooks:
      - id: pyright
        name: pyright
        entry: pyright
        language: system
        types: [python]
        pass_filenames: false

  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v3.1.0
    hooks:
      - id: prettier
        types_or: [javascript, jsx, ts, tsx, json, yaml, markdown]
        args: [--write]

  - repo: local
    hooks:
      - id: frontend-lint
        name: frontend lint
        entry: bash -c "cd src/frontend && bun run lint"
        language: system
        pass_filenames: false

  - repo: local
    hooks:
      - id: backend-tests
        name: backend tests
        entry: bash -c "uv run pytest --cov=src/backend --cov-fail-under=90"
        language: system
        pass_filenames: false
        stages: [push]

  - repo: local
    hooks:
      - id: frontend-tests
        name: frontend tests
        entry: bash -c "cd src/frontend && bun run test --coverage"
        language: system
        pass_filenames: false
        stages: [push]
```

**Install pre-commit:**

```bash
uv run pre-commit install
uv run pre-commit install --hook-type pre-push
```

### Step 17: Create GitHub Actions CI Workflows

**.github/workflows/test.yml:**

```yaml
name: Test & Coverage

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  backend-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install uv
        uses: astral-sh/setup-uv@v4

      - name: Install dependencies
        run: uv sync --dev

      - name: Run ruff lint
        run: uv run ruff check src/ tests/

      - name: Run ruff format check
        run: uv run ruff format --check src/ tests/

      - name: Run mypy
        run: uv run mypy src/backend

      - name: Run pyright
        run: uv run pyright src/backend

      - name: Run tests with coverage
        run: uv run pytest --cov=src/backend --cov-report=xml --cov-report=term --cov-fail-under=90

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v4
        with:
          file: ./coverage.xml
          flags: backend
          name: backend-coverage

  frontend-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2

      - name: Install dependencies
        run: cd src/frontend && bun install

      - name: Run prettier check
        run: cd src/frontend && bun run format:check

      - name: Run lint
        run: cd src/frontend && bun run lint

      - name: Run type check
        run: cd src/frontend && bun run typecheck

      - name: Run tests with coverage
        run: cd src/frontend && bun run test --coverage

      - name: Check coverage threshold
        run: |
          cd src/frontend
          bun run test --coverage --reporter=json > coverage.json
          COVERAGE=$(jq '.coverageMap.total.statements.pct' coverage.json)
          if (( $(echo "$COVERAGE < 90" | bc -l) )); then
            echo "Coverage $COVERAGE% is below 90% threshold"
            exit 1
          fi

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v4
        with:
          files: ./src/frontend/coverage/lcov.info
          flags: frontend
          name: frontend-coverage

  e2e-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2

      - name: Install dependencies
        run: cd src/frontend && bun install

      - name: Install Playwright
        run: cd src/frontend && bunx playwright install --with-deps

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Install Tauri dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y libgtk-3-dev libwebkit2gtk-4.1-dev libappindicator3-dev librsvg2-dev patchelf

      - name: Run E2E tests
        run: cd src/frontend && bun run test:e2e

      - name: Upload test results
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: src/frontend/playwright-report/
```

**.github/workflows/build.yml:**

```yaml
name: Build

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    strategy:
      matrix:
        platform: [ubuntu-latest, macos-latest, windows-latest]
    runs-on: ${{ matrix.platform }}

    steps:
      - uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Install dependencies (Ubuntu)
        if: matrix.platform == 'ubuntu-latest'
        run: |
          sudo apt-get update
          sudo apt-get install -y libgtk-3-dev libwebkit2gtk-4.1-dev libappindicator3-dev librsvg2-dev patchelf

      - name: Install frontend dependencies
        run: cd src/frontend && bun install

      - name: Build Tauri app
        run: cd src/frontend && bun run tauri build

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: app-${{ matrix.platform }}
          path: |
            src/frontend/src-tauri/target/release/bundle/
```

**.github/workflows/release.yml:**

```yaml
name: Release

on:
  push:
    tags:
      - "v*"

jobs:
  release:
    strategy:
      matrix:
        platform: [ubuntu-latest, macos-latest, windows-latest]
    runs-on: ${{ matrix.platform }}

    steps:
      - uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Install dependencies (Ubuntu)
        if: matrix.platform == 'ubuntu-latest'
        run: |
          sudo apt-get update
          sudo apt-get install -y libgtk-3-dev libwebkit2gtk-4.1-dev libappindicator3-dev librsvg2-dev patchelf

      - name: Install frontend dependencies
        run: cd src/frontend && bun install

      - name: Build Tauri app
        run: cd src/frontend && bun run tauri build

      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          files: |
            src/frontend/src-tauri/target/release/bundle/**/*
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### Step 18: Update package.json Scripts

**src/frontend/package.json (add scripts):**

```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "tauri": "tauri",
    "test": "vitest",
    "test:e2e": "playwright test",
    "test:coverage": "vitest --coverage",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "format": "prettier --write \"src/**/*.{ts,tsx,json,css}\"",
    "format:check": "prettier --check \"src/**/*.{ts,tsx,json,css}\"",
    "typecheck": "tsc --noEmit"
  }
}
```

## Todo List

### Backend Tests

- [ ] Add pytest-httpx, mypy, pyright to dev dependencies
- [ ] Configure coverage thresholds (90%) in pyproject.toml
- [ ] Create `tests/backend/conftest.py` with fixtures
- [ ] Write `test_api_usage.py` comprehensive tests
- [ ] Write `test_models.py` Pydantic tests
- [ ] Write `test_credentials.py` tests
- [ ] Write `test_sidecar.py` tests
- [ ] Write `test_app.py` TUI app tests
- [ ] Write `test_widgets.py` TUI widget tests (with color testing)
- [ ] Write `test_reminder.py` scheduler tests
- [ ] Write `test_notifier.py` system notification tests
- [ ] Run `uv run pytest --cov` and verify >= 90% coverage

### Frontend Tests

- [ ] Add Vitest, Playwright, testing-library to dependencies
- [ ] Configure coverage thresholds (90%) in vitest.config.ts
- [ ] Create `tests/frontend/setup.ts` with Tauri mocks
- [ ] Write `use-countdown.test.ts` comprehensive hook tests
- [ ] Write `use-usage.test.ts` hook tests with refresh
- [ ] Write `dashboard.test.tsx` component tests
- [ ] Write `theme-switcher.test.tsx` component tests
- [ ] Write `theme-store.test.ts` Zustand store tests
- [ ] Setup Playwright config for E2E tests
- [ ] Write `dashboard.spec.ts` E2E tests
- [ ] Write `notifications.spec.ts` E2E tests
- [ ] Write `theme-switcher.spec.ts` E2E tests
- [ ] Run `bun run test --coverage` and verify >= 90% coverage
- [ ] Run `bun run test:e2e` and verify all E2E tests pass

### Pre-commit & CI/CD

- [ ] Create `.pre-commit-config.yaml` with ruff, prettier, mypy, pyright
- [ ] Install pre-commit hooks: `uv run pre-commit install`
- [ ] Test pre-commit hooks work on commit
- [ ] Create `.github/workflows/test.yml` with coverage enforcement
- [ ] Create `.github/workflows/build.yml` for cross-platform builds
- [ ] Create `.github/workflows/release.yml` for tag-based releases
- [ ] Add coverage badge to README
- [ ] Test CI pipeline on push
- [ ] Test release workflow on tag

## Success Criteria

- All backend tests pass: `uv run pytest`
- All frontend tests pass: `bun run test`
- All E2E tests pass: `bun run test:e2e`
- **Backend coverage >= 90%** (enforced in CI)
- **Frontend coverage >= 90%** (enforced in CI)
- Pre-commit hooks run successfully
- GitHub Actions CI passes (lint + format + type + test)
- Cross-platform builds succeed (Linux, macOS, Windows)
- Release workflow publishes artifacts on tag

## Risk Assessment

| Risk                          | Mitigation                                       |
| ----------------------------- | ------------------------------------------------ |
| Textual tests require display | Use `textual-dev` for headless testing           |
| Tauri APIs hard to mock       | Mock at module level in setup.ts                 |
| Async test timing issues      | Use `pytest-asyncio`, `vi.useFakeTimers()`       |
| 90% coverage hard to achieve  | Focus on business logic, exclude generated code  |
| E2E tests flaky on CI         | Use Playwright retry logic, longer timeouts      |
| Cross-platform build failures | Test locally with Docker, GitHub matrix strategy |
| Pre-commit hooks slow         | Run heavy checks (tests) only on pre-push        |
| Type checking conflicts       | Configure mypy + pyright with shared settings    |

## Security Considerations

- No real credentials in test fixtures
- Mock all external API calls
- Test files not included in production bundle
- Coverage reports exclude sensitive paths
- Pre-commit prevents committing secrets
- CI environment variables secured
- Release artifacts signed (Tauri config)

## Next Steps

After completing testing phase:

1. Deploy to GitHub and validate CI pipeline
2. Fix any remaining coverage gaps
3. Document test patterns in `docs/02-general/testing-guide.md`
4. Proceed to Phase 6: Documentation & Release
</file>

<file path="docs/01-plans/260117-024834-claudiminder-implementation/plan.md">
---
title: "Claudiminder Full Implementation"
description: "Complete TUI + GUI implementation with Textual, Tauri v2, themes, reminders"
status: pending
priority: P1
effort: 30h
branch: main
tags: [textual, tauri, react, tui, gui, themes, reminders, nuitka, i18n]
created: 2026-01-17
updated: 2026-01-17
---

# Claudiminder Implementation Plan

## Overview

Complete implementation of Claude usage tracking tool with dual interfaces:

- **TUI**: Textual-based terminal dashboard (simple ANSI colors)
- **GUI**: Tauri v2 + React desktop app (6 themes, customizable UI)
- **macOS**: Menu bar app + Touch Bar support

## Requirements

- [Requirements Summary](./requirements-summary.md) - 48 interview questions answered

## Research Reports

- [Tauri v2 Features](../reports/researcher-260117-024702-tauri-v2-features.md)
- [Python TUI Libraries](../reports/researcher-260117-024702-python-tui-libraries.md)
- [UI Themes Design](../reports/researcher-260117-024115-ui-themes-design.md)

## Phases

| Phase | Title                                          | Status  | Effort | Description                                  |
| ----- | ---------------------------------------------- | ------- | ------ | -------------------------------------------- |
| 1     | [Backend Core](./phase-01-backend-core.md)     | pending | 6h     | TUI, scheduler, focus mode, goals, i18n      |
| 2     | [Tauri Scaffold](./phase-02-tauri-scaffold.md) | pending | 4h     | Tauri v2 + React + macOS menu bar            |
| 3     | [Frontend UI](./phase-03-frontend-ui.md)       | pending | 8h     | Customizable UI, 6 themes, drag-drop         |
| 4     | [Integration](./phase-04-integration.md)       | pending | 6h     | Nuitka sidecar, cert pinning, notifications  |
| 5     | [Testing](./phase-05-testing.md)               | pending | 6h     | 90% coverage, Playwright E2E, mypy + pyright |

## Key Dependencies

- Python 3.12+, uv, Textual 1.0+, Nuitka
- Rust, Cargo, Tauri v2
- Bun, React 18+, TypeScript, Playwright

## Architecture

```
src/
├── backend/          # Python (existing + TUI)
│   ├── api/          # Usage API client
│   ├── models/       # Pydantic models
│   ├── utils/        # Credentials
│   ├── tui/          # NEW: Textual TUI
│   ├── scheduler/    # NEW: Reminder scheduler
│   └── cli.py        # Entry point
└── frontend/         # NEW: Tauri + React
    ├── src/          # React app
    └── src-tauri/    # Rust backend
```

## Success Criteria

- [ ] TUI displays usage % + reset time in real-time (simple ANSI)
- [ ] GUI shows all metrics with 6 themes + customizable layout
- [ ] System tray: configurable icon style, full tooltip, complete menu
- [ ] Reminders: all presets + custom shell/URL + snooze support
- [ ] Focus mode: DND when high usage + scheduled quiet hours
- [ ] Goals: daily budget + pace indicator
- [ ] i18n: English + Vietnamese
- [ ] macOS: menu bar app + Touch Bar support
- [ ] Single instance enforcement
- [ ] Offline mode UI when no network
- [ ] 90%+ test coverage, E2E with Playwright
- [ ] Cross-platform: Linux, Windows, macOS
</file>

<file path="docs/01-plans/260117-024834-claudiminder-implementation/requirements-summary.md">
# Requirements Summary (from Interview)

**Date:** 2026-01-17 | **Questions:** 48

---

## Core Functionality

| Aspect           | Decision                            |
| ---------------- | ----------------------------------- |
| Primary mode     | Equal priority (TUI + GUI)          |
| Polling strategy | Hybrid (60s auto + manual refresh)  |
| Token expired    | Notification + button to open login |
| Run mode         | Optional startup (user setting)     |

## Reminder System

| Aspect             | Decision                                                       |
| ------------------ | -------------------------------------------------------------- |
| Preset strategies  | All: before reset (15/30/60m), on reset, percentage thresholds |
| Custom action      | Shell command OR URL                                           |
| Notification style | All: system native + in-app toast + TUI bell                   |
| Snooze             | Yes, with 5/15/30 min options                                  |

## UI/UX Themes

| Aspect        | Decision                                      |
| ------------- | --------------------------------------------- |
| Default theme | Neon Dark                                     |
| Custom colors | Layered: preset → accent → full customization |
| TUI style     | Simple terminal (ANSI colors)                 |
| Window size   | Resizable                                     |

## System Tray

| Aspect     | Decision                                     |
| ---------- | -------------------------------------------- |
| Icon style | Configurable: number + progress + color      |
| Tooltip    | Full details (usage %, reset time, requests) |
| Menu       | Full: Show, Refresh, Settings, About, Quit   |
| Animation  | Pulse on notification (cross-platform safe)  |

## Configuration

| Aspect        | Decision                |
| ------------- | ----------------------- |
| Format        | TOML                    |
| Location      | ~/.config/claudiminder/ |
| Export/Import | No                      |
| Usage history | No                      |

## Build & Deployment

| Aspect       | Decision                                      |
| ------------ | --------------------------------------------- |
| Python build | Nuitka compiled                               |
| Distribution | GitHub Releases only                          |
| CI/CD        | Full pipeline (test + build + sign + publish) |
| Code signing | Later decision                                |

## Error Handling

| Aspect          | Decision                      |
| --------------- | ----------------------------- |
| Log level       | User configurable             |
| Log output      | Stdout + file                 |
| Error recovery  | Retry → toast → degraded mode |
| Crash reporting | No telemetry                  |

## Keyboard & Accessibility

| Aspect        | Decision                        |
| ------------- | ------------------------------- |
| Global hotkey | User customizable               |
| TUI shortcuts | Basic (q/r/h)                   |
| Accessibility | Basic a11y (ARIA, keyboard nav) |
| Font size     | Slider (80%-150%)               |

## API & Integration

| Aspect          | Decision                                       |
| --------------- | ---------------------------------------------- |
| Local API       | None                                           |
| Credentials     | Claude file only (~/.claude/.credentials.json) |
| CLI integration | None (standalone)                              |

## Testing & Quality

| Aspect          | Decision                           |
| --------------- | ---------------------------------- |
| Coverage target | 90%+ comprehensive                 |
| E2E testing     | Full suite (Playwright)            |
| Pre-commit      | Full checks (lint + format + type) |
| Type checking   | Both mypy + pyright                |

## Documentation

| Aspect     | Decision       |
| ---------- | -------------- |
| Level      | Full docs site |
| Changelog  | None           |
| Versioning | SemVer         |
| License    | MIT            |

## Security

| Aspect         | Decision                             |
| -------------- | ------------------------------------ |
| Token handling | Read Claude's file directly          |
| Network        | HTTPS + cert pinning + proxy support |
| Auto-update    | Check only (notify new version)      |

## Edge Cases

| Aspect         | Decision                              |
| -------------- | ------------------------------------- |
| No network     | Offline mode UI                       |
| API down       | Status check + backoff + cached data  |
| Multi-instance | Single instance only                  |
| Rate limit     | All strategies (reduce + wait + warn) |

## Special Features

| Aspect     | Decision                              |
| ---------- | ------------------------------------- |
| Extra info | All metrics (5h, 7d, extra usage)     |
| Focus mode | DND when high + scheduled quiet hours |
| Goals      | Daily budget + pace indicator         |
| Languages  | English + Vietnamese                  |

## UI Components

| Aspect           | Decision                                 |
| ---------------- | ---------------------------------------- |
| Progress bar     | User choice (linear/circular/gauge)      |
| Countdown        | Both formats (HH:MM:SS + human readable) |
| Dashboard layout | User customizable (drag-drop)            |
| Settings UI      | Tabs in main window                      |

## Platform-Specific

| Platform | Features                         |
| -------- | -------------------------------- |
| macOS    | Menu bar app + Touch Bar support |
| Windows  | Standard app                     |
| Linux    | Standard app                     |

## Development

| Aspect          | Decision           |
| --------------- | ------------------ |
| Repo structure  | Mono-repo          |
| Branch strategy | main only          |
| PR review       | No review required |

## Performance

| Aspect  | Target       |
| ------- | ------------ |
| Memory  | < 200MB      |
| Startup | < 5s         |
| Battery | Not priority |
| Bundle  | < 100MB      |

## Release

| Aspect    | Decision                    |
| --------- | --------------------------- |
| MVP scope | Full features               |
| Timeline  | No deadline (quality first) |

---

## Key Changes from Original Plan

1. **Nuitka instead of PyInstaller** - Requires C compiler, faster binary
2. **90%+ test coverage** - High quality bar
3. **Full E2E suite** - Playwright for GUI testing
4. **Both mypy + pyright** - Strict type checking
5. **User customizable UI** - Drag-drop dashboard, configurable progress bar
6. **Focus mode + Goals** - Additional features not in original plan
7. **macOS menu bar + Touch Bar** - Platform-specific features
8. **En + Vi localization** - i18n required
9. **Full docs site** - Not just README

---

## Effort Re-estimation

| Phase          | Original | Updated | Reason                         |
| -------------- | -------- | ------- | ------------------------------ |
| 1. Backend     | 4h       | 6h      | + Focus mode, goals, i18n      |
| 2. Tauri       | 3h       | 4h      | + macOS menu bar               |
| 3. Frontend    | 5h       | 8h      | + Customizable UI, more themes |
| 4. Integration | 5h       | 6h      | + Nuitka build, cert pinning   |
| 5. Testing     | 3h       | 6h      | 90% coverage + E2E             |
| **Total**      | **20h**  | **30h** | +50% scope                     |
</file>

<file path="docs/01-plans/reports/researcher-260117-024115-ui-themes-design.md">
# Research Report: Desktop App UI/UX Design Patterns

**Research Date:** 2026-01-17
**Topics:** Glassmorphism, Neon Themes, Light/Dark Mode, System Tray Icons, Dashboard Widgets

## Executive Summary

Modern desktop apps prioritize glassmorphism + dark mode for aesthetic depth, neon accents for status indicators, and compact widgets for real-time updates. Tauri supports all patterns via CSS + system tray APIs. Use `backdrop-filter: blur()` for glass effects, `text-shadow` layering for neon glow, `prefers-color-scheme` for system detection, and SVG icons for tray percentage indicators.

## Key Findings

### 1. Glassmorphism Implementation

**Core CSS Pattern:**

```css
.glass {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-radius: 16px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
}
```

**Key Parameters:**

- Blur range: 8px–15px (8px = subtle, 15px = heavy diffusion)
- Background opacity: 0.05–0.3 for white; 0.1–0.2 for colored backgrounds
- Border: 1px solid with 0.2 opacity white creates frosted frame
- Shadow: Soft 8px blur + 32px spread for depth

**Browser Support:** Chrome 76+, Safari 9+, Firefox 103+. Always use `-webkit-` prefix for Safari compatibility.

**Accessibility:** Maintain 4.5:1 contrast for normal text. Increase opacity to 0.3–0.4 or add text-shadow if needed.

### 2. Neon Theme Design

**Glow Effect (Text):**

```css
.neon-text {
  color: #00e5ff;
  text-shadow:
    0 0 8px #00e5ff,
    0 0 12px #00e5ff,
    0 0 20px #ff00ff,
    0 0 40px #ff00ff;
  font-weight: bold;
}
```

**Glow Effect (Box):**

```css
.neon-box {
  background: rgba(5, 8, 26, 1);
  border: 2px solid #00e5ff;
  box-shadow:
    0 0 10px #00e5ff,
    inset 0 0 10px rgba(0, 229, 255, 0.1);
}
```

**Recommended Palettes:**

- **Cyberpunk:** Cyan (#00e5ff) + Magenta (#ff00ff) + Neon Green (#00ff85) on Navy (#05081a)
- **Hacker:** Pure Green (#39ff14) + Cyan (#00e5ff) on Black
- **Vaporwave:** Hot Pink (#ff0054) + Cyan (#00e5ff) + Purple (#b100ff) on Deep Navy

**Best Practice:** Neon on dark backgrounds only. Avoid neon-on-neon combinations; use high-contrast pairings.

### 3. Light/Dark Mode Implementation

**CSS Media Query Approach:**

```css
:root {
  color-scheme: light dark;
}

@media (prefers-color-scheme: light) {
  :root {
    --bg-primary: #ffffff;
    --text-primary: #1a1a1a;
  }
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg-primary: #1a1a1a;
    --text-primary: #ffffff;
  }
}

body {
  background-color: var(--bg-primary);
  color: var(--text-primary);
  transition:
    background-color 0.3s ease,
    color 0.3s ease;
}

@media (prefers-reduced-motion: reduce) {
  * {
    transition: none !important;
  }
}
```

**Modern `light-dark()` Function:**

```css
body {
  background: light-dark(#fff, #1a1a1a);
  color: light-dark(#000, #fff);
}
```

**System Detection:** Browser auto-detects OS preferences. Override via localStorage for manual toggle (three-state: system/light/dark).

### 4. System Tray Icon Design

**Dynamic Percentage Icon (SVG Approach):**

```javascript
// Generate SVG tray icon with percentage fill
function generateTrayIcon(percentage) {
  const radius = 45;
  const circumference = 2 * Math.PI * radius;
  const strokeDashoffset = circumference - (percentage / 100) * circumference;

  const svg = `
    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <circle cx="50" cy="50" r="${radius}" fill="none" stroke="#333" stroke-width="4"/>
      <circle cx="50" cy="50" r="${radius}" fill="none" stroke="#00e5ff"
              stroke-width="4" stroke-dasharray="${circumference}"
              stroke-dashoffset="${strokeDashoffset}"
              stroke-linecap="round" transform="rotate(-90 50 50)"/>
      <text x="50" y="58" text-anchor="middle" font-size="24" font-weight="bold" fill="#00e5ff">
        ${percentage}%
      </text>
    </svg>
  `;
  return svg;
}
```

**Icon States:**

- 0–33%: Green (#39ff14)
- 34–66%: Yellow (#ffff00)
- 67–99%: Orange (#ff8800)
- 100%: Red (#ff0000) with warning indicator

**Tauri Integration:** Use `tray::TrayIconBuilder` to update icon dynamically via `set_icon()` API.

**Dark/Light Adaptability:** Export icons in both color schemes. Detect system theme and switch accordingly.

### 5. Compact Dashboard Widget (Usage Percentage + Reset Time)

**HTML Structure:**

```html
<div class="dashboard-widget glass">
  <div class="header">
    <h3>Claude Usage</h3>
    <span class="reset-time">Resets in 4h 23m</span>
  </div>
  <div class="usage-bar">
    <div class="fill" style="width: 72%"></div>
    <span class="percentage">72%</span>
  </div>
  <div class="stats">
    <div class="stat">
      <span class="label">Requests:</span>
      <span class="value">720/1000</span>
    </div>
    <div class="stat">
      <span class="label">Tokens:</span>
      <span class="value">2.4M/5M</span>
    </div>
  </div>
</div>
```

**CSS Styling (Compact + Glass Effect):**

```css
.dashboard-widget {
  width: 280px;
  padding: 16px;
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(10px);
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  font-family: system-ui, sans-serif;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.header h3 {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
}

.reset-time {
  font-size: 12px;
  opacity: 0.7;
}

.usage-bar {
  position: relative;
  height: 20px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 8px;
}

.usage-bar .fill {
  height: 100%;
  background: linear-gradient(90deg, #00e5ff, #ff00ff);
  transition: width 0.3s ease;
}

.usage-bar .percentage {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 11px;
  font-weight: bold;
  color: white;
  text-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
}

.stats {
  display: flex;
  flex-direction: column;
  gap: 6px;
  font-size: 12px;
}

.stat {
  display: flex;
  justify-content: space-between;
}

.stat .label {
  opacity: 0.7;
}
.stat .value {
  font-weight: 600;
  color: #00e5ff;
}
```

**Responsive:** Fixed 280px width fits standard tray dock. Stack stats vertically for small screens.

## Design Recommendations

1. **Glass + Dark Mode:** Default combo reduces eye strain, provides modern aesthetic
2. **Neon Accents:** Use only for status indicators (active/warning/error), not primary UI
3. **SVG Tray Icons:** Scalable, theme-aware, support smooth percentage animations
4. **One Metric Per Widget:** Dashboard shows usage % + reset time only; drill-down for details
5. **Tauri Compatibility:** All patterns work with Tauri's CSS + system tray APIs

## Code References

- [Glassmorphism Generator](https://css.glass/)
- [Neon Color Tools](https://www.terrific.tools/color/neon-color-generator/)
- [prefers-color-scheme MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme)
- [Tauri System Tray Docs](https://v2.tauri.app/learn/system-tray/)
- [Microsoft Widget Design](https://learn.microsoft.com/en-us/windows/apps/design/widgets/)

## Unresolved Questions

- Tauri support for animated tray icon updates (need to verify frame rate limits)
- Performance impact of continuous SVG re-rendering for tray icon percentage changes
- Dark mode auto-detection behavior on Linux (GNOME vs KDE vs others)
</file>

<file path="docs/01-plans/reports/researcher-260117-024702-python-tui-libraries.md">
# Python TUI Libraries Research Report

**Date:** 2026-01-17 | **Project:** claudiminder | **Scope:** TUI framework selection

---

## Executive Summary

**Recommendation: Textual** - Superior for real-time dashboards with async workers, reactive updates, and 60 FPS performance. Rich alone is insufficient for interactive applications but works well as rendering layer within Textual.

---

## Library Comparison

| Feature                   | Textual                            | Rich                       |
| ------------------------- | ---------------------------------- | -------------------------- |
| **Type**                  | Full TUI Framework                 | Formatting Library         |
| **Async Support**         | ✅ Native asyncio, workers         | ✅ Limited (Live context)  |
| **Real-time Updates**     | ✅ set_interval, workers, reactive | ✅ Live display (blocking) |
| **Widget System**         | ✅ Full (60+ widgets)              | ✗ Renderables only         |
| **Performance**           | ✅ 120 FPS (segment trees)         | ✅ Good for static content |
| **Learning Curve**        | Medium (React-like patterns)       | Shallow (library-oriented) |
| **Desktop Notifications** | Via third-party libs               | Via third-party libs       |
| **Code Snippets**         | 1,799 (Context7)                   | 1,609 (Context7)           |
| **Benchmark Score**       | 87.1                               | 89.8                       |

---

## Key Findings

### 1. Real-time Usage Display Widget

**Textual Pattern** - Most suitable for your use case:

```python
from textual.reactive import reactive
from textual.widgets import Static

class UsageWidget(Static):
    percentage = reactive(0.0)

    def watch_percentage(self, value: float) -> None:
        """Auto-update display when percentage changes"""
        bar = "█" * int(value // 5) + "░" * (20 - int(value // 5))
        self.update(f"[cyan]{bar}[/] {value:.1f}%")

    def on_mount(self) -> None:
        self.set_interval(1/60, self.update_from_api)  # 60 FPS refresh

    async def update_from_api(self) -> None:
        # Called 60 times/sec - throttle API calls in worker
        pass
```

### 2. Timer/Countdown Display

**Textual TimeDisplay Widget Pattern:**

```python
class ResetCountdown(Static):
    elapsed = reactive(0.0)

    def on_mount(self) -> None:
        self.update_timer = self.set_interval(1/60, self.update_elapsed)

    def watch_elapsed(self, value: float) -> None:
        remaining = 18000 - value  # 5 hours in seconds
        mins, secs = divmod(int(remaining), 60)
        hours = mins // 60
        self.update(f"[yellow]Reset: {hours:02d}:{mins%60:02d}:{secs:02d}[/]")
```

### 3. Async Integration with httpx

**Workers Pattern for Non-Blocking API Calls:**

```python
@work(exclusive=True, thread=False)
async def fetch_usage_periodic(self) -> None:
    """Background worker - runs without blocking UI"""
    async with httpx.AsyncClient() as client:
        while True:
            try:
                response = await client.get("...")
                self.app.post_message(UsageUpdated(response.json()))
                await asyncio.sleep(5)  # Poll interval
            except Exception as e:
                self.app.notify(f"Error: {e}", severity="error")
```

### 4. Notifications

**Multi-layer Approach:**

| Type                | Implementation           | Code                                       |
| ------------------- | ------------------------ | ------------------------------------------ |
| **Terminal Bell**   | Direct ASCII             | `print("\a")` or `sys.stdout.write("\a")`  |
| **Textual Notify**  | Built-in toast           | `self.notify("Usage updated!", timeout=3)` |
| **Desktop (Linux)** | desktop-notifier         | `await notify("Title", "Body")`            |
| **Desktop (macOS)** | osascript via subprocess | See desktop-notifier library               |

**Best Library:** `desktop-notifier` - async-first, cross-platform, works with Textual workers.

---

## Architecture Recommendation

**Layered Design:**

1. **Textual** - App framework, widgets, event loop
2. **Rich** - Renderables for custom widgets (progress bars, spinners)
3. **httpx** - Async HTTP client for API calls
4. **desktop-notifier** - Cross-platform notifications (optional, non-critical path)

**Why this stack?**

- Textual's `set_interval()` at 60 FPS enables smooth real-time displays
- Reactive attributes auto-trigger watchers, reducing boilerplate
- Workers run background tasks without blocking the 60 FPS render loop
- Rich renderables embedded in Static widgets for complex visuals
- httpx AsyncClient integrates seamlessly with Textual's asyncio event loop

---

## Performance Metrics (2025 Benchmarks)

- **Textual rendering:** 5-10x faster than curses
- **FPS capability:** 60+ FPS for interactive dashboards, 120 FPS for segment trees (delta rendering)
- **Virtual scrolling:** ListView for 1000+ rows without performance degradation
- **Async scheduling:** set_interval() creates microsecond-precision timers

---

## Quick Implementation Checklist

- [ ] Use Textual `Static` widget for usage display
- [ ] Implement reactive attributes with watchers for auto-updates
- [ ] Use `@work` decorator for async httpx polling (non-blocking)
- [ ] Set `set_interval(1/60, update_method)` for 60 FPS refresh
- [ ] Embed Rich Progress bars in Static widgets
- [ ] Add `self.notify()` for terminal notifications
- [ ] Optional: Add desktop-notifier for system notifications

---

## Sources

- [Textual Documentation - Widgets](https://textual.textualize.io/guide/widgets/)
- [Textual Documentation - Workers](https://textual.textualize.io/guide/workers/)
- [Rich Documentation - Progress Bars](https://github.com/textualize/rich/blob/master/docs/source/progress.rst)
- [Textual - Real-Time Updates](https://johal.in/textual-tui-widgets-python-rich-terminal-user-interfaces-apps-2025/)
- [desktop-notifier Library](https://github.com/samschott/desktop-notifier)
- [Real Python - Textual Tutorial](https://realpython.com/python-textual/)

---

## Unresolved Questions

None - Research fully addresses all requirements.
</file>

<file path="docs/01-plans/reports/researcher-260117-024702-tauri-v2-features.md">
# Tauri v2 Research Report: Features & Best Practices

**Date**: 2026-01-17 | **Project**: claudiminder

---

## 1. Project Setup: React + TypeScript + Bun

**Command**:

```bash
bun create tauri-app
# Follow prompts: React → TypeScript
# Then initialize:
cd src
bun tauri init
```

**Dev Workflow**:

```bash
bun install
bun run tauri dev  # Hot-reload both React & Rust
```

**Key Points**:

- `create-tauri-app` supports Bun as package manager (v2 native)
- Config answers: dev server `http://localhost:5173`, frontendCmd `bun run dev`
- Project structure in `docs/02-general/rules/02-tauri.md` already covers this

---

## 2. System Tray API

**Setup Pattern** (Rust):

```rust
use tauri::tray::{TrayIconBuilder, TrayIconEvent, MouseButton, MouseButtonState};
use tauri::menu::{MenuBuilder, MenuItemBuilder};

fn setup_tray(app: &tauri::App) -> Result<()> {
    let quit = MenuItemBuilder::with_id("quit", "Quit").build(app)?;
    let menu = MenuBuilder::new(app).items(&[&quit]).build()?;

    TrayIconBuilder::new()
        .menu(&menu)
        .tooltip("claudiminder: [X.X%]")  // Dynamic via frontend events
        .on_tray_icon_event(|tray, event| {
            if let TrayIconEvent::Click {
                button: MouseButton::Left,
                button_state: MouseButtonState::Up,
                ..
            } = event {
                if let Some(window) = tray.app_handle().get_webview_window("main") {
                    let _ = window.unminimize();
                    let _ = window.show();
                    let _ = window.set_focus();
                }
            }
        })
        .build(app)?;
    Ok(())
}
```

**Dynamic Updates** (Frontend):

```typescript
import { TrayIcon } from "@tauri-apps/api/tray";

// Update tooltip on usage change
await trayIcon.setTooltip(`Claude: ${utilization.toFixed(1)}%`);
await trayIcon.setIcon("icons/tray-" + Math.floor(utilization / 10) + "0.png");
```

**Supported Events**: Click, DoubleClick, Enter, Move, Leave

---

## 3. Python Sidecar Integration

**Config** (`tauri.conf.json`):

```json
{
  "bundle": {
    "externalBin": ["binaries/claudiminder-backend"]
  }
}
```

**Rust Execution** (bidirectional):

```rust
use tauri_plugin_shell::ShellExt;
use tauri_plugin_shell::process::CommandEvent;

#[tauri::command]
async fn call_backend(app: tauri::AppHandle, action: String) -> Result<String, String> {
    let (mut rx, mut child) = app
        .shell()
        .sidecar("claudiminder-backend")
        .map_err(|e| e.to_string())?
        .arg(&action)
        .spawn()
        .map_err(|e| e.to_string())?;

    let mut output = String::new();
    while let Some(event) = rx.recv().await {
        if let CommandEvent::Stdout(line) = event {
            output.push_str(&String::from_utf8_lossy(&line));
        }
    }
    Ok(output)
}
```

**Frontend Call**:

```typescript
const result = await invoke<string>("call_backend", { action: "get_usage" });
```

---

## 4. Window Management: Hide/Show/Minimize

**Hide to Tray Pattern**:

```typescript
import { getCurrentWindow } from "@tauri-apps/api/window";

const window = getCurrentWindow();
await window.hide(); // Hide to tray
await window.show(); // Restore
await window.unminimize(); // Restore from minimize
await window.set_focus(); // Focus window
```

**Tray Interaction** (already in pattern above) handles show/focus on left-click

---

## 5. Native Notifications

**Setup**:

```bash
bun add @tauri-apps/plugin-notification
```

**Rust**:

```rust
fn main() {
    tauri::Builder::default()
        .plugin(tauri_plugin_notification::init())
        .setup(|app| {
            if app.notification().permission_state()? == PermissionState::Unknown {
                app.notification().request_permission()?;
            }
            Ok(())
        })
}
```

**TypeScript**:

```typescript
import {
  isPermissionGranted,
  requestPermission,
  sendNotification,
} from "@tauri-apps/plugin-notification";

async function notifyReset() {
  let granted = await isPermissionGranted();
  if (!granted) {
    const permission = await requestPermission();
    granted = permission === "granted";
  }
  if (granted) {
    sendNotification({
      title: "Claude Token Reset",
      body: "Your 5-hour window has reset!",
    });
  }
}
```

---

## 6. Recommended Implementation Order for claudiminder

1. **Setup**: Use `create-tauri-app` with React + TypeScript + Bun
2. **Tray**: Implement `TrayIconBuilder` with tooltip updates via event emissions
3. **Window**: Hide/show with tray integration
4. **Notifications**: Plugin setup + permission handling
5. **Sidecar**: Python backend execution + JSON response parsing
6. **IPC Commands**: Thin Rust commands delegating to modules (already in rules)

---

## 7. Key Gotchas & Patterns

| Issue                  | Solution                                              |
| ---------------------- | ----------------------------------------------------- |
| Tray tooltip updates   | Use frontend `emit` → Rust listens → updates tray     |
| Sidecar exit codes     | Always check `status.success()` before parsing stdout |
| Permission requests    | Call once at startup, cache result                    |
| Window hide on startup | Use `tauri.conf.json` `visible: false`                |
| Icon scaling macOS     | Use `.icns` (1024x1024), set `iconAsTemplate: true`   |

---

## 8. Capabilities Configuration

Minimal for claudiminder (`capabilities/default.json`):

```json
{
  "permissions": [
    "core:default",
    "shell:allow-execute",
    "shell:allow-sidecar",
    "notification:default"
  ]
}
```

---

## References

- [Tauri v2 Create Project](https://v2.tauri.app/start/create-project/)
- [System Tray Documentation](https://v2.tauri.app/learn/system-tray)
- [Python Sidecar Guide](https://github.com/tauri-apps/tauri-docs/blob/v2/src/content/docs/develop/sidecar.mdx)
- [Notification Plugin](https://v2.tauri.app/plugin/notification)

---

## Unresolved Questions

None. All research areas covered. Ready for implementation planning.
</file>

<file path="docs/02-general/rules/00-principles.md">
# Core Principles

SCOPE: All code in this project
TOOLS: All

---

## YAGNI - You Aren't Gonna Need It

- Only implement features that are currently needed
- Don't add code "just in case"
- Remove dead code immediately
- Avoid premature abstraction

## KISS - Keep It Simple, Stupid

- Prefer simple solutions over clever ones
- Readable code > short code
- Avoid over-engineering
- One responsibility per function/class

## DRY - Don't Repeat Yourself

- Extract common patterns into reusable functions
- Use configuration over hardcoding
- Single source of truth for constants
- But don't over-abstract for minor duplication

---

## Code Quality Standards

1. **Type Safety**: Full type hints, no `Any` without justification
2. **Error Handling**: Explicit error types, no silent failures
3. **Testing**: Unit tests for business logic, integration tests for APIs
4. **Documentation**: Self-documenting code, comments for "why" not "what"

---

## File Organization

- Keep files under 200 lines
- One module = one responsibility
- Use descriptive kebab-case filenames
- Group by feature, not by type

---

## Security

- Never commit secrets
- Use SecretStr for sensitive config
- Validate all external input
- Log securely (no PII, tokens)
</file>

<file path="docs/02-general/rules/01-python.md">
# Python Rules

SCOPE: `src/backend/**/*.py`, `tests/backend/**/*.py`
TOOLS: Python 3.12+, uv, ruff, mypy

---

## Configuration

ALWAYS:

- Use `pydantic-settings` BaseSettings
- Use `env_nested_delimiter="__"` for nested
- Use `Field(description="...")` for all fields
- Use `SecretStr` for passwords/tokens
- Use singleton pattern: `get_settings()`

NEVER:

- `os.environ.get()` directly
- Hardcoded configuration values
- Mutable default values in Field()

PATTERN:

```python
from pydantic import Field
from pydantic_settings import BaseSettings, SettingsConfigDict

class AppSettings(BaseSettings):
    """Main application settings with nested sub-settings."""

    environment: str = Field(default="development", description="Environment")
    debug: bool = Field(default=False, description="Debug mode")

    model_config = SettingsConfigDict(
        env_file=".env",
        env_nested_delimiter="__",
        case_sensitive=False,
        extra="ignore",
    )
```

---

## Type Hints (Python 3.12+)

ALWAYS:

- Type all function parameters
- Type all return values (even None)
- Use `X | None` not `Optional[X]`
- Use `dict[K, V]` not `Dict[K, V]`
- Use `list[X]` not `List[X]`
- Use `from __future__ import annotations` for forward references

NEVER:

- Bare `Any` without comment
- `from typing import Optional, List, Dict`
- Old-style `Union[X, Y]` (use `X | Y`)

---

## Generics (PEP 695 - Python 3.12+)

ALWAYS:

- Use new syntax `class Foo[T]:` instead of `Generic[T]`
- Use new syntax `def foo[T](x: T) -> T:`
- Use bounded generics: `class Foo[T: BaseClass]:`

NEVER:

- `TypeVar("T")` declarations
- `from typing import Generic`

---

## Async/Await (Python 3.12+)

ALWAYS:

- Async for all I/O operations
- `asyncio.to_thread()` for blocking I/O in async context
- `httpx.AsyncClient` over `requests`
- `asynccontextmanager` for resource management

NEVER:

- `time.sleep()` in async (use `asyncio.sleep()`)
- `asyncio.get_event_loop()` (deprecated)
- Block event loop with sync I/O

---

## HTTP Client (httpx + tenacity)

ALWAYS:

- Use `httpx.AsyncClient` with connection pooling
- Use `tenacity` for retries with exponential backoff
- Set reasonable timeouts
- Handle rate limits gracefully

PATTERN:

```python
import httpx
from tenacity import retry, stop_after_attempt, wait_exponential

@retry(stop=stop_after_attempt(3), wait=wait_exponential(min=1, max=10))
async def fetch_usage(client: httpx.AsyncClient, token: str) -> dict:
    response = await client.get(
        "https://api.anthropic.com/api/oauth/usage",
        headers={"Authorization": f"Bearer {token}"},
        timeout=10.0,
    )
    response.raise_for_status()
    return response.json()
```

---

## Logging (loguru)

ALWAYS:

- Use `loguru` instead of stdlib logging
- Configure structured JSON logging for production
- Include context (user_id, request_id) via `bind()`
- Use appropriate log levels

PATTERN:

```python
from loguru import logger

logger.add("logs/app.log", rotation="10 MB", retention="7 days")

def process_request(request_id: str) -> None:
    log = logger.bind(request_id=request_id)
    log.info("Processing request")
```

---

## Pydantic Models (v2)

ALWAYS:

- Use `StrEnum` for JSON-safe enums
- Use `ConfigDict(use_enum_values=True)`
- Use `default_factory` for mutable defaults
- Include `description` in Field() for ALL fields
- Use `SecretStr` for sensitive data

PATTERN:

```python
from pydantic import BaseModel, ConfigDict, Field, SecretStr

class Credentials(BaseModel):
    model_config = ConfigDict(use_enum_values=True)

    access_token: SecretStr = Field(..., description="OAuth access token")
    expires_at: int | None = Field(None, description="Token expiration timestamp")
```

---

## Naming

```
Classes:      PascalCase       UsageTracker
Functions:    snake_case       fetch_usage()
Constants:    UPPER_SNAKE      CACHE_DURATION_MS
Private:      _underscore      _internal_method()
Modules:      kebab-case       usage-tracker.py
```
</file>

<file path="docs/02-general/rules/02-tauri.md">
# Tauri v2 Rules

SCOPE: `src/frontend/src-tauri/**/*.rs`, `src/frontend/src/**/*.{ts,tsx}`
TOOLS: Tauri v2, Rust, TypeScript, React

---

## Project Structure

```
src/frontend/
├── src/                    # React frontend
│   ├── components/         # UI components
│   ├── hooks/              # Custom React hooks
│   ├── stores/             # State management
│   ├── styles/             # CSS/theme files
│   ├── types/              # TypeScript types
│   └── utils/              # Utility functions
├── src-tauri/              # Rust backend
│   ├── src/
│   │   ├── main.rs         # Entry point
│   │   ├── lib.rs          # Library exports
│   │   ├── commands/       # IPC commands
│   │   ├── tray/           # System tray logic
│   │   └── sidecar/        # Python sidecar integration
│   ├── Cargo.toml
│   ├── tauri.conf.json
│   └── capabilities/       # Permission capabilities
└── package.json
```

---

## Tauri Commands (IPC)

ALWAYS:

- Use `#[tauri::command]` for frontend-callable functions
- Return `Result<T, String>` for error handling
- Keep commands thin - delegate to modules
- Use `tauri::State` for shared state

PATTERN:

```rust
#[tauri::command]
async fn get_usage(
    app: tauri::AppHandle,
    state: tauri::State<'_, AppState>,
) -> Result<UsageResponse, String> {
    state.usage_tracker.get_current()
        .await
        .map_err(|e| e.to_string())
}
```

---

## System Tray (v2)

ALWAYS:

- Use `TrayIconBuilder` for creating tray
- Handle both left-click and right-click events
- Update icon dynamically based on usage percentage
- Use `on_tray_icon_event` for mouse events

PATTERN:

```rust
use tauri::tray::{TrayIconBuilder, TrayIconEvent, MouseButton, MouseButtonState};
use tauri::menu::{Menu, MenuItem};

fn setup_tray(app: &tauri::App) -> Result<(), Box<dyn std::error::Error>> {
    let quit = MenuItem::with_id(app, "quit", "Quit", true, None::<&str>)?;
    let menu = Menu::with_items(app, &[&quit])?;

    TrayIconBuilder::new()
        .icon(app.default_window_icon().unwrap().clone())
        .menu(&menu)
        .tooltip("claudiminder")
        .on_menu_event(|app, event| {
            if event.id().as_ref() == "quit" {
                app.exit(0);
            }
        })
        .on_tray_icon_event(|tray, event| {
            if let TrayIconEvent::Click {
                button: MouseButton::Left,
                button_state: MouseButtonState::Up,
                ..
            } = event
            {
                if let Some(window) = tray.app_handle().get_webview_window("main") {
                    let _ = window.show();
                    let _ = window.set_focus();
                }
            }
        })
        .build(app)?;

    Ok(())
}
```

---

## Python Sidecar

ALWAYS:

- Configure sidecar in `tauri.conf.json` under `bundle.externalBin`
- Use `tauri_plugin_shell::ShellExt` for execution
- Handle stdout/stderr asynchronously
- Parse JSON responses from Python

PATTERN:

```rust
use tauri_plugin_shell::ShellExt;

#[tauri::command]
async fn call_backend(app: tauri::AppHandle, action: String) -> Result<String, String> {
    let output = app
        .shell()
        .sidecar("claudiminder-backend")
        .map_err(|e| e.to_string())?
        .arg(&action)
        .output()
        .await
        .map_err(|e| e.to_string())?;

    if output.status.success() {
        Ok(String::from_utf8_lossy(&output.stdout).to_string())
    } else {
        Err(String::from_utf8_lossy(&output.stderr).to_string())
    }
}
```

---

## Frontend (React + TypeScript)

ALWAYS:

- Use `@tauri-apps/api` for IPC calls
- Use `invoke` for command calls
- Handle errors gracefully with try/catch
- Use TypeScript strict mode

PATTERN:

```typescript
import { invoke } from "@tauri-apps/api/core";

interface UsageResponse {
  utilization: number;
  resets_at: string;
}

async function fetchUsage(): Promise<UsageResponse> {
  return await invoke<UsageResponse>("get_usage");
}
```

---

## Capabilities & Permissions

ALWAYS:

- Define minimal permissions in `capabilities/`
- Use capability files for sidecar permissions
- Never grant unnecessary file system access

PATTERN (`capabilities/default.json`):

```json
{
  "$schema": "../gen/schemas/desktop-schema.json",
  "identifier": "default",
  "description": "Default capabilities for claudiminder",
  "windows": ["main"],
  "permissions": ["core:default", "shell:allow-execute", "shell:allow-sidecar"]
}
```

---

## Configuration (`tauri.conf.json`)

KEY SETTINGS:

```json
{
  "productName": "claudiminder",
  "identifier": "com.claudiminder.app",
  "bundle": {
    "active": true,
    "targets": "all",
    "externalBin": ["binaries/claudiminder-backend"],
    "icon": ["icons/icon.png"]
  },
  "app": {
    "trayIcon": {
      "iconPath": "icons/tray.png",
      "iconAsTemplate": true
    }
  }
}
```

---

## Themes & Styling

SUPPORTED THEMES:

1. Light / Dark (standard)
2. Neon Light / Neon Dark (vibrant)
3. Glassmorphism Light / Dark (frosted glass effect)

ALWAYS:

- Use CSS custom properties for theming
- Support system preference detection
- Persist user preference in config
- Use smooth transitions between themes

---

## Error Handling

ALWAYS:

- Rust: Return `Result<T, String>` from commands
- TypeScript: Use try/catch with typed errors
- Show user-friendly error messages in UI
- Log technical details for debugging

NEVER:

- Panic in production code
- Swallow errors silently
- Expose internal error details to users
</file>

<file path="docs/02-general/rules/README.md">
# Development Rules

This directory contains development rules and coding standards for claudiminder.

## Files

| File               | Scope                 | Description                        |
| ------------------ | --------------------- | ---------------------------------- |
| `00-principles.md` | All code              | Core principles (YAGNI, KISS, DRY) |
| `01-python.md`     | `src/backend/**/*.py` | Python coding standards            |
| `02-tauri.md`      | `src/frontend/**/*`   | Tauri v2 & frontend rules          |

## How to Use

1. Read all rules before starting development
2. Follow the patterns in each rule file
3. When in doubt, refer back to these documents

## Quick Reference

### Python (Backend)

- Python 3.12+ with type hints
- Use `pydantic-settings` for config
- Use `httpx` + `tenacity` for HTTP
- Use `loguru` for logging

### Tauri (Frontend)

- Tauri v2 with React + TypeScript
- Use system tray for background mode
- Python sidecar for backend logic
- Minimal Rust commands, delegate to sidecar
</file>

<file path="tests/backend/__init__.py">
"""Backend tests for claudiminder."""
</file>

<file path="tests/backend/test_usage.py">
"""Tests for usage API client."""

from __future__ import annotations

import pytest

from src.claudiminder.models.usage import FiveHourUsage, UsageResponse


class TestUsageModels:
    """Tests for usage models."""

    def test_five_hour_usage_valid(self) -> None:
        """Test valid FiveHourUsage model."""
        usage = FiveHourUsage(
            utilization=0.75,
            resets_at="2026-01-17T10:00:00Z",
        )
        assert usage.utilization == 0.75
        assert usage.resets_at == "2026-01-17T10:00:00Z"

    def test_usage_response_with_five_hour(self) -> None:
        """Test UsageResponse with five_hour data."""
        response = UsageResponse(
            five_hour=FiveHourUsage(
                utilization=0.5,
                resets_at="2026-01-17T10:00:00Z",
            ),
        )
        assert response.five_hour is not None
        assert response.five_hour.utilization == 0.5

    def test_usage_response_empty(self) -> None:
        """Test UsageResponse with no data."""
        response = UsageResponse()
        assert response.five_hour is None
        assert response.extra_usage is None
</file>

<file path="tests/__init__.py">
"""Tests for claudiminder."""
</file>

<file path=".gitignore">
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# Virtual environments
.venv/
venv/
ENV/
env/

# Testing
.tox/
.nox/
.coverage
.coverage.*
htmlcov/
.pytest_cache/
.hypothesis/

# Type checking
.mypy_cache/
.dmypy.json
dmypy.json

# IDEs
.idea/
.vscode/
*.swp
*.swo
*~

# Rust/Cargo
target/
Cargo.lock
**/*.rs.bk

# Node/Bun
node_modules/
.bun/
bun.lockb

# Tauri
src/frontend/src-tauri/target/
src/frontend/dist/

# Environment
.env
.env.local
.env.*.local

# Logs
logs/
*.log

# OS
.DS_Store
Thumbs.db

# Project specific
*.credentials.json
</file>

<file path="CLAUDE.md">
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**Claudeminder** - Claude usage tracking & reminder tool with TUI/GUI support for Linux, Windows, and macOS.

### Core Features

- Usage tracking via Anthropic OAuth API (auto-grab from `~/.claude/.credentials.json`)
- 5-hour window reset time display & reminder
- Preset reminder strategies (before reset, on reset, custom intervals)
- System tray icon with usage percentage + hover for reset time
- Auto-open Claude login when token expired
- TUI mode for terminal usage
- GUI mode via Tauri v2

### Tech Stack

- **Backend**: Python 3.12+ (loguru, pydantic-settings, httpx, tenacity)
- **Frontend**: TypeScript + React + Tauri v2
- **Build**: uv (Python), Cargo (Rust), bun (frontend)

## Role & Responsibilities

Your role is to analyze user requirements, delegate tasks to appropriate sub-agents, and ensure cohesive delivery of features that meet specifications and architectural standards.

## Workflows

- Primary workflow: `$HOME/.claude/rules/primary-workflow.md`
- Development rules: `$HOME/.claude/rules/development-rules.md`
- Orchestration protocols: `$HOME/.claude/rules/orchestration-protocol.md`
- Documentation management: `$HOME/.claude/rules/documentation-management.md`
- Project-specific rules: `./docs/02-general/rules/`

**IMPORTANT:** Analyze the skills catalog and activate the skills that are needed for the task during the process.
**IMPORTANT:** You must follow strictly the development rules in `$HOME/.claude/rules/development-rules.md` file.
**IMPORTANT:** Before you plan or proceed any implementation, always read the `./README.md` and `./docs/02-general/rules` files first to get context.

## Project Structure

```
claudiminder/
├── src/
│   ├── backend/           # Python backend (sidecar)
│   │   ├── core/          # Core business logic
│   │   ├── api/           # API client for Anthropic
│   │   ├── models/        # Pydantic models
│   │   └── utils/         # Utilities (credentials, logging)
│   └── frontend/          # Tauri + React frontend
│       ├── src/
│       │   ├── components/
│       │   ├── hooks/
│       │   ├── stores/
│       │   ├── styles/
│       │   ├── types/
│       │   └── utils/
│       └── src-tauri/     # Rust backend for Tauri
├── tests/
│   ├── backend/
│   └── frontend/
├── docs/
│   ├── 01-plans/          # Implementation plans
│   └── 02-general/        # Project docs & rules
└── scripts/               # Build & utility scripts
```

## Key Commands

```bash
# Backend (Python)
uv sync                    # Install dependencies
uv run python -m claudiminder.cli  # Run TUI
uv run pytest              # Run tests

# Frontend (Tauri)
cd src/frontend
bun install                # Install dependencies
bun run tauri dev          # Dev mode
bun run tauri build        # Production build
```

## Hook Response Protocol

### Privacy Block Hook (`@@PRIVACY_PROMPT@@`)

When a tool call is blocked by the privacy-block hook, the output contains a JSON marker between `@@PRIVACY_PROMPT_START@@` and `@@PRIVACY_PROMPT_END@@`. **You MUST use the `AskUserQuestion` tool** to get proper user approval.

## Python Scripts (Skills)

When running Python scripts from `$HOME/.claude/skills/`, use the venv Python interpreter:

- **Linux/macOS:** `$HOME/.claude/skills/.venv/bin/python3 scripts/xxx.py`
- **Windows:** `$HOME\.claude\skills\.venv\Scripts\python.exe scripts\xxx.py`

## [IMPORTANT] Consider Modularization

- If a code file exceeds 200 lines of code, consider modularizing it
- Check existing modules before creating new
- Use kebab-case naming with descriptive names
- After modularization, continue with main task

## Documentation Management

We keep all important docs in `./docs/02-general` folder:

```
./docs/02-general
├── project-overview-pdr.md
├── code-standards.md
├── codebase-summary.md
├── design-guidelines.md
├── system-architecture.md
├── project-roadmap.md
└── rules/
    ├── 00-principles.md
    ├── 01-python.md
    └── 02-tauri.md
```

**IMPORTANT:** _MUST READ_ and _MUST COMPLY_ all _INSTRUCTIONS_ in this file and `./docs/02-general/rules/`.
</file>

<file path="pyproject.toml">
[project]
name = "claudiminder"
version = "0.1.0"
description = "Claudeminder - Claude usage tracking & reminder tool with TUI/GUI support"
readme = "README.md"
requires-python = ">=3.12"
license = { text = "MIT" }
authors = [{ name = "hieubt" }]
keywords = ["claude", "anthropic", "usage", "tracker", "reminder", "tui", "gui"]

dependencies = [
    "httpx>=0.28.0",
    "loguru>=0.7.3",
    "pydantic>=2.10.0",
    "pydantic-settings>=2.7.0",
    "tenacity>=9.0.0",
    "rich>=13.9.0",
    "textual>=1.0.0",
    "browser-cookie3>=0.19.1",
    "typer>=0.15.0",
    "desktop-notifier>=5.0.0",
    "tomli>=2.0.0",
    "tomli-w>=1.0.0",
    "filelock>=3.16.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=8.3.0",
    "pytest-asyncio>=0.25.0",
    "pytest-cov>=6.0.0",
    "pytest-httpx>=0.35.0",
    "ruff>=0.8.0",
    "mypy>=1.14.0",
    "pyright>=1.1.0",
    "pre-commit>=4.0.0",
]

[project.scripts]
claudiminder = "claudiminder.cli:main"
claudiminder-sidecar = "claudiminder.sidecar:main"

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.hatch.build.targets.wheel]
packages = ["src/claudiminder"]

[tool.ruff]
target-version = "py312"
line-length = 100
src = ["src/claudiminder", "tests"]

[tool.ruff.lint]
select = [
    "E",      # pycodestyle errors
    "W",      # pycodestyle warnings
    "F",      # Pyflakes
    "I",      # isort
    "B",      # flake8-bugbear
    "C4",     # flake8-comprehensions
    "UP",     # pyupgrade
    "ARG",    # flake8-unused-arguments
    "SIM",    # flake8-simplify
]
ignore = ["E501"]  # line too long (handled by formatter)

[tool.ruff.lint.isort]
known-first-party = ["claudiminder"]

[tool.mypy]
python_version = "3.12"
strict = true
warn_return_any = true
warn_unused_ignores = true
disallow_untyped_defs = true
plugins = ["pydantic.mypy"]

[tool.pytest.ini_options]
testpaths = ["tests"]
pythonpath = ["src"]
asyncio_mode = "auto"
addopts = "-v --cov=src/claudiminder --cov-report=term-missing --cov-fail-under=90"
</file>

<file path="README.md">
# Claudeminder

Claude usage tracking & reminder tool with TUI/GUI support for Linux, Windows, and macOS.

## Features

- 📊 Real-time usage tracking via Anthropic OAuth API
- ⏰ 5-hour window reset time display & reminders
- 🔔 Preset reminder strategies (before reset, on reset, custom intervals)
- 🖥️ System tray icon with usage percentage + hover for reset time
- 🔐 Auto-open Claude login when token expired
- 💻 TUI mode for terminal usage
- 🎨 GUI mode via Tauri v2 with multiple themes

## Tech Stack

- **Backend**: Python 3.12+ (loguru, pydantic-settings, httpx, tenacity)
- **Frontend**: TypeScript + React + Tauri v2
- **Build**: uv (Python), Cargo (Rust), bun (frontend)

## Quick Start

### Prerequisites

- Python 3.12+
- uv (Python package manager)
- Rust + Cargo
- Bun (for frontend)

### Installation

```bash
# Clone the repository
git clone https://github.com/yourusername/claudiminder.git
cd claudiminder

# Install Python dependencies
uv sync

# Run TUI
uv run claudiminder status
```

### GUI Mode (Tauri)

```bash
cd src/frontend
bun install
bun run tauri dev
```

## Usage

### CLI Commands

```bash
# Show usage status
claudiminder status

# Show as JSON
claudiminder status --json

# Launch TUI
claudiminder tui

# Show version
claudiminder version
```

## Configuration

Configuration is stored in `~/.config/claudiminder/config.toml`.

OAuth credentials are automatically grabbed from `~/.claude/.credentials.json`.

## Themes

- Light / Dark (standard)
- Neon Light / Neon Dark (vibrant)
- Glassmorphism Light / Dark (frosted glass effect)

## Development

### Testing

```bash
# Run backend tests
uv run pytest tests/backend

# Run frontend tests
cd src/frontend && bun run test

# Run with coverage
uv run pytest tests/backend --cov=src/claudiminder
```

### Building

```bash
# Build Tauri app (Linux)
cd src/frontend && bun run tauri build

# Build Python package
uv build
```

### Pre-commit Hooks

```bash
# Install pre-commit hooks
uv run pre-commit install

# Run hooks manually
uv run pre-commit run --all-files
```

## CI/CD

- **Test workflow**: Runs on push/PR to main/master
- **Build workflow**: Cross-platform builds (Linux, macOS, Windows)
- **Release workflow**: Automatic releases on version tags (v*)

## License

MIT
</file>

</files>
